@model Homer_MVC.IcebergModel.Cotizacion

@{
    ViewBag.Title = "Cotización";
    ViewBag.Icono = "fa fa-usd";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section Styles {
    @Styles.Render("~/bundles/select2/css")
    <link href="~/Vendor/datatables.net-bs/css/dataTables.bootstrap.min.css" rel="stylesheet" />
    <link href="~/Vendor/sweetalert/lib/sweet-alert.css" rel="stylesheet" />
    <link href="~/Vendor/bootstrap-toggle-master/css/bootstrap-toggle.min.css" rel="stylesheet" />
    <link href="~/Vendor/eonasdan-bootstrap-datetimepicker/build/css/bootstrap-datetimepicker.min.css" rel="stylesheet" />
    <link href="~/Vendor/BootstrapMultiselect/multiselect.css" rel="stylesheet" />
    <link href="~/Vendor/toastr/toastr.css" rel="stylesheet" />
    <link href="~/Vendor/toastr/toastr.min.css" rel="stylesheet" />

}

<style type="text/css">
    .align-right {
        text-align: right;
    }

    .align-center {
        text-align: center;
    }
</style>

<div class="panel-body">
    <div class="panel-heading" style="background-color:white;  border:solid 1px; border-color:#e4e5e7">
        <div class="panel-body">

            <div id="hbreadcrumb" class="pull-right">

                <button type="button" class="btn btn-mini btn-default" style="border-radius:25px" data-container="body" data-toggle="popover" data-placement="left" data-title="Enlaces" data-content="<ul>@ViewBag.nombreEnlaces</ul>" data-html="true">
                    <i class="text-info fa fa-tags"></i>
                </button>
                <button type="button" class="btn btn-mini btn-default" style="border-radius:25px" data-container="body" data-toggle="popover" data-placement="left" data-title="Documentos" data-content="<ul></i><a href=''>Documento 1</a></ul>  <ul></i><a href=''>Documento 2</a></ul> <ul></i><a href=''>Documento 3</a></ul>" data-html="true">
                    <i class="text-primary fa fa-files-o"></i>
                </button>
                <button type="button" class="btn btn-mini btn-default" style="border-radius:25px" data-container="body" data-toggle="popover" data-placement="left" data-title="Favoritos" data-content="@ViewBag.Favoritos" data-html="true">
                    <i class="text-warning fa fa-star"></i>
                </button>

            </div>
            <h3 class="font-light m-b-xs">
                <i class="text-info @ViewBag.Icono"></i>&nbsp;&nbsp;@ViewBag.Title
            </h3>
            <small>Registro @ViewBag.Title</small>
        </div>
    </div>
</div>

<div class="panel-body" style="padding-top:0px;">
    <div class="hpanel">
        @if (TempData["mensaje_correcto"] != null)
        {
            <div class="alert alert-success  alert-dismissible" id="alertaCorrecta">
                <button type="button" class="close" data-dismiss="alert" arial-label="close"><span aria-hidden="true">&times;</span></button>
                <p>@TempData["mensaje_correcto"]</p>
            </div>
        }

        @if (TempData["mensaje_error"] != null)
        {
            <div class="alert alert-danger  alert-dismissible">
                <button type="button" class="close" data-dismiss="alert" arial-label="close"><span aria-hidden="true">&times;</span></button>
                <p>@Html.Raw(@TempData["mensaje_error"])</p>
            </div>
        }
        @if (TempData["mensaje_obligatorios"] != null)
        {
            <div class="alert alert-danger  alert-dismissible">
                <button type="button" class="close" data-dismiss="alert" arial-label="close"><span aria-hidden="true">&times;</span></button>
                <p>@Html.Raw(@TempData["mensaje_obligatorios"])</p>
            </div>
        }

        <div id="tabs" class="tab-content">

            <div class="m float-e-margins text-right">
                <div class="tooltip-demo">
                    <div id="div-mensaje"></div>
                </div>
            </div>

            <ul id="tabs-crear" class="nav nav-tabs">
                <li class="active">
                    <a data-toggle="tab" href="#tercero"><i class="@ViewBag.Icono"></i>&nbsp;&nbsp;@ViewBag.Title</a>
                </li>
                <li class="" onclick="buscarAjaxCotizaciones();">
                    <a data-toggle="tab" href="#buscar"><i class="fa fa-search"></i>&nbsp;&nbsp;Búsquedas</a>
                </li>
                @*<li class="" style="display:none"><a data-toggle="tab" href="#"><i class="fa fa-search"></i>&nbsp;&nbsp;Ver</a></li>*@
            </ul>

            <div id="tercero" class="tab-pane active">
                <div class="panel-body">

                    @using (Html.BeginForm("Create", "cotizacion", FormMethod.Post))
                    {
                        @Html.AntiForgeryToken()
                        @Html.Hidden("menu")
                        @Html.Hidden("rolLog")
                        @Html.HiddenFor(x => x.tercero_id);
                        @Html.HiddenFor(x => x.cotizacion_id)

                        <div class="form-horizontal">

                            @Html.ValidationSummary(true, "", new { @class = "text-danger" })

                            <div class="hpanel">
                                <div class="panel-heading hbuilt" style="background-color:#e4e5e7">
                                    <div class="panel-tools">
                                        <a class="showhide"><i class="fa fa-chevron-up"></i></a>
                                    </div>
                                    <i class="@ViewBag.Icono"></i>&nbsp;&nbsp;&nbsp;Información general
                                </div>
                                <div class="panel-body">

                                    <div class="col-sm-12" id="divNumCotizacion" style="display: none">
                                        <div class="form-group">
                                            <div class="col-md-12 text-center">
                                                <h4>
                                                    <span class="label label-info text-right">Número Cotización</span>&nbsp;&nbsp;&nbsp;
                                                    <label id="numCotizacion"></label>
                                                </h4>
                                            </div>
                                            <div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Tipo Documento:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                @Html.DropDownListFor(model => model.tpdoc_id, ViewBag.tpdoc_id.Items as List<SelectListItem>, "", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione", @required = "required", @onkeypress = "return soloNumeros(event)" })
                                                @Html.ValidationMessageFor(model => model.tpdoc_id, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Documento:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-4">
                                                @Html.EditorFor(model => model.doc_tercero, new { htmlAttributes = new { @class = "form-control", @type = "text", @placeholder = "Ingrese Documento", @required = "required", @onkeypress = "return soloNumeros(event)", @autocomplete = "off" } })
                                                @Html.ValidationMessageFor(model => model.doc_tercero, "", new { @class = "text-danger" })
                                                <label class="text-danger" style="display:none;" id="labelDocumentoNoExiste"><picture id="alertaDocumentoBuscado"></picture></label>
                                                <label id="mns_clienteNoExiste" style="display: none; text-align:left" class="control-label col-md-12 text-warning"></label>
                                            </div>
                                            <div class="col-md-2">
                                                @Html.EditorFor(model => model.digito_verificacion, new { htmlAttributes = new { @class = "form-control divRazonSocial", @type = "text", @placeholder = "D.V", @onkeypress = "return soloNumeros(event)", @autocomplete = "off" } })
                                                @Html.ValidationMessageFor(model => model.digito_verificacion, "", new { @class = "text-danger" })
                                            </div>
                                            <div class="col-md-2">
                                                <button type="button" class="btn btn-primary" id="btnBuscarDocumento"><i class="fa fa-search" aria-hidden="true"></i></button>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6 camposNombreYApellido">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Primer Nombre:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                @Html.EditorFor(model => model.prinom_tercero, new { htmlAttributes = new { @class = "form-control", @type = "text", @placeholder = "Ingrese Primer nombre", @onkeypress = "return soloLetras(event)" } })
                                                @Html.ValidationMessageFor(model => model.prinom_tercero, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6 camposNombreYApellido">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Segundo Nombre:&nbsp;<span class="text-danger"></span></label>
                                            <div class="col-md-6">
                                                @Html.EditorFor(model => model.segnom_tercero, new { htmlAttributes = new { @class = "form-control", @type = "text", @placeholder = "Ingrese Segundo nombre",/*@required = "required",*/ @onkeypress = "return soloLetras(event)" } })
                                                @Html.ValidationMessageFor(model => model.segnom_tercero, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6 camposNombreYApellido">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Primer Apellido:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                @Html.EditorFor(model => model.apellido_tercero, new { htmlAttributes = new { @class = "form-control", @type = "text", @placeholder = "Ingrese Primer Apellido", @onkeypress = "return soloLetras(event)" } })
                                                @Html.ValidationMessageFor(model => model.apellido_tercero, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-6 camposNombreYApellido">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Segundo Apellidos:&nbsp;<span class="text-danger"></span></label>
                                            <div class="col-md-6">
                                                @Html.EditorFor(model => model.segapellido_tercero, new { htmlAttributes = new { @class = "form-control", @type = "text", @placeholder = "Ingrese Segundo Apellido", @onkeypress = "return soloLetras(event)" } })
                                                @Html.ValidationMessageFor(model => model.segapellido_tercero, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6 divRazonSocial" style="display:none;">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Razon Social:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                @Html.EditorFor(model => model.razon_social, new { htmlAttributes = new { @class = "form-control", @type = "text", @placeholder = "Ingrese Razon Social" } })
                                                @Html.ValidationMessageFor(model => model.razon_social, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>


                                    <div class="col-sm-6 camposNombreYApellido">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Genero:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                @Html.DropDownListFor(model => model.gentercero_id, ViewBag.gentercero_id.Items as List<SelectListItem>, "", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione", /*@required = "required"*/ })
                                                @Html.ValidationMessageFor(model => model.gentercero_id, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6 camposNombreYApellido">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Ocupación:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                @Html.DropDownListFor(model => model.ocupacion, ViewBag.ocupacion.Items as List<SelectListItem>, "", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione", @name = "ocupacion", /*@required = "required"*/ })
                                                @Html.ValidationMessageFor(model => model.ocupacion, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Correo:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                @Html.EditorFor(model => model.correo, new { htmlAttributes = new { @class = "form-control", @placeholder = "Ingrese Correo", @required = "required", } })
                                                @Html.ValidationMessageFor(model => model.correo, "", new { @class = "text-danger" })
                                                <label id="correoNoValido" class="text-danger" style="display:none;">Digite un correo valido</label>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Telefono:</label>
                                            <div class="col-md-6">
                                                @Html.EditorFor(model => model.telefono_tercero, new { htmlAttributes = new { @class = "form-control", @placeholder = "Ingrese Telefono", @onkeypress = "return soloNumeros(event)" } })
                                                @Html.ValidationMessageFor(model => model.telefono_tercero, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Celular:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                @Html.EditorFor(model => model.celular_tercero, new { htmlAttributes = new { @class = "form-control", @placeholder = "Ingrese Celular", /*@required = "required",*/ @onkeypress = "return soloNumeros(event)" } })
                                                @Html.ValidationMessageFor(model => model.celular_tercero, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-md-12">
                                        <div class="col-sm-2 text-right">
                                            <label class="control-label">Direcci&oacute;n:&nbsp;<span class="text-danger"></span></label>
                                        </div>

                                        <div class="col-sm-10">
                                            <div class="form-group">
                                                <div class="col-md-2">
                                                    <select name="tp_via" id="tp_via" class="form-control js-source-states" placeholder="Via" onclick="CompletarDireccion();">
                                                        <option value=""></option>
                                                        <option value="AUTOP">Autopista</option>
                                                        <option value="AV">Avenida</option>
                                                        <option value="AC">Av Calle</option>
                                                        <option value="AK">Av Carrera</option>
                                                        <option value="CL">Calle</option>
                                                        <option value="KR">Carrera</option>
                                                        <option value="CCV">Circunvalar</option>
                                                        <option value="Dg">Diagonal</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-1">
                                                    <input name="num_via" id="num_via" class="form-control" value="" placeholder="" onkeyup="CompletarDireccion();" />
                                                </div>
                                                <div class="col-md-2">
                                                    <select name="sector_via" id="sector_via" class="form-control js-source-states" placeholder="sector" onclick="CompletarDireccion();">
                                                        <option value=""></option>
                                                        <option value="ESTE">Este</option>
                                                        <option value="NORTE">Norte</option>
                                                        <option value="OESTE">Oeste</option>
                                                        <option value="SUR">Sur</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-1">
                                                    <center>#</center>
                                                </div>
                                                <div class="col-md-1">
                                                    <input name="num_via_generadora" id="num_via_generadora" class="form-control" value="" placeholder="" onkeyup="CompletarDireccion();" />
                                                </div>
                                                @*<div class="col-md-1">
                                                        <center>-</center>
                                                    </div>*@
                                                <div class="col-md-2">
                                                    <input name="num_placa" id="num_placa" class="form-control" value="" placeholder="" onkeyup="CompletarDireccion();" onkeypress="return soloNumeros(event)" />
                                                </div>
                                                <div class="col-md-2">
                                                    <select name="sector_via_generadora" id="sector_via_generadora" class="form-control js-source-states" placeholder="Via" onclick="CompletarDireccion();">
                                                        <option value=""></option>
                                                        <option value="ESTE">Este</option>
                                                        <option value="NORTE">Norte</option>
                                                        <option value="OESTE">Oeste</option>
                                                        <option value="SUR">Sur</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>

                                    </div>

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Otro<span class="text-danger"></span></label>
                                            <div class="col-md-6">
                                                <input name="otros" id="otros" class="form-control" value="" placeholder="Apto, interior, oficina, etc..." onkeyup="CompletarDireccion();" />
                                            </div>
                                        </div>
                                    </div>


                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Direcci&oacute;n Completa:<span class="text-danger">&nbsp;*</span></label>
                                            <div class="col-md-6">
                                                @Html.EditorFor(model => model.direc_tercero, new { htmlAttributes = new { @class = "form-control", @placeholder = "Ingrese Direccion", /*@required = "required"*/ } })
                                                @Html.ValidationMessageFor(model => model.direc_tercero, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Departamento:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                @Html.DropDownListFor(model => model.dpto_id, ViewBag.dpto_id.Items as List<SelectListItem>, "", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione", /*@required = "required"*/ })
                                                @Html.ValidationMessageFor(model => model.dpto_id, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Ciudad:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                @Html.DropDownListFor(model => model.ciu_id, ViewBag.ciu_id.Items as List<SelectListItem>, "", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione", /*@required = "required"*/ })
                                                @Html.ValidationMessageFor(model => model.ciu_id, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Fuente:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                @Html.DropDownListFor(model => model.tporigen_id, ViewBag.tporigen_id.Items as List<SelectListItem>, "", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione", /*@required = "required"*/ })
                                                @Html.ValidationMessageFor(model => model.tporigen_id, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6" style="display:none" id="areaSubfuente">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Sub-Fuente:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                @Html.DropDownListFor(model => model.subfuente_id, ViewBag.subfuente_id.Items as List<SelectListItem>, "", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione" })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6" style="display:none" id="sitioEvento">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Evento:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                @Html.DropDownListFor(model => model.eventoOrigen, Enumerable.Empty<SelectListItem>(), "", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione" })
                                                @Html.ValidationMessageFor(model => model.eventoOrigen, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Medio Comunicación:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                @Html.DropDownListFor(model => model.medcomun_id, ViewBag.medcomun_id.Items as List<SelectListItem>, "", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione", /*@required = "required"*/ })
                                                @Html.ValidationMessageFor(model => model.medcomun_id, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6" id="campoAsesorAsignado">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Asesor:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                @Html.DropDownListFor(model => model.asesorAsignado, new SelectList(ViewBag.asesorAsignado, "Value", "Text"), "", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione", /*@required = "required"*/ })
                                                @Html.ValidationMessageFor(model => model.asesorAsignado, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Enviar Correo:<span class="text-danger"></span></label>
                                            <div class="col-md-8">
                                                @Html.CheckBoxFor(model => model.envio_correo, new { @data_toggle = "toggle", @data_size = "mini" })
                                                @Html.ValidationMessageFor(model => model.envio_correo, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>

                            <div class="hpanel" id="panelHabeasData">
                                <div class="panel-heading hbuilt" style="background-color:#e4e5e7">
                                    <div class="panel-tools">
                                        <a class="showhide"><i class="fa fa-chevron-up"></i></a>

                                    </div>
                                    <i class="fa fa-key"></i>&nbsp;&nbsp;&nbsp;Información habeas data
                                </div>
                                <div class="panel-body">

                                    <div class="col-sm-3">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Correo:&nbsp;</label>
                                            <div class="col-md-8">
                                                @Html.CheckBoxFor(model => model.habdtautor_correo, new { @data_toggle = "toggle", @data_size = "mini" })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-3">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Celular:&nbsp;</label>
                                            <div class="col-md-8">
                                                @Html.CheckBoxFor(model => model.habdtautor_celular, new { @data_toggle = "toggle", @data_size = "mini" })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-3">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">SMS:&nbsp;</label>
                                            <div class="col-md-8">
                                                @Html.CheckBoxFor(model => model.habdtautor_msm, new { @data_toggle = "toggle", @data_size = "mini" })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-3">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Whatsapp:&nbsp;</label>
                                            <div class="col-md-8">
                                                @Html.CheckBoxFor(model => model.habdtautor_whatsapp, new { @data_toggle = "toggle", @data_size = "mini" })
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>

                            <div class="hpanel" id="interesado">
                                <div class="panel-heading hbuilt" style="background-color:#e4e5e7">
                                    <div class="panel-tools">
                                        <a class="showhide"><i class="fa fa-chevron-up"></i></a>
                                    </div>
                                    <i class="fa fa-car"></i>&nbsp;&nbsp;&nbsp;Vehículo interesado
                                </div>
                                <div class="panel-body">
                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Modelo vehículo:&nbsp;</label>
                                            <div class="col-md-6">
                                                <input type="text" name="vhInteresado" id="vhInteresado" class="form-control" value="" readonly />
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>

                            @*Alertas del lado del cliente*@
                            <div class="col-sm-12" style="display:none" id="camposVaciosProspecto">
                                <div class="form-group">
                                    <div class="row">
                                        <div class="alert alert-warning">
                                            <strong>Alerta!</strong> Los campos marcados con (*) son obligatorios.
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-sm-12" style="display:none" id="respuestaAlGuardarProspecto">
                                <div class="form-group">
                                    <div class="row">
                                        <div class="alert alert-info">
                                            <strong>
                                                Informaci&oacute;n!&nbsp;&nbsp;
                                                <p id="mensajeRespuesta"></p>
                                            </strong>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        <!--    <div class="hpanel" id="div_datoscotizacion">
                                <div class="panel-heading hbuilt" style="background-color:#e4e5e7">
                                    <div class="panel-tools">
                                        <a class="showhide"><i class="fa fa-chevron-up"></i></a>
                                    </div>
                                    <i class="fa fa-check-square" aria-hidden="true"></i> Datos Cotización
                                </div>

                                <div class="panel-body" id="vehiculo1">

                                    <div class="text-center m-b-md" id="wizardControl">
                                        <a class="btn btn-primary vehiculo" href="#vehiculo" data-toggle="tab">Vehículo</a>
                                        <a class="btn btn-default accesorios" href="#accesorios" data-toggle="tab">Accesorios</a>
                                        <a class="btn btn-default retomas" href="#retomas" data-toggle="tab">Retomas</a>
                                    </div>

                                    <div class="tab-content">

                                        <div id="vehiculo" class="p-m tab-pane active">
                                            <div class="row" id="vhcotizado">
                                                <div class="col-lg-3 text-center">
                                                    <i class="fa fa-car big-icon text-muted"></i>
                                                    <p class="small m-t-md">Registre los datos del vehículo</p>
                                                    <br />
                                                    <div class="vhcotizado" style="display: none">
                                                        <label>Tipo Vehículo:&nbsp;</label>
                                                        <h4 id="tipo_vh"></h4>
                                                    </div>
                                                </div>
                                                <div class="col-lg-9">

                                                    <div class="col-sm-6">
                                                        <div class="form-group">
                                                            <label class="control-label col-md-4">Tipo Vehículo:&nbsp;<span class="text-danger">*</span></label>
                                                            <div class="col-md-3">
                                                                <input type="radio" name="tipoVh" value="Nuevo" id="rbNuevo" checked="checked">&nbsp;&nbsp;Nuevo
                                                                <br>
                                                            </div>
                                                            <div class="col-md-3">
                                                                <input type="radio" name="tipoVh" value="Usado" id="rbUsado">&nbsp;&nbsp;Usado
                                                                <br>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="col-sm-6" @*id="campoMarca" style="visibility:hidden"*@>
                                                        <div class="form-group">
                                                            <label class="control-label col-md-4">Marca:&nbsp;<span class="text-danger">*</span></label>
                                                            <div class="col-md-6">
                                                                <select id="marcvh_id" name="marcvh_id" class="form-control js-source-states" placeholder="seleccione">
                                                                    <option value=""></option>
                                                                    @foreach (var item in ViewBag.marcvh_id)
                                                                    {
                                                                        <option value="@item.marcvh_id">@item.marcvh_nombre</option>
                                                                    }
                                                                </select>

                                                                @*@Html.DropDownListFor(model => model.marcvh_id, ViewBag.marcvh_id.Items as List<SelectListItem>, "", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione" })
                                                                    @Html.ValidationMessageFor(model => model.marcvh_id, "", new { @class = "text-danger" })*@
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="col-sm-6">
                                                        <div class="form-group">
                                                            <label class="control-label col-md-4">Modelo:&nbsp;<span class="text-danger">*</span></label>
                                                            <div class="col-md-6">
                                                                @Html.DropDownListFor(model => model.modvh_codigo, Enumerable.Empty<SelectListItem>(), "", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione" })
                                                                @Html.ValidationMessageFor(model => model.modvh_codigo, "", new { @class = "text-danger" })
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="col-sm-6">
                                                        <div class="form-group">
                                                            <label class="control-label col-md-4">A&ntilde;o:&nbsp;<span class="text-danger">*</span></label>
                                                            <div class="col-md-6">
                                                                @Html.DropDownListFor(model => model.anio, Enumerable.Empty<SelectListItem>(), "", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione" })
                                                                @*@Html.EditorFor(model => model.anio, new { htmlAttributes = new { @class = "form-control", @placeholder = "Ingrese Año" } })*@
                                                                @Html.ValidationMessageFor(model => model.anio, "", new { @class = "text-danger" })
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="col-sm-6">
                                                        <div class="form-group">
                                                            <label class="control-label col-md-4">Color:&nbsp;<span class="text-danger">*</span></label>
                                                            <div class="col-md-6">
                                                                @Html.DropDownListFor(model => model.colVh_id, ViewBag.colVh_id.Items as List<SelectListItem>, "", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione" })
                                                                @Html.ValidationMessageFor(model => model.colVh_id, "", new { @class = "text-danger" })
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="col-sm-6">
                                                        <div class="form-group">
                                                            <label class="control-label col-md-4">Valor:&nbsp;<span class="text-danger">*</span></label>
                                                            <div class="col-md-6">
                                                                @Html.EditorFor(model => model.valor, new { htmlAttributes = new { @class = "form-control", @placeholder = "Ingrese Valor", @onkeyUp = "return miles(this.id)" } })
                                                                @Html.ValidationMessageFor(model => model.valor, "", new { @class = "text-danger" })
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="col-sm-6">
                                                        <div class="form-group">
                                                            <label class="control-label col-md-4">Costo Poliza aproximado:<span class="text-danger"></span></label>
                                                            <div class="col-md-6">
                                                                @Html.EditorFor(model => model.costo_poliza, new { htmlAttributes = new { @class = "form-control", @placeholder = "Ingrese Costo", @onkeyUp = "return miles(this.id)" } })
                                                                @Html.ValidationMessageFor(model => model.costo_poliza, "", new { @class = "text-danger" })
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="col-sm-6">
                                                        <div class="form-group">
                                                            <label class="control-label col-md-4">Costo SOAT aproximado:<span class="text-danger"></span></label>
                                                            <div class="col-md-6">
                                                                <input type="text" name="soat" id="soat" class="form-control" onkeyup="return miles(this.id)" value="0" placeholder="Ingrese Costo SOAT" />
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="col-sm-6">
                                                        <div class="form-group">
                                                            <label class="control-label col-md-4">Matrícula aproximada:<span class="text-danger"></span></label>
                                                            <div class="col-md-6">
                                                                @Html.EditorFor(model => model.matricula, new { htmlAttributes = new { @class = "form-control", @placeholder = "Ingrese Matricula", @onkeyUp = "return miles(this.id)" } })
                                                                @Html.ValidationMessageFor(model => model.matricula, "", new { @class = "text-danger" })
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="col-sm-6">
                                                        <div class="form-group">
                                                            <label class="control-label col-md-4">Observaciones:<span class="text-danger"></span></label>
                                                            <div class="col-md-6">
                                                                @Html.TextAreaFor(m => m.observacion, new RouteValueDictionary(new { @class = "someClass", style = "width: 100%; height:80px;" }))
                                                                @Html.ValidationMessageFor(model => model.observacion, "", new { @class = "text-danger" })

                                                            </div>
                                                        </div>
                                                    </div>

                                                    <input type="hidden" id="lista_vehiculos" name="lista_vehiculos" value="@Model.listadovehiculos??0" />

                                                    <div class="col-sm-12">
                                                        <div class="form-group">

                                                            <div class="col-md-6 col-md-offset-2">
                                                                <input type="button" id="btnAgregarVehiculo" class="btn btn-info" value="Agregar" />
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="row" id="alertAgregarVehiculo" style="display:none">

                                                        @*Alertas del lado del cliente*@
                                                        <div class="col-sm-12">
                                                            <div class="form-group">
                                                                <div class="row">
                                                                    <div class="alert alert-info">
                                                                        <strong>
                                                                            Informaci&oacute;n!&nbsp;&nbsp;
                                                                            <p id="mensajeAgregarVehiculo"></p>
                                                                        </strong>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        @*Fin de las alertas del lado del cliente*@
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div id="accesorios" class="p-m tab-pane">
                                            <div class="row">
                                                <div class="col-lg-3 text-center">
                                                    <i class="fa fa-wrench big-icon text-muted"></i>
                                                    <p class="small m-t-md">Registrar los accesorios</p>
                                                    <br />
                                                    <input type="hidden" value="" name="lista_repuestos" id="lista_repuestos" />
                                                </div>
                                                <div class="col-lg-9" id="repuestos">

                                                </div>

                                                <div class="col-lg-9 col-lg-offset-3" id="alertAgregarAccesorio" style="display:none">
                                                    <div class="row">

                                                        @*Alertas del lado del cliente*@
                                                        <div class="col-sm-12">
                                                            <div class="form-group">
                                                                <div class="row">
                                                                    <div class="alert alert-info">
                                                                        <strong>
                                                                            Informaci&oacute;n!&nbsp;&nbsp;
                                                                            <p id="mensajeAgregarAccesorio"></p>
                                                                        </strong>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        @*Fin de las alertas del lado del cliente*@
                                                    </div>
                                                </div>


                                                @*<div class="col-lg-12">
                                                        <div class="table-responsive">
                                                            <div id="div-mensaje-buscar"></div>
                                                            <table class="table table-striped table-bordered table-hover" id="tablaRepuestos">
                                                                <thead>
                                                                    <tr>
                                                                        <th style="text-align:center">Accesorio</th>
                                                                        <th style="text-align:center">Valor</th>
                                                                        <th style="text-align:center">Obsequio</th>
                                                                        <th style="text-align:center">Acción</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody></tbody>
                                                            </table>
                                                        </div>
                                                    </div>*@
                                            </div>

                                        </div>

                                        <div id="retomas" class="p-m tab-pane">
                                            <div class="row">
                                                <div class="col-lg-3 text-center">
                                                    <i class="fa fa-bus big-icon text-muted"></i>
                                                    <p class="small m-t-md">Registro de Retomas</p>
                                                    <br />
                                                </div>
                                                <input type="hidden" id="lista_retomas" name="lista_retomas" value="" />
                                                <div class="col-lg-9">

                                                    <div class="row">
                                                        <div class="col-sm-6">
                                                            <div class="form-group">
                                                                <label class="control-label col-md-4">Placa Retoma:<span class="text-danger">&nbsp;*</span></label>
                                                                <div class="col-md-6">
                                                                    @Html.EditorFor(model => model.placaRetoma, new { htmlAttributes = new { @class = "form-control", @placeholder = "Ingrese Placa", @type = "text" } })
                                                                    @Html.ValidationMessageFor(model => model.placaRetoma, "", new { @class = "text-danger" })
                                                                    <label class="text-danger" id="AlertaRetomaNoEncontrada" style="display:none;">Placa no registrada!</label>
                                                                </div>
                                                                <div class="col-md-2">
                                                                    <button type="button" class="btn btn-default" id="btnBuscarRetoma"><i class="fa fa-search"></i></button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    @*<div class="col-sm-6" style="visibility:hidden">
                                                            <div class="form-group">
                                                                <div class="col-md-10">
                                                                    <div class="alert alert-warning text-center">
                                                                        <strong></strong>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>*@


                                                    <div class="row">
                                                        <div class="col-sm-6">
                                                            <div class="form-group">
                                                                <label class="control-label col-md-4">Vehiculo Retoma:<span class="text-danger">&nbsp;*</span></label>
                                                                <div class="col-md-6">
                                                                    @Html.EditorFor(model => model.modeloRetoma, new { htmlAttributes = new { @class = "form-control", @placeholder = "Ingrese Modelo", @type = "text" } })
                                                                    @Html.ValidationMessageFor(model => model.modeloRetoma, "", new { @class = "text-danger" })
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div class="col-sm-6">
                                                            <div class="form-group">
                                                                <label class="control-label col-md-4">A&ntilde;o Modelo:<span class="text-danger">&nbsp;*</span></label>
                                                                <div class="col-md-6">
                                                                    @Html.EditorFor(model => model.anioVehiculoRetoma, new { htmlAttributes = new { @class = "form-control", @placeholder = "Ingrese Año", @onkeypress = "return soloNumeros(event)" } })
                                                                    @Html.ValidationMessageFor(model => model.anioVehiculoRetoma, "", new { @class = "text-danger" })
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="row">
                                                        <div class="col-md-6">
                                                            <div class="form-group">
                                                                <label class="control-label col-md-4">Fecha Ult. Peritaje</label>
                                                                <div class="col-md-6">
                                                                    <input class="form-control" type="text" readonly name="ult_peritaje" id="ult_peritaje" value="" />
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="row">
                                                        <div class="col-sm-6">
                                                            <div class="form-group">
                                                                <label class="control-label col-md-4">Valor Retoma:<span class="text-danger">&nbsp;*</span></label>
                                                                <div class="col-md-6">
                                                                    @Html.EditorFor(model => model.valorRetoma, new { htmlAttributes = new { @class = "form-control", @placeholder = "Ingrese Valor", @onkeyUp = "return miles(this.id)" } })
                                                                    @Html.ValidationMessageFor(model => model.valorRetoma, "", new { @class = "text-danger" })
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div class="col-sm-6">
                                                            <div class="form-group">
                                                                <label class="control-label col-md-4">Kilometraje:<span class="text-danger"></span></label>
                                                                <div class="col-md-6">
                                                                    @Html.EditorFor(model => model.kilometrajeRetoma, new { htmlAttributes = new { @class = "form-control", @placeholder = "Ingrese Kilometraje", @onkeyUp = "return miles(this.id)" } })
                                                                    @Html.ValidationMessageFor(model => model.kilometrajeRetoma, "", new { @class = "text-danger" })
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="col-sm-12">
                                                        <hr />
                                                    </div>

                                                    <div class="col-sm-6 text-left">
                                                        <div class="form-group">
                                                            <div class="col-sm-2"></div>
                                                            <button type="button" class="btn btn-primary" id="btnAgregarRetoma">
                                                                <font>
                                                                    <i class="fa fa-plus-square" aria-hidden="true"></i>&nbsp;&nbsp;Agregar
                                                                </font>
                                                            </button>
                                                        </div>
                                                    </div>

                                                    <div class="col-sm-6 text-right">
                                                        <div class="form-group">
                                                            <button type="button" class="btn btn-primary" id="btnPreciosRetomas">
                                                                <font>
                                                                    <i class="fa fa-money" aria-hidden="true"></i>&nbsp;Precios Retoma
                                                                </font>
                                                            </button>
                                                            @*<button type="button" class="btn btn-primary" id="btnAgendarPeritaje">
                                                                    <font>
                                                                        <i class="fa fa-calendar-o" aria-hidden="true"></i>&nbsp;Agendar Peritaje
                                                                    </font>
                                                                </button>*@
                                                        </div>
                                                    </div>

                                                    <div class="row" id="alertAgregarRetoma" style="display:none">

                                                        @*Alertas del lado del cliente*@
                                                        <div class="col-sm-12">
                                                            <div class="form-group">
                                                                <div class="row">
                                                                    <div class="alert alert-info">
                                                                        <strong>
                                                                            Informaci&oacute;n!&nbsp;&nbsp;
                                                                            <p id="mensajeAgregarRetoma"></p>
                                                                        </strong>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        @*Fin de las alertas del lado del cliente*@
                                                    </div>

                                                </div>
                                            </div>

                                            <div class="m-t-md">
                                                <div class="panel-body-btns text-right">
                                                    <button class="btn btn-info" id="btnGuardar" type="submit" style="display: none"><i class="fa fa-save"></i>&nbsp;&nbsp;&nbsp;Guardar</button>
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>

                            <div class="hpanel">
                                <div class="panel-heading hbuilt" style="background-color:#e4e5e7">
                                    <div class="panel-tools">
                                        <a class="showhide"><i class="fa fa-chevron-up"></i></a>

                                    </div>
                                    <i class="fa fa-volume-control-phone"></i>&nbsp;&nbsp;&nbsp;Detalle Cotizaci&oacute;n
                                </div>
                                <div class="panel-body">

                                    <h4 class="text-center">Vehículos Cotizados</h4>
                                    <div class="panel-body-busqueda col-md-12">
                                        <div class="table-responsive">
                                            <div id="div-mensaje-buscar"></div>
                                            <table class="table table-striped table-bordered table-hover" id="tablaDetallesCotizacion">
                                                <thead>
                                                    <tr>
                                                        <th style="text-align:center">Descripcion</th>
                                                        <th style="text-align:center">A&ntilde;o</th>
                                                        <th style="text-align:center">Valor</th>
                                                        <th style="text-align:center">Poliza</th>
                                                        <th style="text-align:center">Matricula</th>
                                                        <th style="text-align:center">SOAT</th>
                                                        <th style="text-align:center">Valor Total</th>
                                                        <th style="text-align:center">Acción</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    @if (Model.listadovehiculos > 0)
                                                    {
                                                        var i = 1;
                                                        foreach (var item in Model.vehiculos)
                                                        {
                                                            <tr>
                                                                @Html.Raw("<td><input type='hidden' id='descripcion" + i + "' value='" + item.descripcion + "'/>" + item.descripcion + "</td>")
                                                            </tr>
                                                        }
                                                    }

                                                </tbody>
                                            </table>
                                        </div>
                                        <hr />
                                    </div>

                                    <h4 class="text-center">Accesorios Cotizados</h4>
                                    <div class="panel-body-busqueda col-md-12">
                                        <div class="table-responsive">
                                            <div id="div-mensaje-buscar"></div>
                                            <table class="table table-striped table-bordered table-hover" id="tablaRepuestos" @*id="tablaDetallesCotizacionAccesorio"*@>
                                                <thead>
                                                    <tr>
                                                        <th style="text-align:center">Descripcion</th>
                                                        <th style="text-align:center">Valor</th>
                                                        <th style="text-align:center">Cantidad</th>
                                                        <th style="text-align:center">Valor Total</th>
                                                        <th style="text-align:center">Acción</th>
                                                    </tr>
                                                </thead>
                                                <tbody></tbody>
                                            </table>
                                        </div>
                                        <hr />
                                    </div>

                                    <h4 class="text-center">Retomas</h4>
                                    <div class="panel-body-busqueda col-md-12">
                                        <div class="table-responsive">
                                            <div id="div-mensaje-buscar"></div>
                                            <table class="table table-striped table-bordered table-hover" id="tablaRetomas">
                                                <thead>
                                                    <tr>
                                                        <th style="text-align:center">Vehiculo</th>
                                                        <th style="text-align:center">Modelo</th>
                                                        <th style="text-align:center">Placa</th>
                                                        <th style="text-align:center">Valor</th>
                                                        <th style="text-align:center">Kilometraje</th>
                                                        <th style="text-align:center">Acción</th>
                                                    </tr>
                                                </thead>
                                                <tbody></tbody>
                                            </table>
                                        </div>
                                        <hr />
                                    </div>

                                    <div class="col-sm-12">
                                        <div class="form-group">
                                            <label class="control-label col-md-2">Total Cotizaci&oacute;n:<span class="text-danger"></span></label>
                                            <div class="col-md-3">
                                                @Html.EditorFor(model => model.cot_valortotal, new { htmlAttributes = new { @class = "form-control", @placeholder = "Total", @readonly = "readonly" } })
                                                @Html.ValidationMessageFor(model => model.cot_valortotal, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        -->
                        </div>

                        <div class="panel-body-btns text-left" id="alertaFinalizarCotizacion" style="display:none">
                            <div class="col-sm-6">
                                <div class="form-group">
                                    <div class="row">
                                        <div class="alert alert-info">
                                            <strong>
                                                Informaci&oacute;n!&nbsp;&nbsp;
                                                <p id="mensajeFinalizarCotizacion"></p>
                                            </strong>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="panel-body-btns text-right" id="btnFinalizarCotizacion">
                            <button class="btn btn-primary" type="button" id="btnFinalizarValidarCampos" style="font-size:20px;"><i class="fa fa-save">&nbsp;&nbsp;&nbsp;Guardar y Continuar</i></button>
                            <input type="hidden" name="txt_json_listas" id="txt_json_listas" />
                        </div>
                        <div class="panel-body-btns text-right" style="display:none">
                            <button class="btn btn-primary" type="submit" id="btnFinalizarCotizacionValidada"><i class="fa fa-save"></i>&nbsp;&nbsp;&nbsp;Guardar y Continuar</button>
                        </div>
                        <div class="panel-body-btns text-right" style="display:none">
                            <button class="btn btn-primary" type="button" id="btnAlertaNumeroCotizado"><i class="fa fa-save"></i>&nbsp;&nbsp;&nbsp;Guardar y Continuar</button>
                        </div>}
                </div>
            </div>

            <div id="buscar" class="tab-pane">
                <div class="panel-body">

                    <div class="row">
                        <div class="col-sm-6 col-md-offset-3">
                            <div class="form-group">
                                <div class="col-md-8">
                                    <div class="input-group m-b">
                                        @Html.Editor("txtFechaInicio", new { htmlAttributes = new { @class = "form-control", @placeholder = "Fecha Desde" } })
                                        <span class="input-group-addon">-</span>
                                        @Html.Editor("txtFechaFin", new { htmlAttributes = new { @class = "form-control", @placeholder = "Fecha Hasta" } })
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <button type="button" class="btn btn-primary" id="btnBuscarPorFecha">Buscar&nbsp;&nbsp;<i class="fa fa-search"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="panel-body-busqueda">
                        <div class="table-responsive">
                            <div id="div-mensaje-buscar"></div>
                            <table class="table table-striped table-bordered table-hover" id="tablaPaginada">
                                <thead>
                                    <tr>
                                        <th style="text-align:center">Numero Cotizacion</th>
                                        <th style="text-align:center">Fecha</th>
                                        <th style="text-align:center">Identificación</th>
                                        <th style="text-align:center">Nombre Cliente</th>
                                        <th style="text-align:center">Telefono</th>
                                        <th style="text-align:center">Email</th>
                                        <th style="text-align:center">Fuente</th>
                                        <th style="text-align:center">Subfuente</th>
                                        <th style="text-align:center">Asesor</th>
                                        <th style="text-align:center">Ultimo seguimiento</th>
                                        <th style="text-align:center">Nota</th>
                                        <th style="text-align:center">Acción</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                        <div class="row col-md-4 col-md-offset-4">
                            <div id="page-selection"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade hmodal-info" id="modalAccesorios" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="color-line"></div>
            <div class="modal-header text-center">
                <h4 class="modal-title">Accesorios</h4>
                <small>Agregar Accesorios A Vehículos</small>
            </div>
            <div class="modal-body">
                <div class="col-sm-12">
                    <div class="form-group">
                        <label class="control-label col-md-4">Modelo:&nbsp;</label>
                        <div class="col-md-8">
                            <label class="control-label" id="labelModelo"></label>
                        </div>
                    </div>
                </div>

                <div class="col-sm-12">
                    <div class="form-group">
                        <label class="control-label col-md-4">Tipo De Accesorio:&nbsp;</label>
                    </div>
                </div>

                <div class="col-sm-12">
                    <div class="col-md-6">
                        <input type="radio" name="tipoRepuesto" value="generico" id="rbGenerico"> Accesorio Generico
                        <br>
                    </div>
                </div>

                <div class="col-sm-12">
                    <div class="col-md-6">
                        <input type="radio" name="tipoRepuesto" value="modelo" id="rbModelo"> Accesorio Por Modelo
                        <br>
                    </div>
                </div>

                <label></label>
                <div class="col-sm-12">
                    <div class="form-group">
                        <label class="control-label col-md-4">Seleccione:&nbsp;<span class="text-danger">*</span></label>
                        <div class="col-md-8">
                            <select class="form-control" id="selectRepuestos"></select>
                        </div>
                    </div>
                </div>

                <div class="col-sm-12">
                    <div class="form-group">
                        <label class="control-label col-md-4">Precio:&nbsp;<span class="text-danger">*</span></label>
                        <div class="col-md-8">
                            <input type="text" class="form-control" id="txtCostoAccesorio" />
                        </div>
                    </div>
                </div>

                <div class="col-sm-12">
                    <div class="form-group">
                        <div class="row" style="display:none" id="alertAgregarRepuesto">
                            <div class="alert alert-info">
                                <strong>
                                    Informaci&oacute;n!&nbsp;&nbsp;
                                    <p id="mensajeAgregarRepuesto"></p>
                                </strong>
                            </div>
                        </div>
                    </div>
                </div>
                <label></label>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
                <button type="button" class="btn btn-primary" id="btnGuardarRepuesto">Guardar</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade hmodal-info" id="modalPreciosRetomas" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="color-line"></div>
            <div class="modal-header text-center">
                <h4 class="modal-title">Modelos Retomas</h4>
                <small>Lista De Modelos Por Marca</small>
            </div>
            <div class="modal-body">

                <div class="table-responsive">
                    <div id="div-mensaje-buscar"></div>
                    <table class="table table-striped table-bordered table-hover" id="tablaPaginadaPrecioRetoma">
                        <thead>
                            <tr>
                                <th style="text-align:center">Marca</th>
                                <th style="text-align:center">Modelo</th>
                                <th style="text-align:center">Cantidad</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade hmodal-info" id="modalPreciosPorAnio" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="color-line"></div>
            <div class="modal-header text-center">
                <h4 class="modal-title">A&ntilde;os Por Modelo</h4>
                <small>Lista De Precios</small>
            </div>
            <div class="modal-body">

                <div class="table-responsive">
                    <div id="div-mensaje-buscar"></div>
                    <table class="table table-striped table-bordered table-hover" id="tablaPaginadaPrecioAnio">
                        <thead>
                            <tr>
                                <th style="text-align:center">Marca</th>
                                <th style="text-align:center">Modelo</th>
                                <th style="text-align:center">A&ntilde;o</th>
                                <th style="text-align:center">Precio</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>

@*modal Cotizacion registrada*@
<div id="modalCotizacion" class="modal" tabindex="-1" aria-hidden="true" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="color-line"></div>
            <div class="modal-header text-center">
                @*<button type="button" class="close" data-dismiss="modal">&times;</button>*@
                <h4 class="modal-title">Cotización registrada con éxito</h4>
            </div>
            <div class="modal-body">
                <div class="row" style="text-align:center;">
                    <div style="display:none" id="sinVehiculo" name="sinVehiculo" class="alert alert-danger" role="alert">
                        Esta cotización se registró sin un vehículo
                    </div>
                    <h4>Se registró la cotización con el número</h4>
                    <h3>
                        <span class="label label-default">@TempData["numCotizacionCreada"]</span>
                    </h3>

                </div>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal" id="cerrarModal">Cerrar</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modalTerceroBuscado" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog" style="width:50%;">
        <div class="modal-content">
            <div class="color-line"></div>
            <div class="modal-header">
                <h4 class="modal-title">
                    <font><font>Tercero Encontrado</font></font>
                </h4>
                <small class="font-bold"><font><font>Datos de la persona buscada</font></font></small>
            </div>

            <div class="modal-body" id="datosModal">

                <div class="hpanel">
                    <div class="panel-heading hbuilt" style="background-color:#e4e5e7">
                        <div class="panel-tools">
                            <a class="showhide"><i class="fa fa-chevron-up"></i></a>
                        </div>
                        <i class="fa fa-car  text-primary font-lg"></i>&nbsp;&nbsp;Información Tercero
                    </div>
                    <div class="panel-body">

                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="control-label col-md-6">Primer Nombre:&nbsp;</label>
                                <div class="col-md-6">
                                    <input type="text" class="form-control" id="primer_nombre_modal" value="" readonly="readonly" />
                                </div>
                            </div>
                        </div>

                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="control-label col-md-6">Segundo Nombre:&nbsp;</label>
                                <div class="col-md-6">
                                    <input type="text" class="form-control" id="segundo_nombre_modal" value="" readonly="readonly" />
                                </div>
                            </div>
                        </div>

                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="control-label col-md-6">Primer Apellido:&nbsp;</label>
                                <div class="col-md-6">
                                    <input type="text" class="form-control" id="primer_apellido_modal" value="" readonly="readonly" />
                                </div>
                            </div>
                        </div>

                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="control-label col-md-6">Segundo Apellido:&nbsp;</label>
                                <div class="col-md-6">
                                    <input type="text" class="form-control" id="segundo_apellido_modal" value="" readonly="readonly" />
                                </div>
                            </div>
                        </div>

                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="control-label col-md-6">Razon Social:&nbsp;</label>
                                <div class="col-md-6">
                                    <input type="text" class="form-control" id="razon_social_modal" value="" readonly="readonly" />
                                </div>
                            </div>
                        </div>

                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="control-label col-md-6">Direcci&oacute;n:&nbsp;</label>
                                <div class="col-md-6">
                                    <input type="text" class="form-control" id="direccion_modal" value="" readonly="readonly" />
                                </div>
                            </div>
                        </div>

                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="control-label col-md-6">Ciudad:&nbsp;</label>
                                <div class="col-md-6">
                                    <input type="text" class="form-control" id="ciudad_modal" value="" readonly="readonly" />
                                </div>
                            </div>
                        </div>

                        <input type="hidden" class="form-control" id="ciudad_id_modal" value="" />
                        <input type="hidden" class="form-control" id="genero_id_modal" value="" />
                        <input type="hidden" class="form-control" id="email_modal" value="" />
                        <input type="hidden" class="form-control" id="celular_modal" value="" />
                        <input type="hidden" class="form-control" id="fuente_modal" value="" />
                        <input type="hidden" class="form-control" id="subfuente_modal" value="" />

                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="control-label col-md-6">Telefono:&nbsp;</label>
                                <div class="col-md-6">
                                    <input type="text" class="form-control" id="telefono_modal" value="" readonly="readonly" />
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
                <div class="hpanel">
                    <div class="panel-heading hbuilt" style="background-color:#e4e5e7">
                        <div class="panel-tools">
                            <a class="showhide"><i class="fa fa-chevron-up"></i></a>
                        </div>
                        <i class="fa fa-car  text-primary font-lg"></i>&nbsp;&nbsp;Créditos
                    </div>
                    <div class="panel-body">
                        <table class="table table-striped table-bordered table-hover" id="tabla_creditos">
                            <thead>
                                <tr>
                                    <th style="text-align:center">Estado</th>
                                    <th style="text-align:center">Valor Solicitado</th>
                                    <th style="text-align:center">Valor Aprobado</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal"><font><font>Cerrar</font></font></button>
                <button type="button" class="btn btn-info" onclick="agregarDatosTercero()"><font><font>Cargar Datos</font></font></button>
            </div>
        </div>
    </div>
</div>

@*------------------- Modal plan pago -------------------------- *@
<div class="modal fade" id="modalCredito" tabindex="-1" role="dialog" aria-hidden="true" wid>
    @using (Html.BeginForm("AgregarPlanPago", "cotizacion", FormMethod.Post, new { @name = "formcredito", @id = "formcredito" }))
    {<div class="modal-dialog modal-lg" style="width:80%;">
            <div class="modal-content">
                <div class="color-line"></div>
                <div class="modal-header">
                    <h4 class="modal-title"><font><font>Plan de Pago</font></font></h4>
                    <small class="font-bold"><font><font>Planes de credito</font></font></small>
                </div>

                <div class="modal-body" id="datosModal">

                    <div class="alert alert-success  alert-dismissible" style="display: none" id="mensaje">
                        <button type="button" class="close" data-dismiss="alert" arial-label="close"><span aria-hidden="true">&times;</span></button>
                        <p id="cuerpo_mensaje"></p>
                    </div>

                    <div class="alert alert-danger  alert-dismissible" style="display: none" id="mensaje_error">
                        <button type="button" class="close" data-dismiss="alert" arial-label="close"><span aria-hidden="true">&times;</span></button>
                        <p id="cuerpo_mensaje_error"></p>
                    </div>

                    <div class="alert alert-success alert-dismissible" style="display: none" id="mensaje_enviando">
                        <button type="button" class="close" data-dismiss="alert" arial-label="close"><span aria-hidden="true">&times;</span></button>
                        <p id="cuerpo_mensaje_enviando"></p>
                    </div>

                    <div class="hpanel">
                        <div class="panel-heading hbuilt" style="background-color:#e4e5e7">
                            <div class="panel-tools">
                                <a class="showhide"><i class="fa fa-chevron-up"></i></a>
                            </div>
                            <i class="fa fa-car  text-primary font-lg"></i>&nbsp;&nbsp;Información Vehiculo
                        </div>
                        <div class="panel-body">
                            <div class="col-sm-6">
                                <div class="form-group">
                                    <label class="control-label col-md-6">Valor total:&nbsp;<span class="text-danger">*</span></label>
                                    <div class="col-md-6">
                                        <input type="text" class="form-control" id="valor_total" name="valor_total" value="" required="required" placeholder="Digite valor" onkeyUp="return miles(this.id)" />
                                    </div>
                                </div>
                            </div>

                            <div class="col-sm-6">
                                <div class="form-group">
                                    <label class="control-label col-md-6">Tasa de Interes:&nbsp;<span class="text-danger">*</span></label>
                                    <div class="col-md-6">
                                        <input class="form-control" id="tasa_interes" name="tasa_interes" value="" required="required" onkeyUp="return miles3(this.id)" placeholder="Digite porcentaje" />
                                    </div>
                                </div>
                            </div>

                            <div class="col-sm-6">
                                <div class="form-group">
                                    <label class="control-label col-md-6">Cuota inicial:&nbsp;<span class="text-danger">*</span></label>
                                    <div class="col-md-6">
                                        <input type="text" class="form-control" id="cuota_inicial" name="cuota_inicial" value="" required="required" placeholder="Digite cuota" onkeyUp="return miles(this.id)" />
                                        <input type="hidden" class="form-control" id="codigo_modelo" name="codigo_modelo" value="" />
                                    </div>
                                </div>
                            </div>

                            <div class="col-sm-6">
                                <div class="form-group">
                                    <label class="control-label col-md-6">Credito:&nbsp;<span class="text-danger">*</span></label>
                                    <div class="col-md-6">
                                        <input type="text" class="form-control" id="credito" name="credito" value="" required="required" placeholder="Digite valor credito" readonly="readonly" onkeyUp="return miles(this.id)" />
                                    </div>
                                </div>
                            </div>

                            <div class="col-sm-6">
                                <div class="form-group">
                                    <label class="control-label col-md-6">Plazo (s):&nbsp;<span class="text-danger">*</span></label>
                                    <div class="col-md-6">
                                        <select id="cuotas2" name="cuotas2" multiple="multiple" required="required">
                                            <option value="12">12 Meses</option>
                                            <option value="24">24 Meses</option>
                                            <option value="36">36 Meses</option>
                                            <option value="48">48 Meses</option>
                                            <option value="60">60 Meses</option>
                                            <option value="72">72 Meses</option>
                                            <option value="84">84 Meses</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div class="col-sm-6">
                                <div class="form-group">
                                    <label class="control-label col-md-6">Plan Financiero:&nbsp;<span class="text-danger"></span></label>
                                    <div class="col-md-6">
                                        @Html.DropDownList("plan_id", null, "Seleccione", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione" })
                                    </div>
                                </div>
                            </div>

                            <div class="col-sm-6">
                                <div class="form-group">
                                    <label class="control-label col-md-6">Valor Residual:&nbsp;<span class="text-danger"></span></label>
                                    <div class="col-md-6">
                                        <input type="text" class="form-control" id="valor_residual" name="valor_residual" value="" placeholder="Digite valor residual" onkeyUp="return miles(this.id)" />
                                    </div>
                                </div>
                            </div>

                            <div class="col-sm-6">
                                <div class="form-group">
                                    <label class="control-label col-md-6">Otros Valores:&nbsp;<span class="text-danger"></span></label>
                                    <div class="col-md-6">
                                        <input type="text" class="form-control" id="otros_valores" name="otros_valores" value="" placeholder="Digite otros valores" onkeyUp="return miles(this.id)" />
                                    </div>
                                </div>
                            </div>

                            <div class="form-group" id="btn_calcular">
                                <div class="col-md-6">
                                    <input onclick="calcular()" type="button" class="btn btn-primary" value="Calcular" id="calcularplan" />
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="informacionCredito" style="display:none">
                        <div class="hpanel">
                            <div class="panel-heading hbuilt" style="background-color:#e4e5e7">
                                <div class="panel-tools">
                                    <a class="showhide"><i class="fa fa-chevron-up"></i></a>
                                </div>
                                <i class="fa fa-credit-card-alt"></i>&nbsp;&nbsp;información Financiación
                            </div>
                            <div class="panel-body" id="plazos">
                                <div id="buscar" class="tab-pane">
                                    <div class="panel-body-busqueda">
                                        <div class="table-responsive">
                                            <div id="div-mensaje-buscar"></div>
                                            <table class="table table-striped table-bordered table-hover tablaCreditos" id="tablaCreditos">
                                                <thead>
                                                    <tr>
                                                        <th style="text-align:center">Valor a Financiar</th>
                                                        <th style="text-align:center">Tasa Interes</th>
                                                        <th style="text-align:center">Cuotas</th>
                                                        <th style="text-align:center">Valor Cuota</th>
                                                        <th style="text-align:center">Plan Financiero</th>
                                                        <th style="text-align:center">Valor Residual</th>
                                                        <th style="text-align:center">Otros Valores</th>
                                                    </tr>
                                                </thead>
                                                <tbody></tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                <div class="modal-footer">
                    <input type="hidden" id="idCotizacionASD" name="idCotizacionASD" value="" />
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
                    <button type="button" class="btn btn-info" name="addLista" id="addLista">Guardar cambios</button>
                </div>
            </div>
        </div>
    }
</div>

<div id="modalCreacionPlanPago" class="modal" tabindex="-1" aria-hidden="true" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="color-line"></div>
            <div class="modal-header text-center">
                <h4 class="modal-title">Plan de pago registrado con éxito</h4>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal" id="cerrarModalPlanPago">Cerrar</button>
            </div>
        </div>
    </div>
</div>

<div id="modalPlanPagoAgregados" class="modal" tabindex="-1" aria-hidden="true" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="color-line"></div>
            <div class="modal-header text-center">
                <h4 class="modal-title">Plan de pago para este vehículo</h4>
            </div>
            <div class="modal-body">
                <div class="table-responsive">
                    <div id="div-mensaje-buscar"></div>
                    <table class="table table-striped table-bordered table-hover" id="tablaPlanPagoAgregados">
                        <thead>
                            <tr>
                                <th style="text-align:right">Número</th>
                                <th style="text-align:right">Cuota Inicial</th>
                                <th style="text-align:center">Plazos</th>
                                <th style="text-align:center">Acción</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                        <tfoot></tfoot>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal" id="cerrarModalPlanPago">Cerrar</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modalDetallePlanPago" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg" style="width:80%;">
        <div class="modal-content">
            <div class="color-line"></div>
            <div class="modal-header">
                <h4 class="modal-title"><font><font>Plan de Pago</font></font></h4>
                <small class="font-bold"><font><font>Planes de credito</font></font></small>
            </div>

            <div class="modal-body" id="datosModal">
                <div class="hpanel">
                    <div class="panel-heading hbuilt" style="background-color:#e4e5e7">
                        <div class="panel-tools">
                            <a class="showhide"><i class="fa fa-chevron-up"></i></a>
                        </div>
                        <i class="fa fa-car  text-primary font-lg"></i>&nbsp;&nbsp;Información Vehiculo
                    </div>
                    <div class="panel-body">
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="control-label col-md-6">Valor total:&nbsp;<span class="text-danger">*</span></label>
                                <div class="col-md-6">
                                    <input type="text" class="form-control" id="valor_totalDetalle" name="valor_totalDetalle" value="" required="required" placeholder="Digite valor" onkeyUp="return miles(this.id)" readonly />
                                </div>
                            </div>
                        </div>

                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="control-label col-md-6">Tasa de Interes:&nbsp;<span class="text-danger">*</span></label>
                                <div class="col-md-6">
                                    <input type="number" class="form-control" id="tasa_interesDetalle" name="tasa_interesDetalle" value="" required="required" placeholder="Digite porcentaje" typeof="number" readonly />
                                </div>
                            </div>
                        </div>

                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="control-label col-md-6">Cuota inicial:&nbsp;<span class="text-danger">*</span></label>
                                <div class="col-md-6">
                                    <input type="text" class="form-control" id="cuota_inicialDetalle" name="cuota_inicialDetalle" value="" required="required" placeholder="Digite cuota" onkeyUp="return miles(this.id)" readonly />
                                    <input type="hidden" class="form-control" id="codigo_modeloDetalle" name="codigo_modeloDetalle" value="" />
                                </div>
                            </div>
                        </div>

                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="control-label col-md-6">Credito:&nbsp;<span class="text-danger">*</span></label>
                                <div class="col-md-6">
                                    <input type="text" class="form-control" id="creditoDetalle" name="creditoDetalle" value="" required="required" placeholder="Digite valor credito" readonly="readonly" onkeyUp="return miles(this.id)" readonly />
                                </div>
                            </div>
                        </div>

                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="control-label col-md-6">Plazo (s):&nbsp;<span class="text-danger">*</span></label>
                                <div class="col-md-6">
                                    <select id="cuotas2Detalle" name="cuotas2Detalle" multiple="multiple" required="required" readonly>
                                        <option value="12">12 Meses</option>
                                        <option value="24">24 Meses</option>
                                        <option value="36">36 Meses</option>
                                        <option value="48">48 Meses</option>
                                        <option value="60">60 Meses</option>
                                        <option value="72">72 Meses</option>
                                        <option value="84">84 Meses</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="control-label col-md-6">Plan Financiero:&nbsp;<span class="text-danger"></span></label>
                                <div class="col-md-6">
                                    @Html.DropDownList("plan_idDetalle", null, "Seleccione", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione", @readonly = "readonly" })
                                </div>
                            </div>
                        </div>

                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="control-label col-md-6">Valor Residual:&nbsp;<span class="text-danger"></span></label>
                                <div class="col-md-6">
                                    <input type="text" class="form-control" id="valor_residualDetalle" name="valor_residualDetalle" value="" placeholder="Digite valor residual" onkeyUp="return miles(this.id)" readonly />
                                </div>
                            </div>
                        </div>

                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="control-label col-md-6">Otros Valores:&nbsp;<span class="text-danger"></span></label>
                                <div class="col-md-6">
                                    <input type="text" class="form-control" id="otros_valoresDetalle" name="otros_valoresDetalle" value="" placeholder="Digite otros valores" onkeyUp="return miles(this.id)" readonly />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="informacionCreditotablaCreditosDetalle" style="display:none">
                    <div class="hpanel">
                        <div class="panel-heading hbuilt" style="background-color:#e4e5e7">
                            <div class="panel-tools">
                                <a class="showhide"><i class="fa fa-chevron-up"></i></a>
                            </div>
                            <i class="fa fa-credit-card-alt"></i>&nbsp;&nbsp;Información Credito
                        </div>
                        <div class="panel-body" id="plazos">
                            <div id="buscar" class="tab-pane">
                                <div class="panel-body-busqueda">
                                    <div class="table-responsive">
                                        <div id="div-mensaje-buscar"></div>
                                        <table class="table table-striped table-bordered table-hover tablaCreditos" id="tablaCreditosDetalle">
                                            <thead>
                                                <tr>
                                                    <th style="text-align:right">Valor a Financiar</th>
                                                    <th style="text-align:right">Tasa Interes</th>
                                                    <th style="text-align:right">Cuotas</th>
                                                    <th style="text-align:right">Valor Cuota</th>
                                                    <th style="text-align:left">Plan Financiero</th>
                                                    <th style="text-align:right">Valor Residual</th>
                                                    <th style="text-align:right">Otros Valores</th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <div class="modal-footer">
                <input type="hidden" id="idCotizacionASD" name="idCotizacionASD" value="" />
                <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>

<div id="modalActivacion" class="modal" tabindex="-1" aria-hidden="true" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="color-line"></div>
            <div class="modal-header text-center">
                <h4 class="modal-title" id="tituloModal"></h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-12" style="display:none" id="requiereBodega">
                        <div class="form-group">
                            <label class="control-label col-md-4">Bodega:&nbsp;<span class="text-danger">*</span></label>
                            <div class="col-md-8">
                                <select id="bodega" name="bodega" class="form-control js-source-states">
                                    <option></option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-12">
                        <div class="form-group">
                            <label class="control-label col-md-4">Asignar a:&nbsp;<span class="text-danger">*</span></label>
                            <div class="col-md-8">
                                <input type="hidden" name="idCotActivacion" id="idCotActivacion" class="form-control" value="" />
                                <input type="hidden" name="tipoActivacion" id="tipoActivacion" class="form-control" value="" />
                                <select id="asignado" name="asignado" class="form-control js-source-states" required>
                                    <option></option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-12">
                        <div class="form-group">
                            <label class="control-label col-md-4">Notas:&nbsp;<span class="text-danger">*</span></label>
                            <div class="col-md-8">
                                <textarea type="text" name="observaciones" id="observaciones" value="" class="form-control" required></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="alert alert-danger" role="alert" id="msjCamposObligatorios" style="display:none">
                            Los campos marcados con * son obligatorios
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal" id="cerrarModalPlanPago">Cerrar</button>
                <button type="button" class="btn btn-info" onclick="guardarActivacion()">Confirmar</button>
            </div>
        </div>
    </div>
</div>


@section Scripts {
    @Scripts.Render("~/bundles/select2/js")
    <script src="~/Vendor/BootstrapMultiselect/multiselect.js"></script>
    <script src="~/Vendor/datatables/media/js/jquery.dataTables.min.js"></script>
    <script src="~/Vendor/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>
    <script src="~/Vendor/datatables.net-buttons/js/buttons.html5.min.js"></script>
    <script src="~/Vendor/datatables.net-buttons/js/buttons.print.min.js"></script>
    <script src="~/Vendor/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
    <script src="~/Vendor/datatables.net-buttons-bs/js/buttons.bootstrap.min.js"></script>
    <script src="~/Vendor/datatablesExcelExport/dataTable1.4.0-buttons.js"></script>
    <script src="~/Vendor/datatablesExcelExport/JSZip3.1.3.min.js"></script>
    <script src="~/Vendor/datatablesExcelExport/jsZipDataTables.js"></script>
    <script src="~/Vendor/sweetalert/lib/sweet-alert.min.js"></script>
    <script src="~/Vendor/bootstrap-toggle-master/js/bootstrap-toggle.min.js"></script>
    <script src="~/Vendor/moment/min/moment.min.js"></script>
    <script src="~/Vendor/eonasdan-bootstrap-datetimepicker/build/js/bootstrap-datetimepicker.min.js"></script>
    <script src="~/Vendor/toastr/toastr.min.js"></script>

    <script type="text/javascript">
        var v = 0;
        var r = 0;
        var cot = 0;
        var vehNumero = 0;
        var retNumero = 0;
        var vehiculosCotizados=0;
        var accesoriosCotizados=0;

        $(document).ready(function () {
            $('.js-source-states').select2();
            $('#ciu_id').select2();
            buscarPermisos()
            $("#tablaCreditos").dataTable().fnDestroy();
            $('#tablaCreditos').find('tbody').empty();
            $('#cuotas2').multiselect({
                includeSelectAllOption: true,
                maxHeight: 400,
                dropUp: false
            });
            $('#menu').val(@ViewBag.id_menu);
            $('#rolLog').val(@ViewBag.rol);
            $('#txtFechaInicio').datetimepicker({
                format: 'DD/MM/YYYY'
            });
            $('#txtFechaFin').datetimepicker({
                format: 'DD/MM/YYYY'
            });
            var pdf='@ViewBag.pdf';
            var cotizacionn = '@ViewBag.cotizacionn';
            if(pdf>0){
                generarPDF(cotizacionn)
            }
            ValidarTipoDocumento();
            agregarAccesorio();
            ValidarSiEsEvento();
            $('#cuotas').select2();
            $('#rbNuevo').trigger('click');
            $('#lista_vehiculos').val('0');
            $('#lista_repuestos').val('0');
            $('#lista_retomas').val('0');
            setTimeout(function () {
                $("#alertaCorrecta").fadeOut(1500);
            }, 3000);
            $("#direc_tercero").on('keydown paste', function(e){
                e.preventDefault();
            });

            $('form select').each(function (i) {
                this.addEventListener('invalid', function (e) {
                    var _s2Id = 's2id_' + e.target.id; //s2 autosuggest html ul li element id
                    var _posS2 = $('#' + _s2Id).position();
                    //get the current position of respective select2
                    $('#' + _s2Id + ' ul').addClass('_invalid'); //add this class with border:1px solid red;
                    //this will reposition the hidden select2 just behind the actual select2 autosuggest field with z-index = -1
                    $('#' + e.target.id).attr('style', 'display:block !important;position:absolute;z-index:-1;top:' + (0 - $('#' + _s2Id).outerHeight() + 30) + 'px;left:' + (15 - ($('#' + _s2Id).width() / 10)) + 'px;');
                    /*
                    //Adjust the left and top position accordingly
                    */
                    //remove invalid class after 3 seconds
                    setTimeout(function () {
                        $('#' + _s2Id + ' ul').removeClass('_invalid');
                    }, 3000);
                    return true;
                }, false);
            });
            if ($('#doc_tercero').val() != "") {
                buscarVHinteresado();
            }
        });

        function validarcamposobligatorios() {
            debugger
            var tpdoc_id= $('#tpdoc_id').val();
            var doc_tercero= $('#doc_tercero').val();
            var prinom_tercero= $('#prinom_tercero').val();
            var apellido_tercero= $('#apellido_tercero').val();
            var gentercero_id= $('#gentercero_id').val();
            var ocupacion= $('#ocupacion').val();
            var correo= $('#correo').val();
            var celular_tercero= $('#celular_tercero').val();
            var direc_tercero= $('#direc_tercero').val();
            var dpto_id= $('#dpto_id').val();
            var ciu_id= $('#ciu_id').val();
            var tporigen_id= $('#tporigen_id').val();
            var medcomun_id= $('#medcomun_id').val();
            var asesorAsignado= $('#asesorAsignado').val();
            var razon_social= $('#razon_social').val();

            if (tpdoc_id == "") { toastr.warning("Tipo doc no puede ser null"); }
            else if (doc_tercero == "") { toastr.warning("Documento tercero no puede ser null"); }
            else if (tpdoc_id != 1 && prinom_tercero == ""  ) { toastr.warning("Primer nombre tercero no puede ser null");}
            else if (tpdoc_id == 1 && razon_social == "") { toastr.warning("razon social tercero no puede ser null"); }
            else if (apellido_tercero == "" && tpdoc_id != 1) { toastr.warning("Primer apellido tercero no puede ser null");}
            else if (gentercero_id == "" && tpdoc_id != 1) { toastr.warning("Genero no puede ser null"); }
            else if (ocupacion == null && tpdoc_id != 1) { toastr.warning("Ocupacion no puede ser null"); }
            else if (correo == "") { toastr.warning("Correo no puede ser null"); }
            else if (celular_tercero == "") { toastr.warning("celular tercero no puede ser null"); }
            else if (direc_tercero == "") { toastr.warning("Direccion tercero no puede ser null"); }
            else if (dpto_id == "") { toastr.warning("Departamento no puede ser null"); }
            else if (ciu_id == null) { toastr.warning("Ciudad no puede ser null");debugger }
            else if (tporigen_id == "") { toastr.warning("Fuente no puede ser null"); }
            else if (medcomun_id == "") { toastr.warning("Medio Comunicación no puede ser null"); }
            else if (asesorAsignado == "") { toastr.warning("Asesor Asignado no puede ser null"); }
            else return 0;debugger
        };

        function buscarVHinteresado() {
            debugger
            $.ajax({
                url: '/cotizacion/buscarVHinteresado',
                data: {
                    tercero: $('#doc_tercero').val()
                },
                type: 'post',
                cache: false,
                success: function (data) {
                    $('#vhInteresado').val(data)
                }
            });
        }

        function buscarPermisos(){
            $.ajax({
                url: '/prospectos/buscarPermisos',
                data: {
                },
                type: "post",
                cache: false,
                success: function (data) {
                    console.log(data);
                    for (var i = 0; i < data.length; i++) {
                        if (data[i] == 20) {
                            $('#celular_tercero').prop('required', false)
                        }
                        if (data[i] == 21) {
                            $('#correo').prop('required', false)
                        }
                    }
                },
                complete: function (data) { }
            });
        }

        $('#correo').keyup(function () {
            var expreg = /^[_.\-A-Za-z0-9]{4,}@@[A-Za-z0-9-]{4,}[.][A-Za-z]{2,3}[.]*[A-Za-z]+$/;
            var email = $('#correo').val()
            if (expreg.test(email)) {
                $('#correoNoValido').hide();
            } else {
                $('#correoNoValido').show();
            };
        });

        $('#btnAgendarPeritaje').click(function (){
            window.open('@Url.Action("Solicitud", "peritaje")?menu='+@ViewBag.id_menu+'&&cotizacion=' + $('#cotizacion_id').val(), '_blank');
        });

        $('form select').each(function (i) {
            this.addEventListener('invalid', function (e) {
                var _s2Id = 's2id_' + e.target.id; //s2 autosuggest html ul li element id
                var _posS2 = $('#' + _s2Id).position();
                //get the current position of respective select2
                $('#' + _s2Id + ' ul').addClass('_invalid'); //add this class with border:1px solid red;
                //this will reposition the hidden select2 just behind the actual select2 autosuggest field with z-index = -1
                $('#' + e.target.id).attr('style', 'display:block !important;position:absolute;z-index:-1;top:' + (0 - $('#' + _s2Id).outerHeight() + 30) + 'px;left:' + (15 - ($('#' + _s2Id).width() / 10)) + 'px;');
                /*
                //Adjust the left and top position accordingly
                */
                //remove invalid class after 3 seconds
                setTimeout(function () {
                    $('#' + _s2Id + ' ul').removeClass('_invalid');
                }, 3000);
                return true;
            }, false);
        });

        $('#cerrarModal').click(function () {
            $('#modalCotizacion').hide();
        });

        $('#btnAgregarVehiculo').click(function () {

            debugger
            if ($('#modvh_codigo').val() == '' || $('#anio').val() == '' || $('#colVh_id').val() == '' || $.trim($('#valor').val()) == '' ) {

                $('#mensajeAgregarVehiculo').text('Los campos marcados con (*) son obligatorios');
                $('#alertAgregarVehiculo').show();
                setTimeout(function () {
                    $("#alertAgregarVehiculo").fadeOut(1500);
                }, 3000);
            } else {
                agregarVehiculo();
            }
        });

        $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
            $('a[data-toggle="tab"]').removeClass('btn-primary');
            $('a[data-toggle="tab"]').addClass('btn-default');
            $(this).removeClass('btn-default');
            $(this).addClass('btn-primary');
        });

        function generarPDF(cotizacionn){
            $.ajax({
                url: '/cotizacion/buscarVehiculo',
                data: { cotizacionn, },
                type: 'post',
                cache: false,
                success: function (data) {
                    if (data == 1) {
                        window.open('@Url.Action("crearPDF", "cotizacion")?cotizacion=' + cotizacionn, '_blank');
                    } else {
                        //$('#sinVehiculo').show()
                    }
                }
            });
        }

        function generarPDF2(cotizacionn){
            $.ajax({
                url:'/cotizacion/buscarVehiculo',
                data: {
                    id : cotizacionn
                },
                type: "post",
                cache: false,
                success: function (data) {
                    if (data == 1) {
                        window.open('@Url.Action("crearPDF", "cotizacion")?cotizacion='+cotizacionn,'_blank');
                    }else{
                        swal("Esta cotización no tiene un vehículo!", "", "warning");
                    }
                },
                fail: function(err) {
                    console.log('err',err);
                },
            });
        }

        $('#rbNuevo').click(function () {
            reiniciarPorRadioButton();
        });

        $('#rbUsado').click(function () {
            reiniciarPorRadioButton();
        });

        $('#marcvh_id').click(function () {
            var checkNuevo = false;
            if ($("input[name=tipoVh]:checked").val() == 'Nuevo') {
                checkNuevo = true;
            }

            $.ajax({
                url: '/cotizacion/BuscarModelosPorMarca',
                data: {
                    idMarca: $('#marcvh_id').val(),
                    esNuevo: checkNuevo
                },
                type: "post",
                cache: false,
                success: function (data) {
                    $('#anio').empty();
                    $('#anio').append($('<option>', {
                        value: '',
                        text: ''
                    }));
                    $('#anio').select2();

                    $('#modvh_codigo').empty();
                    $('#modvh_codigo').append($('<option>', {
                        value: '',
                        text: ''
                    }));
                    for (var i = 0; i < data.length; i++) {
                        $('#modvh_codigo').append($('<option>', {
                            value: data[i].modvh_codigo,
                            text: data[i].modvh_nombre
                        }));
                    }
                    $('#modvh_codigo').val('').select2();
                    $('#valor').val('');
                    $('#colVh_id').select2();
                }
            });
        });

        $('#rbGenerico').click(function () {
            $.ajax({
                url: '/cotizacion/buscarRepuestosGenericos',
                data: {
                },
                type: "post",
                cache: false,
                success: function (data) {
                    $('#selectRepuestos').empty();
                    $('#selectRepuestos').append($('<option>', {
                        value: '',
                        text: ''
                    }));
                    for (var i = 0 ; i < data.length ; i ++){
                        $('#selectRepuestos').append($('<option>', {
                            value: data[i].ref_codigo,
                            text: '('+data[i].ref_codigo + ') ' + data[i].ref_descripcion
                        }));
                    }
                    $('#selectRepuestos').select2();
                }
            });
        });

        $('#rbModelo').click(function () {
            $.ajax({
                url: '/cotizacion/buscarRepuestosPorModelo',
                data: {
                    modelo: $('#modvh_codigo').val()
                },
                type: "post",
                cache: false,
                success: function (data) {
                    $('#selectRepuestos').empty();
                    $('#selectRepuestos').append($('<option>', {
                        value: '',
                        text: ''
                    }));
                    for (var i = 0 ; i < data.length ; i++) {
                        $('#selectRepuestos').append($('<option>', {
                            value: data[i].referencia,
                            text: data[i].descripcion
                        }));
                    }
                    $('#selectRepuestos').select2();
                }
            });
        });

        $('#selectRepuestos').change(function () {
            $.ajax({
                url: '/cotizacion/buscarPrecioReferencia',
                data: {
                    idRepuesto: $('#selectRepuestos').val()
                },
                type: "post",
                cache: false,
                success: function (data) {
                }, complete: function (data) {
                    if (data.responseText != '') {
                    } else {
                        $('#txtCostoAccesorio').val('0');
                    }
                }
            });
        });

        $('#btnGuardarRepuesto').click(function () {
            validarcamposobligatorios();
            if ($.trim($('#selectRepuestos').val()) == '' || $.trim($('#txtCostoAccesorio').val()) == '') {
                $('#mensajeAgregarRepuesto').text('Los campos marcados con (*) son obligatorios');
                $('#alertAgregarRepuesto').show();
                setTimeout(function () {
                    $("#alertAgregarRepuesto").fadeOut(1500);
                }, 3000);
            } else {
                guardarAccesorio();
            }
        });

        $('#btnBuscarRetoma').click(function(){
            $.ajax({
                url: '/cotizacion/buscarPlacaRetoma',
                data: {
                    placa: $('#placaRetoma').val()
                },
                type: "post",
                cache: false,
                success: function (data) {
                    if(data.encontrado == false){
                        $('#modeloRetoma').val('');
                        $('#anioVehiculoRetoma').val('');
                        $('#AlertaRetomaNoEncontrada').show();
                        setTimeout(function () {
                            $("#AlertaRetomaNoEncontrada").fadeOut(1500);
                        }, 3000);
                    }else{
                        $('#modeloRetoma').val(data.buscarPlaca.modvh_nombre);
                        $('#anioVehiculoRetoma').val(data.buscarPlaca.anio_vh);
                        $('#ult_peritaje').val(data.fecha)
                    }
                }
            });
        });



        $('.marca').change(function () {
            var esNuevo = true;
            if (!$('.rbNuevo').is(':checked')) {
                esNuevo = false;
            }
            $.ajax({
                url: '/cotizacion/BuscarModelosPorMarca',
                data: {
                    idMarca: $('.marca').val(),
                    esNuevo: esNuevo
                },
                type: "post",
                cache: false,
                success: function (data) {
                    $('.anio').empty();
                    $('.modelo').empty();
                    $('.modelo').append($('<option>', {
                        value: '',
                        text: 'Seleccione'
                    }));
                    for (var i = 0; i < data.length; i++) {
                        $('.modelo').append($('<option>', {
                            value: data[i].modvh_codigo,
                            text: data[i].modvh_nombre
                        }));
                    }
                    $('.modelo').select2();
                }
            });
        });

        $('#modvh_codigo').change(function () {
            $('#descripcion').val('');
            $('#valor').val('');
            var esNuevo = true;
            if (!$('#rbNuevo').is(':checked')) {
                esNuevo = false;
            }
            $.ajax({
                url: '/cotizacion/BuscarAniosModelos',
                data: {
                    codigoModelo: $('#modvh_codigo').val(),
                    esNuevo: esNuevo
                },
                type: "post",
                cache: false,
                success: function (data) {
                    $('#anio').empty();
                    $('#anio').append($('<option>', {
                        value: '',
                        text: ''
                    }));
                    for (var i = 0; i < data.length;i++){
                        $('#anio').append($('<option>', {
                            value: data[i].codigo,
                            text: data[i].anios
                        }));
                    }
                    $('#anio').val('').select2();
                }
            });
        });

        $('#anio').change(function () {
            var esNuevo = true;
            if (!$('#rbNuevo').is(':checked')) {
                esNuevo = false;
            }
            $.ajax({
                url: '/cotizacion/BuscarPreciosPorAnio',
                data: {
                    codigoModelo: $('#modvh_codigo').val(),
                    anioModelo: $('#anio').val(),
                    esNuevo: esNuevo
                },
                type: "post",
                cache: false,
                success: function (data) {
                    if (data.esNuevo == true) {
                        $('#descripcion').val(data.descripcion);
                        if(data.puedeActualizar == true){
                            $('#valor').prop('readonly',false);
                        }else{
                            $('#valor').prop('readonly',true);
                        }
                        $('#valor').val(addComas(data.valor));
                        $('#costo_poliza').val(addComas(data.poliza));
                        $('#matricula').val(addComas(data.matricula));
                    }
                    //$('#colVh_id').empty();
                    //$('#colVh_id').append($('<option>', {
                    //    value: '',
                    //    text: ''
                    //}));
                    //for (var i = 0; i < data.buscaColor.length; i++) {
                    //    $('#colVh_id').append($('<option>', {
                    //        value: data.buscaColor[i].colvh_id,
                    //        text: data.buscaColor[i].colvh_nombre
                    //    }));
                    //}
                    //$('#colVh_id').val('').select2();

                }
            });
        });

        $('#btnBuscarPorFecha').click(function(){
            buscarAjaxCotizaciones();
        });

        $('#valor').change(function () {
            var dato = $('#valor').val();
            $('#valor_total').val(dato);
        });

        $('#valorRetoma').change(function () {
            var dato = $('#valorRetoma').val();
            $('#valor_retoma').val(dato);
        });

        $('#cuota_inicial').change(function () {
            var valor = parseInt(quitCommas($('#cuota_inicial').val()));
            var valor2 = parseInt(quitCommas($('#valor_total').val()));
            if ($("#valorRetoma").val() != "" && $("#valorRetoma").val() != null) {
                var valor_retoma = parseInt(quitCommas($("#valorRetoma").val()));
                var total = valor2 - valor_retoma - valor ;
                $('#credito').val(addCommas(total));
            }else {
                var total = valor2 - valor ;
                $('#credito').val(addCommas(total));
            }
        });

        $('#modalCredito').on('hidden.bs.modal', function () {
            $(this).removeData('bs.modal'); //para borrar todos los datos que tenga los input, textareas, select.
            $("#tablaCreditos").dataTable().fnDestroy();
            $('#tablaCreditos').find('tbody').empty();
            //$("alert.success").remove();  //lo utilice para borrar la etiqueta de error del jquery validate
        });


        //function reactivar() {
        //    $('#btnFinalizarCotizacionValidada').prop('disabled', false)
        //    $('#btnFinalizarValidarCampos').prop('disabled', false)
        //   }

        $('#btnFinalizarValidarCampos').click(function () {
            debugger
            if (validarcamposobligatorios() != 0) {
                swal("Faltan Campos Esenciales", "", "warning");
            }
            //else if (vehiculosCotizados <= 0) {
            //    debugger
            //    swal("Debe agregar minimo un vehiculo!", "", "warning");
            //}
            //else if (vehiculosCotizados <= 0 && accesoriosCotizados <= 0)
            //{
            //    swal("Debe agregar minimo un accesorio o un vehiculo!", "", "warning");
            //    //swal({
            //    //    title: "La cotizacion no tiene ningun vehiculo asociado",
            //    //    text: "Desea seguir?",
            //    //    type: "warning",
            //    //    showCancelButton: true,
            //    //    confirmButtonColor: "#62cb31",
            //    //    confirmButtonText: "Aceptar!",
            //    //    cancelButtonText: "Cancelar!",
            //    //    closeOnConfirm: true,
            //    //    closeOnCancel: false
            //    //},
            //        //function (isConfirm) {
            //        //    if (isConfirm) {
            //        //        debugger
            //        //        $('#btnFinalizarCotizacionValidada').trigger('click');
            //        //        $('#btnFinalizarCotizacionValidada').prop('disabled', true)
            //        //        $('#btnFinalizarValidarCampos').prop('disabled', true)
            //        //    } else {
            //        //        swal("No se guardo la cotización", "", "warning");
            //        //    }
            //        //});
            //}
            //else if (vehiculosCotizados > 0 && validarcamposobligatorios() == 0) {
            else if (validarcamposobligatorios() == 0) {
                debugger
                $('#btnFinalizarCotizacionValidada').trigger('click');
                $('#btnFinalizarCotizacionValidada').prop('disabled', true);
                $('#btnFinalizarValidarCampos').prop('disabled', true);

               //setTimeout(function () {
               // $('#btnFinalizarCotizacionValidada').prop('disabled', false).fadeOut(1500);
               // $('#btnFinalizarValidarCampos').prop('disabled', false).fadeOut(1500);
               //     }, 3000);
               //    // setTimeout(reactivar(),15000);
            }
        });

        $('#btnBuscarDocumento').click(function () {
            buscarClientePorDocumento();
        });

        $('#doc_tercero').keyup(function(){
            // Primero se calcula el digito de verificacion
            var documento = $('#doc_tercero').val()
            var numero = 0;
            var numeros = [3, 7, 13, 17, 19, 23, 29, 37, 41, 43, 47, 53, 59, 67, 71];
            var datos = documento.length;

            for (i = 0; i < documento.length; i++) {
                numero += documento.substring(datos - 1, datos) * numeros[i];
                datos--;
            }
            var digito_verificacion = numero % 11;

            if (digito_verificacion > 1) {
                digito_verificacion = 11 - digito_verificacion;
            }
            $('#digito_verificacion').val(digito_verificacion);
            // Fin de el calculo del digito de verificacion

            $.ajax({
                url: '/cotizacion/BuscarDocumentoExiste',
                data: {
                    documento: $('#doc_tercero').val(),
                    tipoDocumento: $('#tpdoc_id').val()
                },
                type: "post",
                cache: false,
                success: function (data) {
                    if (data == true) {
                        $('#alertaDocumentoBuscado').text('Documento ya existe');
                        $('#labelDocumentoNoExiste').show();
                        setTimeout(function () {
                            $('#labelDocumentoNoExiste').fadeOut(1500);
                        }, 3000);
                    } else {
                        $('#labelDocumentoNoExiste').hide();
                    }
                }
            });
        });

        $('#tporigen_id').change(function () {
            ValidarSiEsEvento();
        });

        $('#tpdoc_id').change(function () {
            ValidarTipoDocumento();
        });

        $('#btnAlertaNumeroCotizado').click(function(){
            swal({
                title: "Desea generar un plan de pago",
                text: "Cotización Generada: ",
                type: "success",
                showCancelButton: false,
                confirmButtonColor: "#62cb31",
                confirmButtonText: "Aceptar!",
                cancelButtonText: "Cancelar!",
                closeOnConfirm: true,
                closeOnCancel: false
            },
                function (isConfirm) {
                    if (isConfirm) {
                        atenderUsuario(id, true);
                        swal("Aceptado!", "", "success");
                        setTimeout(function () { }, 4000);
                        window.location.href = '@Url.Action("Ver", "cotizacion")';
                    } else {
                        swalCancelar(mensaje, id);
                    }
                });
        });

        


        $('#submitpago').click(function submit(e) {
            debugger
            $("#valor_total").prop('required',true);
            //     $("#tasa_interes").val('');
            var valor_total = $("#valor_total").val().replace(/\./g, "");
            var cuota_inicial = $("#cuota_inicial").val().replace(/\./g, "");
            var credito = $("#credito").val().replace(/\./g, "");
            var cuotas = $("#cuotas").val();
            //var plan_id = $("#plan_id").val();
            var plazos = "";
            var valor_cuota12 = $("#valor_cuota12").val();
            valor_cuota12 = parseFloat(valor_cuota12);
            if(cuotas != null){
                for (var i = 0; i < cuotas.length; i++)
                {
                    plazos += cuotas[i] + ",";
                }
            };

            var form=$('#formcredito');
            var valid=this.form.checkValidity();
            var aux = '@ViewBag.Cotizacionn'
            if(valid){
                $.ajax({
                    url: '/cotizacion/plan_pago',
                    type: 'POST',
                    data:{
                        idXCot: '@ViewBag.Cotizacionn',
                        valor_total: valor_total,
                        cuota_inicial: cuota_inicial,
                        cuotas: plazos,
                        credito: credito,
                        tasa_interes: $("#tasa_interes").val(),
                        cuota12: $("#cuota12").val(),
                        cuota24: $("#cuota24").val(),
                        cuota36: $("#cuota36").val(),
                        cuota48: $("#cuota48").val(),
                        cuota60: $("#cuota60").val(),
                        cuota72: $("#cuota72").val(),
                        cuota84: $("#cuota84").val(),
                        valor_cuota12: valor_cuota12,
                        valor_cuota24: $("#valor_cuota24").val(),
                        valor_cuota36: $("#valor_cuota36").val(),
                        valor_cuota48: $("#valor_cuota48").val(),
                        valor_cuota60: $("#valor_cuota60").val(),
                        valor_cuota72: $("#valor_cuota72").val(),
                        valor_cuota84: $("#valor_cuota84").val(),
                    },
                    type: "post",
                    cache: false,
                    success: function (data) {
                        console.log(data);
                    }
                    //beforeSend:function(objeto)
                    //    {
                    //        $('#mensaje_enviando').show();
                    //        $('#cuerpo_mensaje_enviando').html('<i class="fa fa-spinner text-center" aria-hidden="true" ></i> Enviando datos...')
                    //    },
                    //}).done(function (result) {
                    //    $('#mensaje_enviando').hide();
                    //
                    //    if (result == 1) {
                    //
                    //        $("#mensaje").html('<i class="fa fa-check" aria-hidden="true" ></i> Plan de pago agregado con exito');
                    //        $("#mensaje").show();
                    //
                    //        // ojo 1 ver//
                    //        $("#tasa_interes").val('');
                    //        $("#cuota_inicial").val('');
                    //        $("#credito").val('');
                    //        $("#mensaje").val('');
                    //        $("#cuotas2").val('').multiselect('refresh'); // limpiar el multiselect
                    //        //     $("#informacionCredito").hide();
                    //        $('#modalCredito').modal('show');
                    //
                    //        $("#mensaje").hide();
                    //
                    //        var xcc = 'ViewBag.cotizacionn';
                    //        var xccc = parseInt(xcc);
                    //        //MostrarTodosPlanes(xccc);
                    //
                    //    } else {
                    //        $("#mensaje_error").html('<i class="fa fa-times" aria-hidden="true" ></i> Error en guardar plan de pago');
                    //        $("#mensaje_error").show();
                    //    }
                });
            } else{
                $("#mensaje_error").html('<i class="fa fa-times" aria-hidden="true" ></i> Error en guardar plan de pago. Debe seleccionar mínimo un plazo');
                $("#mensaje_error").show();
            }
        });

        var numero_miles = "";
        function formatNumber (n) {
            n = String(n).replace(/\D/g, "");
            return n === '' ? n : String(n).replace(/\B(?=(\d{3})+(?!\d))/g, ".");
        };

        function miles (id) {
            numero_miles = formatNumber($('#'+id+'').val());
            $('#'+id+'').val(numero_miles);
        };

        function soloLetras(e){
            key = e.keyCode || e.which;
            tecla = String.fromCharCode(key).toLowerCase();
            letras = " áéíóúabcdefghijklmnñopqrstuvwxyz";
            especiales = "8-37-39-46";

            tecla_especial = false
            for(var i in especiales){
                if(key == especiales[i]){
                    tecla_especial = true;
                    break;
                }
            }
            if(letras.indexOf(tecla)==-1 && !tecla_especial){
                return false;
            }
        };

        function soloNumeros(e){
            key = e.keyCode || e.which;
            tecla = String.fromCharCode(key).toLowerCase();
            letras = "1234567890";
            especiales = "8-37-39-46";

            tecla_especial = false
            for(var i in especiales){
                if(key == especiales[i]){
                    tecla_especial = true;
                    break;
                }
            }
            if(letras.indexOf(tecla)==-1 && !tecla_especial){
                return false;
            }
        };

        function reiniciarPorRadioButton(){
            $('#anio').empty();
            $('#anio').append($('<option>', {
                value: '',
                text: ''
            }));
            $('#anio').select2();

            //$('#colVh_id').empty();
            //$('#colVh_id').append($('<option>', {
            //    value: '',
            //    text: ''
            //}));
            $('#colVh_id').select2();

            $('#modvh_codigo').empty();
            $('#modvh_codigo').append($('<option>', {
                value: '',
                text: ''
            }));
            $('#modvh_codigo').select2();
            $('#valor').val('');
            $('#costo_poliza').val('');
            $('#matricula').val('');
            $('#marcvh_id').val('').select2();
        }

        function guardarAccesorio() {
            debugger
            $.ajax({
                url: '/cotizacion/agregarReferencia',
                data: {
                    idReferencia: $('#selectRepuestos').val(),
                    costo: $('#txtCostoAccesorio').val(),
                    idCotizacion: $('#cotizacion_id').val()
                },
                type: "post",
                cache: false,
                success: function (data) {
                    if (data == true) {
                        $('#mensajeAgregarRepuesto').text('Accesorio se ha agregado correctamente');
                        $('#alertAgregarRepuesto').show();
                        calcularValorCotizacionAjax();
                        setTimeout(function () {
                            $('#alertAgregarRepuesto').fadeOut(1500);
                        }, 3000);
                    } else {
                        $('#mensajeAgregarRepuesto').text('Accesorio no se ha agregado, verifique su conexion');
                        $('#alertAgregarRepuesto').show();
                        setTimeout(function () {
                            $("#alertAgregarRepuesto").fadeOut(1500);
                        }, 3000);
                    }
                },
                complete: function (data) {
                }
            });
        }

        function agregarAccesorio() {debugger
            r++;
            var optionBanco = '';
            var btnAgregar = '<button class="btn btn-success" type="button" onclick="pintarTablaAccesorio()"><i class="fa fa-plus"></i>&nbsp;Agregar</button>';
            $('#repuestos').html('<div class="row">'
                                       +'<div class="col-lg-12">'
                                           + '<div class="row"><label class="control-label col-md-3">Tipo Accesorio:</label>'
                                           + '<div class="col-md-4"><input type="radio" name="tipoRepuesto' + r + '" onclick="rbGenericos(' + r + ')" value="generico" id="rbGenerico' + r + '"checked/> Accesorio Generico</div>'
                                           + '<div class="col-md-4"><input type="radio" name="tipoRepuesto' + r + '" onclick="rbModelos(' + r + ')" value="modelo" id="rbModelo' + r + '" /> Accesorio Por Modelo</div></div>'
                                           + ''
                                           + ''
                                           + '</div>'
                                       + '<br />'
                                       + '<br />'

                                       + '<div class="col-lg-12">'
                                           + '<div class="form-group" id="contenido" style="display:none">'

                                               + '<div class="row" style="display:none" id="filaVehiculosOculta'+ r +'"><label class="control-label col-md-3">Vehiculos Seleccionados:&nbsp;<span class="text-danger">*</span></label><div class="col-md-4"><select id="selectModelosCotizados'
                                           + r + '" class="form-control" placeholder="Seleccione..." onchange="BuscarAccesoriosModeloEspecifico(' + r + ')"></select></div></div>'

                                           + '<div class="row" style="display:none" id="filaAccesoriosOculta'+ r +'"><label class="control-label col-md-3">Nombre o Código de Referencia:&nbsp;<span class="text-danger">*</span></label><div class="col-md-4"><input id="codNombreAccesorios'
                                           + r + '" class="form-control col-md-4" placeholder="Codigo - Nombre"/></div><div class="col-md-4"><button type="button" class="btn btn-info" onclick="buscarRepuestosGenericos('+ r +')"><i class="fa fa-search"></i></button></div></div>'

                                           + '<div class="row"><label class="control-label col-md-3">Referencia:&nbsp;<span class="text-danger">*</span></label>'
                                                + '<div class="col-md-4">'
                                                    + '<select class="form-control" onchange="costos(' + r + ')" name="selectRepuestos' + r + '" id="selectRepuestos' + r + '" placeholder="Seleccione..."></select>'
                                               + '</div></div>'

                                                + '<div class="row"><label class="control-label col-md-3">Precio:&nbsp;<span class="text-danger">*</span></label>'
                                                + '<div class="col-md-4">'
                                                    + '<input type="text" class="form-control" name="txtCostoAccesorio' + r + '" id="txtCostoAccesorio' + r + '" onkeyUp = "return miles(this.id)" placeholder="Digite precio"/>'
                                               + '</div></div>'

                                               + '<div class="row"><label class="control-label col-md-3">Cantidad:&nbsp;<span class="text-danger">*</span></label>'
                                                + '<div class="col-md-4">'
                                                    + '<input type="text" class="form-control" name="txtCantidadAccesorio' + r + '" id="txtCantidadAccesorio' + r + '" onkeyUp = "return miles(this.id)" placeholder="Digite cantidad"/>'
                                               + '</div></div>'

                                                + '<div class="row"><div class="col-md-2 col-md-offset-3">'
                                                    + '<div class="rpt">'
                                                       + btnAgregar
                                                    + '</div>'
                                               + '</div></div>'

                                           + '</div>'
                                       +'</div>'

                                   + '</div>'

                                  );

            $('#selectRepuestos' + r + '').append($('<option>', {
                value: '',
                text: ''
            }));
            $('#selectRepuestos' + r + '').val('').select2();
            rbGenericos(r);
        }

        function agregarVehiculo() {
            debugger
            var esNuevo = true;
            var valor = parseInt(quitCommas($('#valor').val()));
            if (!$('#rbNuevo').is(':checked')) {
                esNuevo = false;
            }
            vehNumero++;
            var valorsoat="";
            if($('#soat').val()!=""){
                valorsoat=$('#soat').val();
            }
            else{
                valorsoat="0";
            }
            $('#lista_vehiculos').val(vehNumero);
            debugger
            var sumaTotalvh = parseInt(quitCommas($('#costo_poliza').val())) + parseInt(quitCommas($('#matricula').val())) + parseInt(quitCommas(valorsoat)) + valor
            $('#tablaDetallesCotizacion').append('<tr id="rowVh' + vehNumero + '">'
                +'<td align="left">'
                    +'<input type="hidden" name="descripcion' + vehNumero + '" id="descripcion' + vehNumero + '" value="' + $('#modvh_codigo').val() + '"/>'
                    +'<input type="hidden" name="nombreVehiculo' + vehNumero + '" id="nombreVehiculo' + vehNumero + '" value="' + $('#modvh_codigo option:selected').text() + '"/>'
                    + $('#modvh_codigo option:selected').text() + ''
                + '</td>'
                +'<td align="right">'
                    +'<input type="hidden" name="anioVehiculo' + vehNumero + '" id="anioVehiculo' + vehNumero + '" value="' + $('#anio').val() + '"/>'
                    + $('#anio option:selected').text() + ''
                + '</td>'
                +'<td align="right">'
                    +'<input type="hidden" name="valor' + vehNumero + '" id="valor' + vehNumero + '" value="' + valor + '"/>$ '
                    + $('#valor').val() + ''
                + '</td>'
                +'<td align="right">'
                    +'<input type="hidden" name="poliza' + vehNumero + '" id="poliza' + vehNumero + '" value="' + $('#costo_poliza').val() + '"/>$ '
                    + $('#costo_poliza').val() + ''
                + '</td>'
                +'<td align="right">'
                    +'<input type="hidden" name="matricula' + vehNumero + '" id="matricula' + vehNumero + '" value="' + $('#matricula').val() + '"/>$ '
                    + $('#matricula').val() + ''
               + '</td>'
               +'<td align="right">'
                    +'<input type="hidden" name="soat' + vehNumero + '" id="soat' + vehNumero + '" value="' + valorsoat + '"/>$ '
                    + valorsoat + ''
               + '</td>'
               +'<td align="right">'
                    +'<input type="hidden" name="vTotalvh' + vehNumero + '" id="vTotalvh' + vehNumero + '" value="'+sumaTotalvh+'"/>$'+addCommas(sumaTotalvh)
               + '</td>'
               +'<input type="hidden" name="colorVehiculo' + vehNumero + '" id="colorVehiculo' + vehNumero + '" value="' + $('#colVh_id').val() + '"/>'
               +'<input type="hidden" name="observacionVehiculo' + vehNumero + '" id="observacionVehiculo' + vehNumero + '" value="' + $('#observacion').val() + '"/>'
               +'<input type="hidden" name="esNuevo' + vehNumero + '" id="esNuevo' + vehNumero + '" value="' + esNuevo + '"/>'
               +'<td align="center">'
                    + '<button class="btn btn-danger btn-xs  data-toggle="tooltip" title="Eliminar vehículo cotizado" type="button" onclick="eliminarVehiculoCotizado(' + vehNumero + ')"><i class="fa fa-remove"></i></button>&nbsp;&nbsp;'
                    + '<button class="btn btn-info btn-xs  data-toggle="tooltip" title="Gestión plan de pago" type="button" onclick="planPago($(\'#valor'+vehNumero+'\').val(), $(\'#descripcion'+vehNumero+'\').val());"><i class="fa fa-money"></i></button>'
              +'</td></tr>');

            $('#marcvh_id').val('').select2();
            $('#modvh_codigo').empty();
            $('#modvh_codigo').empty().val('').select2();
            $('#modvh_codigo').append($('<option>', {
                value: '',
                text: ''
            }));
            $('#modvh_codigo').val('').select2();
            $('#anio').empty().val('').select2();
            $('#anio').append($('<option>', {
                value: '',
                text: ''
            }));
            $('#anio').val('').select2();
            $("#colVh_id").val($("#colVh_id option:first").val()).select2();
            $('#valor').val('');
            $('#costo_poliza').val('');
            $('#matricula').val('');
            $('#soat').val('');
            $('#observacion').val('');
            vehiculosCotizados ++;
            calcularTotalCotizacion();
        }

        function eliminarVehiculoCotizado(pos) {
            $("#rowVh" + pos + "").remove();
            vehiculosCotizados--;
            calcularTotalCotizacion();
        }



        function calcularTotalCotizacion() {
            var total = 0;
            // Valor de vehiculos agregados
            for (var i = 1 ; i <= vehNumero ; i++ ){
                var valorVehiculo = $('#vTotalvh' + i + '').val();
                if (typeof valorVehiculo === "undefined") {
                    // Valor de vehiculo eliminado de la tabla
                } else {
                    valorVehiculo = valorVehiculo.replace(/\./g, "");
                    total += parseInt(valorVehiculo);
                }
            }
            // Valor de accesorios agregados

            for (var i = 1 ; i <= r ; i++) {
                var valorAccesorio = $('#totalRespuesto' + i + '').val();
                if (typeof valorAccesorio === "undefined") {
                    // Valor de accesorios eliminados de la tabla
                } else {
                    valorAccesorio = valorAccesorio.replace(/\./g, "")
                    total += parseInt(valorAccesorio);
                }
            }
            $('#cot_valortotal').val(addCommas(total));
        }

        function pintarTablaAccesorio() {
            if ($.trim($('#selectRepuestos' + r + '').val()) == '' || $.trim($('#txtCostoAccesorio' + r + '').val()) == '' || $.trim($('#txtCantidadAccesorio' + r + '').val()) == '') {
                $('#mensajeAgregarAccesorio').text('Los campos marcados con (*) son obligatorios');
                $('#alertAgregarAccesorio').show();
                setTimeout(function () {
                    $("#alertAgregarAccesorio").fadeOut(1500);
                }, 3000);
            } else {
                var x = r;
                $('#lista_repuestos').val(x);
                var obsequio = '';
                var valor = '';

                if ($('#slcobsequio' + x + '').prop('checked')) {
                    obsequio = "Si";
                    valor = "true";
                } else {
                    obsequio = "No";
                    valor = "false";
                }
                var calcularValorTotal = Math.round(parseFloat($('#txtCantidadAccesorio' + x + '').val().replace(/\./g, "")) * parseFloat($('#txtCostoAccesorio' + x + '').val().replace(/\./g, "")));
                $('#tablaRepuestos').append('<tr id="row' + x + '"><td align="left"><input type="hidden" name="repuestos' + x + '" id="repuestos' + x + '" value="' + $('#selectRepuestos' + x + '').val() + '"/>'
                                         + $('#selectRepuestos' + x + ' option:selected').text() + ''
                                         + '</td><td align="right"><input type="hidden" name="costo' + x + '" id="costo' + x + '" value="' + $('#txtCostoAccesorio' + x + '').val() + '"/>$ ' + addCommas($('#txtCostoAccesorio' + x + '').val())
                                         + '</td><td align="right"><input type="hidden" name="cantidadRespuesto' + x + '" id="cantidadRespuesto' + x + '" value="' + $('#txtCantidadAccesorio' + x + '').val()
                                         + '"/>'+ addComas($('#txtCantidadAccesorio' + x + '').val()) +'</td><td align="right"><input type="hidden" name="totalRespuesto' + x + '" id="totalRespuesto' + x + '" value="' + calcularValorTotal + '"/>$ ' + addComas(calcularValorTotal) + '</td><td align="center">'
                                         + '<button class="btn btn-danger btn-circle" type="button" onclick="eliminarAccesorio(' + x + ')"><i class="fa fa-remove"></i></button></td></tr>');
                accesoriosCotizados++;
                calcularTotalCotizacion();
                agregarAccesorio();
            }
        }

        function eliminarAccesorio(pos) {
            $("#row" + pos + "").remove();
            accesoriosCotizados--;
            calcularTotalCotizacion();
        }

        function eliminarVehiculo(pos) {
            $("#item" + pos + "").remove();
        }

        function rbGenericos(id) {
            $('#selectRepuestos' + id + '').empty();
            $('#filaVehiculosOculta' + id + '').hide();
            $('#contenido').show();
            $('#filaAccesoriosOculta' + id + '').show();
        }

        function buscarRepuestosGenericos(id){
            $('#selectRepuestos' + id + '').empty();
            $.ajax({
                url: '/cotizacion/buscarRepuestosGenericos',
                data: {
                    cod : $('#codNombreAccesorios' + id + '').val(),
                },
                type: "post",
                cache: false,
                success: function (data) {
                    $('#rbGenerico' + id + '').empty();
                    $('#selectRepuestos' + id + '').append($('<option>', {
                        value: '',
                        text: ''
                    }));
                    for (var i = 0 ; i < data.length ; i++) {
                        $('#selectRepuestos' + id + '').append($('<option>', {
                            value: data[i].ref_codigo,
                            text: '('+data[i].ref_codigo + ') ' + data[i].ref_descripcion +' - ' +data[i].alias
                        }));
                    }
                    $('#selectRepuestos' + id + '').select2();
                }
            });
        }

        function rbModelos(id) {
            $('#selectRepuestos' + id + '').empty();
            $('#selectModelosCotizados' + r + '').empty();
            $('#selectModelosCotizados' + r + '').append($('<option>', {
                value: '',
                text: ''
            }));
            $('#contenido').show();
            for (var i = 1 ; i <= vehNumero ; i++) {
                var descripcionVehiculo = $('#descripcion' + i + '').val();
                var nombreVehiculo = $('#nombreVehiculo'+ i + '').val();
                if (typeof descripcionVehiculo === "undefined") {
                    // Valor de vehiculo eliminado de la tabla
                } else {
                    $('#selectModelosCotizados' + r + '').append($('<option>', {
                        value: descripcionVehiculo,
                        text: nombreVehiculo
                    }));
                }
            }
            //$('#selectModelosCotizados' + r + '').select2();
            $('#selectModelosCotizados' + r + '').select2();
            $('#filaVehiculosOculta' + r + '').show();
            $('#filaAccesoriosOculta' + r + '').hide();
        }

        function BuscarAccesoriosModeloEspecifico(id) {
            $.ajax({
                url: '/cotizacion/buscarRepuestosPorModelo',
                data: {
                    modelo: $('#selectModelosCotizados' + r + '').val()
                },
                type: "post",
                cache: false,
                success: function (data) {
                    $('#selectRepuestos' + id + '').empty();
                    $('#selectRepuestos' + id + '').append($('<option>', {
                        value: '',
                        text: ''
                    }));
                    for (var i = 0 ; i < data.length ; i++) {
                        $('#selectRepuestos' + id + '').append($('<option>', {
                            value: data[i].referencia,
                            text: data[i].descripcion
                        }));
                    }
                }
            });
        }
        /////////////////////////////////------------------------
        function buscarMarca() {
            $.ajax({
                url: '/cotizacion/Listas',
                data: {

                },
                type: "post",
                cache: false,
                success: function (data) {
                    $('.marca').empty();
                    $('.marca').append($('<option>', {
                        value: '',
                        text: ''
                    }));
                    for (var i = 0 ; i < data.length ; i++) {
                        $('.marca').append($('<option>', {
                            value: data.marca[i].id,
                            text: data.marca[i].nombre
                        }));
                    }
                }
            });
        }

        function costos(id) {
            $.ajax({
                url: '/cotizacion/buscarPrecioReferencia',
                data: {
                    idRepuesto: $('#selectRepuestos' + id + '').val()
                },
                type: "post",
                cache: false,
                success: function (data) {

                }, complete: function (data) {
                    if (data.responseText != '') {

                        $('#txtCostoAccesorio'+ id + '').val(addComas(data.responseJSON.precio1));
                    } else {
                        $('#txtCostoAccesorio' + id + '').val('0');
                    }
                }
            });
        }

        function calcularValorCotizacionAjax() {
            $("#tablaDetallesCotizacion").dataTable().fnDestroy();
            $("#tablaDetallesCotizacionAccesorio").dataTable().fnDestroy();
            $.ajax({
                url: '/cotizacion/CalcularTotalCotizacion',
                data: {
                    idCotizacion: $('#cotizacion_id').val()
                },
                type: "post",
                cache: false,
                success: function (data) {
                    $('#tablaDetallesCotizacion').find('tbody').empty();
                    for (var i = 0; i < data.listaVehiculos.length; i++) {
                        $('#tablaDetallesCotizacion').find('tbody').append('<tr>'
                            +'<td align="left">' + data.listaVehiculos[i].descripcion + '</td>'
                            +'<td align="right">'+ data.listaVehiculos[i].valor + '</td>'
                            +'<td align="right">'+ data.listaVehiculos[i].poliza + '</td>'
                            +'<td align="right">'+ data.listaVehiculos[i].matricula + '</td>'
                            +'<td align="left">'+ data.listaVehiculos[i].modeloretoma + '</td>'
                            +'<td align="right">' + data.listaVehiculos[i].vrretoma + '</td>'
                            +'<td width="5%">'
                                +'<button class="btn btn-info btn-xs" onclick="eliminarDetalle('+ '\'' + data.listaVehiculos[i].id_detalle+ '\')">&nbsp;&nbsp;Eliminar&nbsp;&nbsp;</button>'
                            +'</td>'
                            +'</tr>');
                    }

                    $('#tablaDetallesCotizacionAccesorio').find('tbody').empty();
                    for (var i = 0; i < data.listaAccesorios.length; i++) {
                        $('#tablaDetallesCotizacionAccesorio').find('tbody').append('<tr><td align="center">' + data.listaAccesorios[i].descripcion + '</td><td align="center">'
                                        + data.listaAccesorios[i].valor + '</td><td width="5%"><button class="btn btn-info btn-xs" onclick="eliminarDetalleAccesorio('
                                        + '\'' + data.listaAccesorios[i].id_detalle
                                        + '\')">&nbsp;&nbsp;Eliminar&nbsp;&nbsp;</button></td></tr>');
                    }
                    $('#cot_valortotal').val(data.totalCotizado);
                },
                complete: function(data) {
                    $('#tablaDetallesCotizacion').dataTable({
                        //dom: "<''<'col-sm-4'l><'col-sm-4 text-center'B><'col-sm-4'f>>t<'col-sm-4'i>p",
                        dom: "<''<'col-md-6'l><'col-md-6'f>>t<'col-md-4'i><'col-md-8 text-right'pB>",
                        "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
                        buttons: [
                        { extend: 'excel', className: 'btn-sm', text: 'Exportar a Excel' },
                        //{ extend: 'pdf', title: 'ExampleFile', className: 'btn-sm', text: 'PDF' },
                        //{ extend: 'print', className: 'btn-sm', text: 'Imprimir' }
                        ]
                    });

                    $('#tablaDetallesCotizacionAccesorio').dataTable({
                        //dom: "<''<'col-sm-4'l><'col-sm-4 text-center'B><'col-sm-4'f>>t<'col-sm-4'i>p",
                        dom: "<''<'col-md-6'l><'col-md-6'f>>t<'col-md-4'i><'col-md-8 text-right'pB>",
                        "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
                        buttons: [
                        { extend: 'excel', className: 'btn-sm', text: 'Exportar a Excel' },
                        //{ extend: 'pdf', title: 'ExampleFile', className: 'btn-sm', text: 'PDF' },
                        //{ extend: 'print', className: 'btn-sm', text: 'Imprimir' }
                        ]
                    });
                }
            });
        }

        function eliminarDetalle(valor) {
            event.preventDefault();
            $.ajax({
                url: '/cotizacion/eliminarVehiculo',
                data: {
                    idDetalle: valor,
                },
                type: "post",
                cache: false,
                success: function (data) {
                    if (data == true) {
                        calcularValorCotizacionAjax();
                    }
                }
            });
        }

        function eliminarDetalleAccesorio(valor) {
            event.preventDefault();
            $.ajax({
                url: '/cotizacion/eliminarAccesorio',
                data: {
                    idDetalle: valor,
                },
                type: "post",
                cache: false,
                success: function (data) {
                    if (data == true) {
                        calcularValorCotizacionAjax();
                    }
                }
            });
        }

        function validaCantModelos(estilo) {debugger
            event.preventDefault();
            $("#tablaPaginadaPrecioAnio").dataTable().fnDestroy();
            $.ajax({
                url: '/vlisretomas/GetCantidadModelo',
                data: {
                    estilo: estilo
                },
                type: "post",
                cache: false,
                success: function (data) {

                    $('#tablaPaginadaPrecioAnio').find('tbody').empty();
                    for (var i = 0; i < data.length; i++) {
                        $('#tablaPaginadaPrecioAnio').find('tbody').append('<tr><td align="center">'
                            + data[i].marca + '</td><td align="center">'
                            + data[i].estilo + '</td><td align="center">'
                            + data[i].anoModelo + '</td><td align="center"> $'
                            + addCommas(data[i].precio) + '</td></tr>');
                    }
                },
                complete: function (data) {

                    var test = $('#tablaPaginadaPrecioAnio').dataTable({
                        //dom: "<''<'col-sm-4'l><'col-sm-4 text-center'B><'col-sm-4'f>>t<'col-sm-4'i>p",
                        dom: "<''<'col-md-6'l><'col-md-6'f>>t<'col-md-4'i><'col-md-8 text-right'pB>",
                        "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
                        buttons: [
                        ]
                    });
                }
            });
            $('#modalPreciosRetomas').modal('hide');
            $('#modalPreciosPorAnio').modal('show');
        }

        function calcular() {
            $("#tablaCreditos").dataTable().fnDestroy();
            $('#tablaCreditos').find('tbody').empty();
            var valor_total = $("#valor_total").val();
            var tasa_interes = $("#tasa_interes").val();
            var cuota_inicial = $("#cuota_inicial").val();
            var cuotas = $("#cuotas2").val();

            if ($.trim(valor_total) != "" && $.trim(tasa_interes) != "" && $.trim(cuota_inicial) != "" && cuotas != null) {

                $("#informacionCredito").show();
                $('#mensaje_error').hide();

                var valorcredito = quitCommas($("#credito").val());
                debugger
                tasa_interespo = tasa_interes ;
                tasa_interes = parseFloat(tasa_interes);
                tasa_interes = tasa_interes / 100;
                var valor_credito = addCommas(valorcredito);

                for (var i = 0; i < cuotas.length; i++) {

                    var valor_total = 0;
                    cuotas[i] = parseInt(cuotas[i]);

                    var aux = valorcredito * tasa_interes;
                    var aux1 = 1 + tasa_interes;
                    var aux3 = Math.pow(aux1, - cuotas[i])
                    var aux2 = 1 - aux3;
                    valor_total = aux / aux2;
                    valor_total = valor_total.toFixed(2);
                    valor_total = Math.round(valor_total);
                    var valor_total_concomas = addCommas(valor_total);

                    $('#tablaCreditos').find('tbody').append('<tr>'
                                                +'<td align="center">$'+ valor_credito + '</td>'
                                                +'<td align="center">'+ tasa_interespo + '%</td>'
                                                +'<td align="center">'
                                                    +'<input type="hidden" id="cuota' + cuotas[i] + '" value="' + cuotas[i] + '">' + cuotas[i]
                                                + '</td>'
                                                +'<td align="center">'
                                                    +'<input type="hidden" id="valor_cuota'+ cuotas[i] +'" value="' + valor_total + '">$' + valor_total_concomas
                                                + '</td>'
                                                +'<td align="center">'+ $('#plan_id option:selected').text() + '</td>'
                                                +'<td align="center">'+ $("#valor_residual").val() + '</td>'
                                                +'<td align="center">'+ $("#otros_valores").val() + '</td>'
                                                +'</tr>');
                }
            } else {
                $('#mensaje_error').show();
                $('#cuerpo_mensaje_error').html('<i class="fa fa-times" aria-hidden="true" ></i> Por favor valide los campos requeridos (*)');
            }
        }

        function guardarPlanPago(){debugger
            var valor_total = $("#valor_total").val();
            var cuota_inicial = $("#cuota_inicial").val();
            var credito = $("#credito").val();
            var cuotas = $("#cuotas").val();
            //var plan_id = $("#plan_id").val();
            var plazos = "";
            var valor_cuota12 = $("#valor_cuota12").val();
            valor_cuota12 = parseFloat(valor_cuota12);

            for (var i = 0; i < cuotas.length; i++) {
                plazos += cuotas[i] + ",";
            }

            $.ajax({
                url: '/cotizacion/AgregarPlanPago',
                type: 'POST',
                data: {
                    valor_total: valor_total,
                    cuota_inicial: cuota_inicial,
                    cuotas: plazos,
                    credito: credito,
                    tasa_interes: $("#tasa_interes").val(),
                    // plan_id: $("#plan_id").val(),
                    cuota12: $("#cuota12").val(),
                    cuota24: $("#cuota24").val(),
                    cuota36: $("#cuota36").val(),
                    cuota48: $("#cuota48").val(),
                    cuota60: $("#cuota60").val(),
                    cuota72: $("#cuota72").val(),
                    cuota84: $("#cuota84").val(),
                    valor_cuota12: valor_cuota12,
                    valor_cuota24: $("#valor_cuota24").val(),
                    valor_cuota36: $("#valor_cuota36").val(),
                    valor_cuota48: $("#valor_cuota48").val(),
                    valor_cuota60: $("#valor_cuota60").val(),
                    valor_cuota72: $("#valor_cuota72").val(),
                    valor_cuota84: $("#valor_cuota84").val(),
                },
                beforeSend:function(objeto){
                    $('#mensaje_enviando').show();
                    $('#cuerpo_mensaje_enviando').html('<i class="fa fa-spinner text-center" aria-hidden="true" ></i> Enviando datos...')
                },
            }).done(function (result) {
                $('#mensaje_enviando').hide();
                if (result == 1) {
                    $("#mensaje").html('<i class="fa fa-check" aria-hidden="true" ></i> Plan de pago agregado con exito');
                    $("#mensaje").show();
                    //// OJO 1 create ///
                    $("#tasa_interes").val('');
                    $("#cuota_inicial").val('');
                    $("#credito").val('');

                    $("#cuotas2").val('').multiselect('refresh');
                    // $("#informacionCredito").hide();

                    /// OJO 1 create  ///
                    //setTimeout(function () {
                    //    $('#modalCredito').modal('hide');
                    //}, 1500);
                } else {
                    $("#mensaje_error").html('<i class="fa fa-times" aria-hidden="true" ></i> Error en guardar plan de pago');
                    $("#mensaje_error").show();
                }
            });
        }

        function addCommas(nStr) {
            nStr += '';
            x = nStr.split('.');
            x1 = x[0];
            x2 = x.length > 1 ? '.' + x[1] : '';
            var rgx = /(\d+)(\d{3})/;
            while (rgx.test(x1)) {
                x1 = x1.replace(rgx, '$1' + '.' + '$2');
            }
            return x1 + x2;
        };

        function quitCommas(nStr) {
            nStr.toString();
            //console.log(nStr);
            var s = nStr.replace(/\./g, "");
            return s;
        }

        function agregarDatosTercero(){
            $('#razon_social').val('');
            $('#prinom_tercero').val('');
            $('#segnom_tercero').val('');
            $('#apellido_tercero').val('');
            $('#segapellido_tercero').val('');

            $('#prinom_tercero').val($('#primer_nombre_modal').val());
            $('#segnom_tercero').val($('#segundo_nombre_modal').val());
            $('#apellido_tercero').val($('#primer_apellido_modal').val());
            $('#segapellido_tercero').val($('#segundo_apellido_modal').val());
            $('#direc_tercero').val($('#direccion_modal').val());
            $('#ciu_id').val($('#ciudad_id_modal').val()).select2();
            $('#telefono_tercero').val($('#telefono_modal').val());
            $('#gentercero_id').val($('#genero_id_modal').val()).select2();
            $('#correo').val($('#email_modal').val());
            $('#celular_tercero').val($('#celular_modal').val());
            $('#tporigen_id').val($('#fuente_modal').val());
            $('#subfuente_id').val($('#subfuente_modal').val());
            $('#razon_social').val($('#razon_social_modal').val());

            $('#tporigen_id').trigger('change');
            $('#modalTerceroBuscado').modal('hide');
            buscarVHinteresado();
            $('#subfuente_id').select2();
            $('#tporigen_id').select2();
        };

        function buscarClientePorDocumento() {
            $.ajax({
                url: '/cotizacion/BuscarClientePorDocumento',
                data: {
                    documento: $('#doc_tercero').val(),
                    tipoDocumento: $('#tpdoc_id').val()
                },
                type: "post",
                cache: false,
                success: function (data) {
                    console.log(data)
                    if (data.data.clienteExiste == true && data.data.terceroExiste == true) {
                        $('#razon_social_modal').val(data.data.razon_social);
                        $('#primer_nombre_modal').val(data.data.prinom_tercero);
                        $('#segundo_nombre_modal').val(data.data.segnom_tercero);
                        $('#primer_apellido_modal').val(data.data.apellido_tercero);
                        $('#segundo_apellido_modal').val(data.data.segapellido_tercero);
                        $('#direccion_modal').val(data.data.direc_tercero);
                        $('#telefono_modal').val(data.data.telf_tercero);
                        $('#ciudad_modal').val(data.data.ciudad_nombre);
                        $('#ciudad_id_modal').val(data.data.ciudad_direccionId);
                        $('#genero_id_modal').val(data.data.genero_tercero);
                        $('#email_modal').val(data.data.email_tercero);
                        $('#celular_modal').val(data.data.celular_tercero);
                        $('#fuente_modal').val(data.data.origen_id);
                        $('#subfuente_modal').val(data.data.subfuente);
                        $('#modalTerceroBuscado').modal('show');
                        $('#tabla_creditos').find('tbody').empty()
                        for (var i = 0; i < data.buscar_creditos.length; i++) {
                            $('#tabla_creditos').find('tbody').append(
                                '<tr>'
                                + '<td>' + data.buscar_creditos[i].estado + '</td>'
                                + '<td align="right">' + addCommas(data.buscar_creditos[i].valor) + '</td>'
                                + '<td align="right">' + addCommas(data.buscar_creditos[i].aprobado) + '</td>'
                                + '</tr>'
                            );
                        }
                        //    $('#prinom_tercero').val(data.data.prinom_tercero);
                        //    $('#segnom_tercero').val(data.data.segnom_tercero);
                        //    $('#apellido_tercero').val(data.data.apellido_tercero);
                        //    $('#segapellido_tercero').val(data.data.segapellido_tercero);
                        //    $('#gentercero_id').val(data.data.genero_tercero).select2();
                        //    $('#correo').val(data.data.email_tercero);
                        //    $('#telefono_tercero').val(data.data.telf_tercero);
                        //    $('#celular_tercero').val(data.data.celular_tercero);
                        //    $('#direc_tercero').val(data.data.direc_tercero);
                        //    $('#ciu_id').val(data.data.ciu_id).select2();
                        //    $('#tporigen_id').val(data.data.origen_id).select2();
                        //    $('#medcomun_id').val(data.data.medcomun_id).select2();
                        //    $('#asesorAsignado').val(data.data.asesor_id).select2();
                    } else if (data.data.terceroExiste == true && data.data.clienteExiste == false) {
                        //$('#alertaDocumentoBuscado').text('Documento no encontrado');
                        $('#mns_clienteNoExiste').html('<i class="fa fa-warning"></i>&nbsp;Cliente desactualizado, debe ser actualizado antes de continuar. <a class="text-warning" href="@Url.Action("update","icb_terceros")?id=' + data.data.tercero_id + '" target="_blank"><u>CLICK AQUÍ</u></a>');
                        $('#mns_clienteNoExiste').show();
                        $('#razon_social_modal').val(data.data.razon_social);
                        $('#primer_nombre_modal').val(data.data.prinom_tercero);
                        $('#segundo_nombre_modal').val(data.data.segnom_tercero);
                        $('#primer_apellido_modal').val(data.data.apellido_tercero);
                        $('#segundo_apellido_modal').val(data.data.segapellido_tercero);
                        $('#direccion_modal').val(data.data.direc_tercero);
                        $('#telefono_modal').val(data.data.telf_tercero);
                        $('#ciudad_modal').val(data.data.ciudad_nombre);
                        $('#ciudad_id_modal').val(data.data.ciudad_direccionId);
                        $('#genero_id_modal').val(data.data.genero_tercero);
                        $('#email_modal').val(data.data.email_tercero);
                        $('#celular_modal').val(data.data.celular_tercero);
                        $('#fuente_modal').val(data.data.origen_id);
                        $('#subfuente_modal').val(data.data.subfuente);
                        $('#modalTerceroBuscado').modal('show');
                        $('#tabla_creditos').find('tbody').empty()
                        for (var i = 0; i < data.buscar_creditos.length; i++) {
                            $('#tabla_creditos').find('tbody').append(
                                '<tr>'
                                + '<td>' + data.buscar_creditos[i].estado + '</td>'
                                + '<td align="right">' + addCommas(data.buscar_creditos[i].valor) + '</td>'
                                + '<td align="right">' + addCommas(data.buscar_creditos[i].aprobado) + '</td>'
                                + '</tr>'
                            )
                        }
                    } else if (data.data.terceroExiste == false && data.data.clienteExiste == false) {
                        $('#alertaDocumentoBuscado').text('Documento no encontrado');
                        $('#labelDocumentoNoExiste').show();
                        setTimeout(function () {
                            $('#labelDocumentoNoExiste').fadeOut(1500);
                        }, 3000);
                    }
                    //else{
                    //    $('#prinom_tercero').val('');
                    //    $('#segnom_tercero').val('');
                    //    $('#apellido_tercero').val('');
                    //    $('#segapellido_tercero').val('');
                    //    $('#gentercero_id').val('').select2();
                    //    $('#correo').val('');
                    //    $('#telefono_tercero').val('');
                    //    $('#celular_tercero').val('');
                    //    $('#direc_tercero').val('');
                    //    $('#ciu_id').val('').select2();
                    //    $('#tporigen_id').val('').select2();
                    //    $('#medcomun_id').val('').select2();
                    //    $('#asesorAsignado').val('').select2();
                    //}
                }
            });
        }

        function ValidarSiEsEvento() {
            var subFuenteSeleccionada = $('#subfuente_id').val();
            if (subFuenteSeleccionada == null) {
                subFuenteSeleccionada = $('#subfuente_modal').val();
            }
            var tipoOrigen = 0;
            if ($('#tporigen_id').val() != null && $('#tporigen_id').val() != '') {
                tipoOrigen = $('#tporigen_id').val();
            }
            $.ajax({
                url: '/prospectos/BuscarLugaresEvento',
                data: {
                    idOrigen: tipoOrigen
                },
                type: "post",
                cache: false,
                success: function (data) {
                    $('#eventoOrigen').empty();
                    $('#eventoOrigen').append($('<option>', {
                        value: '',
                        text: ''
                    }));

                    $('#subfuente_id').empty();
                    $('#subfuente_id').append($('<option>', {
                        value: '',
                        text: ''
                    }));

                    if (data.requiere == true) {
                        for (var i = 0; i < data.eventos.length; i++) {
                            $('#eventoOrigen').append($('<option>', {
                                value: data.eventos[i].id,
                                text: data.eventos[i].descripcion
                            }));
                        }
                        $('#eventoOrigen').select2();
                        $('#sitioEvento').show();
                        $('#eventoOrigen').prop('required', true);
                    } else {
                        $('#eventoOrigen').prop('required', false);
                        $('#eventoOrigen').append($('<option>', {
                            value: '0',
                            text: ''
                        }));
                        $("#eventoOrigen").val($("#eventoOrigen option:last").val());
                        $('#sitioEvento').hide();
                    }

                    if (data.requiereSubFuente == true) {
                        for (var i = 0; i < data.listaSubFuentes.length; i++) {
                            $('#subfuente_id').append($('<option>', {
                                value: data.listaSubFuentes[i].id,
                                text: data.listaSubFuentes[i].subfuente
                            }));
                        }
                        $('#subfuente_id').val(subFuenteSeleccionada).prop('style', 'visible:visible').select2();
                        //$('#subfuente_id').prop('required',true);
                        $('#areaSubfuente').show();
                    } else {
                        $('#subfuente_id').prop('required', false);
                        $('#areaSubfuente').hide();
                    }
                }
            });
        }

        function ValidarTipoDocumento(){
            $.ajax({
                url: '/cotizacion/BuscarSiEsNit',
                data: {
                    tpDocumento: $('#tpdoc_id').val()
                },
                type: "post",
                cache: false,
                success: function (data) {
                    if (data == true) {
                        $('.camposNombreYApellido').hide();
                        $('.divRazonSocial').show();
                        $('#ocupacion').prop('required', false)
                        //$('#digito_verificacion').prop("required", true);
                        //$('#razon_social').prop('required', true);
                        $('#prinom_tercero').prop('required', false);
                        $('#apellido_tercero').prop('required', false);
                        $('#gentercero_id').prop('required', false);
                    } else {
                        $('.divRazonSocial').hide();
                        $('.camposNombreYApellido').show();
                        //$('#ocupacion').prop('required', true)
                        $('#digito_verificacion').prop("required", false);
                        $('#razon_social').prop('required', false);
                        //$('#prinom_tercero').prop('required',true);
                        //$('#apellido_tercero').prop('required',true);
                        //$('#gentercero_id').prop('required',true);
                    }
                }
            });
        };

        function CompletarDireccion(){
            $('#direc_tercero').val($.trim($('#tp_via').val() + ' ' + $('#num_via').val() + ' ' + $('#sector_via').val() + ' ' + $('#num_via_generadora').val() + ' '
                + $('#num_placa').val() + ' ' + $('#sector_via_generadora').val() + ' ' + $('#otros').val()));
        };

        function buscarAjaxCotizaciones() {debugger
            if ($.fn.DataTable.isDataTable('#tablaPaginada') ) {
                $('#tablaPaginada').dataTable().fnDestroy();
            }

            //var table = $('#tablaPaginada').DataTable({
            //    "processing": true,
            //    "serverSide": true,
            //    "filter": true,
            //    "orderMulti": false,
            //    "searching": true,
            //    dom: "<''<'col-sm-4'l><'col-sm-4 text-center'B><'col-sm-4'f>>t<'col-sm-4'i>p",
            //    "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
            //    buttons: [
            //        //{ extend: 'csv', title: 'ExampleFile', className: 'btn-sm', text: 'Exportar a Excel' }
            //    ],
            //    "ajax": {
            //        "url": "/cotizacion/BuscarCotizacionesPaginadas",
            //        "type": "POST",
            //        "datatype": "json",
            //        "data": {
            //            inicio: $('#txtFechaInicio').val(),
            //            fin: $('#txtFechaFin').val()
            //        }
            //    },
            //    "columns": [
            //        { "data": "cot_numcotizacion", "name": "cot_numcotizacion", "autoWidth": true, className: "align-right" },
            //        { "data": "cot_feccreacion", "name": "cot_feccreacion", "autoWidth": true, className: "align-center" },
            //        { "data": "doc_tercero", "name": "doc_tercero", "autoWidth": true, className: "align-right" },
            //        { "data": "nombre", "name": "nombre", "autoWidth": true },
            //        { "data": "celular_tercero", "name": "celular_tercero", "autoWidth": true, className: "align-right" },
            //        { "data": "email_tercero", "name": "email_tercero", "autoWidth": true },
            //        { "data": "fuente", "name": "fuente", "autoWidth": true },
            //        { "data": "subfuente", "name": "subfuente", "autoWidth": true },
            //        { "data": "asesor", "name": "asesor", "autoWidth": true, className: "align-left" },
            //        { "data": "desTipoUltimoSeg", "name": "desTipoUltimoSeg", "autoWidth": true, className: "align-left" },
            //        { "data": "notaultimoSeg", "name": "notaultimoSeg", "autoWidth": true, className: "align-left" },
            //    {
            //        "mData": null,
            //        "bSortable": false,
            //        "mRender": function (o)
            //        {
            //            var botonRol = ""
            //            if ($('#rolLog').val() == 2029) {
            //                botonRol = '<button class="btn btn-warning btn-xs" onclick="activarProspecto(' +  o.cot_idserial + ',' + 1 + ')">&nbsp;&nbsp;Activar Asesor&nbsp;&nbsp;</button>';
            //            }else {
            //                botonRol = '<button class="btn btn-warning btn-xs" onclick="activarProspecto(' +  o.cot_idserial + ',' + 2 + ')">&nbsp;&nbsp;Activar Call Center&nbsp;&nbsp;</button>';
            //            }
            //            return '<center><button class="btn btn-info btn-xs" onclick="valida('+ o.cot_idserial +')">&nbsp;&nbsp;Ver&nbsp;&nbsp;</button>&nbsp;&nbsp;'
            //                                                +'<button class="btn btn-primary btn-xs" onclick="Seguimiento(' + o.cot_numcotizacion + ')">&nbsp;&nbsp;Seguimiento&nbsp;&nbsp;</button>&nbsp;&nbsp;'
            //                                                +'<button class="btn btn-success btn-xs" onclick="generarPDF2(' +  o.cot_idserial + ')">&nbsp;&nbsp;PDF&nbsp;&nbsp;</button>&nbsp;&nbsp;'
            //                                                + botonRol
            //                                                +'</center>';
            //        }
            //    }
            //    ]
            //});

            //$("#tablaPaginada").dataTable().fnDestroy();
            $.ajax({
                url: '/cotizacion/BuscarCotizacionesPaginadas',
                data: {
                    inicio: $('#txtFechaInicio').val(),
                    fin: $('#txtFechaFin').val()
                },
                type: "post",
                cache: false,
                success: function (data) {
                    console.log(data)
                    $('#tablaPaginada').find('tbody').empty();

                    for (var i = 0; i < data.buscaCotizacionSQL.length; i++) {
                        var botonRol = ""
                        if ($('#rolLog').val() == 2029) {
                            botonRol = '<button class="btn btn-warning btn-xs" onclick="activarProspecto(' + data.buscaCotizacionSQL[i].cot_idserial + ',' + 1 + ')">&nbsp;&nbsp;Activar Asesor&nbsp;&nbsp;</button>';
                        } else {
                            botonRol = '<button class="btn btn-warning btn-xs" onclick="activarProspecto(' + data.buscaCotizacionSQL[i].cot_idserial + ',' + 2 + ')">&nbsp;&nbsp;Activar Call Center&nbsp;&nbsp;</button>';
                        }

                        $('#tablaPaginada').find('tbody').append('<tr>'
                            + '<td align="right">' + data.buscaCotizacionSQL[i].cot_numcotizacion + '</td>'
                            + '<td align="left">' + data.buscaCotizacionSQL[i].cot_feccreacion + '</td>'
                            + '<td align="left">' + data.buscaCotizacionSQL[i].doc_tercero + '</td>'
                            + '<td align="left">' + data.buscaCotizacionSQL[i].nombre + '</td>'
                            + '<td align="left">' + data.buscaCotizacionSQL[i].celular_tercero + '</td>'
                            + '<td align="right">' + data.buscaCotizacionSQL[i].email_tercero + '</td>'
                            + '<td align="left">' + data.buscaCotizacionSQL[i].fuente + '</td>'
                            + '<td align="left">' + data.buscaCotizacionSQL[i].subfuente + '</td>'
                            + '<td align="left">' + data.buscaCotizacionSQL[i].asesor + '</td>'
                            + '<td align="right">' + data.buscaCotizacionSQL[i].desTipoUltimoSeg + '</td>'
                            + '<td align="right">' + data.buscaCotizacionSQL[i].notaultimoSeg + '</td>'
                            + '<td width="15%" align="center">'
                            + '<button class="btn btn-info btn-xs" onclick="valida(' + data.buscaCotizacionSQL[i].cot_idserial + ')">&nbsp;&nbsp;Ver&nbsp;&nbsp;</button>&nbsp;&nbsp;'
                            + '<button class="btn btn-primary btn-xs" onclick="Seguimiento(' + data.buscaCotizacionSQL[i].cot_idserial + ')">&nbsp;&nbsp;Seguimiento&nbsp;&nbsp;</button>&nbsp;&nbsp;'
                            + '<button class="btn btn-success btn-xs" onclick="generarPDF2(' + data.buscaCotizacionSQL[i].cot_idserial + ')">&nbsp;&nbsp;PDF&nbsp;&nbsp;</button>&nbsp;&nbsp;'
                            + botonRol
                            + '</td>'
                            + '</tr>');
                    }
                },
                complete: function (data) {
                    $('#tablaPaginada').dataTable({
                        dom: "<''<'col-md-6'l><'col-md-6'f>>t<'col-md-4'i><'col-md-8 text-right'pB>",
                        "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
                        buttons: []
                    });
                }
            });
        }

        function activarProspecto(id, tipo) {
            $('#bodega').val('').select2()
            $('#asignado').val('').select2()
            $('#observaciones').val('')
            $('#idCotActivacion').val('')
            $('#tipoActivacion').val(tipo)
            $.ajax({
                url: '/cotizacion/buscarInfoActivacion',
                data: {
                    tipo: tipo
                },
                type: "post",
                cache: false,
                success: function (data) {
                    console.log(data)
                    if (data.tipo == 1) {
                        $('#tituloModal').text('Activar Asesor')
                        $('#requiereBodega').show();
                        $('#idCotActivacion').val(id)
                        $('#bodega').empty();

                        $('#bodega').append($('<option>', {
                            value: '',
                            text: ''
                        }));
                        for (var i = 0; i < data.info.length; i++) {
                            $('#bodega').append($('<option>', {
                                value: data.info[i].id,
                                text: data.info[i].nombre
                            }));
                        }
                    }
                    if (data.tipo ==2) {
                        $('#tituloModal').text('Activar Call Center')
                        $('#requiereBodega').hide();
                        $('#idCotActivacion').val(id)
                        $('#asignado').empty();

                        $('#asignado').append($('<option>', {
                            value: '',
                            text: ''
                        }));
                        for (var i = 0; i < data.info.length; i++) {
                            $('#asignado').append($('<option>', {
                                value: data.info[i].id,
                                text: data.info[i].nombre
                            }));
                        }
                    }
                },
                complete: function (data){
                    $('#modalActivacion').modal('show');
                }
            });
        }

        $('#bodega').change(function(){
            $.ajax({
                url: '/cotizacion/buscarAsesorBodega',
                data: {
                    idBodega: $('#bodega').val()
                },
                type: "post",
                cache: false,
                success: function (data) {
                    $('#asignado').empty();

                    $('#asignado').append($('<option>', {
                        value: '',
                        text: ''
                    }));
                    for (var i = 0; i < data.length; i++) {
                        $('#asignado').append($('<option>', {
                            value: data[i].id,
                            text: data[i].nombre
                        }));
                    }
                }
            });
        });

        function guardarActivacion() {
            if ($('#asignado').val() != "" && $('#observaciones').val() != "") {
                $('#msjCamposObligatorios').hide('1000')
                $.ajax({
                    url: '/cotizacion/guardarActivacion',
                    data: {
                        idCot: $('#idCotActivacion').val(),
                        usuario: $('#asignado').val(),
                        nota: $('#observaciones').val()
                    },
                    type: "post",
                    cache: false,
                    success: function (data) {
                        console.log(data)
                        if (data.exito = true) {
                            $('#modalActivacion').modal('hide');
                            swal("Exito!", "La activación se ha realizado con éxito", "success");
                        }else {
                            $('#modalActivacion').modal('hide');
                            swal("Error!", "La activación no se pudo realizar con éxito", "error");
                        }
                    },
                    complete: function (data){
                    }
                });
            }else {
                $('#msjCamposObligatorios').show('1000')
            }
        }

        function planPago(valor, modelo) {debugger
            var flagBTN = 0;
            var array = [];
            var cont = 0;
            if (multiplesListas == "") {
                $('#valor_total').val(addCommas(valor));
                $("#tasa_interes").val('');
                $("#cuota_inicial").val('');
                $("#credito").val('');
                $("#cuotas2").val('').multiselect('refresh');
                $("#informacionCredito").show();
                $('#modalCredito').modal('show');
                $('#codigo_modelo').val(modelo);
                var xcc = @ViewBag.cotizacionn;
                var xccc = parseInt(xcc);
            }else {
                $('#tablaPlanPagoAgregados').find('tbody').empty();
                $('#tablaPlanPagoAgregados').find('tfoot').empty();
                for(var j = 0; j < multiplesListas.length; j++){
                    if (multiplesListas[j][19] == modelo) {
                        array[cont] = multiplesListas[j]
                        cont++
                    }
                }
                if (array.length == 0) {
                    $('#valor_total').val(addCommas(valor));
                    $("#tasa_interes").val('');
                    $("#cuota_inicial").val('');
                    $("#credito").val('');
                    $("#cuotas2").val('').multiselect('refresh');
                    $("#informacionCredito").show();
                    $('#modalCredito').modal('show');
                    $('#codigo_modelo').val(modelo);
                    var xcc = @ViewBag.cotizacionn;
                    var xccc = parseInt(xcc);
                }else{
                    var str = array;
                    var valorVH  = [];
                    for (var i = 0; i < str.length; i++) {
                        $('#tablaPlanPagoAgregados').find('tbody').append('<tr id="planpago' + i + '">'
                                +'<td align="right">'+ str[i][23] + '</td>'
                                +'<td align="right">' + addCommas(str[i][1]) + '</td>'
                                +'<td align="right">' + str[i][2] + '</td>'
                                +'<td align="center">'
                                    +'<button type="button" class="btn btn-info btn-sm"  id="detallePlanPago" onclick="detallePlanPago('+str[i][23]+')">Ver</button>'
                                +'</td>'
                            +'</tr>');
                        if (flagBTN == 0) {
                            $('#tablaPlanPagoAgregados').find('tfoot').append('<tr>'
                                                    +'<td align="center" colspan="4">'
                                                        +'<button type="button" class="btn btn-info"  id="registrarlPlanPago" onclick="registrarNuevoPlanPago('+str[i][0]+','+'\''+str[i][19]+'\')">Registrar nuevo</button>'
                                                    +'</td>'
                                                +'</tr>');
                            flagBTN = 1;
                        }
                        $('#modalPlanPagoAgregados').modal('show');
                    }
                }
            }
        }

        function detallePlanPago(id){
            for(var j = 0; j < multiplesListas.length; j++){
                if (multiplesListas[j][23] == id) {
                    var plazosElegidos = multiplesListas[j][2].split(",")
                    $('#valor_totalDetalle').val(addCommas(multiplesListas[j][0]));
                    $("#cuota_inicialDetalle").val(addCommas(multiplesListas[j][1]));
                    $("#cuotas2Detalle").val(plazosElegidos).trigger('change');

                    $('#cuotas2Detalle').multiselect("destroy").multiselect({
                        includeSelectAllOption: true,
                        maxHeight: 400,
                        dropUp: false
                    });
                    $('#cuotas2Detalle').multiselect('refresh');

                    $("#creditoDetalle").val(addCommas(multiplesListas[j][3]));
                    $("#tasa_interesDetalle").val(multiplesListas[j][4]);
                    $('#codigo_modeloDetalle').val(multiplesListas[j][19]);
                    $("#plan_idDetalle").val(multiplesListas[j][20]).select2();
                    $("#valor_residualDetalle").val(addCommas(multiplesListas[j][21]));
                    $("#otros_valoresDetalle").val(addCommas(multiplesListas[j][22]));
                    $("#informacionCreditotablaCreditosDetalle").show();
                    calcularDetalle()
                }
            }

            $('#modalDetallePlanPago').modal('show');
        }

        function calcularDetalle() {
            $("#tablaCreditosDetalle").dataTable().fnDestroy();
            $('#tablaCreditosDetalle').find('tbody').empty();
            var valor_total = $("#valor_totalDetalle").val();
            var tasa_interes = $("#tasa_interesDetalle").val();
            var cuota_inicial = $("#cuota_inicialDetalle").val();
            var cuotas = $("#cuotas2Detalle").val();

            if ($.trim(valor_total) != "" && $.trim(tasa_interes) != "" && $.trim(cuota_inicial) != "" && cuotas != null) {

                $("#informacionCreditotablaCreditosDetalle").show();
                $('#mensaje_error').hide();

                var valorcredito = quitCommas($("#creditoDetalle").val());
                tasa_interespor = tasa_interes;
                tasa_interes = parseFloat(tasa_interes);
                tasa_interes = tasa_interes / 100;
                var valor_credito = addCommas(valorcredito);

                for (var i = 0; i < cuotas.length; i++) {

                    var valor_total = 0;
                    cuotas[i] = parseInt(cuotas[i]);

                    var aux = valorcredito * tasa_interes;
                    var aux1 = 1 + tasa_interes;
                    var aux3 = Math.pow(aux1, - cuotas[i])
                    var aux2 = 1 - aux3;
                    valor_total = aux / aux2;
                    valor_total = valor_total.toFixed(2);
                    valor_total = Math.round(valor_total);
                    var valor_total_concomas = addCommas(valor_total);

                    $('#tablaCreditosDetalle').find('tbody').append('<tr>'
                                                +'<td align="center">$'+ valor_credito + '</td>'
                                                +'<td align="center">'+ tasa_interespor + '%</td>'
                                                +'<td align="center">'
                                                    +'<input type="hidden" id="cuota' + cuotas[i] + '" value="' + cuotas[i] + '">' + cuotas[i]
                                                + '</td>'
                                                +'<td align="center">'
                                                    +'<input type="hidden" id="valor_cuota'+ cuotas[i] +'" value="' + valor_total + '">$' + valor_total_concomas
                                                + '</td>'
                                                +'<td align="center">'+ $('#plan_id option:selected').text() + '</td>'
                                                +'<td align="center">'+ $("#valor_residual").val() + '</td>'
                                                +'<td align="center">'+ $("#otros_valores").val() + '</td>'

                                                +'</tr>');
                }
            } else {
                $('#mensaje_error').show();
                $('#cuerpo_mensaje_error').html('<i class="fa fa-times" aria-hidden="true" ></i> Por favor valide los campos requeridos (*)')
            }
        }

        function registrarNuevoPlanPago(valor, modelo) {debugger
            $('#modalPlanPagoAgregados').modal('hide');
            $('#valor_total').val(addCommas(valor));
            $("#tasa_interes").val('');
            $("#cuota_inicial").val('');
            $("#credito").val('');
            $("#cuotas2").val('').multiselect('refresh');
            $("#informacionCredito").show();
            $('#modalCredito').modal('show');
            $('#codigo_modelo').val(modelo);
            var xcc = @ViewBag.cotizacionn;
            var xccc = parseInt(xcc);
        }

        function MostrarTodosPlanes(xcotizacionid) {debugger
            $("#informacionCredito").show();
            $("#tablaCreditos").dataTable().fnDestroy();
            $('#tablaCreditos').find('tbody').empty();

            $.ajax({
                url: '/cotizacion/BuscarPlanesPagoCotizacion',
                data: {
                    xcotizacionid: xcotizacionid
                },
                type: "post",
                cache: false,
                success: function (data) {
                    for (var i = 0; i < data.length ; i++)
                    {

                        $('#tablaCreditos').find('tbody').append('<tr>'
                                +'<td align="center">$' + addCommas(data[i].credito) + '</td>'
                                +'<td align="center">' + data[i].tasa_interes  + '%</td>'
                                +'<td align="center">'
                                    +'<input type="hidden" id="cuota' + data[i].plazo + '" value="' + data[i].plazo + '">'
                                    + data[i].plazo
                                +'</td>'
                                +'<td align="center">'
                                    +'<input type="hidden" id="valor_cuota'+  addCommas(data[i].valor) +'" value="' +  addCommas(data[i].valor) + '">$'
                                    + addCommas(data[i].valor)
                                +'</td>'
                                +'<td align="center">'+ data[i].plan_nombre  + '</td>'
                                +'<td align="center">'+ data[i].valor_residual  + '</td>'
                                +'<td align="center">'+ data[i].otros_valores  +'</td>'
                            +'</tr>');
                    }
                },
                //complete: function (data) {
                //    $('#tablaCreditos').dataTable({
                //        dom: "<''<'col-md-6'l><'col-md-6'f>>t<'col-md-4'i><'col-md-8 text-right'pB>",
                //        "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
                //        buttons: []
                //    });
                //}
            });
        }

        function valida(id) {
            window.location.href = '@Url.Action("Ver", "cotizacion")?menu='+@ViewBag.id_menu+'&&id=' + id;
        }

        function Seguimiento(id) {
            window.location.href = '@Url.Action("Seguimiento", "cotizacion")?menu='+@ViewBag.id_menu+'&&id=' + id;
        }

        function AgregarQuitarFavorito(){
            $.ajax({
                url: '/Inicio/AgregarQuitarFavorito',
                data: {
                    id_menu: @ViewBag.id_menu,
                },
                type: "post",
                cache: false,
                success: function (data) {
                    if (data.esFavorito == true) {
                        $('#areaFavoritos').html("<i class='fa fa-close'></i>&nbsp;&nbsp;<a href='#' onclick='AgregarQuitarFavorito();return false;'>Quitar de Favoritos</a>");
                    } else {
                        $('#areaFavoritos').html("<i class='fa fa-check'></i>&nbsp;&nbsp;<a href='#' onclick='AgregarQuitarFavorito();return false;'>Agregar a Favoritos</a>");
                    }
                }
            });
        }

        var multiplesListas=[];
        var multiplesListasJson="";
        var idPlanPagoAgregado = 1;
        $('#addLista').click(function agregarLista(e) {debugger
            $("#valor_total").prop('required', true);
            //$("#tasa_interes").val('');
            var valor_total = $("#valor_total").val().replace(/\./g, "");
            var cuota_inicial = $("#cuota_inicial").val().replace(/\./g, "");
            var credito = $("#credito").val().replace(/\./g, "");
            var cuotas = $("#cuotas2").val();
            //var plan_id = $("#plan_id").val();
            var plazos = "";
            var valor_cuota12 = $("#valor_cuota12").val();
            valor_cuota12 = parseFloat(valor_cuota12);
            if (cuotas != null) {
                for (var i = 0; i < cuotas.length; i++) {
                    plazos += cuotas[i] + ",";
                }
            };
            var lista = [];

            var form = $('#formcredito');
            var valid = this.form.checkValidity();
            var aux = '@ViewBag.Cotizacionn'

            valor_total = valor_total;
            cuota_inicial = cuota_inicial;
            cuotas = plazos;
            credito = credito;
            tasa_interes = $("#tasa_interes").val();
            cuota12 = $("#cuota12").val();
            cuota24 = $("#cuota24").val();
            cuota36 = $("#cuota36").val();
            cuota48 = $("#cuota48").val();
            cuota60 = $("#cuota60").val();
            cuota72 = $("#cuota72").val();
            cuota84 = $("#cuota84").val();
            valor_cuota12 = valor_cuota12;
            valor_cuota24 = $("#valor_cuota24").val();
            valor_cuota36 = $("#valor_cuota36").val();
            valor_cuota48 = $("#valor_cuota48").val();
            valor_cuota60 = $("#valor_cuota60").val();
            valor_cuota72 = $("#valor_cuota72").val();
            valor_cuota84 = $("#valor_cuota84").val();
            modelo = $('#codigo_modelo').val();
            var planFinanciero = $('#plan_id').val();
            if (planFinanciero == "") {
                plan_id = 0
            } else {
                plan_id = $('#plan_id').val();
            }
            valor_residual = parseInt(quitCommas($('#valor_residual').val()));
            otros_valores = parseInt(quitCommas($('#otros_valores').val()));

            lista = [valor_total, cuota_inicial, cuotas, credito, tasa_interes, cuota12, cuota24, cuota36, cuota48, cuota60, cuota72, cuota84, valor_cuota12, valor_cuota24, valor_cuota36,
                valor_cuota48, valor_cuota60, valor_cuota72, valor_cuota84, modelo, plan_id, valor_residual, otros_valores, idPlanPagoAgregado];
            multiplesListas.push(lista);
            multiplesListasJson = JSON.stringify(multiplesListas);
            console.log(multiplesListasJson);
            $('#txt_json_listas').val(multiplesListasJson);
            idPlanPagoAgregado++;
            $('#modalCotizacion').hide();
            $('#modalCreacionPlanPago').show();
            $('#modalCredito').modal('hide');
            $('#cerrarModalPlanPago').click(function () {
                $('#modalCreacionPlanPago').hide();
            });
        });

        $('#dpto_id').change(function () {
            $.ajax({
                url: '/cotizacion/buscarCuidadesDepartamento',
                data: {
                    id: $('#dpto_id').val()
                },
                type: "post",
                cache: false,
                success: function (data) {
                    console.log(data)
                    $('#ciu_id').empty();
                    $('#ciu_id').append($('<option>', {
                        value: '',
                        text: ''
                    }));
                    for (var i = 0; i < data.length; i++) {
                        $('#ciu_id').append($('<option>', {
                            value: data[i].ciu_id,
                            text: data[i].ciu_nombre
                        }));
                    }
                    //$('#ciu_id').select2();
                }
            });
        });

        function formatNumber3(n) {
            var m = n;
            var nn = m.indexOf(".");
            if (nn != -1) {
                var n2 = n.split('.', 2);
                m = n2[0];
                if (m === '') {
                    return m;
                }
                else {
                    var o = n2[1];
                    o = String(o).replace(/\D/g, "");
                    m = String(m).replace(/\D/g, "");
                    //m=String(m).replace(/\B(?=(\d{3})+(?!\d))/g, ".");
                    m = m +'.'+ o;
                    return m;
                }
            }
            else {
                m = String(m).replace(/\D/g, "");
                //return m === '' ? m : String(n).replace(/\B(?=(\d{3})+(?!\d))/g, ".");
                return m;

            }
            // return n === '' ? n : Number(n).toLocaleString();
        }

        function miles3(id) {
            debugger;
            numero_miles = formatNumber3($('#' + id + '').val());
            $('#' + id + '').val(numero_miles);
            console.log($('#' + id + '').val);
        }

    </script>
    @if (TempData["mensaje_correcto"] != null)
    {
        <script type="text/javascript">
            debugger
        //alert('Numero de cotizacion generado : ' + @*@ViewBag.numCotizacionCreada);*@
            $('#modalCotizacion').show();
        </script>
    }
}

@if (Session["user_rolid"] != null && (Session["user_rolid"].ToString() == "4" || Session["user_rolid"].ToString() == "2030"))
{
    <script type="text/javascript">
        debugger
        // SI EL ROL ACTUAL ES ASESOR ENTONCES QUEDA ASIGNADO AL ASESOR ACTUAL Y NO SE MUESTRA LA LISTA DESPLEGABLE PARA ASIGNAR UN ASESOR
        $('#asesorAsignado').val(@Session["user_usuarioid"].ToString());
        //$('#asesorAsignado').select2();
        $('#asesorAsignado option:not(:selected)').attr('disabled', true);
    </script>

}