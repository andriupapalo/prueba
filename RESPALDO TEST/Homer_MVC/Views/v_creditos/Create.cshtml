@using System.Globalization;
@model Homer_MVC.IcebergModel.v_creditosform
@{
    ViewBag.Icono = "fa fa-credit-card-alt";
    ViewBag.Title = "Solicitud Creditos";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section Styles {
    @Styles.Render("~/bundles/select2/css")
    <link rel="stylesheet" href="https://demos.jquerymobile.com/1.4.2/css/themes/default/jquery.mobile-1.4.2.min.css">
    <link href="~/Vendor/datatables.net-bs/css/dataTables.bootstrap.min.css" rel="stylesheet" />
    <link href="~/Vendor/bootstrap-datepicker-master/dist/css/bootstrap-datepicker.min.css" rel="stylesheet" />
    <link href="~/Vendor/eonasdan-bootstrap-datetimepicker/build/css/bootstrap-datetimepicker.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link href="~/Content/toastr.min.css" rel="stylesheet" />
    <link href="~/Content/Site.css" rel="stylesheet" />
    <style>
        .ui-slider-range {
            background-color: #3498db;
        }
    </style>
}

<div class="panel-body">
    <div class="panel-heading" style="background-color:white;  border:solid 1px; border-color:#e4e5e7">
        <div class="panel-body">

            <div id="hbreadcrumb" class="pull-right">

                <button type="button" class="btn btn-mini btn-default" style="border-radius:25px" data-container="body" data-toggle="popover" data-placement="left" data-title="Enlaces" data-content="<ul>@ViewBag.nombreEnlaces</ul>" data-html="true">
                    <i class="text-info fa fa-tags"></i>
                </button>
                <button type="button" class="btn btn-mini btn-default" style="border-radius:25px" data-container="body" data-toggle="popover" data-placement="left" data-title="Documentos" data-content="<ul></i><a href=''>Documento 1</a></ul>  <ul></i><a href=''>Documento 2</a></ul> <ul></i><a href=''>Documento 3</a></ul>" data-html="true">
                    <i class="text-primary fa fa-files-o"></i>
                </button>
                <button type="button" class="btn btn-mini btn-default" style="border-radius:25px" data-container="body" data-toggle="popover" data-placement="left" data-title="Favoritos" data-content="@ViewBag.Favoritos" data-html="true">
                    <i class="text-warning fa fa-star"></i>
                </button>

            </div>
            <h3 class="font-light m-b-xs">
                <i class="text-info @ViewBag.Icono"></i>&nbsp;&nbsp;@ViewBag.Title
            </h3>
            <small>Registro de @ViewBag.Title</small>
        </div>
    </div>
</div>

<div class="panel-body" style="padding-top:0px;">
    <div class="hpanel">
        @if (TempData["mensaje"] != null)
        {
            <br />
            <div class="alert alert-success  alert-dismissible">
                <button type="button" class="close" data-dismiss="alert" arial-label="close"><span aria-hidden="true">&times;</span></button>
                <p><i class="fa fa-check fa-2x"></i> @TempData["mensaje"]</p>
            </div>
        }

        @if (TempData["mensaje_error"] != null)
        {
            <br />
            <div class="alert alert-danger  alert-dismissible">
                <button type="button" class="close" data-dismiss="alert" arial-label="close"><span aria-hidden="true">&times;</span></button>
                <p><i class="fa fa-times fa-2x"></i> @TempData["mensaje_error"]</p>
            </div>
        }

        <div id="tabs" class="tab-content">
            <div class="m float-e-margins text-right">
                <div class="tooltip-demo">
                    <div id="div-mensaje"></div>
                </div>
            </div>

            <ul id="tabs-crear" class="nav nav-tabs">
                <li class="active"><a data-toggle="tab" href="#crear"><i class="@ViewBag.Icono"></i>&nbsp;&nbsp;Crear</a></li>
                <li class="" onclick="buscarDatos();"><a data-toggle="tab" href="#buscar"><i class="fa fa-search"></i>&nbsp;&nbsp;Búsquedas</a></li>
            </ul>

            <div id="crear" class="tab-pane active">
                <div class="panel-body">

                    @using (Html.BeginForm())
                    {
                        <div class="panel-body-btns text-right">
                            <button class="btn btn-info" type="submit"><i class="fa fa-save"></i>&nbsp;&nbsp;&nbsp;Guardar</button>
                        </div>

                        @Html.AntiForgeryToken()
                        @Html.Hidden("idtercero")
                        @Html.Hidden("idvehiculo")
                        @Html.Hidden("menu")

                        <div class="form-horizontal">

                            @Html.ValidationSummary(true, "", new { @class = "text-danger" })

                            <div class="hpanel">
                                <div class="panel-heading hbuilt" style="background-color:#e4e5e7">
                                    <div class="panel-tools">
                                        <a class="showhide"><i class="fa fa-chevron-up"></i></a>
                                    </div>
                                    Datos del Solicitante
                                </div>
                                <div class="panel-body">

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4 text text-primary">Pedido: #</label>
                                            <div class="col-md-7">
                                                @Html.DropDownList("pedido", null, "Seleccione", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione"  /*, @onclick = "return pedidonit(this.id)"*/ })
                                                @Html.ValidationMessageFor(model => model.pedido, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Cédula / Nit 1:<span class="text-danger">*</span></label>
                                            <div class="col-md-7">
                                                @Html.DropDownListFor(model => model.tercero, null, "Seleccione", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione", @name = "tercero", @required = "required" })
                                            </div>
                                        </div>
                                    </div>


                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4 text text-primary">Correo:</label>
                                            <div class="col-md-7">
                                                <input id="correo" name="correo" class="form-control" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4 text text-primary">Teléfono:</label>
                                            <div class="col-md-7">
                                                <input id="telefono" name="telefono" class="form-control" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4 text text-primary">Dirección:</label>
                                            <div class="col-md-7">
                                                <input id="direccion" name="direccion" class="form-control" />
                                            </div>
                                        </div>
                                    </div>



                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Cédula / Nit 2:</label>
                                            <div class="col-md-7">
                                                @Html.DropDownList("tercero2", null, "Seleccione", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione", @name = "tercero", })
                                            </div>
                                        </div>
                                    </div>


                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Vehículo:<span class="text-danger">*</span></label>
                                            <div class="col-md-7">
                                                @Html.DropDownList("vehiculo", null, "Seleccione", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione", @required = "required" })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">A&ntilde;o Modelo:<span class="text-danger">*</span></label>
                                            <div class="col-md-7">
                                                <select name="id_anio_modelo" id="id_anio_modelo" class="form-control js-source-states">
                                                    <option></option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4 text text-primary">Valor Vehiculo:</label>
                                            <div class="col-md-7">
                                                <input id="tot_vehiculo" name="tot_vehiculo" class="form-control" onkeyUp="return miles(this.id)" />
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-12" style="display:none" id="infoSolicitante1">
                                        <div class="table-responsive">
                                            <div id="div-mensaje-buscar"></div>
                                            <table class="table table-striped table-bordered table-hover" id="tablaPaginadaSolicitante">
                                                <thead>
                                                    <tr>
                                                        <th style="text-align:center">Cliente</th>
                                                        <th style="text-align:center">Ciudad</th>
                                                        <th style="text-align:center">Telefono</th>
                                                        <th style="text-align:center">Celular</th>
                                                        <th style="text-align:center">Email</th>
                                                    </tr>
                                                </thead>
                                                <tbody></tbody>
                                            </table>
                                        </div>
                                    </div>

                                    <br />
                                    <div class="col-sm-6">
                                        <div class="form-group">

                                            <p class="col-md-4" style="text-align:right">
                                                <label for="amount">Salario:<input type="text" id="amount" readonly style="border:0; color:#6a6c6f; font-weight:bold;text-align:right;"></label>
                                            </p>
                                            <input id="salario" name="salario" class="form-control" value="@ViewBag.salario" placeholder="Digite salario" type="hidden" />
                                            <div id="slider-range" class="col-md-7" style="color:blue;"></div>
                                            @*<label class="control-label col-md-4 text text-primary">Salario:</label>
                                                <div class="col-md-7">
                                                <input id="salario" name="salario" class="form-control" value="@ViewBag.salario" placeholder="Digite salario" onkeyup="return miles(this.id)" />
                                                </div>*@
                                        </div>
                                    </div>

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4 text text-primary">Comisiones:</label>
                                            <div class="col-md-7">
                                                <input id="comisiones" name="comisiones" class="form-control" value="@ViewBag.comisiones" placeholder="Digite comisiones" onkeyup="return miles(this.id)" />
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4 text text-primary">Arriendo:</label>
                                            <div class="col-md-7">
                                                <input id="arriendo" name="arriendo" class="form-control" value="@ViewBag.arriendo" placeholder="Digite arriendo" onkeyup="return miles(this.id)" />
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4 text text-primary">Otros:</label>
                                            <div class="col-md-7">
                                                <input id="otros" name="otros" class="form-control" value="@ViewBag.otros" placeholder="Digite otros" onkeyup="return miles(this.id)" />
                                            </div>
                                        </div>
                                    </div>

                                    @* <div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="control-label col-md-4 text text-primary">Prestamos:</label>
                                                <div class="col-md-7">
                                                    <input id="prestamo" name="prestamo" class="form-control" value="@ViewBag.prestamo" placeholder="Digite prestamo" onkeyup = "return miles(this.id)" />
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="control-label col-md-4 text text-primary">Tarjetas:</label>
                                                <div class="col-md-7">
                                                    <input id="tarjetas" name="tarjetas" class="form-control" value="@ViewBag.tarjetas" placeholder="Digite tarjetas"  onkeyup = "return miles(this.id)"/>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="control-label col-md-4 text text-primary">Hipotecas:</label>
                                                <div class="col-md-7">
                                                    <input id="hipotecas" name="hipotecas" class="form-control" value="@ViewBag.hipotecas" placeholder="Digite hipotecas" onkeyup = "return miles(this.id)"/>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="control-label col-md-4 text text-primary">Sostenimento:</label>
                                                <div class="col-md-7">
                                                    <input id="sostenimiento" name="sostenimiento" class="form-control" value="@ViewBag.sostenimiento" placeholder="Digite sostenimiento" onkeyup = "return miles(this.id)"/>
                                                </div>
                                            </div>
                                        </div>*@

                                </div>
                            </div>

                            <div class="hpanel" id="panelCredito">
                                <div class="panel-heading hbuilt" style="background-color:#e4e5e7">
                                    <div class="panel-tools">
                                        <a class="showhide"><i class="fa fa-chevron-up"></i></a>
                                    </div>
                                    Datos del Credito
                                </div>
                                <div class="panel-body">

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4 text text-primary">Estado Credito:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-7">
                                                @Html.DropDownList("estadoc", null, "", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione", @required = "required" })
                                                @Html.ValidationMessageFor(model => model.estadoc, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-6" @*id="div_plan_id" style="display: none"*@>
                                        <div class="form-group">
                                            <label class="control-label col-md-4 text text-primary">Plan:&nbsp;<span class="text-danger"></span></label>
                                            <div class="col-md-7">
                                                @Html.DropDownList("plan_id", null, "Seleccione...", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione" })
                                                @Html.ValidationMessageFor(model => model.plan_id, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>


                                    @*<div class="row">
                                            <div class="col-sm-6 desembolso">
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">Póliza: <span class="text-danger">*</span></label>
                                                    <div class="col-md-6">
                                                        @Html.EditorFor(model => model.poliza, new { htmlAttributes = new { @class = "form-control fecha_a" } })
                                                         @Html.ValidationMessageFor(model => model.poliza, "", new { @class = "text-danger" })
                                                    </div>
                                                </div>
                                            </div>
                                        </div>*@




                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4 text text-primary">Financiera:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-7">
                                                @Html.DropDownList("financiera_id", null, "Seleccione...", htmlAttributes: new { @class = "form-control js-source-states", @required = "required" })
                                                @Html.ValidationMessageFor(model => model.financiera_id, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Fecha Solicitud: <span class="text-danger">*</span></label>
                                            <div class="col-md-7">
                                                @Html.EditorFor(model => model.fec_solicitud, new { htmlAttributes = new { @class = "form-control fecha", @required = "required", @onchage = "fncio" } })
                                                @Html.ValidationMessageFor(model => model.fec_solicitud, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Valor Solicitado:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-7">
                                                @*@Html.EditorFor(model => model.vsolicitado, new { htmlAttributes = new { @class = "form-control", @required = "" } })*@
                                                @Html.EditorFor(model => model.vsolicitado, new { htmlAttributes = new { @class = "form-control", @placeholder = "Ingrese el valor solicitado", @required = "required", @onkeyup = "return miles(this.id)" } })
                                                @Html.ValidationMessageFor(model => model.vsolicitado, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6" id="div_fec_envdocumentos">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Fecha Envío Documento: <span class="text-danger">*</span></label>
                                            <div class="col-md-7">
                                                @Html.EditorFor(model => model.fec_envdocumentos, new { htmlAttributes = new { @class = "form-control fecha", @required = "required" } })
                                                @Html.ValidationMessageFor(model => model.fec_envdocumentos, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>

                                    @*<div class="col-sm-6" id="div_fec_entdocumentos">
                                            <div class="form-group">
                                                <label class="control-label col-md-4">Fecha Entrada Documento:&nbsp;</label>
                                                <div class="col-md-6">
                                                    @Html.EditorFor(model => model.fec_entdocumentos, new { htmlAttributes = new { @class = "form-control" } })
                                                    @Html.ValidationMessageFor(model => model.fec_entdocumentos, "", new { @class = "text-danger" })
                                                </div>
                                            </div>
                                        </div>*@

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Plazo Solicitado:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-7">
                                                @Html.EditorFor(model => model.plazo, new { htmlAttributes = new { @class = "form-control", @required = "required", @placeholder = "Ingrese el plazo solicitado" } })
                                                @Html.ValidationMessageFor(model => model.plazo, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Cuota Inicial:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-7">
                                                @Html.EditorFor(model => model.cuota_inicial, new { htmlAttributes = new { @class = "form-control", @placeholder = "Ingrese la cuota inicial", @required = "required", @onkeyup = "return miles(this.id)" } })
                                                @Html.ValidationMessageFor(model => model.cuota_inicial, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4 text text-primary">Asesor:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-7">
                                                @Html.DropDownList("asesor_id", null, "", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione", @required = "required" })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6 confirmacion">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Genera Comisión:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                @Html.CheckBoxFor(model => model.comison, new { @class = "i-checks checks_comision", @checked = "" })
                                                @Html.ValidationMessageFor(model => model.comison, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-6" id="dropDownMotivo" style="display:none">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Motivo:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-7">
                                                @Html.DropDownList("idmotcomision", null, "", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione" })
                                            </div>
                                        </div>
                                    </div>


                                </div>

                            </div>

                            <div class="hpanel" id="panelRef">
                                <div class="panel-heading hbuilt" style="background-color:#e4e5e7">
                                    <div class="panel-tools">
                                        <a class="showhide"><i class="fa fa-chevron-up"></i></a>
                                    </div>
                                    Referencias Personales
                                </div>
                                <div class="panel-body">

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4 text text-primary">Nombre(s):&nbsp;</label>
                                            <div class="col-md-7">
                                                <input type="text" class="form-control" id="nombreref" value="" />
                                                @*@Html.DropDownList("estadoc", null, "", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione"})
                                                    @Html.ValidationMessageFor(model => model.estadoc, "", new { @class = "text-danger" })*@
                                            </div>
                                        </div>
                                    </div>


                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4 text text-primary">Apellidos:&nbsp;</label>
                                            <div class="col-md-7">
                                                <input type="text" class="form-control" id="apellidoref" value="" />
                                                @*@Html.DropDownList("financiera_id", null, "", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione", @required = "required" })
                                                    @Html.ValidationMessageFor(model => model.financiera_id, "", new { @class = "text-danger" })*@
                                            </div>
                                        </div>
                                    </div>



                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4 text text-primary">Teléfono:&nbsp;</label>
                                            <div class="col-md-7">
                                                <input type="number" class="form-control" id="telefonoref" value="" pattern="/^[0-9]*$/" />
                                                @*@Html.DropDownList("plan_id", null, "Seleccione...", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione" })
                                                    @Html.ValidationMessageFor(model => model.plan_id, "", new { @class = "text-danger" })*@
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Celular: </label>
                                            <div class="col-md-7">
                                                <input type="number" class="form-control" id="celularref" value="" pattern="/^[0-9]*$/" />
                                                @*@Html.EditorFor(model => model.fec_solicitud, new { htmlAttributes = new { @class = "form-control fecha", @required = "required", @onchage = "fncio" } })
                                                    @Html.ValidationMessageFor(model => model.fec_solicitud, "", new { @class = "text-danger" })*@
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <button type="button" id="agregarReferencias" class="btn btn-success" style="margin-top:10px; float:right"><i class="fa fa-plus-square"></i>&nbsp;&nbsp;&nbsp;Agregar</button>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="table-responsive">
                                                <table class="table table-striped table-bordered table-hover" id="tabla_referencias">
                                                    <thead>
                                                        <tr>
                                                            <th style="text-align:center">Nombre(s)</th>
                                                            <th style="text-align:center">Apellidos</th>
                                                            <th style="text-align:center">Teléfono</th>
                                                            <th style="text-align:center">Celular</th>
                                                            <th style="text-align:center">Acción</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody></tbody>
                                                    <tfoot>
                                                        <tr>
                                                            <td colspan="3" style="border-left:hidden; border-bottom:hidden"></td>
                                                            <td style="border-right:hidden; border-bottom:hidden"></td>
                                                        </tr>
                                                    </tfoot>
                                                </table>
                                                <input type="hidden" name="listaReferencias" id="listaReferencias" value="" />
                                                <input type="hidden" name="contador" id="contador" value="" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="hpanel" id="panelAprobacion">
                                <div class="panel-heading hbuilt" style="background-color:#e4e5e7">
                                    <div class="panel-tools">
                                        <a class="showhide"><i class="fa fa-chevron-up"></i></a>
                                    </div>
                                    <i class="fa fa-check-circle" aria-hidden="true"></i> Información de Aprobación
                                </div>
                                <div class="panel-body">

                                    <div class="col-sm-6" id="div_fec_aprobacion" style="display: none">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Fecha Aprobación:</label>
                                            <div class="col-md-6">
                                                @Html.EditorFor(model => model.fec_aprobacion, new { htmlAttributes = new { @class = "form-control" } })
                                                @Html.ValidationMessageFor(model => model.fec_aprobacion, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6" id="div_fec_negacion" style="display: none">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Fecha Negación:</label>
                                            <div class="col-md-6">
                                                @Html.EditorFor(model => model.fec_negacion, new { htmlAttributes = new { @class = "form-control" } })
                                                @Html.ValidationMessageFor(model => model.fec_negacion, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6" id="div_fec_desembolso" style="display: none">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Fecha Desembolso:</label>
                                            <div class="col-md-6">
                                                @Html.EditorFor(model => model.fec_desembolso, new { htmlAttributes = new { @class = "form-control" } })
                                                @Html.ValidationMessageFor(model => model.fec_desembolso, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6" id="div_fec_confirmacion" style="display: none">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Fecha Confirmación:</label>
                                            <div class="col-md-6">
                                                @Html.EditorFor(model => model.fec_confirmacion, new { htmlAttributes = new { @class = "form-control" } })
                                                @Html.ValidationMessageFor(model => model.fec_confirmacion, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Valor Solicitado:</label>
                                            <div class="col-md-6">
                                                @Html.EditorFor(model => model.vsolicitado, new { htmlAttributes = new { @class = "form-control", @placeholder = "" } })
                                                @*@Html.EditorFor(model => model.vsolicitado, new { htmlAttributes = new { @class = "form-control",@type="text", @onkeyup ="return miles(this.id)"} })*@
                                                @Html.ValidationMessageFor(model => model.vsolicitado, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6" id="div_vaprobado" style="display: none">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Valor Aprobado:</label>
                                            <div class="col-md-6">
                                                @Html.EditorFor(model => model.vaprobado, new { htmlAttributes = new { @class = "form-control", @type = "text", @onkeyup = "return miles(this.id)" } })
                                                @Html.ValidationMessageFor(model => model.vaprobado, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6" id="div_num_aprobacion" style="display: none">
                                        <div class="form-group">
                                            <label class="control-label col-md-4 text text-primary">Número de Aprobación:</label>
                                            <div class="col-md-6">
                                                @Html.EditorFor(model => model.num_aprobacion, new { htmlAttributes = new { @class = "form-control" } })
                                                @Html.ValidationMessageFor(model => model.num_aprobacion, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Detalle:</label>
                                            <div class="col-md-6">
                                                @Html.TextAreaFor(model => model.detalle, new { @class = "form-control", @style = "width: 280px; height: 150px" })
                                                @Html.ValidationMessageFor(model => model.detalle, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Toma Credito:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                @Html.CheckBoxFor(model => model.toma_credito, new { @class = "i-checks", @checked = "", @required = "required" })
                                                @Html.ValidationMessageFor(model => model.toma_credito, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>



                                </div>
                            </div>
                        </div>}
                </div>
            </div>

            <div id="buscar" class="tab-pane">
                <div class="panel-body">
                    <div class="panel-body-busqueda">
                        <div class="col-sm-6">
                            <div class="form-group">
                                @*<label class="control-label col-md-4">Rango Fechas:&nbsp;</label>*@
                                <div class="col-md-9">
                                    <div class="input-daterange input-group" id="datepicker">
                                        <input type="text" class="input-sm form-control" name="fechaDesde" id="fechaDesde" placeholder="Fecha Inicio" autocomplete="off" />
                                        <span class="input-group-addon">Hasta</span>
                                        <input type="text" class="input-sm form-control" name="fechaHasta" id="fechaHasta" placeholder="Fecha Fin" autocomplete="off" />
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <button class="form-control btn btn-primary" onclick="buscarDatos()" type="button"><i class="fa fa-filter"></i></button>
                                </div>
                            </div>
                        </div>
                        <div class="table-responsive col-md-12">
                            <div id="div-mensaje-buscar"></div>
                            <table class="table table-striped table-bordered table-hover" id="tablaPaginada">
                                <thead>
                                    <tr>
                                        <th style="text-align:center">Pedido</th>
                                        <th style="text-align:center">Financiera</th>
                                        <th style="text-align:center">Nombre Cliente</th>
                                        <th style="text-align:center">Fecha Solicitud</th>
                                        <th style="text-align:center">Estado Credito</th>
                                        <th style="text-align:center">Motivo No Comisión</th>
                                        <th style="text-align:center">Motivo Negación</th>
                                        <th style="text-align:center">Fecha</th>
                                        <th style="text-align:center">Acción</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>
<div id="modal_pedido_cotizacion" class="modal fade" tabindex="-1" aria-hidden="true" role="dialog">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="color-line"></div>
            <div class="modal-header text-center">
                <h4 class="modal-title">Cotizaciones y Pedidos</h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <h3>Cotizaciones</h3>
                    <div class="table-responsive">
                        <table class="table table-striped table-bordered table-hover" id="tablaDetalleCotizaciones">
                            <thead>
                                <tr>
                                    <th style="text-align:center">Número</th>
                                    <th style="text-align:center">Fecha</th>
                                    <th style="text-align:center">Bodega</th>
                                    <th style="text-align:center">Vehículo</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
                <div class="row">
                    <h3>Pedidos</h3>
                    <div class="table-responsive">
                        <table class="table table-striped table-bordered table-hover" id="tablaDetallePedidos">
                            <thead>
                                <tr>
                                    <th style="text-align:center">Número</th>
                                    <th style="text-align:center">Fecha</th>
                                    <th style="text-align:center">Bodega</th>
                                    <th style="text-align:center">Vehículo</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal" id="cerrarModalExito">Cerrar</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade hmodal-info" id="documentoscredito" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="color-line"></div>
            <div class="modal-header text-center">
                <h4 class="modal-title">Documentos</h4>
                @*<small class="font-bold">Los documentos son los siguientes</small><br />*@
            </div>
            <div class="modal-body">
                <div class="hpanel">
                    @if (TempData["mensaje_error_modal"] != null)
                    {
                        <br />
                        <div class="alert alert-danger  alert-dismissible">
                            <button type="button" class="close" data-dismiss="alert" arial-label="close"><span aria-hidden="true">&times;</span></button>
                            <p><i class="fa fa-times fa-2x"></i> @TempData["mensaje_error_modal"]</p>
                        </div>
                    }
                    <div class="panel-heading hbuilt" style="background-color:#e4e5e7">
                        <div class="panel-tools">
                            <a class="showhide"><i class="fa fa-chevron-up"></i></a>
                        </div>
                        Datos del Credito
                    </div>
                    <div class="panel-body">
                        <input type="hidden" id="idcredito" value="" />
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="control-label col-md-4 text text-primary">Pedido: #</label>
                                <div class="col-md-7">
                                    <input class="form-control" type="text" id="numPedidoModal" value="" readonly />
                                </div>
                            </div>
                        </div>

                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="control-label col-md-4 text text-primary">Financiera:</label>
                                <div class="col-md-7">
                                    <input class="form-control" type="text" id="financieraModal" value="" readonly />
                                </div>
                            </div>
                        </div>

                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="control-label col-md-4">Nombre Cliente:<span class="text-danger">*</span></label>
                                <div class="col-md-7">
                                    <input class="form-control" type="text" id="nomClienteModal" value="" readonly />
                                </div>
                            </div>
                        </div>


                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="control-label col-md-4 text text-primary">Fecha Solicitud:</label>
                                <div class="col-md-7">
                                    <input class="form-control" type="text" id="fecSolicitudModal" value="" readonly />
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="control-label col-md-4 text text-primary">Estado Crédito:</label>
                                <div class="col-md-7">
                                    <input class="form-control" type="text" id="estadoCredModal" value="" readonly />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="hpanel">
                    <div class="panel-heading hbuilt" style="background-color:#e4e5e7">
                        <div class="panel-tools">
                            <a class="showhide"><i class="fa fa-chevron-up"></i></a>
                        </div>
                        Cargar Documentos
                    </div>
                    <div class="panel-body">
                        <div class="form-group">
                            <div class="col-md-5">
                                <select id="documentosSinCargar" class="form-control">
                                </select>
                            </div>
                            <div class="col-md-5">
                                <input type="file" class="form-control" id="archivo" />
                            </div>
                            <div class="col-md-2">
                                <button class="btn btn-success" type="button" id="btnArchivo"><i class="fa fa-save"></i>&nbsp;&nbsp;&nbsp;Guardar</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="hpanel">
                    <div class="panel-heading hbuilt" style="background-color:#e4e5e7">
                        <div class="panel-tools">
                            <a class="showhide"><i class="fa fa-chevron-up"></i></a>
                        </div>
                        Documentos Cargados
                    </div>
                    <div class="panel-body">
                        <div class="table-responsive">
                            <table class="table table-striped table-bordered table-hover" id="tablaDocumentos">
                                <thead>
                                    <tr>
                                        <th style="text-align:center">Nombre</th>
                                        <th style="text-align:center">Fecha</th>
                                        <th style="text-align:center">Acción</th>
                                    </tr>
                                </thead>
                                <tbody id="detalles"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" id="btnCerrar" data-dismiss="modal" class="btn btn-danger">Cerrar</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @Scripts.Render("~/bundles/select2/js")

    <script src="~/Vendor/moment/min/moment.min.js"></script>
    <script src="~/Vendor/datatables/media/js/jquery.dataTables.min.js"></script>
    <script src="~/Vendor/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>
    <script src="~/Vendor/datatables.net-buttons/js/buttons.html5.min.js"></script>
    <script src="~/Vendor/datatables.net-buttons/js/buttons.print.min.js"></script>
    <script src="~/Vendor/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
    <script src="~/Vendor/datatables.net-buttons-bs/js/buttons.bootstrap.min.js"></script>
    <script src="~/Vendor/datatablesExcelExport/dataTable1.4.0-buttons.js"></script>
    <script src="~/Vendor/datatablesExcelExport/JSZip3.1.3.min.js"></script>
    <script src="~/Vendor/bootstrap-datepicker-master/dist/js/bootstrap-datepicker.min.js"></script>
    <script src="~/Vendor/eonasdan-bootstrap-datetimepicker/build/js/bootstrap-datetimepicker.min.js"></script>
    <script src="~/Vendor/pdfmake/build/pdfmake.min.js"></script>
    <script src="~/Vendor/pdfmake/build/vfs_fonts.js"></script>
    <script src="~/Vendor/datatablesExcelExport/jsZipDataTables.js"></script>
    <script src="~/Vendor/eonasdan-bootstrap-datetimepicker/build/js/bootstrap-datetimepicker.min.js"></script>
    <script src="~/Scripts/toastr.min.js"></script>
    <script type="text/javascript">
        var contador = 0;
        var lista = 0;
        var plan_id = 0;
        $('#listaReferencias').val(0);

        $(document).ready(function () {
        $("#plan_id").on("change", function () {
            plan_id = $(this).val();//obtenemos el valor seleccionado en una variable
        })


                $( "#slider-range" ).slider({
                    range: true,
                    min: 800000,
                    max: 10000000,
                    values: [3000000, 5000000],
                    step: 100000,
                    slide: function( event, ui ) {
                        $( "#amount" ).val( "$" + addComas(ui.values[ 0 ]) + " - $" + addComas(ui.values[ 1 ]) );
                        $( "#salario" ).val( ui.values[ 0 ] + "-" + ui.values[ 1 ] );
                    }
                });
            $( "#amount" ).val( "$" + addComas($( "#slider-range" ).slider( "values", 0 )) +
                " - $" + addComas($("#slider-range").slider("values", 1)));
            $('#salario').val( $( "#slider-range" ).slider( "values", 0 ) +
                "-" + $("#slider-range").slider("values", 1))
            $('.js-source-states').select2();
            $('#menu').val(@ViewBag.id_menu);
            var fecha ='@DateTime.Now.AddDays(-30).ToString("yyyy/MM/dd",new CultureInfo("en-US"))';
            var fecha2 = '@DateTime.Now.ToString("yyyy/MM/dd",new CultureInfo("en-US"))';

            $('#fechaDesde').val(fecha);
            $('#fechaHasta').val(fecha2);
            $('#fechaDesde').datetimepicker({
                format: 'YYYY/MM/DD',
            });
            $('#fechaHasta').datetimepicker({
                format: 'YYYY/MM/DD',
                maxDate: '-' + new Date() + '',
            });
            $('#fec_solicitud').attr('autocomplete', 'off');
            $('#fec_envdocumentos').attr('autocomplete', 'off');

            $('#fec_solicitud').datetimepicker({
                defaultDate: new Date(),
                showTodayButton: true,
                format: 'YYYY/MM/DD HH:mm',
                maxDate: new Date(),
                minDate: new Date(),
            }).on('dp.change', function(e) {
                $('#fec_envdocumentos').data("DateTimePicker").minDate(e.date)
            });

            $('#fec_envdocumentos').datetimepicker({
                defaultDate: new Date(),
                showTodayButton: true,
                format: 'YYYY/MM/DD HH:mm',
                minDate: '-' + new Date() + '',
            });

            //  $('#detalle').prop('disabled', false);
            //  $('#detalle').prop('readonly',false);

            $('#fec_envdocumentos').val('');
            $('#panelAprobacion').hide();
            //  $('.confirmacion').show();

            $('#estadoc').val("T");
            $('#estadoc').select2();
            $("#estadoc").find("option[value='N']").prop("disabled", true);
            $("#estadoc").find("option[value='A']").prop("disabled", true);
            $("#estadoc").find("option[value='D']").prop("disabled", true);
            $("#estadoc").find("option[value='C']").prop("disabled", true);
            $("#estadoc").find("option[value='O']").prop("disabled", true);

            //$('#panelCredito').find('.showhide').trigger('click');
            $('#panelAprobacion').find('.showhide').trigger('click');

            $('form select').each(function (i) {
                this.addEventListener('invalid', function (e) {
                    var _s2Id = 's2id_' + e.target.id; //s2 autosuggest html ul li element id
                    var _posS2 = $('#' + _s2Id).position();
                    //get the current position of respective select2
                    $('#' + _s2Id + ' ul').addClass('_invalid'); //add this class with border:1px solid red;
                    //this will reposition the hidden select2 just behind the actual select2 autosuggest field with z-index = -1
                    $('#' + e.target.id).attr('style', 'display:block !important;position:absolute;z-index:-1;top:' + (0 - $('#' + _s2Id).outerHeight() + 30) + 'px;left:' + (15 - ($('#' + _s2Id).width() / 10)) + 'px;');
                    /*
                    //Adjust the left and top position accordingly
                    */
                    //remove invalid class after 3 seconds
                    setTimeout(function () {
                        $('#' + _s2Id + ' ul').removeClass('_invalid');
                    }, 3000);
                    return true;
                }, false);
            });
        });

        $('#plan_id').change(function () {

            plan_id = { plan_id: $(this).val() };//obtenemos el valor seleccionado en una variable

        //limpia el departamento si seleccionas otro pais o el mismo nuevamente
        if ($(this).val() != "") { $("#financiera_id").empty(); }


        $.ajax({
            url: '/v_creditos/Getfinanciera',
            //contentType: "application/json",
            method: 'GET',
            data: plan_id,//{Pais:"COL"},// JSON.stringify(Pais),
            //headers: {
            //    'Authorization': 'Bearer '
            //        + sessionStorage.getItem("accessToken")
            //},
            cache: false,
            success: function (respuesta) {

                $("#financiera_id").append('<option Value="' + respuesta[0].id + '">' + respuesta[0].nombre + "</option>");
                //$(respuesta[0]).each(function (i) {
                //    $("#financiera_id").append('<option Value="' + respuesta[0][i].id + '">' + respuesta[0][i].nombre + "</option>");
                //    debugger
                //});
            },
            error: function (jQXHR) {
                //alert("error" + jQXHR.statusText);
               //  swal("El plan financiro no tiene una financiera asociado", "", "error");
                toastr.error("El plan financiro no tiene una financiera asociado");
                }
            //,error: function (jQXHR) {
            //    alert("error"+jQXHR.statusText);
            //}
        });
    });

        $('#vehiculo').change(function () {
            $('#id_anio_modelo').val('');
            $('#id_anio_modelo').empty();
            $('#tot_vehiculo').val('');
            var esNuevo = true;

            $.ajax({
                url: '/cotizacion/BuscarAniosModelos',
                data: {
                    codigoModelo: $('#vehiculo').val(),
                    esNuevo: esNuevo
                },
                type: "post",
                cache: false,
                success: function (data) {
                    $('#id_anio_modelo').append($('<option>', {
                        value: '',
                        text: 'Seleccione'
                    }));
                    for (var i = 0; i < data.length; i++) {
                        $('#id_anio_modelo').append($('<option>', {
                            value: data[i].codigo,
                            text: data[i].anios
                        }));
                    }
                    //$('#id_anio_modelo').select2();
                }
            });
        });

        $('#id_anio_modelo').change(function () {
            var esNuevo = true;
            $.ajax({
                url: '/vpedidos/BuscarPreciosPorAnio',
                data: {
                    codigoModelo: $('#vehiculo').val(),
                    anioModelo: $('#id_anio_modelo').val(),
                    esNuevo: esNuevo
                },
                type: "post",
                cache: false,
                success: function (data) {
                    if (data.esNuevo == true) {
                        $('#tot_vehiculo').val(addComas(data.valor));
                        //$('#tot_vehiculo').trigger('change');
                    }
                }
            });
        });

        //$('#financiera_id').change(function () {
        //    if ($('#financiera_id option:selected').text() == 'GMAC') {
        //        $('#div_plan_id').show()
        //        console.log(" Pasa por cambio de financiera es GMAC")
        //        BuscarPlanXFinan();
        //    } else {
        //        // $('#div_plan_id').hide()
        //        console.log(" Pasa por cambio de financiera")
        //        BuscarPlanXFinan();
        //    }
        //});

        $('.checks_comision').on('ifUnchecked', function(event){
            $('#idmotcomision').prop('required', true)
            $('#dropDownMotivo').show()
        })

        $('.checks_comision').on('ifChecked', function(event){
            $('#idmotcomision').prop('required', false)
            $('#dropDownMotivo').hide()
        })

        $('#estadoc').change(function () {
            if ($('#estadoc').val() == "A") {
                $('#div_fec_aprobacion').show();
                $('#div_vaprobado').show();
                $('#div_num_aprobacion').show();
                $('#div_fec_negacion').hide();
            }
            else if ($('#estadoc').val() == "N") {
                $('#div_fec_negacion').show();
                $('#div_fec_aprobacion').hide();
                $('#div_vaprobado').hide();
                $('#div_num_aprobacion').hide();
            }
            else if ($('#estadoc').val() == "D") {
                $('#div_fec_desembolso').show();
            }
            else if ($('#estadoc').val() == "C") {
                $('#div_fec_confirmacion').show();
            }
        });

        $('#tercero').change(function () {
            console.log("Paso por tercero change" );
            pedidonit($('#tercero').val());
            //  sinpedidonit($('#tercero').val());

            //buscarTercero();
            $('#idtercero').val($('#tercero').val());
            setTimeout(function(){
                cotizacion_pedido()
            },1500)
        });

        $('#agregarReferencias').click(function () {
            if ($('#nombreref').val() == "") {
                swal("El nombre es obligario", "", "warning");
            } else if ($('#apellidoref').val() == "") {
                swal("El apellido es obligatorio", "", "warning");
            } else if ($('#telefonoref').val() == "") {
                swal("El teléfono es obligatorio", "", "warning");
            } else if ($('#celularref').val() == "") {
                swal("El celular es obligatorio", "", "warning");
            } else {
                $('#tabla_referencias').find('tbody').append(
                '<tr id="fila' + contador + '">'
                + '<td>'
                + '<input type="hidden" id="nombreTabla' + contador + '" name="nombreTabla' + contador + '" value="' + $('#nombreref').val() + '"/>' + $('#nombreref').val()
                + '</td>'
                + '<td>'
                + '<input type="hidden" id="apellidosTabla' + contador + '" name="apellidosTabla' + contador + '" value="' + $('#apellidoref').val() + '"/>' + $('#apellidoref').val()
                + '</td>'
                + '<td align="right">'
                + '<input type="hidden" id="telefonoTabla' + contador + '" name="telefonoTabla' + contador + '" value="' + $('#telefonoref').val() + '"/>' + $('#telefonoref').val()
                + '</td>'
                + '<td align="right">'
                + '<input type="hidden" id="celularTabla' + contador + '" name="celularTabla' + contador + '" value="' + $('#celularref').val() + '"/>' + $('#celularref').val()
                + '</td>'
                + '<td align="center">'
                + '<button type="button" class="btn btn-danger btn-xs" onclick="eliminar(' + contador + ')"><i class="fa fa-times"></i></button>'
                + '</td>'
            + '</tr>'
                );
                contador++;
                lista++;
                $('#listaReferencias').val(lista);
                if (contador == 3) {
                    $('#agregarReferencias').prop('disabled', true);
                }
                $('#nombreref').val('');
                $('#apellidoref').val('');
                $('#telefonoref').val('');
                $('#celularref').val('');
            }
        })

        function eliminar(i){
            $('#fila'+i).remove()
            contador--
            lista--
            $('#listaReferencias').val(lista)
            if (contador == 0) {
                $('#grantotalTablaReferencias').val('')
            }
            if (contador < 3) {
                $('#agregarReferencias').prop('disabled', false);
            }
        }

        function BuscarFianaciera ()
        {
            // url: '/v_creditos/BuscarDatosPedido',
            $.ajax({
                url: '/v_creditos/BuscarFinanciera',
                data: {
                    idPlan: $('#plan_id').val(),
                },
                type: "post",
                cache: false,
                success: function (data) {
                    $('#financiera_id').empty();
                    $('#financiera_id').append($('<option>', {
                        value: '',
                        text: ''
                    }));
                    for (var i = 0; i < data.length; i++) {
                        $('#financiera_id').append($('<option>', {
                            value: data[i].financiera_id,
                            text: data[i].financiera_nombre
                        }));
                    }
                    $('#financiera_id').empty();
                    $('#financiera_id').append($('<option>', {
                        value: '',
                        text: ''
                    }));
                    for (var i = 0; i < data.length; i++) {
                        $('#financiera_id').append($('<option>', {
                            value: data[i].financiera_id,
                            text: data[i].financiera_nombre
                        }));
                    }
                },
                complete: function (datos) {

                }
            });
        }

        function BuscarPlanXFinan ()
        {
            // url: '/v_creditos/BuscarDatosPedido',
            $.ajax({
                url: '/v_creditos/BuscarPlanXFinanciera',
                data: {
                    finan: $('#financiera_id').val(),
                },
                type: "post",
                cache: false,
                success: function (data) {
                    $('#plan_id').empty();
                    $('#plan_id').append($('<option>', {
                        value: '',
                        text: ''
                    }));
                    for (var i = 0; i < data.length; i++) {
                        $('#plan_id').append($('<option>', {
                            value: data[i].plan_id,
                            text: data[i].nombre
                        }));
                    }
                    $('#plan_id').empty();
                    $('#plan_id').append($('<option>', {
                        value: '',
                        text: ''
                    }));
                    for (var i = 0; i < data.length; i++) {
                        $('#plan_id').append($('<option>', {
                            value: data[i].plan_id,
                            text: data[i].nombre
                        }));
                    }
                },
                complete: function (datos) {

                }
            });
        }

        function pedidonit (id)
        {
            console.log(" pedidonit Nit a procesar " + id);
            // url: '/v_creditos/BuscarDatosPedido',
            if(id !=null){
                $.ajax({
                    url: '/v_creditos/BuscarPedidoNit',
                    data: {
                        wnit:id,
                    },
                    type: "post",
                    cache: false,
                    success: function (pedidos) {
                        var option = "<option value=''>Seleccione...</option>";
                        for (var j = 0; j < pedidos.length; j++) {
                            option += ' <option value="' + pedidos[j].id + '">' + pedidos[j].numero + '</option>'
                        }
                        $('#pedido').empty();
                        $('#pedido').append(option);
                    },
                    complete: function (pedidos) {
                        console.log("Esta dentro del segundo ajax qqqq " + id);
                        console.log("Es nan  qqqq " + id);
                        if( id === "" )
                        {
                            console.log("Esta dentro del segundo ajax pasando  qqqq " + id);
                            $('#correo').val('');
                            $('#telefono').val('');
                            $('#direccion').val('');

                            $('#correo').prop('disabled', true);
                            $('#telefono').prop('disabled', true);
                            $('#direccion').prop('disabled', true);

                            $('#tot_vehiculo').val('');

                            $('#vsolicitado').val('');
                        }
                        if (id != null)
                        {
                            //  console.log("Esta dentro del segundo ajax pasando  qqqq" + id);
                            $.ajax({
                                url: '/v_creditos/BuscarSinPedido_Nit',
                                data: {
                                    wnit:id,
                                },
                                type: "post",
                                cache: false,
                                success: function (persona) {
                                    $('#correo').val(persona.email);
                                    $('#telefono').val(persona.telefono);
                                    $('#direccion').val(persona.direccion);

                                    $('#correo').prop('disabled', true);
                                    $('#telefono').prop('disabled', true);
                                    $('#direccion').prop('disabled', true);

                                },
                                complete: function (persona) {

                                }
                            });
                        }else
                        {
                            $('#correo').val('');
                            $('#telefono').val('');
                            $('#direccion').val('');
                            $('#tot_vehiculo').val('');
                            $('#vsolicitado').val('');
                        }
                    }
                });
            }
            else{
                console.log("Esto si id es null " + id);
                $('#correo').val('');
                $('#telefono').val('');
                $('#direccion').val('');
                $('#correo').prop('disabled', true);
                $('#telefono').prop('disabled', true);
                $('#direccion').prop('disabled', true);
                $('#tot_vehiculo').val('');
                $('#vsolicitado').val('');
            }
        }

        function sinpedidonit (id)
        {
            // url: '/v_creditos/BuscarDatosPedido',
            if(id !=null){
                $.ajax({
                    url: '/v_creditos/BuscarSinPedido_Nit',
                    data: {
                        wnit:id,
                    },
                    type: "post",
                    cache: false,
                    success: function (persona) {
                        $('#correo').val(persona.email);
                        $('#telefono').val(persona.telefono);
                        $('#direccion').val(persona.direccion);
                        $('#correo').prop('disabled', true);
                        $('#telefono').prop('disabled', true);
                        $('#direccion').prop('disabled', true);
                    },
                    complete: function (persona) {

                    }
                });
            }
            else{
                $('#correo').val('');
                $('#telefono').val('');
                $('#direccion').val('');
                $('#correo').prop('disabled', true);
                $('#telefono').prop('disabled', true);
                $('#direccion').prop('disabled', true);
            }
        }

        $('#vehiculo').change(function () {
            //buscarTercero();
            $('#idvehiculo').val($('#vehiculo').val());
        });

        $('#pedido').change(function (){
            var ter = 0;
            if($('#pedido').val()!= "" || $('#pedido').val()!= null)
            {
                $.ajax({
                    url: '/v_creditos/BuscarDatosPedido',
                    data: {
                        pedido: $('#pedido').val(),
                    },
                    type: "post",
                    cache: false,
                    success: function (data) {
                        if (data.length > 0)
                        {debugger;
                            console.log(data[0])
                            //$('#vehiculo option:not(:selected)').attr('disabled', false);
                            //$('#tercero option:not(:selected)').attr('disable', false);
                            $('#tercero').val(data[0].nit).attr('style','visible:visible').select2();
                            ter = data[0].nit;
                            $('#idtercero').val(data[0].nit);
                            $('#asesor_id').val(data[0].vendedor).attr('style','visible:visible').select2();
                            $('#vehiculo').val(data[0].modelo).attr('style','visible:visible').select2();
                            $('#vehiculo').trigger('change');
                            $('#idvehiculo').val(data[0].modelo);
                            $('#idvehiculo').trigger('change');
                            $('#tot_vehiculo').val(addCommas(data[0].valorveh));
                            setTimeout(function () {
                                $('#id_anio_modelo').val(data[0].anio).select2();
                            }, 300);

                            //tot_vehiculo
                            //$('#tercero').val(data[0].nit).trigger('change');
                            // $('#asesor_id').val(data[0].vendedor).trigger('change');
                            //$('#asesor_id').select2();
                            //$('#vehiculo').val(data[0].modelo).trigger('change');
                            //$('#vehiculo').select2();
                            //$('#tercero').prop('readonly', true);
                            $('#vehiculo option:not(:selected)').attr('disabled', true);
                            //$('#tercero option:not(:selected)').attr('disabled', true);
                            $('#tot_vehiculo').prop('readonly', true);
                            //$('#vehiculo').prop('readonly', true);
                            $('#tercero').prop('readonly', true);
                            $('#id_anio_modelo').prop('readonly', true);
                            $('#vsolicitado').val(addCommas(data[0].valor));
                            // buscarTercero();
                            console.log(" PEDIDO CHANGE paso por Ajax con Pedido " + $('#pedido').val() + " y Nit " + ter );
                            $('#tercero').trigger('change')
                        }
                        else{
                            $('#vehiculo').prop('disabled', false);
                            $('#tercero').prop('disabled', false);
                            $('#vehiculo').val('').trigger('change');
                            $('#tercero').val('').trigger('change');

                        }
                    },
                    complete: function (data) {
                        //if (data.length > 0)
                        //{
                        if (ter > 0)
                        {
                            console.log(" PEDIDO CHANGE XXX paso por Ajax con Pedido y  tercero valido xxx " + ter );
                            if (ter != null)
                            {
                                console.log(" PEDIDO CHANGE paso por Ajax con Pedido y  tercero valido xxx " + ter );
                                $.ajax({
                                    url: '/v_creditos/BuscarSinPedido_Nit', //    DatosCliente',
                                    data: {
                                        // idtercero: ter
                                        wnit:ter
                                    },
                                    type: "post",
                                    cache: false,
                                    success: function (persona) {
                                        $('#correo').val(persona.email);
                                        $('#telefono').val(persona.telefono);
                                        $('#direccion').val(persona.direccion);
                                        $('#correo').prop('disabled', true);
                                        $('#telefono').prop('disabled', true);
                                        $('#direccion').prop('disabled', true);
                                    },
                                    complete: function (persona) {

                                    }
                                });
                            }else
                            {
                                console.log(" PEDIDO CHANGE paso por Ajax con Pedido y  tercero null  " + ter );
                                $('#correo').val('');
                                $('#telefono').val('');
                                $('#direccion').val('');
                                $('#tot_vehiculo').val('');
                                $('#vsolicitado').val('');
                            }
                        }else
                        {
                            $('#correo').val('');
                            $('#telefono').val('');
                            $('#direccion').val('');
                            $('#tot_vehiculo').val('');
                            $('#vsolicitado').val('');
                        }
                    }
                });
            }
            else
            {
                console.log(" PEDIDO CHANGE paso por Ajax sin Pedido ");
                $('#vehiculo').prop('disabled', false);
                $('#tercero').prop('disabled', false);
                $('#idtercero').val('');
                $('#idvehiculo').val('');
                $('#vehiculo').val('').trigger('change');
                $('#tercero').val('').trigger('change');
                $('#correo').val('');
                $('#telefono').val('');
                $('#direccion').val('');
                $('#tot_vehiculo').val('');
                $('#vsolicitado').val('');
            }
        });

        function buscarTercero() {
            $.ajax({
                url: '/v_creditos/BuscarDatosCliente',
                data: {
                    id: $('#tercero').val()
                },
                type: "post",
                cache: false,
                success: function (data) {
                    if(data!=0){
                        console.log(data);
                        $('#cliente').text(data[0].nombre);
                        $('#ciudad').text(data[0].ciudad);
                        $('#telefono').text(data[0].telefono);
                        $('#email').text(data[0].email);
                        $('#celular').text(data[0].celular);
                        $('#infoSolicitante1').show();
                    }
                    else{
                        $('#cliente').text('');
                        $('#ciudad').text('');
                        $('#telefono').text('');
                        $('#email').text('');
                        $('#celular').text('');
                        $('#infoSolicitante1').hide();
                    }
                },
                complete: function () {

                }
            });
        }

        function valida(id) {
            window.location.href = '@Url.Action("Edit", "v_creditos")?menu='+@ViewBag.id_menu+'&&id=' + id;
        }

        function seguimiento(id) {
            window.location.href = '@Url.Action("Seguimiento", "v_creditos")?menu='+@ViewBag.id_menu+'&&id=' + id;
        }

        function buscarDatos() {
            $('#tablaPaginada').dataTable().fnDestroy();
            $.ajax({
                url: '/v_creditos/BuscarDatos',
                data: {
                    fecha_inicio: $('#fechaDesde').val(),
                    fecha_fin: $('#fechaHasta').val()
                },
                type: "post",
                cache: false,
                success: function (data) {
                    $('#tablaPaginada').find('tbody').empty();
                    for (var i = 0; i < data.length; i++) {
                        $('#tablaPaginada').find('tbody').append(
                            '<tr>'
                                +'<td align="right">' + data[i].pedido + '</td>'
                                +'<td align="left">' + data[i].financiera + '</td>'
                                +'<td align="left">' + data[i].nombre + '</td>'
                                +'<td align="left">' + data[i].fec_solicitud + '</td>'
                                +'<td align="left">' + data[i].estadoc + '</td>'
                                +'<td align="left">'+data[i].motivo+'</td>'
                                +'<td align="left">'+data[i].descripcion+'</td>'
                                +'<td align="left">' + data[i].fecha_estado + '</td>'
                                +'<td width="15%" align="center">'
                                    +'<button class="btn btn-info btn-xs" onclick="valida(' + '\'' + data[i].id + '\')">&nbsp;&nbsp;Ver&nbsp;&nbsp;</button>&nbsp;&nbsp;'
                                    +'<button class="btn btn-primary btn-xs" onclick="seguimiento(' + '\'' + data[i].id + '\')">&nbsp;&nbsp;Seguimiento&nbsp;&nbsp;</button>'
                                    +'<button class="btn btn-success btn-xs" onclick="documentos(' + '\'' + data[i].id + '\')">&nbsp;&nbsp;Documentos&nbsp;&nbsp;</button>'
                                +'</td>'
                             +'</tr>');
                    }
                },
                complete: function (data) {
                    $('#tablaPaginada').dataTable({
                        dom: "<''<'col-md-6'l><'col-md-6'f>>t<'col-md-4'i><'col-md-8 text-right'pB>",
                        "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
                        buttons: []
                    });
                }
            })
        }

        function documentos(id) {
            $.ajax({
                url: 'v_creditos/BuscarDocumentos',
                data: { id: id },
                type: "post",
                cache: false,
                success: function (data) {
                    console.log(data);
                    $('#tablaDocumentos').find('tbody').empty();
                    $('#documentosSinCargar').empty();
                    $('#numPedidoModal').val('');
                    $('#financieraModal').val('');
                    $('#nomClienteModal').val('');
                    $('#fecSolicitudModal').val('');
                    $('#estadoCredModal').val('');
                    $('#idcredito').val('');
                    for (var j = 0; j < data.cargados.length; j++) {
                        $('#tablaDocumentos').find('tbody').append(
                            '<tr>'
                            + '<td align="left">' + data.cargados[j].nombre + '</td>'
                            + '<td align="left">' + data.cargados[j].fecha + '</td>'
                            +'<td width="15%" align="center">'
                               +'<button class="btn btn-danger btn-xs" onclick="eliminarDoc(' + '\'' + data.cargados[j].id + '\')">&nbsp;&nbsp;Eliminar&nbsp;&nbsp;</button>&nbsp;&nbsp;'
                               //+'<button class="btn btn-danger btn-xs">&nbsp;&nbsp;Eliminar&nbsp;&nbsp;</button>&nbsp;&nbsp;'
                               +'<button class="btn btn-info btn-xs" onclick="verArchivo(' + '\'' + data.cargados[j].id + '\')">&nbsp;&nbsp;Ver&nbsp;&nbsp;</button>&nbsp;&nbsp;'
                            +'</td>'
                            + '</tr>'
                        );
                    }
                    $('#documentosSinCargar').append(
                            '<option selected value="0">Seleccione</option>'
                        );
                    for (var i = 0; i < data.sincargar.length; i++) {
                        $('#documentosSinCargar').append(
                            '<option value="'+ data.sincargar[i].id +'">' + data.sincargar[i].nombre + '</option>'
                        );
                    }
                    $('#numPedidoModal').val(data.info[0].pedido);
                    $('#financieraModal').val(data.info[0].financiera);
                    $('#nomClienteModal').val(data.info[0].nombre);
                    $('#fecSolicitudModal').val(data.info[0].fec_solicitud);
                    $('#estadoCredModal').val(data.info[0].estadoc);
                    $('#idcredito').val(data.info[0].id);
                    $('#documentoscredito').modal('show');
                }
            })
        }

        function verArchivo(id) {
            $.ajax({
                url: '/v_creditos/buscarArchivo',
                type: "post",
                cache: false,
                data: {id : id},
                success: function (data) {
                    window.open('/Content/'+data, '_blank');
                }
            });
        }

        function eliminarDoc(id) {
            $.ajax({
                url: '/v_creditos/eliminarDoc',
                type: "post",
                cache: false,
                data: {id:id},
                success: function (data) {
                    if (data.valor == 1) {
                        swal(data.respuesta, "", "success");
                        documentos($('#idcredito').val());
                    } else {
                        swal(data.respuesta,"","error");
                    }
                }
            });
        }

        $('#btnArchivo').click(function () {
            debugger;
            var id = $('#idcredito').val();
            var tipo = $("#documentosSinCargar option:selected").val();
            var file = $('#archivo')[0].files[0];
            if (id != "" && tipo != "" && file != "" && tipo != 0) {
                var formData = new FormData();
                formData.append("observacion", file);
                formData.append("id", id);
                formData.append("tipo", tipo);
                actualizarconsultaob2vehi(formData, id);
                $('#obs_consulta_placavehi').wrap('<form>').closest('form').get(0).reset();
                $('#obs_consulta_placavehi').unwrap();
            }
        });

        function actualizarconsultaob2vehi(formData, id) {

            $.ajax({
                url: '/v_creditos/subirArchivo',
                type: "post",
                cache: false,
                data: formData,
                dataType: 'json',
                contentType: false,
                processData: false,
                success: function (data) {
                    if (data == 1) {
                        swal("Exito!", "El archivo ha sido subido con exito!", "success");
                        documentos(id);
                        $('#archivo').val('');
                    } else if (data == 0) {
                        swal("Error!", "El archivo no pudo ser subido. Por favor verifique.", "error");
                    } else {
                        swal("Error!","Extensión no permitida. Las Extensiones permitidas son .pdf, .doc, .docx, .odf, .gif, .jpg , .jpeg  y .png","error");
                    }
                },
                fail: function (data) {

                }
            });
        }

        function cotizacion_pedido(){
            $.ajax({
                url:'/v_creditos/cotizacion_pedido',
                data:{
                    id_tercero: $('#tercero').val(),
                },
                type:'post',
                cache: false,
                success: function(data){

                    $('#tablaDetalleCotizaciones').find('tbody').empty()
                    for (var i = 0; i < data.cotizaciones.length; i++) {

                        $('#tablaDetalleCotizaciones').find('tbody').append(
                                '<tr>'
                                    +'<td align="right">'+data.cotizaciones[i].cot_numcotizacion+'</td>'
                                    +'<td align="right">'+data.cotizaciones[i].cot_feccreacion+'</td>'
                                    +'<td align="left">'+data.cotizaciones[i].bodccs_nombre+'</td>'
                                    +'<td align="left">'+data.cotizaciones[i].vehiculo+'</td>'
                                +'</tr>'
                            )
                    }

                    $('#tablaDetallePedidos').find('tbody').empty()
                    for (var i = 0; i < data.pedidos.length; i++) {

                        $('#tablaDetallePedidos').find('tbody').append(
                                '<tr>'
                                    +'<td align="right">'+data.pedidos[i].numero+'</td>'
                                    +'<td align="right">'+data.pedidos[i].fecha+'</td>'
                                    +'<td align="left">'+data.pedidos[i].bodega_nom+'</td>'
                                    +'<td align="left">'+data.pedidos[i].vehiculo+'</td>'
                                +'</tr>'
                            )
                    }
                    $('#modal_pedido_cotizacion').modal('show')
                    console.log(data)

                }
            })
        }

        var numero_miles = "";

        function formatNumber(n) {
            n = String(n).replace(/\D/g, "");
            return n === '' ? n : String(n).replace(/\B(?=(\d{3})+(?!\d))/g, ".");
        }

        function miles(id) {
            numero_miles = formatNumber($('#' + id + '').val());
            $('#' + id + '').val(numero_miles);
            //console.log($('#'+id+'').val);
        }

        function addCommas(nStr) {
            nStr += '';
            x = nStr.split('.');
            x1 = x[0];
            x2 = x.length > 1 ? '.' + x[1] : '';
            var rgx = /(\d+)(\d{3})/;
            while (rgx.test(x1)) {
                x1 = x1.replace(rgx, '$1' + '.' + '$2');
            }
            return x1 + x2;
        }

        function quitCommas(nStr) {
            nStr += '';
            x = nStr.split(',');
            x1 = x[0];
            x2 = x.length > 1 ? ',' + x[1] : '';
            var rgx = /(\d+)(\d{3})/;
            while (rgx.test(x1)) {
                x1 = x1.replace(rgx, '$1' + '.' + '$2');
            }
            return x1 + x2;
        }

        function AgregarQuitarFavorito() {
            $.ajax({
                url: '/Inicio/AgregarQuitarFavorito',
                data: {
                    id_menu: @ViewBag.id_menu,
                },
                type: "post",
                cache: false,
                success: function (data) {
                    if(data.esFavorito == true){
                        $('#areaFavoritos').html("<i class='fa fa-close'></i>&nbsp;&nbsp;<a href='#' onclick='AgregarQuitarFavorito();return false;'>Quitar de Favoritos</a>");
                    }else{
                        $('#areaFavoritos').html("<i class='fa fa-check'></i>&nbsp;&nbsp;<a href='#' onclick='AgregarQuitarFavorito();return false;'>Agregar a Favoritos</a>");
                    }
                }
            });
        }

    </script>

}



@*//$('#fec_solicitud').datetimepicker({
       //    maxDate: '-' + new Date() + '',
       //    format: 'DD/MM/YYYY'
       //});

       //format:'d.m.Y H:i',
       //inline:true,
       //lang:'ru'
       //format:'DD.MM.YYYY h:mm a',
       //formatTime:'h:mm a',
       //formatDate:'DD.MM.YYYY'

       //ejemplo
       //$("#datepicker").datepicker({
       //    dateFormat: 'dd/mm/yy',
       //    firstDay: 1
       //}).datepicker("setDate", new Date());


      //$('#fec_solicitud').datetimepicker({
       //    showTodayButton: true,
       //    format: 'DD/MM/YYYY HH:mm',
       //    //value: DateTime.Now,
       //    maxDate: '-' + new Date() + '',
       //}).on('dp.change', function(e) {
       //    $('#fec_envdocumentos').data("DateTimePicker").minDate(e.date)
       //});

       //$('#fec_envdocumentos').datetimepicker({
       //format: 'DD/MM/YYYY'
       //});

    //if ($('#estadoc').val() == "A") {
       //    $('#div_fec_aprobacion').show();
       //    $('#div_vaprobado').show();
       //    $('#div_num_aprobacion').show();
       //    $('#div_fec_negacion').hide();
       //} else if ($('#estadoc').val() == "N") {
       //    $('#div_fec_negacion').show();
       //    $('#div_fec_aprobacion').hide();
       //    $('#div_vaprobado').hide();
       //    $('#div_num_aprobacion').hide();

       //} else if ($('#estadoc').val() == "D") {
       //    $('#div_fec_desembolso').show();

       //} else if ($('#estadoc').val() == "D") {
       //    $('#div_fec_desembolso').show();

       //} else if ($('#estadoc').val() == "C") {
       //    $('#div_fec_confirmacion').show();

       //}


      //$('#fec_solicitud').change(function () {

       //    $('#fec_solicitud').datetimepicker({
       //        maxDate: '-' + new Date() + '',
       //        format: 'DD/MM/YYYY'
       //    });

       //    $('#fec_envdocumentos').datetimepicker('destroy');
       //});
*@