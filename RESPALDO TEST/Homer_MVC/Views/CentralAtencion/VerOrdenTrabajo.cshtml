@model Homer_MVC.Models.OperacionLiquidacionForm

@{
    ViewBag.Icono = "fa fa-file";
    ViewBag.Title = "Orden De Taller (Central de Atención)";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section Styles {
    <link href="~/Vendor/datatables.net-bs/css/dataTables.bootstrap.min.css" rel="stylesheet" />
    <link href="~/Vendor/bootstrap-toggle-master/css/bootstrap-toggle.min.css" rel="stylesheet" />
    @Styles.Render("~/bundles/select2/css")
}

<div class="panel-body">
    <div class="panel-heading" style="background-color:white;  border:solid 1px; border-color:#e4e5e7">
        <div class="panel-body">

            <div id="hbreadcrumb" class="pull-right">

                <button type="button" class="btn btn-mini btn-default" style="border-radius:25px" data-container="body" data-toggle="popover" data-placement="left" data-title="Enlaces" data-content="<ul>@ViewBag.nombreEnlaces</ul>" data-html="true">
                    <i class="text-info fa fa-tags"></i>
                </button>
                <button type="button" class="btn btn-mini btn-default" style="border-radius:25px" data-container="body" data-toggle="popover" data-placement="left" data-title="Documentos" data-content="<ul></i><a href=''>Documento 1</a></ul>  <ul></i><a href=''>Documento 2</a></ul> <ul></i><a href=''>Documento 3</a></ul>" data-html="true">
                    <i class="text-primary fa fa-files-o"></i>
                </button>
                <button type="button" class="btn btn-mini btn-default" style="border-radius:25px" data-container="body" data-toggle="popover" data-placement="left" data-title="Favoritos" data-content="@ViewBag.Favoritos" data-html="true">
                    <i class="text-warning fa fa-star"></i>
                </button>

            </div>

            <h3 class="font-light m-b-xs">
                <i class="text-info @ViewBag.Icono"></i>&nbsp;&nbsp;@ViewBag.Title&nbsp;@Html.DisplayFor(model => model.codigoentrada)&nbsp;<span id="labelestado"></span>
                <a class="btn btn-sm btn-info" href="../../CentralAtencion/Index?menu=@ViewBag.menu"><i class="fa fa-reply">&nbsp;Regresar&nbsp;</i></a>
            </h3>
            <small>@ViewBag.Title</small>
        </div>
    </div>
</div>

<div class="panel-body" style="padding-top:0px;">
    <div class="hpanel">
        @*@if (TempData["mensaje"] != null)
            {
                <div class="alert alert-success  alert-dismissible" id="mensaje">
                    <button type="button" class="close" data-dismiss="alert" arial-label="close"><span aria-hidden="true">&times;</span></button>
                    <p>@TempData["mensaje"]</p>
                </div>
            }*@

        @if (TempData["mensaje_error"] != null)
        {
            <div class="alert alert-danger  alert-dismissible" id="mensaje_error">
                <button type="button" class="close" data-dismiss="alert" arial-label="close"><span aria-hidden="true">&times;</span></button>
                <p>@TempData["mensaje_error"]</p>
            </div>
        }

        <div id="tabs" class="tab-content">

            <div class="m float-e-margins text-right">
                <div class="tooltip-demo">

                    <div id="div-mensaje"></div>

                </div>
            </div>
            <div>
                <div class="panel-body" style="display:none" id="paneloperacionesnormal">
                    <div class="row" id="panelproduccion">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="control-label col-md-4">Tiempo Transcurrido:&nbsp;<span class="text-danger">*</span></label>
                                <div class="col-md-6">
                                    <span id="tiempoDuracion">00:00:00</span>
                                    @*<input type="hidden" id="tiempoDuracionhid" />*@
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <button type="button" id="comenzar" name="comenzar" class="btn btn-lg btn-primary"><i class="fa fa-play-circle"></i></button>
                            <button type="button" id="pausar" name="pausar" class="btn btn-lg btn-warning"><i class="fa fa-pause-circle-o"></i></button>
                            <button type="button" id="despausar" name="despausar" class="btn btn-lg btn-info"><i class="fa fa-pause-circle"></i></button>
                            <button type="button" id="finalizar" name="finalizar" class="btn btn-lg btn-success"><i class="fa fa-stop-circle"></i></button>

                        </div>
                    </div>
                </div>
            </div>
            <ul id="tabs-crear" class="nav nav-tabs">
                <li class="active"><a data-toggle="tab" href="#crear"><i class="@ViewBag.Icono"></i>&nbsp;&nbsp;@ViewBag.Title - Datos de la Orden</a></li>
                <li class=""><a data-toggle="tab" href="#recepcion"><i class="@ViewBag.Icono"></i>&nbsp;&nbsp;@ViewBag.Title - Recepción</a></li>
                <li class=""><a data-toggle="tab" href="#inspeccion" id="insp_tab" onclick="inspeccionVhSig(false)"><i class="@ViewBag.Icono"></i>&nbsp;&nbsp;@ViewBag.Title - Inspeccion</a></li>
                <li class=""><a data-toggle="tab" href="#repuestosSolicitados"><i class="@ViewBag.Icono"></i>&nbsp;&nbsp;@ViewBag.Title - Repuestos Solicitados</a></li>
                <li class=""><a data-toggle="tab" href="#ejecucion"><i class="@ViewBag.Icono"></i>&nbsp;&nbsp;@ViewBag.Title - Ejecucion</a></li>
                @*}*@
                @if (ViewBag.liquidacion == 1)
                {
                    <li class=""><a data-toggle="tab" href="#liquidacion"><i class="@ViewBag.Icono"></i>&nbsp;&nbsp;@ViewBag.Title - Liquidacion</a></li>

                }
                @*<li class="" onclick="buscarAjaxOrdenesTaller();"><a data-toggle="tab" href="#buscar"><i class="fa fa-search"></i>&nbsp;&nbsp;Búsquedas</a></li>*@
            </ul>

            <div id="crear" class="tab-pane active">
                <div class="panel-body">

                    @using (Html.BeginForm())
                    {
                        @Html.AntiForgeryToken()
                        @Html.Hidden("menu")
                        @Html.Hidden("numeroSolicitudes")
                        @Html.Hidden("id_cliente")
                        @Html.Hidden("numeroOperaciones")
                        @Html.Hidden("id_cita")

                        @Html.HiddenFor(model => model.idorden);
                        @Html.HiddenFor(model => model.id);

                        @Html.HiddenFor(model => model.id_cliente);
                        @Html.HiddenFor(model => model.bodega);
                        <input type="hidden" name="tipodegarantia" id="tipodegarantia" value="@ViewBag.tipodegarantia" />

                        <div class="form-horizontal">

                            @Html.ValidationSummary(true, "", new { @class = "text-danger" })

                            <input type="hidden" name="citaOrden" id="citaOrden" value="" />

                            <div class="hpanel">
                                <div class="panel-heading hbuilt" style="background-color:#e4e5e7">
                                    <div class="panel-tools">
                                        <a class="showhide"><i class="fa fa-chevron-up"></i></a>

                                    </div>
                                    <i class="fa fa-calendar-check-o"></i>&nbsp;&nbsp;&nbsp;Datos entrada
                                </div>
                                <div class="panel-body">

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Codigo:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                @Html.EditorFor(model => model.codigoentrada, new { htmlAttributes = new { @class = "form-control", @required = "required", @placeholder = "Digite codigo entrada", @readonly = "readonly" } })
                                                @Html.ValidationMessageFor(model => model.codigoentrada, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Asesor:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                @Html.DropDownListFor(model => model.asesor, null, "", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione", @required = "required" })
                                                @Html.ValidationMessageFor(model => model.asesor, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Tecnico:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                @Html.DropDownListFor(model => model.tecnico, null, "", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione" })
                                                @*@Html.ValidationMessageFor(model => model.idtipodoc, "", new { @class = "text-danger" })*@
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Motivo Ingreso Primario:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                @Html.DropDownListFor(model => model.razon_ingreso, null, "Seleccione", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione", @required = "required" })
                                                @Html.ValidationMessageFor(model => model.razon_ingreso, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Motivo Ingreso Secundario:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                @Html.DropDownListFor(model => model.razon_ingreso2, null, "Seleccione", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione", @required = "required" })
                                                @Html.ValidationMessageFor(model => model.razon_ingreso2, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6" id="areaRazonIngreso" style="display:none;">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Aseguradora:&nbsp;</label>
                                            <div class="col-md-6">
                                                @Html.DropDownListFor(model => model.aseguradora, null, "Seleccione", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione" })
                                                @Html.ValidationMessageFor(model => model.aseguradora, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>

                                    <div id="areaGarantia" style="display:block;">
                                        <div class="col-sm-12">
                                            <div class="form-group">
                                                <label class="control-label col-md-4">Falla:&nbsp;<span class="text-danger">*</span></label>
                                                <div class="col-md-6">
                                                    @Html.TextAreaFor(m => m.garantia_falla, new RouteValueDictionary(new { @class = "form-control requeridoGarantia", style = "width: 100%; height:80px;" }))
                                                    @Html.ValidationMessageFor(model => model.garantia_falla, "", new { @class = "text-danger" })
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-12">
                                            <div class="form-group">
                                                <label class="control-label col-md-4">Causa:&nbsp;<span class="text-danger">*</span></label>
                                                <div class="col-md-6">
                                                    @Html.TextAreaFor(m => m.garantia_causa, new RouteValueDictionary(new { @class = "form-control requeridoGarantia", style = "width: 100%; height:80px;" }))
                                                    @Html.ValidationMessageFor(model => model.garantia_causa, "", new { @class = "text-danger" })
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-12">
                                            <div class="form-group">
                                                <label class="control-label col-md-4">Solución:&nbsp;<span class="text-danger">*</span></label>
                                                <div class="col-md-6">
                                                    @Html.TextAreaFor(m => m.garantia_solucion, new RouteValueDictionary(new { @class = "form-control requeridoGarantia", style = "width: 100%; height:80px;" }))
                                                    @Html.ValidationMessageFor(model => model.garantia_solucion, "", new { @class = "text-danger" })
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="areaDatosAseguradora" style="display:none;">
                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="control-label col-md-4">Poliza:&nbsp;<span class="text-danger">*</span></label>
                                                <div class="col-md-6">
                                                    @Html.EditorFor(model => model.poliza, new { htmlAttributes = new { @class = "form-control requeridoAseguradora", @placeholder = "Digite poliza" } })
                                                    @Html.ValidationMessageFor(model => model.poliza, "", new { @class = "text-danger" })
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="control-label col-md-4">Siniestro:&nbsp;<span class="text-danger">*</span></label>
                                                <div class="col-md-6">
                                                    @Html.EditorFor(model => model.siniestro, new { htmlAttributes = new { @class = "form-control requeridoAseguradora", @placeholder = "Digite siniestro" } })
                                                    @Html.ValidationMessageFor(model => model.siniestro, "", new { @class = "text-danger" })
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="control-label col-md-4">Valor Minimo:&nbsp;<span class="text-danger">*</span></label>
                                                <div class="col-md-6">
                                                    @Html.EditorFor(model => model.minimo, new { htmlAttributes = new { @class = "form-control requeridoAseguradora", @placeholder = "Digite valor ($)", @onkeyUp = "return miles(this.id)" } })
                                                    @*@Html.ValidationMessageFor(model => model.minimo, "", new { @class = "text-danger" })*@
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="control-label col-md-4">Deducible:&nbsp;<span class="text-danger">*</span></label>
                                                <div class="col-md-6">
                                                    @Html.EditorFor(model => model.deducible, new { htmlAttributes = new { @class = "form-control requeridoAseguradora", @placeholder = "Digite deducible", @onkeyUp = "return miles(this.id)" } })
                                                    @*@Html.ValidationMessageFor(model => model.deducible, "", new { @class = "text-danger" })*@
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="control-label col-md-4">Fecha Soat:&nbsp;<span class="text-danger">*</span></label>
                                                <div class="col-md-6">
                                                    @Html.EditorFor(model => model.fecha_soat, new { htmlAttributes = new { @class = "form-control requeridoAseguradora", @placeholder = "", } })
                                                    @*@Html.ValidationMessageFor(model => model.deducible, "", new { @class = "text-danger" })*@
                                                    <div class="col-sm-12" id="selectInfoSoat" style="display:none">
                                                        <div class="form-group">
                                                            <div class="col-md-12">
                                                                <div class="alert alert-danger">
                                                                    <strong></strong><p id="textosoat"></p><br />
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="control-label col-md-4">Numero de Soat:&nbsp;<span class="text-danger">*</span></label>
                                                <div class="col-md-6">
                                                    @Html.EditorFor(model => model.numero_soat, new { htmlAttributes = new { @class = "form-control requeridoAseguradora", @placeholder = "Digite N° de SOAT", @onkeyUp = "return soloNumeros(this.id)" } })
                                                    @*@Html.ValidationMessageFor(model => model.deducible, "", new { @class = "text-danger" })*@
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>

                            <div class="hpanel">
                                <div class="panel-heading hbuilt" style="background-color:#e4e5e7">
                                    <div class="panel-tools">
                                        <a class="showhide"><i class="fa fa-chevron-up"></i></a>

                                    </div>
                                    <i class="fa fa-car"></i>&nbsp;&nbsp;&nbsp;Datos Vehiculo
                                </div>
                                <div class="panel-body">

                                    <div class="row">
                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="control-label col-md-4">Placa / Plan Mayor:&nbsp;<span class="text-danger">*</span></label>
                                                <div class="col-md-6">
                                                    @Html.EditorFor(model => model.placa, new { htmlAttributes = new { @class = "form-control", @required = "required", @placeholder = "Digite placa", @readonly = "readonly" } })
                                                    @Html.ValidationMessageFor(model => model.placa, "", new { @class = "text-danger" })
                                                </div>
                                                <div class="col-md-2">
                                                    <button type="button" class="btn btn-primary" id="btnBuscarPlaca" style="display:none"><i class="fa fa-search"></i></button>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-6" style="display:none;" id="placaNoEncontrada">
                                            <div class="form-group">
                                                <label class="control-label col-md-10">Placa no encontrada &nbsp;<a class="btn btn-link" href="../../creacionVh?menu=@ViewBag.id_menu">&nbsp;Crear vehiculo aqui&nbsp;&nbsp;<i class="fa fa-car"></i></a>&nbsp;</label>

                                            </div>
                                        </div>

                                    </div>

                                    <div class="row">

                                        <div class="areaVehiculoOculta" style="display:none;">
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">Serie:&nbsp;</label>
                                                    <div class="col-md-6">
                                                        <p id="serieBuscado"></p>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">Numero Motor:&nbsp;</label>
                                                    <div class="col-md-6">
                                                        <p id="numMotorBuscado"></p>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">Color:&nbsp;</label>
                                                    <div class="col-md-6">
                                                        <p id="colorBuscado"></p>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">Fecha Venta:&nbsp;</label>
                                                    <div class="col-md-6">
                                                        <p id="fechaVentaBuscado"></p>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">Fecha Fin Garantia:&nbsp;</label>
                                                    <div class="col-md-6">
                                                        <p id="fechaFinGarantiaBuscado"></p>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">Kilometraje Anterior:&nbsp;</label>
                                                    <div class="col-md-6">
                                                        <p id="kilometrajeBuscado"></p>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="row">
                                                <div class="col-sm-6">
                                                    <div class="form-group">
                                                        <label class="control-label col-md-4">kilometraje Actual:&nbsp;<span class="text-danger">*</span></label>
                                                        <div class="col-md-6">
                                                            @Html.EditorFor(model => model.kilometraje, new { htmlAttributes = new { @class = "form-control", @required = "required", @placeholder = "Digite kilometraje", @readonly = "readonly" } })
                                                            @Html.ValidationMessageFor(model => model.kilometraje, "", new { @class = "text-danger" })
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>

                                    </div>
                                </div>
                            </div>

                            <div class="hpanel" id="areaPanelCliente" style="display:none;">
                                <div class="panel-heading hbuilt" style="background-color:#e4e5e7">
                                    <div class="panel-tools">
                                        <a class="showhide"><i class="fa fa-chevron-up"></i></a>

                                    </div>
                                    <i class="fa fa-user-circle-o"></i>&nbsp;&nbsp;&nbsp;Datos Propietario
                                </div>
                                <div class="panel-body">

                                    <div class="row">

                                        <div class="row">
                                            <div class="col-sm-6" id="areaTxtBuscarDocumento">
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">Documento:&nbsp;<span class="text-danger">*</span></label>
                                                    <div class="col-md-6">
                                                        @Html.EditorFor(model => model.txtDocumentoCliente, new { htmlAttributes = new { @class = "form-control", @placeholder = "Digite numero documento" } })
                                                    </div>
                                                    <div class="col-md-2">
                                                        <button type="button" class="btn btn-primary" id="btnBuscarCliente"><i class="fa fa-search"></i></button>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-sm-6" style="display:none;" id="documentoNoEncontrado">
                                                <div class="form-group">
                                                    <label class="control-label col-md-10">Propietario no encontrado, puede buscarlo o&nbsp;<a class="btn btn-link" href="../../terceros?menu=@ViewBag.id_menu">&nbsp;Crear cliente aqui&nbsp;&nbsp;<i class="fa fa-user-circle-o"></i></a>&nbsp;</label>

                                                </div>
                                            </div>

                                        </div>

                                        <div class="areaClienteOculta" style="display:none;">
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">Documento:&nbsp;</label>
                                                    <div class="col-md-6">
                                                        <p id="documentoBuscado"></p>
                                                        <input type="hidden" value="" name="documentoBuscadoCliente" id="documentoBuscadoCliente" />
                                                        <input type="hidden" name="docTerceroBuscado" id="docTerceroBuscado" value="" />
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">Nombre:&nbsp;</label>
                                                    <div class="col-md-6">
                                                        <p id="nombreBuscado"></p>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">Telefono:&nbsp;</label>
                                                    <div class="col-md-6">
                                                        <p id="telefonoBuscado"></p>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">Celular:&nbsp;</label>
                                                    <div class="col-md-6">
                                                        <p id="celularBuscado"></p>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="row">
                                                <div class="col-sm-6">
                                                    <div class="form-group">
                                                        <label class="control-label col-md-4">Email:&nbsp;</label>
                                                        <div class="col-md-6">
                                                            <p id="emailBuscado"></p>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="col-sm-6">
                                                    <div class="form-group">
                                                        <label class="control-label col-md-4">Ciudad:&nbsp;</label>
                                                        <div class="col-md-6">
                                                            <p id="ciudadBuscado"></p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            @*<div class="row">
                                                    <div class="col-sm-6">
                                                        <div class="form-group">
                                                            <label class="control-label col-md-4">Recibido de:&nbsp;</label>
                                                            <div class="col-md-6">
                                                                @Html.DropDownListFor(model => model.recibidode, null, "", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione", @disabled = "disabled" })
                                                                @Html.ValidationMessageFor(model => model.recibidode, "", new { @class = "text-danger" })
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>*@
                                        </div>

                                    </div>
                                </div>
                            </div>



                            @*/**********************************************************************************************************************************************************************************************************/*@
                            <div class="hpanel" id="tareasInspeccion" style="display:none">
                                <div class="panel-heading hbuilt" style="background-color:#e4e5e7">
                                    <div class="panel-tools">
                                        <a class="showhide"><i class="fa fa-chevron-up"></i></a>
                                    </div>
                                    <i class="fa fa-clone"></i>&nbsp;&nbsp;&nbsp;Adicionales de Inspección
                                </div>
                                <div class="panel-body">
                                    <div class="row">
                                        <div class="row">
                                            <div class="col-md-12 text-center">
                                                <h4><label class="label label-default">Tareas Solicitadas en Inspección</label></h4>
                                            </div>
                                        </div>

                                        <div class="col-md-12">
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <input type="hidden" name="numeroTareas" id="numeroTareas" value="" />
                                                    <div class="table-responsive">
                                                        <div id="div-mensaje-buscar"></div>
                                                        <table class="table table-striped table-bordered table-hover" id="tablaTareas">
                                                            <thead>
                                                                <tr>
                                                                    <th style="text-align:center">Tarea Inspección</th>
                                                                    <th style="text-align:center">Cantidad</th>
                                                                    <th style="text-align:center">Valor</th>
                                                                    <th style="text-align:center">Fecha Autorización</th>
                                                                    <th style="text-align:center">Autorizar</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody></tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            @*/**********************************************************************************************************************************************************************************************************/*@



                            <div class="panel-body-btns text-right">
                                <button class="btn btn-info" type="submit"><i class="fa fa-save"></i>&nbsp;&nbsp;&nbsp;Guardar</button>
                            </div>

                        </div>
                    }
                </div>
            </div>
            <div id="recepcion" class="tab-pane">
                <div class="panel-body">

                    <div class="hpanel">
                        <div class="panel-heading hbuilt" style="background-color:#e4e5e7">
                            <div class="panel-tools">
                                <a class="showhide"><i class="fa fa-chevron-up"></i></a>

                            </div>
                            <i class="fa fa-calendar"></i>&nbsp;&nbsp;&nbsp;Parametros De Entrega
                        </div>
                        <div class="panel-body">

                            <div class="row">

                                <div class="row">

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Entrega:&nbsp;</label>
                                            <div class="col-md-6">
                                                @Html.Editor("txtEntregaEstimado", new { htmlAttributes = new { @class = "form-control", @required = "required", @placeholder = "Fecha entrega estimada", @readonly = "readonly" } })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Notas:</label>
                                            <div class="col-md-6">
                                                @Html.TextAreaFor(m => m.notas, new RouteValueDictionary(new { @class = "someClass", style = "width: 100%; height:80px;" }))
                                                @Html.ValidationMessageFor(model => model.notas, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>

                                </div>

                            </div>
                        </div>
                    </div>

                    <div class="hpanel">
                        <div class="panel-heading hbuilt" style="background-color:#e4e5e7">
                            <div class="panel-tools">
                                <a class="showhide"><i class="fa fa-chevron-up"></i></a>

                            </div>
                            <i class="fa fa-clone"></i>&nbsp;&nbsp;&nbsp;Síntomas
                        </div>
                        <div class="panel-body">

                            <div class="row">
                                <div class="row">
                                    <div class="col-md-12 text-center">
                                        <h4><label class="label label-default">Solicitudes Presentadas</label></h4>
                                    </div>
                                </div>
                                <hr />


                                <div class="col-sm-12">
                                    <div class="form-group">
                                        <div class="table-responsive">
                                            <div id="div-mensaje-buscar"></div>
                                            <table class="table table-striped table-bordered table-hover" id="tablaSolicitudes">
                                                <thead>
                                                    <tr>
                                                        <th style="text-align:center">Solicitud Cliente</th>
                                                        <th style="text-align:center">Respuesta Taller</th>
                                                    </tr>
                                                </thead>
                                                <tbody></tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                                @*<button class="btn btn-primary" onclick="inspeccionVhSig(true)"><i class="fa fa-wrench"></i>  Inspeccion Signos Vitales</button>
        <button class="btn btn btn-danger" type="button" id="cotizacion" name="cotizacion" style="display:none" disabled="disabled"><i class="fa fa-file-pdf-o">&nbsp;Imprimir Cotizacion</i></button>*@

                            </div>
                        </div>
                    </div>

                    <div class="hpanel">
                        <div class="panel-heading hbuilt" style="background-color:#e4e5e7">
                            <div class="panel-tools">
                                <a class="showhide"><i class="fa fa-chevron-up"></i></a>
                            </div>
                            <i class="fa fa-cogs"></i>&nbsp;&nbsp;&nbsp;Operaciones
                        </div>
                        <div class="panel-body">
                            <div class="row">
                                <div class="col-sm-12">
                                    <div class="form-group">
                                        <div class="panel-body-btns text-right">
                                            <a class="btn btn-info" href="@ViewBag.linkrepuestos" target="_blank"><i class="fa fa-car"></i>&nbsp;&nbsp;&nbsp;Catálogo de Repuestos</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="row">
                                    @*<div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="control-label col-md-4">Tipo Tarifa:&nbsp;<span class="text-danger">*</span></label>
                                                <div class="col-md-6">
                                                    @Html.DropDownList("tipoTarifa", null, "", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione" })
                                                    <input type="hidden" name="nitTipoTarifa" id="nitTipoTarifa" value="" />
                                                </div>
                                            </div>
                                        </div>*@

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Operación:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                @Html.DropDownList("operacionesTempario", null, "", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione" })
                                            </div>
                                        </div>
                                    </div>



                                    @*<div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="control-label col-md-4">Descuento (%):</label>
                                                <div class="col-md-6">
                                                    @Html.Editor("txtDescuentoOperacion", new { htmlAttributes = new { @class = "form-control", @placeholder = "Digite descuento" } })
                                                </div>
                                            </div>
                                        </div>*@

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <div class="col-md-6 col-md-offset-4">
                                                <button type="button" class="btn btn-primary" id="btnAgregarOperacion"><i class="fa fa-plus"></i>&nbsp;&nbsp;Agregar</button>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-12 text-center" style="display:none;" id="alertaAgregarOperacion">
                                        <div class="form-group">
                                            <div class="col-md-12">
                                                <div class="alert alert-info">
                                                    <strong>Alerta!</strong><p id="mensajeAlertaAgregarOperacion"></p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>


                                <div class="col-md-12">
                                    <div class="table-responsive">
                                        <div id="div-mensaje-buscar"></div>
                                        <table class="table table-striped table-bordered table-hover" id="tablaOperacionesPorPlaca">
                                            <thead>
                                                <tr>
                                                    <th style="text-align:center">Código</th>
                                                    <th style="text-align:center">Operación</th>
                                                    <th style="text-align:center">Tecnico</th>
                                                    <th style="text-align:center">Tiempo</th>
                                                    @*<th style="text-align:center">Valor</th>*@
                                                    @*<th style="text-align:center">Descuento (%)</th>
                                                        <th style="text-align:center">Valor Descuento</th>*@
                                                    @*<th style="text-align:center">Iva (%)</th>
                                                        <th style="text-align:center">Valor Iva</th>*@
                                                    <th style="text-align:center">Valor Total</th>
                                                    <th style="text-align:center">Acción</th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>

                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label class="control-label col-md-4">Total Valor Operaciones:</label>
                                        <div class="col-md-6">
                                            @Html.Editor("totaloperaciones", new { htmlAttributes = new { @class = "form-control", @placeholder = "Total Operaciones", @readonly = "true" } })
                                        </div>
                                    </div>
                                </div>



                            </div>
                        </div>
                    </div>

                    <div class="hpanel">
                        <div class="panel-heading hbuilt" style="background-color:#e4e5e7">
                            <div class="panel-tools">
                                <a class="showhide"><i class="fa fa-chevron-up"></i></a>
                            </div>
                            <i class="fa fa-cogs"></i>&nbsp;&nbsp;&nbsp;Repuestos
                        </div>
                        <div class="panel-body">

                            <div class="row">

                                @Html.Hidden("nombre_repuesto")

                                <div class="row">
                                    <div class="col-lg-12">
                                        <div class="form-group">
                                            <label class="control-label col-md-6">Tipo de repuesto:<span class="text-danger">*&nbsp;</span></label>
                                            <div class="col-md-6">
                                                <input type="checkbox" name="tipoRepuesto" id="tipoRepuesto" value="" data_toggle="toggle" data_size="mini" checked />
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">

                                    @*<div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="control-label col-md-4">Tipo Tarifa:&nbsp;<span class="text-danger">*</span></label>
                                                <div class="col-md-6">
                                                    @Html.DropDownList("tipoTarifaR", null, "", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione" })
                                                </div>
                                            </div>
                                        </div>*@

                                    <div class="col-sm-6" id="rOficial">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Referencia:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                @Html.DropDownList("repuestos", null, "", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione" })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6" style="display:none" id="rGenerico">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Referencia Generica:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                @Html.DropDownList("repuestosG", null, "", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione" })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Cantidad:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                @Html.Editor("txtCantidadRepuesto", new { htmlAttributes = new { @class = "form-control", @placeholder = "Digite cantidad" } })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Precio Unitario:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                @Html.Editor("txtPrecioRepuesto", new { htmlAttributes = new { @class = "form-control", @placeholder = "Digite precio", @readonly = "readonly" } })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Iva:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-3" style="display:none">
                                                @Html.Editor("txtPorIvaRepuesto", new { htmlAttributes = new { @class = "form-control", @placeholder = "Iva (%)", @readonly = "readonly" } })
                                            </div>
                                            <div class="col-md-3">
                                                @Html.Editor("txtValorIvaRepuesto", new { htmlAttributes = new { @class = "form-control", @placeholder = "Iva ($)", @readonly = "readonly" } })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6" style="display:none">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Descuento:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-3">
                                                @Html.Editor("txtPorDsctoRepuesto", new { htmlAttributes = new { @class = "form-control", @placeholder = "Descuento (%)", @readonly = "readonly" } })
                                            </div>
                                            <div class="col-md-3">
                                                @Html.Editor("txtValorDsctoRepuesto", new { htmlAttributes = new { @class = "form-control", @placeholder = "Descuento ($)", @readonly = "readonly" } })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <div class="col-md-6 col-md-offset-4">
                                                <button type="button" class="btn btn-primary" id="btnAgregarRepuesto"><i class="fa fa-plus"></i>&nbsp;&nbsp;Agregar</button>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-12 text-center" style="display:none;" id="alertaAgregarRepuesto">
                                        <div class="form-group">
                                            <div class="col-md-12">
                                                <div class="alert alert-info">
                                                    <strong>Alerta!</strong><p id="mensajeAlertaAgregarRepuesto"></p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>

                                <div class="col-sm-12 col-md-12 col-lg-12">
                                    <p><strong> Leyendas</strong></p>
                                    <div class="col-sm-2 col-md-2 col-lg-2" style="text-align:center">
                                        <button type="button" class="btn btn-sm btn-success btn-circle">&nbsp;</button><strong>Stock en bodega</strong>
                                    </div>
                                    <div class="col-sm-2 col-md-2 col-lg-2" style="text-align:center">
                                        <button type="button" class="btn btn-sm btn-warning btn-circle">&nbsp;</button><strong> Stock en Otra Bodega</strong>
                                    </div>
                                    <div class="col-sm-2 col-md-2 col-lg-2" style="text-align:center">
                                        <button type="button" class="btn btn-sm btn-warning2 btn-circle">&nbsp;</button><strong> Stock en referencia reemplazo</strong>
                                    </div>
                                    <div class="col-sm-2 col-md-2 col-lg-2" style="text-align:center">
                                        <button type="button" class="btn btn-sm btn-danger btn-circle">&nbsp;</button><strong> NO hay stock</strong>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="table-responsive">
                                        <div id="div-mensaje-buscar"></div>
                                        <table class="table table-striped table-bordered table-hover" id="tablaRepuestosPorPlaca">
                                            <thead>
                                                <tr>
                                                    <th style="text-align:center">Código</th>
                                                    <th style="text-align:center">Descripción</th>
                                                    <th style="text-align:center">Cantidad</th>
                                                    <th style="text-align:center">Precio Unitario</th>
                                                    @*<th style="text-align:center">Iva (%)</th>*@
                                                    <th style="text-align:center">Iva ($)</th>
                                                    @*<th style="text-align:center">Descuento (%)</th>
                                                        <th style="text-align:center">Descuento ($)</th>*@
                                                    <th style="text-align:center">Total</th>
                                                    <th style="text-align:center">Stock</th>
                                                    <th style="text-align:center">Solicitar</th>
                                                    <th style="text-align:center">Acción</th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                        <input type="hidden" value="" name="numeroRepuestos" id="numeroRepuestos" />
                                    </div>
                                </div>

                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label class="control-label col-md-4">Total Valor Repuestos:</label>
                                        <div class="col-md-6">
                                            @Html.Editor("total_repuestos", new { htmlAttributes = new { @class = "form-control", @placeholder = "Total Operaciones", @readonly = "true" } })
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-12" style="display:none">
                                    <div class="table-responsive">
                                        <div id="div-mensaje-buscar"></div>
                                        <table class="table table-striped table-bordered table-hover" id="tablaSolicitudRepuestos">
                                            <thead>
                                                <tr>
                                                    <th style="text-align:center">Código</th>
                                                    <th style="text-align:center">Cantidad</th>
                                                    <th style="text-align:center">Precio Unitario</th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <div class="panel-body-btns text-right">
                                        <button class="btn btn-primary" type="button" id="btnSolicitarRepuestos" style="display:none" disabled><i class="fa fa-save"></i>&nbsp;&nbsp;&nbsp;Solicitar</button>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    @*<div class="alert alert-info" role="alert">
                                            <p>Para solicitar los repuestos primero debes haber guardado la orden</p>
                                        </div>*@
                                    <div class="alert alert-success" role="alert" style="display:none;" id="alertaSolicitudGuardadaRepuesto">
                                        <p id="msjSolicitud"></p>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-12">
                                <div class="table-responsive">
                                    <div id="div-mensaje-buscar"></div>
                                    <table class="table table-striped table-bordered table-hover" id="tablaRepuestosSolicitudes">
                                        <thead>
                                            <tr>
                                                <th style="text-align:center"># Solicitud</th>
                                                <th style="text-align:center">Repuesto</th>
                                                <th style="text-align:center">Cantidad Solicitada</th>
                                                <th style="text-align:center">Precio Unitario</th>
                                                <th style="text-align:center">Fecha de Solicitud</th>
                                                <th style="text-align:center">Recibido</th>
                                                <th style="text-align:center">Fecha de Recepción</th>
                                                <th style="text-align:center">Cantidad Recepcion</th>
                                            </tr>
                                        </thead>
                                        <tbody></tbody>
                                    </table>
                                </div>
                            </div>

                            <br />
                        </div>
                    </div>


                </div>
            </div>
            <div id="inspeccion" class="tab-pane">
                <div class="panel-body">
                    <div id="dv_sistemasVh">
                    </div>
                    <div id="dv_operacionesVh">
                        @if (Request["id"] != null || !Request.Url.Segments[3].IsEmpty())
                        {
                            var id_url = (Request["id"] != null) ? Request["id"] : Request.Url.Segments[3];
                            @Html.Action("tablasVw", "SignosVitales", new { ot_id = id_url });
                        }
                    </div>
                </div>
            </div>
            <div id="repuestosSolicitados" class="tab-pane">
                <div class="panel-body">
                    <div class="hpanel">
                        <div class="panel-heading hbuilt" style="background-color:#e4e5e7">
                            <div class="panel-tools">
                                <a class="showhide"><i class="fa fa-chevron-up"></i></a>

                            </div>
                            <i class="fa fa-gears"></i>&nbsp;&nbsp;&nbsp;Repuestos Solicitados
                        </div>

                        <div class="panel-body">
                            <div class="panel-body-busqueda">
                                <div class="col-md-12">
                                    <div class="table-responsive">
                                        <div id="div-mensaje-buscar"></div>
                                        <table class="table table-striped table-bordered table-hover" id="tablaRepuestosSolicitudes2">
                                            <thead>
                                                <tr>
                                                    <th style="text-align:center"># Solicitud</th>
                                                    <th style="text-align:center">Repuesto</th>
                                                    <th style="text-align:center">Cantidad Solicitada</th>
                                                    <th style="text-align:center">Precio Unitario</th>
                                                    <th style="text-align:center">Fecha de Solicitud</th>
                                                    <th style="text-align:center">Recibido</th>
                                                    <th style="text-align:center">Fecha de Recepción</th>
                                                    <th style="text-align:center">Cantidad Recepcion</th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>

                    <div class="hpanel">
                        <div class="panel-heading hbuilt" style="background-color:#e4e5e7">
                            <div class="panel-tools">
                                <a class="showhide"><i class="fa fa-chevron-up"></i></a>

                            </div>
                            <i class="fa fa-gears"></i>&nbsp;&nbsp;&nbsp;Repuestos Recibidos
                        </div>

                        <div class="panel-body">
                            <div class="panel-body-busqueda">
                                <div class="col-md-12">
                                    <div class="table-responsive">
                                        <div id="div-mensaje-buscar"></div>
                                        <table class="table table-striped table-bordered table-hover" id="tablaRepuestosTrasladados">
                                            <thead>
                                                <tr>
                                                    <th style="text-align:center"># Traslado</th>
                                                    <th style="text-align:center">Repuesto</th>
                                                    <th style="text-align:center">Cantidad</th>
                                                    <th style="text-align:center">Precio Unitario</th>
                                                    @*<th style="text-align:center">Iva (%)</th>*@
                                                    <th style="text-align:center">Iva ($)</th>
                                                    @*<th style="text-align:center">Descuento (%)</th>
                                                        <th style="text-align:center">Descuento ($)</th>*@
                                                    <th style="text-align:center">Total</th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>

                    <div class="col-md-6">
                        <button type="button" name="btnEjecutarOT" id="btnEjecutarOT" class="btn btn-sm btn-info" style="display:none"><i class="fa fa-play"></i>&nbsp;Comenzar Operacion</button>
                    </div>
                </div>
            </div>
            <div id="ejecucion" class="tab-pane">
                <div class="panel-body">

                    <div class="hpanel">
                        <div class="panel-heading hbuilt" style="background-color:#e4e5e7">
                            <div class="panel-tools">
                                <a class="showhide"><i class="fa fa-chevron-up"></i></a>

                            </div>
                            <i class="fa fa-gears"></i>&nbsp;&nbsp;&nbsp;Repuestos Recibidos
                        </div>

                        <div class="panel-body">


                        </div>
                    </div>
                    <div class="hpanel">
                        <div class="panel-heading hbuilt" style="background-color:#e4e5e7">
                            <div class="panel-tools">
                                <a class="showhide"><i class="fa fa-chevron-up"></i></a>

                            </div>
                            <i class="fa fa-gears"></i>&nbsp;&nbsp;&nbsp;Tracking de Eventos
                        </div>

                        <div class="panel-body">

                            <div class="panel-body-busqueda">
                                <div class="col-md-12">
                                    <div class="table-responsive">
                                        <div id="div-mensaje-buscar"></div>
                                        <table class="table table-striped table-bordered table-hover" id="trackingEventos">
                                            <thead>
                                                <tr>
                                                    <th style="text-align:center">#</th>
                                                    <th style="text-align:center">Descripcion</th>
                                                    <th style="text-align:center">Estado de OT</th>
                                                    <th style="text-align:center">Responsable</th>
                                                    <th style="text-align:center">Fecha</th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>



                    <div class="col-md-6">
                        <button type="button" name="btnFinalizarOT" id="btnFinalizarOT" class="btn btn-sm btn-info" style="display:none"><i class="fa fa-hand-paper-o"></i>&nbsp;Finalizar Operaciones</button>
                    </div>
                </div>
            </div>
            <div id="buscar" class="tab-pane">
                <div class="panel-body">
                    <div class="panel-body-busqueda">
                        <div class="table-responsive">
                            <div id="div-mensaje-buscar"></div>
                            <table class="table table-striped table-bordered table-hover" id="tablaPaginada">
                                <thead>
                                    <tr>
                                        <th style="text-align:center">Codigo Orden</th>
                                        <th style="text-align:center">Documento</th>
                                        <th style="text-align:center">Cliente</th>
                                        <th style="text-align:center">Placa</th>
                                        <th style="text-align:center">Descripcion</th>
                                        <th style="text-align:center">Fecha</th>
                                        <th style="text-align:center">Acción</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>

                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<div id="modalEditarSolicitudCliente" class="modal hmodal-success" tabindex="-1" aria-hidden="true" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="color-line"></div>
            <div class="modal-header text-center">
                @*<button type="button" class="close" data-dismiss="modal">&times;</button>*@
                <h4 class="modal-title">Editar Solicitud</h4>
            </div>
            <div class="modal-body">

                <input type="hidden" id="txtIdFilaEditada" />
                <input type="hidden" id="txtIdSolicitudEditada" />

                <div class="row" style="text-align:center;">
                    <div class="col-sm-12">
                        <div class="form-group">
                            <label class="control-label col-md-2">Solicitud:&nbsp;</label>
                            <div class="col-md-8">
                                <input type="text" class="form-control" id="txtSolicitudClienteEditar" name="txtSolicitudClienteEditar" placeholder="Digite solicitud del cliente" readonly />
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row" style="text-align:center;">
                    <div class="col-sm-12">
                        <div class="form-group">
                            <label class="control-label col-md-2">Respuesta:&nbsp;</label>
                            <div class="col-md-8">
                                <input type="text" class="form-control" id="txtRespuestaClienteEditar" name="txtRespuestaClienteEditar" placeholder="Digite respuesta a solicitud" />
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="btnEditarSolicitud">Aceptar</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal" id="cerrarModal">Cancelar</button>
            </div>
        </div>
    </div>
</div>

<div id="modalOrdenCreada" class="modal" tabindex="-1" aria-hidden="true" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="color-line"></div>
            <div class="modal-header text-center">
                @*<button type="button" class="close" data-dismiss="modal">&times;</button>*@
                <h4 class="modal-title">Orden de taller registrada con éxito</h4>
            </div>
            <div class="modal-body">
                <div class="row" style="text-align:center;">
                    <h4>Se Creó la orden de taller</h4> <h3><span class="label label-default">@TempData["mensaje"]</span></h3>
                </div>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal" id="cerrarModalOrdenCreada">Cerrar</button>
            </div>
        </div>
    </div>
</div>

<div id="modalEditarReferencia" class="modal hmodal-success" tabindex="-1" aria-hidden="true" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="color-line"></div>
            <div class="modal-header text-center">
                @*<button type="button" class="close" data-dismiss="modal">&times;</button>*@
                <h4 class="modal-title">Editar Referencia</h4>
                <small class="font-bold">Referencias que se asignaran a la orden de taller.</small>
            </div>
            <div class="modal-body">

                <input type="hidden" id="txtIdFilaEditadaRepuesto" />

                <div class="col-sm-12">
                    <div class="form-group">
                        <label class="control-label col-md-4">Referencia:&nbsp;<span class="text-danger">*</span></label>
                        <div class="col-md-6">
                            @Html.Editor("txtCodigoReferencia", new { htmlAttributes = new { @class = "form-control", @placeholder = "Nombre Referencia", @readonly = "readonly" } })
                        </div>
                    </div>
                </div>

                <div class="col-sm-12">
                    <div class="form-group">
                        <label class="control-label col-md-4">Nombre:&nbsp;<span class="text-danger">*</span></label>
                        <div class="col-md-6">
                            @Html.Editor("txtNombreReferencia", new { htmlAttributes = new { @class = "form-control", @placeholder = "Nombre Referencia", @readonly = "readonly" } })
                        </div>
                    </div>
                </div>

                <div class="col-sm-12">
                    <div class="form-group">
                        <label class="control-label col-md-4">Cantidad:&nbsp;<span class="text-danger">*</span></label>
                        <div class="col-md-6">
                            @Html.Editor("txtCantidadReferencia", new { htmlAttributes = new { @class = "form-control", @placeholder = "Cantidad Referencia" } })
                        </div>
                    </div>
                </div>

                <div class="col-sm-12">
                    <div class="form-group">
                        <label class="control-label col-md-4">Precio:&nbsp;<span class="text-danger">*</span></label>
                        <div class="col-md-6">
                            @Html.Editor("txtPrecioReferencia", new { htmlAttributes = new { @class = "form-control", @placeholder = "Precio Referencia", @readonly = "readonly" } })
                        </div>
                    </div>
                </div>

                <div class="col-sm-12" style="display:none">
                    <div class="form-group">
                        <label class="control-label col-md-4">Iva (%):&nbsp;<span class="text-danger">*</span></label>
                        <div class="col-md-6">
                            @Html.Editor("txtPorIvaReferencia", new { htmlAttributes = new { @class = "form-control", @placeholder = "Iva (%)", @readonly = "readonly" } })
                        </div>
                    </div>
                </div>

                <div class="col-sm-12">
                    <div class="form-group">
                        <label class="control-label col-md-4">Iva ($):&nbsp;<span class="text-danger">*</span></label>
                        <div class="col-md-6">
                            @Html.Editor("txtValorIvaReferencia", new { htmlAttributes = new { @class = "form-control", @placeholder = "Iva ($)", @readonly = "readonly" } })
                        </div>
                    </div>
                </div>

                <div class="col-sm-12" style="display:none">
                    <div class="form-group">
                        <label class="control-label col-md-4">Descuento (%):&nbsp;<span class="text-danger">*</span></label>
                        <div class="col-md-6">
                            @Html.Editor("txtPorDsctoReferencia", new { htmlAttributes = new { @class = "form-control", @placeholder = "Descuento (%)", @readonly = "readonly" } })
                        </div>
                    </div>
                </div>

                <div class="col-sm-12" style="display:none">
                    <div class="form-group">
                        <label class="control-label col-md-4">Descuento ($):&nbsp;<span class="text-danger">*</span></label>
                        <div class="col-md-6">
                            @Html.Editor("txtValorDsctoReferencia", new { htmlAttributes = new { @class = "form-control", @placeholder = "Descuento ($)", @readonly = "readonly" } })
                        </div>
                    </div>
                </div>

                <div class="col-sm-12">
                    <div class="form-group">
                        <label class="control-label col-md-4">Precio Total:&nbsp;<span class="text-danger">*</span></label>
                        <div class="col-md-6">
                            @Html.Editor("txtPrecioTotalReferencia", new { htmlAttributes = new { @class = "form-control", @placeholder = "Precio Total", @readonly = "readonly" } })
                        </div>
                    </div>
                </div>

                <label></label>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="btnModificarReferencia">Guardar</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal" id="cerrarModal">Cancelar</button>
            </div>
        </div>
    </div>
</div>


<div class="modal fade hmodal-success in" id="modalTareas" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="color-line"></div>
            <div class="modal-header">
                <h4 class="modal-title">Tareas Por Gestionar</h4>
                <small class="font-bold">Los siguientes procesos estan asociados al estado que ha seleccionado</small>
            </div>

            <form id="Tareasform" onsubmit="return false" method="post" name="myForm">

                @Html.AntiForgeryToken()

                <div class="modal-body">

                    @Html.ValidationSummary(true, "", new { @class = "text-danger" })
                    <input type="hidden" name="prioridad" id="prioridad" value="" />
                    <input type="hidden" name="nombre_item" id="nombre_item" value="" />
                    <input type="hidden" name="nombre_categoria" id="nombre_categoria" value="" />
                    <div style="display:none;">
                        @Html.DropDownList("selectItems", Enumerable.Empty<SelectListItem>(), "", htmlAttributes: new { @class = "form-control js-source-states", @style = "display:none" })
                        @Html.DropDownList("selectCategorias", Enumerable.Empty<SelectListItem>(), "", htmlAttributes: new { @class = "form-control js-source-states", @style = "display:none" })
                    </div>

                    <div class="col-sm-12">
                        <div class="form-group">
                            <label class="control-label col-md-4">Tarea:&nbsp;<span class="text-danger">*</span></label>
                            <div class="col-md-6">
                                @Html.DropDownList("selectTareas", Enumerable.Empty<SelectListItem>(), "", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione", @required = "required" })
                            </div>
                        </div>
                    </div>

                    <div class="col-sm-12">
                        <div class="form-group">
                            <label class="control-label col-md-4">Cantidad:&nbsp;<span class="text-danger">*</span></label>
                            <div class="col-md-6">
                                @Html.Editor("txtCantidad", new { htmlAttributes = new { @class = "form-control", @placeholder = "Digite Cantidad", @required = "required", @autocomplete = "off", @onkeyUp = "return miles(this.id)" } })
                            </div>
                        </div>
                    </div>

                    <div class="col-sm-12">
                        <div class="form-group">
                            <label class="control-label col-md-4">Costo:&nbsp;<span class="text-danger">*</span></label>
                            <div class="col-md-6">
                                @Html.Editor("txtCosto", new { htmlAttributes = new { @class = "form-control", @placeholder = "Digite Costo", @required = "required", @autocomplete = "off", @onkeyUp = "return miles(this.id)" } })
                            </div>
                        </div>
                    </div>

                    <div class="col-sm-12" style="display:none;" id="areaFechaOculta">
                        <div class="form-group">
                            <label class="control-label col-md-4">Fecha:&nbsp;<span class="text-danger">*</span></label>
                            <div class="col-md-6">
                                @Html.Editor("txtFecha", new { htmlAttributes = new { @class = "form-control fechas", @placeholder = "Digite Fecha", @required = "required" } })
                            </div>
                        </div>
                    </div>

                    <div class="col-md-12">
                        <label class="text-danger"></label>
                    </div>

                    <label></label>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
                    <button type="submit" class="btn btn-primary" id="btnAgregarTarea">Guardar</button>
                </div>

            </form>
        </div>
    </div>
</div>

<div class="modal fade hmodal-success in" id="modalEditarTareas" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="color-line"></div>
            <div class="modal-header">
                <h4 class="modal-title">Tareas Por Gestionar</h4>
                <small class="font-bold">Los siguientes procesos estan asociados al estado que ha seleccionado</small>
            </div>

            <form id="TareasformEditar" onsubmit="return false" method="post" name="myForm2">

                @Html.AntiForgeryToken()

                <div class="modal-body">

                    @Html.ValidationSummary(true, "", new { @class = "text-danger" })
                    <input type="hidden" name="prioridadEditar" id="prioridadEditar" value="" />
                    <input type="hidden" name="nombre_itemEditar" id="nombre_itemEditar" value="" />
                    <input type="hidden" name="nombre_categoriaEditar" id="nombre_categoriaEditar" value="" />

                    <div class="col-sm-12">
                        <div class="form-group">
                            <label class="control-label col-md-4">Tarea:&nbsp;<span class="text-danger">*</span></label>
                            <div class="col-md-6">
                                @Html.DropDownList("selectTareasEditar", Enumerable.Empty<SelectListItem>(), "", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione", @required = "required" })
                            </div>
                        </div>
                    </div>

                    <div class="col-sm-12">
                        <div class="form-group">
                            <label class="control-label col-md-4">Cantidad:&nbsp;<span class="text-danger">*</span></label>
                            <div class="col-md-6">
                                @Html.Editor("txtCantidadEditar", new { htmlAttributes = new { @class = "form-control", @placeholder = "Digite Cantidad", @required = "required", @autocomplete = "off", @onkeyUp = "return miles(this.id)" } })
                            </div>
                        </div>
                    </div>

                    <div class="col-sm-12">
                        <div class="form-group">
                            <label class="control-label col-md-4">Costo:&nbsp;<span class="text-danger">*</span></label>
                            <div class="col-md-6">
                                @Html.Editor("txtCostoEditar", new { htmlAttributes = new { @class = "form-control", @placeholder = "Digite Costo", @required = "required", @autocomplete = "off", @onkeyUp = "return miles(this.id)" } })
                            </div>
                        </div>
                    </div>

                    <div class="col-sm-12" style="display:none;" id="areaFechaOcultaEditar">
                        <div class="form-group">
                            <label class="control-label col-md-4">Fecha:&nbsp;<span class="text-danger">*</span></label>
                            <div class="col-md-6">
                                @Html.Editor("txtFechaEditar", new { htmlAttributes = new { @class = "form-control fechas", @placeholder = "Digite Fecha", @required = "required" } })
                            </div>
                        </div>
                    </div>

                    <div class="col-md-12">
                        <label class="text-danger"></label>
                    </div>

                    <label></label>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
                    <button type="submit" class="btn btn-primary" id="btnEditarTarea">Guardar</button>
                </div>

            </form>
        </div>
    </div>
</div>

@section Scripts {
    @Scripts.Render("~/bundles/select2/js")
    <script src="~/Vendor/datatables/media/js/jquery.dataTables.min.js"></script>
    <script src="~/Vendor/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>
    <script src="~/Vendor/datatables.net-buttons/js/buttons.html5.min.js"></script>
    <script src="~/Vendor/datatables.net-buttons/js/buttons.print.min.js"></script>
    <script src="~/Vendor/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
    <script src="~/Vendor/datatables.net-buttons-bs/js/buttons.bootstrap.min.js"></script>
    <script src="~/Vendor/datatablesExcelExport/dataTable1.4.0-buttons.js"></script>
    <script src="~/Vendor/datatablesExcelExport/JSZip3.1.3.min.js"></script>
    <script src="~/Vendor/pdfmake/build/pdfmake.min.js"></script>
    <script src="~/Vendor/pdfmake/build/vfs_fonts.js"></script>
    <script src="~/Vendor/datatablesExcelExport/jsZipDataTables.js"></script>
    <script src="~/Vendor/bootstrap-toggle-master/js/bootstrap-toggle.min.js"></script>
    <script src="~/Vendor/moment/moment.js"></script>

    <script src="~/Vendor/eonasdan-bootstrap-datetimepicker/build/js/bootstrap-datetimepicker.min.js"></script>

    <script src="~/Scripts/detalleot.js"></script>
    <script src="~/Scripts/inspeccionSistemasVh.js?fec=@DateTime.Now"></script>

    <script type="text/javascript">
        var numeroOperacion = 0;
        var numeroTareas = 0;
        var contadorRS = 0;
        var numeroRepuesto = 0;
        var numeroSolicitud = 0;
        var BDnumeroOperacion = 0;
        var BDnumeroRepuesto = 0;
        var BDnumeroSolicitud = 0;

        $(document).ready(function () {
            var razon2=$("#razon_ingreso option:selected").text();
            $('.js-source-states').select2();
            $('#idtipodoc').select2('readonly', true);

            $('#fecha_soat').datetimepicker({
                format: 'YYYY/MM/DD'
            }).on('dp.change', function (e) {
            
                var fechax = e.currentTarget.value;
                var fechasoat=moment(fechax,"YYYY-MM-DD");
                var fechahoy2 = new Date().toJSON().slice(0,10).replace(/-/g,'/');
                var fechahoy=moment(fechahoy2,"YYYY-MM-DD");
                var diferencia=fechahoy.diff(fechasoat,'days');
                if(diferencia>365){
                    $('#selectInfoSoat').show();
                    $('#textosoat').html('El SOAT se encuentra vencido');
                }
                else{
                    $('#selectInfoSoat').hide();
                    $('#textosoat').html('');
                }
            });

            $('#citaOrden').val(@ViewBag.citaId)
            $('#id_cita').val(@ViewBag.citaId)

            $('#aseguradora').append($('<option>', {
                value: '',
                text: 'Ninguna'
            }));
            $('#numeroSolicitudes').val(0);
            $('#btnBuscarPlaca').trigger('click');
            $('#txtEntregaEstimado').val('@ViewBag.entrega');
            $('#minimoOrden').val(addComas($('#minimo').val()));
            $('#deducibleOrden').val(addComas($('#deducible').val()));
         
            if(razon2.indexOf("Colision") >= 0){
                $('#areaRazonIngreso').show();
            }
            else{
                $('#areaRazonIngreso').hide();
                $('#aseguradora').val('');
                $('#poliza').val('');
                $('#siniestro').val('');
                $('#minimoOrden').val('');
                $('#deducibleOrden').val('');
                $('#aseguradora').val('').trigger('change');
            }

            if ($('#aseguradora').val() == '') {
                $('#areaDatosAseguradora').hide();
                $('.requeridoAseguradora').prop('required', false);
            } else {
                $('.requeridoAseguradora').prop('required', true);
                $('#areaDatosAseguradora').show();
            }

            CargarDatosPorOrdenId();
            buscarTareasAsignadas();
            buscarSolicitudesCreadas($('#id').val());
            verificargarantia();

        });

        $('#cotizacion').click(function (event) {
            //$('#btnSolicitarRepuestos').prop('disabled',false);
            //$('#btnSolicitarRepuestos').show();
            window.open('@Url.Action("CotizacionPDF", "OrdenTaller")?id_orden_trabajo=' + $('#id').val(), '_blank');
            CargarDatosPorOrdenId();
        });

        function verificargarantia(){
           
            var razon_ingreso=$('#razon_ingreso').val();
            //var razon_secundaria=$('#razon_secundaria').val();
            //if(razon_ingreso==7 || razon_secundaria==7){
            var razongarantia=@ViewBag.razongarantia;
            if(razon_ingreso==razongarantia){
                $('#areaGarantia').show();
            }
            else{
                $('#garantia_falla').val('');
                $('#garantia_causa').val('');
                $('#garantia_solucion').val('');
                $('#areaGarantia').hide();

            }
        };

        $('#tipoRepuesto').bootstrapToggle({
            on: 'Repuesto',
            off: 'Generico'
        });

        $('#tipoRepuesto').change(function () {
            if ($('#tipoRepuesto').prop('checked')) {
                $('#rOficial').show()
                $('#rGenerico').hide()
                $('#repuestosG').val('').select2();
            } else {
                $('#rOficial').hide()
                $('#rGenerico').show()
                $('#repuestos').val('').select2();
                $('#txtCantidadRepuesto').val('')
                $('#txtPrecioRepuesto').val(0)
                $('#txtPorDsctoRepuesto').val(0)
                $('#txtPorIvaRepuesto').val(0)
            }
        });

        $('#aseguradora').change(function () {
            if ($('#aseguradora').val() == '') {
                $('#areaDatosAseguradora').hide();
                $('.requeridoAseguradora').prop('required', false);
            } else {
                $('.requeridoAseguradora').prop('required', true);
                $('#areaDatosAseguradora').show();
                //$.ajax({
                //    url: '/ordenTaller/BuscarNitAseguradora',
                //    data: {
                //        aseguradora: $('#aseguradora').val()
                //    },
                //    type: 'post',
                //    dataType: 'json',
                //    cache: false,
                //    success: function (data) {
                //        $('#nitTipoTarifa').val(data);
                //    }
                //});
            }
        });

        function CargarDatosPorOrdenId(){
            $.ajax({
                url: '/ordenTaller/BuscarDatosPorIdOrden',
                data: {
                    id_orden: $('#idorden').val()
                },
                type: 'post',
                dataType: 'json',
                cache: false,
                success: function (data) {
                    console.log(data)
                    $('#tablaOperacionesPorPlaca').find('tbody').empty();
                    for (var i = 0; i < data.buscarOperaciones.length; i++) {
                        $('#tablaOperacionesPorPlaca').find('tbody').append('<tr id="rowOperaciones'+ BDnumeroOperacion +'">'
                                +'<td align="left">'
                                    +'<input style="display:none" type="text" id="codigoOperacionBD'+BDnumeroOperacion+'" name="codigoOperacionBD' + BDnumeroOperacion+'" value="' + data.buscarOperaciones[i].codigo + '"/>'
                                    + data.buscarOperaciones[i].codigo
                                +'</td>'
                                +'<td align="left">'
                                    + data.buscarOperaciones[i].operacion
                                +'</td>'
                                //+'<td align="left">'
                                //    +'<input style="display:none" type="text" id="tipoTarifaBD' + BDnumeroOperacion+'" name="tipoTarifaBD' + BDnumeroOperacion + '" value="' + data.buscarOperaciones[i].id_tarifa + '"/>'
                                //    + data.buscarOperaciones[i].tarifa
                                //+'</td>'
                                +'<td align="left">'
                                    +'<input style="display:none" type="text" id="id_tecnicoBD'+ BDnumeroOperacion + '" name="id_tecnicoBD' + BDnumeroOperacion + '" value="' + data.buscarOperaciones[i].tecnico_id + '"/>'
                                    + data.buscarOperaciones[i].tecnico
                                +'</td>'
                                +'<td align="right">'
                                    +'<input style="display:none" type="text" id="tiempoBD'+ BDnumeroOperacion + '" name="tiempoBD' + BDnumeroOperacion + '" value="' + data.buscarOperaciones[i].tiempo + '"/>'
                                    +'<input style="display:none" type="text" id="precioBD'+ BDnumeroOperacion + '" name="precioBD'+ BDnumeroOperacion + '" value="' + data.buscarOperaciones[i].precio + '"/>'
                                    +'<input style="display:none" type="text" id="ivaOperacionBD' + BDnumeroOperacion+'" name="ivaOperacionBD'+ BDnumeroOperacion + '" value="' + data.buscarOperaciones[i].ivaOperacion + '"/>'


                                    + data.buscarOperaciones[i].tiempo
                                + '</td>'
                                //+'<td align="right">'
                                //    + addComas(data.buscarOperaciones[i].precio)
                                //+ '</td>'
                            //    +'<td align="right">'
                            //    +'<input style="display:none" type="text" id="descuentoBD' + BDnumeroOperacion+'" name="descuentoBD'+ BDnumeroOperacion + '" value="' + data.buscarOperaciones[i].descuentoOperacion + '"/>'
                            //    + data.buscarOperaciones[i].descuentoOperacion
                            //+'</td>'
                            //+'<td align="right">'
                            //    +'<input style="display:none" type="text" id="descuentoVBD' + BDnumeroOperacion+'" name="descuentoVBD'+ BDnumeroOperacion + '" value="' + data.buscarOperaciones[i].descuento + '"/>'
                            //    + addComas(data.buscarOperaciones[i].descuento)
                            //+'</td>'
                                //+'<td align="right">'
                                //    + data.buscarOperaciones[i].ivaOperacion
                                //+'</td>'
                                //+'<td align="right">$ '
                                //    + addComas(data.buscarOperaciones[i].valorIva)
                                //+'</td>'
                                +'<td align="right">$ '
                                    + addComas(data.buscarOperaciones[i].valorTotal)
                                +'</td>'
                                +'<td width="15%" style="text-align:center">'
                                   // +'<button type="button" class="btn btn-danger btn-xs" onclick="eliminarOperacionBD('+ data.buscarOperaciones[i].idoperacion + ')">&nbsp;&nbsp;<i class="fa fa-times"></i>&nbsp;&nbsp;</button>'
                                +'</td>'
                            +'</tr>');
                        numeroOperacion++;
                        //$('#numeroOperaciones').val(numeroOperacion);
                    }
                    $('#totaloperaciones').val('');
                    $('#totaloperaciones').val(data.preciooperaciones);
                    $('#txtEntregaEstimado').val('');
                    $('#txtEntregaEstimado').val(data.entrega);
                    $('#tablaRepuestosPorPlaca').find('tbody').empty();
                    $('#total_repuestos').val('');
                    $('#total_repuestos').val(data.preciorepuestos);

                    $('#labelestado').html('');
                    $('#labelestado').html(data.estado);

                    for (var i = 0; i < data.repuestosAgendados.length; i++) {
                        var solicitado = '';
                        if(data.repuestosAgendados[i].solicitado == true){
                            solicitado = 'checked';
                        }
                        var texto="";
                        if(data.repuestosAgendados[i].stock_bodega>0){
                            texto = "<button type='button' class='btn btn-xs btn-success btn-circle'>&nbsp;&nbsp;&nbsp;</button>";
                        }
                        else if(data.repuestosAgendados[i].stock_otrasbodegas>0){
                            texto = "<button type='button' class='btn btn-xs btn-warning btn-circle'>&nbsp;&nbsp;&nbsp;</button>";
                        }
                        else if(data.repuestosAgendados[i].stock_reemplazo>0){
                            texto = "<button type='button' class='btn btn-xs btn-warning2 btn-circle'>&nbsp;&nbsp;&nbsp;</button>";
                        }
                        else{
                            texto = "<button type='button' class='btn btn-xs btn-danger btn-circle'>&nbsp;&nbsp;&nbsp;</button>";
                        }
                            $('#tablaRepuestosPorPlaca').find('tbody').append('<tr id="rowRepuestoBD'+ BDnumeroRepuesto +'">'
                                +'<td align="left">'
                                    +'<input style="display:none" type="text" id="codigoRepuestoBD'+BDnumeroRepuesto+'" name="codigoRepuestoBD'+ BDnumeroRepuesto+'" value="' + data.repuestosAgendados[i].ref_codigo + '"/>'
                                    +'<input style="display:none" type="text" id="idRepuestoBD'+BDnumeroRepuesto+'" name="idRepuestoBD'+ BDnumeroRepuesto+'" value="' + data.repuestosAgendados[i].id + '"/>'
                                    + data.repuestosAgendados[i].ref_codigo
                                +'</td>'
                                +'<td align="left">'
                                    +'<input style="display:none" type="text" id="nombreRepuestoBD'+BDnumeroRepuesto+'" name="nombreRepuestoBD'+ BDnumeroRepuesto+'" value="' + data.repuestosAgendados[i].ref_descripcion + '"/>'
                                    + data.repuestosAgendados[i].ref_descripcion
                                + '</td>'
                                //+'<td align="left">'
                                //    +'<input style="display:none" type="text" id="tarifaBD'+BDnumeroRepuesto+'" name="tarifaBD'+ BDnumeroRepuesto+'" value="' + data.repuestosAgendados[i].idTarifa + '"/>'
                                //    + data.repuestosAgendados[i].tarifaDes
                                //+ '</td>'
                                +'<td align="right">'
                                    +'<input style="display:none" type="text" id="cantidadRepuestoBD'+ BDnumeroRepuesto + '" name="cantidadRepuestoBD'+ BDnumeroRepuesto + '" value="' + data.repuestosAgendados[i].cantidad + '"/>'
                                    +'<input style="display:none" type="text" id="precioRepuestoBD'+ BDnumeroRepuesto + '" name="precioRepuestoBD'+ BDnumeroRepuesto + '" value="' + data.repuestosAgendados[i].precio + '"/>'
                                    +'<input style="display:none" type="text" id="porIvaRepuestoBD'+ BDnumeroRepuesto + '" name="porIvaRepuestoBD'+ BDnumeroRepuesto + '" value="' + data.repuestosAgendados[i].por_iva + '"/>'
                                    +'<input style="display:none" type="text" id="porDsctRepuestoBD'+ BDnumeroRepuesto + '" name="porDsctRepuestoBD' + BDnumeroRepuesto + '" value="' + data.repuestosAgendados[i].por_dscto + '"/>'
                                    + data.repuestosAgendados[i].cantidad
                                +'</td>'
                                +'<td align="right">'
                                    + addComas(data.repuestosAgendados[i].precio)
                                +'</td>'
                                //+'<td align="right">'
                                //    +'<input style="display:none" type="text" id="porIvaRepuestoBD'+ BDnumeroRepuesto + '" name="porIvaRepuestoBD'+ BDnumeroRepuesto + '" value="' + data.repuestosAgendados[i].por_iva + '"/>% '
                                //    + data.repuestosAgendados[i].por_iva
                                //+'</td>'
                                +'<td align="right">$'
                                    + addComas(data.repuestosAgendados[i].valorIva)
                                +'</td>'
                                //+'<td align="right">'
                                //    +'<input style="display:none" type="text" id="porDsctRepuestoBD'+ BDnumeroRepuesto + '" name="porDsctRepuestoBD' + BDnumeroRepuesto + '" value="' + data.repuestosAgendados[i].por_dscto + '"/>% '
                                //    + addComas(data.repuestosAgendados[i].por_dscto)
                                //+ '</td>'
                                //+'<td align="right">$'
                                //    + addComas(data.repuestosAgendados[i].valor_dscto)
                                //+'</td>'
                                +'<td align="right">'
                                 +'<input style="display:none" type="text" id="valorTotalBD'+ BDnumeroRepuesto + '" name="valorTotalBD' + BDnumeroRepuesto + '" value="' + data.repuestosAgendados[i].valorTotal + '"/>$ '
                                    + addComas(data.repuestosAgendados[i].valorTotal)
                                +'</td>'
                                 +'<td align="center">'
                                    +texto
                                +'</td>'
                                +'<td align="center">'
                                    + '<input type="checkbox" class="i-checks" id="solicitarRepuestoBD'+ BDnumeroRepuesto +'" name="solicitarRepuestoBD'+ BDnumeroRepuesto +'" '+solicitado+' value="'+BDnumeroRepuesto+'"/>'
                                +'</td>'
                                +'<td width="15%" style="text-align:center">'
                                    +'<button id="editRptBD'+BDnumeroRepuesto+'" type="button" class="btn btn-warning btn-xs" onclick="editarRepuesto('+ data.repuestosAgendados[i].id + ')">&nbsp;&nbsp;<i class="fa fa-edit"></i>&nbsp;&nbsp;</button>&nbsp;&nbsp;'
                                   // +'<button id="elimRptBD'+BDnumeroRepuesto+'" type="button" class="btn btn-danger btn-xs" onclick="eliminarRepuestoBD('+ data.repuestosAgendados[i].id + ')">&nbsp;&nbsp;<i class="fa fa-times"></i>&nbsp;&nbsp;</button>'
                                +'</td>'
                            +'</tr>');
                        
                        //$('#numeroRepuestos').val(numeroRepuesto);

                        if (data.repuestosAgendados[i].solicitudes == true) {
                            $('#editRptBD'+BDnumeroRepuesto+'').prop('disabled', true);
                            $('#elimRptBD'+BDnumeroRepuesto+'').prop('disabled', true);
                            $('#solicitarRepuestoBD'+BDnumeroRepuesto+'').prop('disabled', true);
                        }

                        BDnumeroRepuesto++;
                    }

                    if(data.botoninicioinspeccion==1 && data.botonfininspeccion==1){
                        $('[href="#inspeccion"]').show();


                    } else {
                        $('[href="#inspeccion"]').hide();
                    }
                    if(data.botonfininspeccion==1){
                        $('#btn_terminar_inspeccion').hide();
                    }
                    else{
                        $('#btn_terminar_inspeccion').show();
                    }
                    if(data.botonsolicitudrepuestos==1){
                        $('[href="#repuestosSolicitados"]').show();

                    } else {
                        $('[href="#repuestosSolicitados"]').hide();
                    }
                    if(data.botonsolicitudrepuestos==1){
                        $('[href="#repuestosSolicitados"]').show();

                    } else {
                        $('[href="#repuestosSolicitados"]').hide();
                    }

                    if(data.botonimpresionpdf==1){
                        $('#btnSolicitarRepuestos').prop('disabled',false);
                        $('#btnSolicitarRepuestos').show();

                    } else {
                        $('#btnSolicitarRepuestos').prop('disabled',true);
                        $('#btnSolicitarRepuestos').hide();
                    }

                    if(data.operacioniniciada=="1"){
                        $('[href="#ejecucion"]').show();

                    } else {
                        $('[href="#ejecucion"]').hide();
                    }

                    if(data.solicitar>0){
                        $('#btnSolicitarRepuestos').show();
                    }
                    else{
                        $('#btnSolicitarRepuestos').hide();
                    }
                    $('#tablaRepuestosSolicitudes').find('tbody').empty();
                    if(data.listaSolicitados.length>0){
                        $('#btnEjecutarOT').show();
                    }
                    for (var i = 0; i < data.listaSolicitados.length; i++) {
                        $('#tablaRepuestosSolicitudes').find('tbody').append('<tr id="rowRepuestoSoliBD'+ id +'">'
                                                                                +'<td align="left">'
                                                                                    + data.listaSolicitados[i].id
                                                                                + '</td>'
                                                                                +'<td align="left">'
                                                                                    + data.listaSolicitados[i].descripcion
                                                                                + '</td>'
                                                                                //+'<td align="left">'
                                                                                //    + data.repuestosSolicitados[i].tarifa
                                                                                //+ '</td>'
                                                                                +'<td align="right">'
                                                                                    + data.listaSolicitados[i].cantidad
                                                                                +'</td>'
                                                                                +'<td align="right">'
                                                                                    +data.listaSolicitados[i].precio
                                                                                +'</td>'
                                                                                +'<td align="right">'
                                                                                    + data.listaSolicitados[i].fechasolicitud
                                                                                +'</td>'
                                                                                +'<td align="right">'
                                                                                    +  data.listaSolicitados[i].recibido
                                                                                +'</td>'
                                                                                +'<td align="right">'
                                                                                     + data.listaSolicitados[i].fecharecibido
                                                                                + '</td>'
                                                                                +'<td align="right">'
                                                                                    + data.listaSolicitados[i].cantidadrecibido
                                                                                +'</td>'

                                                                            +'</tr>');
                    }

                    $('#tablaRepuestosSolicitudes2').find('tbody').empty();
                    for (var i = 0; i < data.listaSolicitados.length; i++) {
                        $('#tablaRepuestosSolicitudes2').find('tbody').append('<tr id="rowRepuestoSoliBD'+ id +'">'
                                                                                +'<td align="left">'
                                                                                    + data.listaSolicitados[i].id
                                                                                + '</td>'
                                                                                +'<td align="left">'
                                                                                    + data.listaSolicitados[i].descripcion
                                                                                + '</td>'
                                                                                //+'<td align="left">'
                                                                                //    + data.repuestosSolicitados[i].tarifa
                                                                                //+ '</td>'
                                                                                +'<td align="right">'
                                                                                    + data.listaSolicitados[i].cantidad
                                                                                +'</td>'
                                                                                +'<td align="right">'
                                                                                    +data.listaSolicitados[i].precio
                                                                                +'</td>'
                                                                                +'<td align="right">'
                                                                                    + data.listaSolicitados[i].fechasolicitud
                                                                                +'</td>'
                                                                                +'<td align="right">'
                                                                                    +  data.listaSolicitados[i].recibido
                                                                                +'</td>'
                                                                                +'<td align="right">'
                                                                                     + data.listaSolicitados[i].fecharecibido
                                                                                + '</td>'
                                                                                +'<td align="right">'
                                                                                    + data.listaSolicitados[i].cantidadrecibido
                                                                                +'</td>'

                                                                            +'</tr>');
                    }

                    $('#tablaRepuestosTrasladados').find('tbody').empty();
                    for (var i = 0; i < data.repuestosSolicitados.length; i++) {

                        precio = parseInt(data.repuestosSolicitados[i].precioU)

                        var descuento = 0;
                        if ($.trim(data.repuestosSolicitados[i].descuento) != '') {
                            descuento = Math.round((parseFloat(data.repuestosSolicitados[i].descuento) * parseInt(data.repuestosSolicitados[i].precioU) / 100) * parseFloat(data.repuestosSolicitados[i].cantidad));
                        }
                        var iva = 0;
                        if ($.trim(data.repuestosSolicitados[i].iva) != '') {
                            iva = Math.round(((parseFloat(data.repuestosSolicitados[i].cantidad) * parseInt(data.repuestosSolicitados[i].precioU) - descuento) * parseFloat(data.repuestosSolicitados[i].iva) / 100) );
                        }
                        var valorAntesIva = (data.repuestosSolicitados[i].cantidad) * parseInt(data.repuestosSolicitados[i].precioU);
                        var valorTotal = (valorAntesIva + iva) - descuento;

                        var codigo = data.repuestosSolicitados[i].codigo;
                        var precioU = data.repuestosSolicitados[i].precioU;
                        var porcentaje_iva = data.repuestosSolicitados[i].iva;
                        var porcentaje_descuento = data.repuestosSolicitados[i].descuento;
                        var cantidad = data.repuestosSolicitados[i].cantidad;

                        $('#tablaRepuestosTrasladados').find('tbody').append('<tr id="rowRepuestoBD'+ BDnumeroRepuesto +'">'
                                                                                +'<td align="left">'
                                                                                    + data.repuestosSolicitados[i].traslado
                                                                                + '</td>'
                                                                                +'<td align="left">'
                                                                                    + data.repuestosSolicitados[i].repuesto
                                                                                + '</td>'
                                                                                //+'<td align="left">'
                                                                                //    + data.repuestosSolicitados[i].tarifa
                                                                                //+ '</td>'
                                                                                +'<td align="right">'
                                                                                    + data.repuestosSolicitados[i].cantidad
                                                                                +'</td>'
                                                                                +'<td align="right">'
                                                                                    + addComas(data.repuestosSolicitados[i].precioU)
                                                                                +'</td>'
                                                                                +'<td align="right">'
                                                                                    + data.repuestosSolicitados[i].iva
                                                                                +'</td>'
                                                                                +'<td align="right">$'
                                                                                    + addComas(iva)
                                                                                +'</td>'
                                                                                +'<td align="right">'
                                                                                    + addComas(data.repuestosSolicitados[i].descuento)
                                                                                + '</td>'
                                                                                +'<td align="right">$'
                                                                                    + addComas(descuento)
                                                                                +'</td>'
                                                                                +'<td align="right">$ '
                                                                                    + addComas(valorTotal)
                                                                                +'</td>'
                                                                            +'</tr>');
                    }

                    //
                    //$('#tiempoDuracionhid').val(data.tiempotranscurrido);
                    $('#trackingEventos').find('tbody').empty();
                    var indice=0;
                    for (var i = 0; i < data.datostracking.length; i++) {
                        indice=i+1;
                        $('#trackingEventos').find('tbody').append('<tr>'
                                                                                    +'<td align="left">'
                                                                                       + indice
                                                                                    + '</td>'
                                                                                    +'<td align="left">'
                                                                                        + data.datostracking[i].descripcion
                                                                                    + '</td>'
                                                                                    //+'<td align="left">'
                                                                                    //    + data.repuestosSolicitados[i].tarifa
                                                                                    //+ '</td>'
                                                                                    +'<td align="right">'
                                                                                        + data.datostracking[i].estado
                                                                                    +'</td>'
                                                                                    +'<td align="right">'
                                                                                        + data.datostracking[i].responsable
                                                                                    +'</td>'
                                                                                    +'<td align="right">'
                                                                                        + data.datostracking[i].fecha
                                                                                    +'</td>'
                                                                                +'</tr>');
                    }
                    $('#comenzar').hide();
                    $('#pausar').hide();
                    $('#despausar').hide();
                    $('#finalizar').hide();
                    //debugger;
                    if(data.buscarOperaciones.length>0){
                        $('#cotizacion').show();
                        $('#cotizacion').prop('disabled',false);

                    }
                    else{
                        $('#cotizacion').hide();
                        $('#cotizacion').prop('disabled',true);
                    }
                    if(data.botoniniciar==1){
                        //$('#comenzar').show();
                        $('#paneloperacionesnormal').show();
                    }
                    if(data.botoniniciar==1){
                        //$('#comenzar').show();
                        $('#paneloperacionesnormal').show();
                    }
                    if(data.botonpausar==1){
                       // $('#pausar').show();
                        $('#paneloperacionesnormal').show();
                    }
                    if(data.botondespausar==1){
                       // $('#despausar').show();
                        $('#paneloperacionesnormal').show();
                    }
                    if(data.botonfinalizar==1){
                       // $('#finalizar').show();
                        $('#paneloperacionesnormal').show();
                    }
                },
                complete: function (data) {
                    $('.i-checks').iCheck({
                        checkboxClass: 'icheckbox_square-green',
                        radioClass: 'iradio_square-green'
                    }).on('ifChanged', function(e) {
                    
                        // Get the field name
                        var isChecked = e.currentTarget.checked;
                        var nombre=e.currentTarget.id;
                        if(nombre.indexOf("solicitarRepuestoBD")!=-1){
                            if (isChecked == true) {
                                sumarprecio(e.currentTarget.value);
                            }
                            else{
                                restarprecio(e.currentTarget.value);
                            }
                        }


                    });
                    console.log(data);
                    if(data.responseJSON.avanza==1){
                        movertiempo(data.responseJSON.tiempotranscurrido);
                    }
                    else{
                        clearInterval(movertiempo);
                        $('#tiempoDuracion').html("<h3 class='text-primary'><strong>"+data.responseJSON.tiempotranscurrido+"</strong></h3>");

                    }
                }
            })
        }
        function movertiempo(tiempo){
            var tiempohora=tiempo.split(":");
            var hora=tiempohora[0];
            var minuto=tiempohora[1];
            var segundo=tiempohora[2];



           /* if(hora<10){
                    hora="0"+hora;
                }
                if(minuto<10){
                    minuto="0"+minuto;
                }
                if(segundo<10){
                    segundo="0"+segundo;
                }*/
            counter = window.setInterval(function(){
                hora2=(hora.toLocaleString(undefined,{minimumIntegerDigits: 2}));
                minuto2=(minuto.toLocaleString(undefined,{minimumIntegerDigits: 2}));
                segundo2=(segundo.toLocaleString(undefined,{minimumIntegerDigits: 2}));
                $('#tiempoDuracion').html("<h3 class='text-danger'><strong>"+ hora2 + ":"+ minuto2 +":"+segundo2 +"</strong></h3>");

                segundo++;
                if(segundo==60){
                    minuto++;
                    segundo=0;
                }else if(minuto==60 ){
                    hora++;
                    minuto = 0;
                }
            },1000);
        }

        $('#btnEjecutarOT').click(function(){
            $('#btnEjecutarOT').hide();
            var orden= $('#id').val();
            $.ajax({
                url: '/ordenTaller/ComenzarEjecucion',
                data: {
                    id_orden: $('#id').val(),
                    ope:1,
                },
                type: 'post',
                dataType: 'json',
                cache: false,
                success: function (data) {
                    console.log(data)
                    if(data!=0){
                        swal("Iniciado!", "La Orden de Taller ha iniciado ejecución de operaciones.", "success");
                        CargarDatosPorOrdenId();
                    }
                }
            });
        });
        $('#comenzar').click(function(){
            $('#comenzar').hide();
            var orden= $('#id').val();
            $.ajax({
                url: '/ordenTaller/ComenzarEjecucion',
                data: {
                    id_orden: $('#id').val(),
                    ope:1,
                },
                type: 'post',
                dataType: 'json',
                cache: false,
                success: function (data) {
                    console.log(data)
                    if(data!=0){
                        swal("Iniciado!", "La Orden de Taller ha iniciado ejecución de operaciones.", "success");
                        CargarDatosPorOrdenId();
                    }
                }
            });
        });

        $('#pausar').click(function(){
            $('#pausar').hide();
            var orden= $('#id').val();
            $.ajax({
                url: '/ordenTaller/ComenzarEjecucion',
                data: {
                    id_orden: $('#id').val(),
                    ope:2,
                },
                type: 'post',
                dataType: 'json',
                cache: false,
                success: function (data) {
                    console.log(data)
                    if(data!=0){
                        swal("Iniciado!", "La Orden de Taller ha sido pausada.", "success");
                        clearInterval(counter);
                        CargarDatosPorOrdenId();
                    }
                }
            });
        });

        $('#despausar').click(function(){
            $('#despausar').hide();
            var orden= $('#id').val();
            $.ajax({
                url: '/ordenTaller/ComenzarEjecucion',
                data: {
                    id_orden: $('#id').val(),
                    ope:3,
                },
                type: 'post',
                dataType: 'json',
                cache: false,
                success: function (data) {
                    console.log(data)
                    if(data!=0){
                        swal("Iniciado!", "Se ha reanudado la ejecución de La Orden de Taller.", "success");
                        CargarDatosPorOrdenId();
                    }
                }
            });
        });

        $('#finalizar').click(function(){
            $('#finalizar').hide();
            var orden= $('#id').val();
            $.ajax({
                url: '/ordenTaller/ComenzarEjecucion',
                data: {
                    id_orden: $('#id').val(),
                    ope:4,
                },
                type: 'post',
                dataType: 'json',
                cache: false,
                success: function (data) {
                    console.log(data)
                    if(data!=0){
                        swal("Iniciado!", "Se ha reanudado la ejecución de La Orden de Taller.", "success");
                        CargarDatosPorOrdenId();
                    }
                }
            });
        });


        //$('#tipoTarifa').change(function(){
        //    if ($('#tipoTarifa').val() == parseInt(1) || $('#tipoTarifa').val() == parseInt(3) || $('#tipoTarifa').val() == parseInt(4)) {
        //        $('#nitTipoTarifa').val($('#docTerceroBuscado').val());
        //        if ($('#operacionesTempario').val() != "") {
        //            $.ajax({
        //                url: '/ordenTaller/BuscarDescuentoOperacion',
        //                data: {
        //                    tarifa: $('#tipoTarifa').val(),
        //                    operacion: $('#operacionesTempario').val(),
        //                    tercero: $('#nitTipoTarifa').val()
        //                },
        //                type: 'post',
        //                dataType: 'json',
        //                cache: false,
        //                success: function (data) {
        //                    console.log('que hubo chino')
        //                    console.log(data)
        //                    $('#txtDescuentoOperacion').val(data);
        //                }
        //            })
        //        }
        //    }
        //    if ($('#tipoTarifa').val() == parseInt(2)) {
        //        $.ajax({
        //            url: '/ordenTaller/BuscarNitTarifa',
        //            data: {
        //                tarifa: $('#tipoTarifa').val(),
        //            },
        //            type: 'post',
        //            dataType: 'json',
        //            cache: false,
        //            success: function (data) {
        //                console.log(data)
        //                $('#nitTipoTarifa').val(data);
        //                if ($('#operacionesTempario').val() != "") {
        //                    $.ajax({
        //                        url: '/ordenTaller/BuscarDescuentoOperacion',
        //                        data: {
        //                            tarifa: $('#tipoTarifa').val(),
        //                            operacion: $('#operacionesTempario').val(),
        //                            tercero: $('#nitTipoTarifa').val()
        //                        },
        //                        type: 'post',
        //                        dataType: 'json',
        //                        cache: false,
        //                        success: function (data) {
        //                            console.log('que hubo chino')
        //                            console.log(data)
        //                            $('#txtDescuentoOperacion').val(data);
        //                        }
        //                    })
        //                }
        //            }
        //        })
        //    }
        //    if($('#tipoTarifa').val() == parseInt(5)){
        //        $.ajax({
        //            url: '/ordenTaller/BuscarNitAseguradora',
        //            data: {
        //                aseguradora: $('#aseguradora').val()
        //            },
        //            type: 'post',
        //            dataType: 'json',
        //            cache: false,
        //            success: function (data) {
        //                $('#nitTipoTarifa').val(data);
        //                if ($('#operacionesTempario').val() != "") {
        //                    $.ajax({
        //                        url: '/ordenTaller/BuscarDescuentoOperacion',
        //                        data: {
        //                            tarifa: $('#tipoTarifa').val(),
        //                            operacion: $('#operacionesTempario').val(),
        //                            tercero: $('#nitTipoTarifa').val()
        //                        },
        //                        type: 'post',
        //                        dataType: 'json',
        //                        cache: false,
        //                        success: function (data) {
        //                            console.log('que hubo chino')
        //                            console.log(data)
        //                            $('#txtDescuentoOperacion').val(data);
        //                        }
        //                    })
        //                }
        //            }
        //        });
        //    }
        //});

        //$('#operacionesTempario').change(function(){
        //    $.ajax({
        //        url: '/ordenTaller/BuscarDescuentoOperacion',
        //        data: {
        //            tarifa: $('#tipoTarifa').val(),
        //            operacion: $('#operacionesTempario').val(),
        //            tercero: $('#nitTipoTarifa').val()
        //        },
        //        type: 'post',
        //        dataType: 'json',
        //        cache: false,
        //        success: function (data) {
        //            $('#txtDescuentoOperacion').val(data);
        //        }
        //    })
        //});

        $('#repuestos').change(function(){
            $.ajax({
                url: '/ordenTaller/BuscarReferencia',
                data: {
                    codigo_referencia: $('#repuestos').val(),
                    documento_cliente: $('#documentoBuscadoCliente').val()
                },
                type: 'post',
                dataType: 'json',
                cache: false,
                success: function (data) {
                    if(data.error == false){
                        $('#nombre_repuesto').val(data.referenciaEncontrada.ref_descripcion);
                        $('#txtPrecioRepuesto').val(addComas(data.referenciaEncontrada.precio));
                        $('#txtPorIvaRepuesto').val(data.referenciaEncontrada.por_iva);
                        //$('#txtValorIvaRepuesto').val(addComas(data.referenciaEncontrada.valorIva));
                        $('#txtPorDsctoRepuesto').val(data.referenciaEncontrada.por_dscto);
                        //$('#txtValorDsctoRepuesto').val(addComas(data.referenciaEncontrada.valor_dscto));
                    }else{
                        $('#mensajeAlertaAgregarRepuesto').text(data.errorMessage);
                        $('#alertaAgregarRepuesto').show();
                        setTimeout(function () {
                            $("#alertaAgregarRepuesto").fadeOut(2500);
                        }, 10000);
                    }
                }
            })
        });

        
        $('#repuestosG').change(function(){
            $.ajax({
                url: '/ordenTaller/BuscarReferencia',
                data: {
                    codigo_referencia: $('#repuestosG').val(),
                    documento_cliente: $('#documentoBuscadoCliente').val()
                },
                type: 'post',
                dataType: 'json',
                cache: false,
                success: function (data) {
                    if(data.error == false){
                        $('#nombre_repuesto').val(data.referenciaEncontrada.ref_descripcion);
                        $('#txtPrecioRepuesto').val(addComas(data.referenciaEncontrada.precio));
                        $('#txtPorIvaRepuesto').val(data.referenciaEncontrada.por_iva);
                        //$('#txtValorIvaRepuesto').val(addComas(data.referenciaEncontrada.valorIva));
                        $('#txtPorDsctoRepuesto').val(data.referenciaEncontrada.por_dscto);
                        //$('#txtValorDsctoRepuesto').val(addComas(data.referenciaEncontrada.valor_dscto));
                    }else{
                        $('#mensajeAlertaAgregarRepuesto').text(data.errorMessage);
                        $('#alertaAgregarRepuesto').show();
                        setTimeout(function () {
                            $("#alertaAgregarRepuesto").fadeOut(2500);
                        }, 10000);
                    }
                }
            })
        });



        $('#txtCantidadRepuesto').keyup(function(){
            var valorDescuento =  Math.round(parseInt(quitCommas($('#txtPrecioRepuesto').val())) * parseInt(quitCommas($('#txtCantidadRepuesto').val())) * ($('#txtPorDsctoRepuesto').val() / 100))
            var valorIVA = Math.round((parseInt(quitCommas($('#txtPrecioRepuesto').val())) * parseInt(quitCommas($('#txtCantidadRepuesto').val())) - valorDescuento) * ($('#txtPorIvaRepuesto').val() / 100))

            $('#txtValorDsctoRepuesto').val(addComas(valorDescuento));
            $('#txtValorIvaRepuesto').val(addComas(valorIVA));
        })

        $('#txtCantidadReferencia').keyup(function(){
          
            var cantidad=$('#txtCantidadReferencia').val()==""?0:parseInt(quitCommas($('#txtCantidadReferencia').val()));
            var valorDescuentoR =  Math.round((parseInt(quitCommas($('#txtPrecioReferencia').val())) * cantidad * ($('#txtPorDsctoReferencia').val() / 100)));
            var valorIVAR = Math.round((parseInt(quitCommas($('#txtPrecioReferencia').val())) * cantidad - valorDescuentoR) * ($('#txtPorIvaReferencia').val() / 100))
            var valorTotalR=Math.round(parseInt(quitCommas($('#txtPrecioReferencia').val())) * cantidad-valorDescuentoR+valorIVAR);
            $('#txtValorDsctoReferencia').val(addComas(valorDescuentoR));
            $('#txtValorIvaReferencia').val(addComas(valorIVAR));
            $('#txtPrecioTotalReferencia').val(addComas(valorTotalR));

        })

        $('#btnAgregarRepuesto').click(function(){
            if($('#repuestos').val() != '' && $('#txtCantidadRepuesto').val() != ''){
                if ($('#txtCantidadRepuesto').val() > 0) {
                    var calcularTotal = ($('#txtCantidadRepuesto').val() * parseInt(quitCommas($('#txtPrecioRepuesto').val())) - parseInt(quitCommas($('#txtValorDsctoRepuesto').val())) + parseInt(quitCommas($('#txtValorIvaRepuesto').val())));

                    $.ajax({
                        url: '/ordenTaller/AgregarRepuesto',
                        data: {
                            orden: $('#id').val(),
                            codigorepuesto: $('#repuestos').val(),
                            cantidad: $('#txtCantidadRepuesto').val(),
                            preciounitario: $('#txtPrecioRepuesto').val(),
                            porcentajeiva: $('#txtPorIvaRepuesto').val(),
                            porcentajedescuento: $('#txtPorDsctoRepuesto').val()
                        },
                        type: 'post',
                        dataType: 'json',
                        cache: false,
                        success: function (data) {
                            if(data!=0){
                                $('#tablaRepuestosPorPlaca').find('tbody').append('<tr id="rowRepuesto'+ numeroRepuesto +'">'
                            +'<td align="left">'
                                +'<input style="display:none" type="text" id="codigoRepuesto'+numeroRepuesto+'" name="codigoRepuesto'+ numeroRepuesto+'" value="' + $('#repuestos').val() + '"/>'
                                + $('#repuestos').val()
                            + '</td>'
                            +'<td align="left">'
                                +'<input style="display:none" type="text" id="nombreRepuesto'+numeroRepuesto+'" name="nombreRepuesto'+ numeroRepuesto+'" value="' + $('#nombre_repuesto').val() + '"/>'
                                + $('#nombre_repuesto').val()
                            + '</td>'
                            //+'<td align="left">'
                            //    +'<input style="display:none" type="text" id="tipoTarifaRpt'+numeroRepuesto+'" name="tipoTarifaRpt'+ numeroRepuesto+'" value="' + $('#tipoTarifaR').val() + '"/>'
                            //    + $('#tipoTarifaR option:selected').text()
                            //+ '</td>'
                            +'<td align="right">'
                                +'<input style="display:none" type="text" id="cantidadRepuesto'+ numeroRepuesto + '" name="cantidadRepuesto' + numeroRepuesto + '" value="' + $('#txtCantidadRepuesto').val() + '"/>'
                                + addComas($('#txtCantidadRepuesto').val())
                            + '</td>'
                            +'<td align="right">'
                                +'<input style="display:none" type="text" id="precioRepuesto'+ numeroRepuesto + '" name="precioRepuesto'+ numeroRepuesto + '" value="' + $('#txtPrecioRepuesto').val() + '"/>'
                                + addComas($('#txtPrecioRepuesto').val())
                            + '</td>'
                            +'<td align="right">'
                                +'<input style="display:none" type="text" id="porIvaRepuesto'+ numeroRepuesto + '" name="porIvaRepuesto' + numeroRepuesto + '" value="' + $('#txtPorIvaRepuesto').val() + '"/> '
                                + $('#txtPorIvaRepuesto').val()
                            + '</td>'
                            +'<td align="right">'
                                + $('#txtPorIvaRepuesto').val()
                            + '</td>'
                            +'<td align="right">'
                                +'<input style="display:none" type="text" id="porDsctRepuesto'+ numeroRepuesto + '" name="porDsctRepuesto'+ numeroRepuesto + '" value="' + $('#txtPorDsctoRepuesto').val() + '"/>'
                                +  $('#txtPorDsctoRepuesto').val()
                            + '</td>'
                            +'<td align="right"> '
                                +  $('#txtValorDsctoRepuesto').val()
                            + '</td>'
                            +'<td align="right"> '
                                + addComas(calcularTotal)
                            + '</td>'
                            +'<td align="center">'
                                + '<input type="checkbox" id="solicitarRepuesto'+ numeroRepuesto +'" name="solicitarRepuesto'+ numeroRepuesto +'" checked/>'
                            + '</td>'
                            +'<td width="15%" style="text-align:center">'
                                +'<button type="button" class="btn btn-warning btn-xs" onclick="editarRepuesto('+ data.idrep + ')">&nbsp;&nbsp;<i class="fa fa-edit"></i>&nbsp;&nbsp;</button>&nbsp;&nbsp;'
                                +'<button type="button" class="btn btn-danger btn-xs" onclick="eliminarRepuesto('+ data.idrep  + ')">&nbsp;&nbsp;<i class="fa fa-times"></i>&nbsp;&nbsp;</button>'
                            +'</td>'
                        +'</tr>');
                                numeroRepuesto++;
                                $('#numeroRepuestos').val(numeroRepuesto);
                                $('#repuestos').val('').select2();
                                $('#txtCantidadRepuesto').val('');
                                $('#txtPrecioRepuesto').val('');
                                $('#txtPorIvaRepuesto').val('');
                                $('#txtValorIvaRepuesto').val('');
                                $('#txtPorDsctoRepuesto').val('');
                                $('#txtValorDsctoRepuesto').val('');
                                CargarDatosPorOrdenId();

                            }
                        }
                    });

                }else {
                    $('#mensajeAlertaAgregarRepuesto').text('No puedes agregar referencias cuya cantidad es 0');
                    $('#alertaAgregarRepuesto').show();
                    setTimeout(function () {
                        $("#alertaAgregarRepuesto").fadeOut(2500);
                    }, 10000);
                }
            }
            else if($('#repuestosG').val() != '' && $('#txtCantidadRepuesto').val() != ''){
                if ($('#txtCantidadRepuesto').val() != 0){
                    $('#tablaRepuestosPorPlaca').find('tbody').append('<tr id="rowRepuesto'+ numeroRepuesto +'">'
                            +'<td align="left">'
                                +'<input style="display:none" type="text" id="codigoRepuesto'+numeroRepuesto+'" name="codigoRepuesto'+ numeroRepuesto+'" value="' + $('#repuestosG').val() + '"/>'
                                + $('#repuestosG').val()
                            + '</td>'
                            +'<td align="left">'
                                +'<input style="display:none" type="text" id="nombreRepuesto'+numeroRepuesto+'" name="nombreRepuesto'+ numeroRepuesto+'" value="' + $('#nombre_repuesto').val() + '"/>'
                                + $('#nombre_repuesto').val()
                            + '</td>'
                            //+'<td align="left">'
                            //    +'<input style="display:none" type="text" id="tipoTarifaRpt'+numeroRepuesto+'" name="tipoTarifaRpt'+ numeroRepuesto+'" value="' + $('#tipoTarifaR').val() + '"/>'
                            //    + $('#tipoTarifaR option:selected').text()
                            //+ '</td>'
                            +'<td align="right">'
                                +'<input style="display:none" type="text" id="cantidadRepuesto'+ numeroRepuesto + '" name="cantidadRepuesto' + numeroRepuesto + '" value="' + $('#txtCantidadRepuesto').val() + '"/>'
                                + addComas($('#txtCantidadRepuesto').val())
                            + '</td>'
                            +'<td align="right">'
                                +'<input style="display:none" type="text" id="precioRepuesto'+ numeroRepuesto + '" name="precioRepuesto'+ numeroRepuesto + '" value="' + $('#txtPrecioRepuesto').val() + '"/>'
                                + addComas($('#txtPrecioRepuesto').val())
                            + '</td>'
                            +'<td align="right">'
                                +'<input style="display:none" type="text" id="porIvaRepuesto'+ numeroRepuesto + '" name="porIvaRepuesto' + numeroRepuesto + '" value="' + $('#txtPorIvaRepuesto').val() + '"/> '
                                + $('#txtPorIvaRepuesto').val()
                            + '</td>'
                            +'<td align="right">'
                                + $('#txtPorIvaRepuesto').val()
                            + '</td>'
                            +'<td align="right">'
                                +'<input style="display:none" type="text" id="porDsctRepuesto'+ numeroRepuesto + '" name="porDsctRepuesto'+ numeroRepuesto + '" value="' + $('#txtPorDsctoRepuesto').val() + '"/>'
                                +  $('#txtPorDsctoRepuesto').val()
                            + '</td>'
                            +'<td align="right"> '
                                +  $('#txtValorDsctoRepuesto').val()
                            + '</td>'
                            +'<td align="right"> '
                                + 0
                            + '</td>'
                            +'<td align="center">'
                                + '<input type="checkbox" id="solicitarRepuesto'+ numeroRepuesto +'" name="solicitarRepuesto'+ numeroRepuesto +'" checked/>'
                            + '</td>'
                            +'<td width="15%" style="text-align:center">'
                                +'<button type="button" class="btn btn-warning btn-xs" onclick="editarRepuesto('+ numeroRepuesto + ')">&nbsp;&nbsp;<i class="fa fa-edit"></i>&nbsp;&nbsp;</button>&nbsp;&nbsp;'
                                +'<button type="button" class="btn btn-danger btn-xs" onclick="eliminarRepuesto('+ numeroRepuesto + ')">&nbsp;&nbsp;<i class="fa fa-times"></i>&nbsp;&nbsp;</button>'
                            +'</td>'
                        +'</tr>');
                    numeroRepuesto++;
                    $('#numeroRepuestos').val(numeroRepuesto);
                    $('#repuestos').val('').select2();
                    $('#txtCantidadRepuesto').val('');
                    $('#txtPrecioRepuesto').val('');
                    $('#txtPorIvaRepuesto').val('');
                    $('#txtValorIvaRepuesto').val('');
                    $('#txtPorDsctoRepuesto').val('');
                    $('#txtValorDsctoRepuesto').val('');
                }
                else {
                    $('#mensajeAlertaAgregarRepuesto').text('No puedes agregar referencias cuya cantidad es 0');
                    $('#alertaAgregarRepuesto').show();
                    setTimeout(function () {
                        $("#alertaAgregarRepuesto").fadeOut(2500);
                    }, 10000);
                }
            }
            else{
                $('#mensajeAlertaAgregarRepuesto').text('Debe digitar una referencia y una cantidad');
                $('#alertaAgregarRepuesto').show();
                setTimeout(function () {
                    $("#alertaAgregarRepuesto").fadeOut(2500);
                }, 10000);
            }
        });

        function quitCommas(nStr) {
            nStr.toString();
            var s = nStr.replace(/\./g, "");
            return s;
        }

        function eliminarOperacionBD(id) {
            swal({
                title: "Esta seguro que desea eliminar?",
                text: "El registro se eliminara de la base de datos",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                confirmButtonText: "Si, Eliminar!",
                cancelButtonText: "No, cancelar!",
                closeOnConfirm: false,
                closeOnCancel: false
            },
                function (isConfirm) {
                    if (isConfirm) {
                        $.ajax({
                            url: '/ordenTaller/EliminarOperacion',
                            data: {
                                id: id
                            },
                            type: "post",
                            cache: false,
                            success: function () {
                                swal("Eliminado!", "El registro se ha eliminado correctamente.", "success");
                                CargarDatosPorOrdenId();
                                cargarTablas()
                                //location.reload(true);
                            }
                        });

                    } else {
                        swal("Cancelado", "Se ha cancelado la operación", "error");
                    }
                });
        }
        //buscardatospororden
        function eliminarRepuestoBD(id) {
            swal({
                title: "Esta seguro que desea eliminar?",
                text: "El registro se eliminara de la base de datos",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                confirmButtonText: "Si, Eliminar!",
                cancelButtonText: "No, cancelar!",
                closeOnConfirm: false,
                closeOnCancel: false
            },
                function (isConfirm) {
                    if (isConfirm) {
                        $.ajax({
                            url: '/ordenTaller/EliminarRepuesto',
                            data: {
                                id: id
                            },
                            type: "post",
                            cache: false,
                            success: function () {
                                swal("Eliminado!", "El registro se ha eliminado correctamente.", "success");
                                CargarDatosPorOrdenId();
                                //location.reload(true);
                            }
                        });

                    } else {
                        swal("Cancelado", "Se ha cancelado la operación", "error");
                    }
                });
        }

        function eliminarRepuesto(pos){
            $("#rowRepuesto" + pos + "").remove();
        }
        //$('#razon_secundaria').change(function(){
        //    verificargarantia();
        //});

        $('#razon_ingreso').change(function(){
            verificargarantia();
            var razon=$("#razon_ingreso option:selected").text();
            if(razon.indexOf("Colision") >= 0){
                $('#areaRazonIngreso').show();
            }
            else{
                $('#areaRazonIngreso').hide();
                $('#aseguradora').val('');
                $('#poliza').val('');
                $('#siniestro').val('');
                $('#minimoOrden').val('');
                $('#deducibleOrden').val('');
                $('#aseguradora').val('').trigger('change');
            }

            //$.ajax({
            //    url: '/ordenTaller/buscarRazonesSecundarias',
            //    data: {
            //        razonprimaria: $('#razoningreso').val(),
            //    },
            //    type: 'post',
            //    dataType: 'json',
            //    cache: false,
            //    success: function (data) {
            //        $('#razon_secundaria').empty();
            //        if (data != 0) {
            //            if (data.length > 0) {
            //                var ope = "";
            //                ope += ' <option value="">Seleccione</option>'

            //                for (var j = 0; j < data.length; j++) {
            //                    ope += ' <option value="' + data[j].id + '">' + data[j].nombre + '</option>'
            //                }
            //                $('#razon_secundaria').append(ope);
            //            }
            //            $('#razon_secundaria').val("").trigger('change');
            //        }
            //    }
            //})
        });
        //function editarRepuesto(pos){
        //    var porcentajeIva = $('#porIvaRepuesto'+pos+'').val();
        //    var porcentajeDescuento = $('#porDsctRepuesto'+pos+'').val();
        //    var precio = $('#precioRepuesto'+pos+'').val();
        //    var valorIva = parseFloat($('#precioRepuesto'+pos+'').val())*$('#porIvaRepuesto'+pos+'').val()/100;
        //    var valorDescuento = parseFloat($('#precioRepuesto'+pos+'').val())*$('#porDsctRepuesto'+pos+'').val()/100;
        //    var valorTotal = (parseFloat(precio)+ valorIva - valorDescuento) * parseFloat($('#cantidadRepuesto'+pos+'').val())
        //    $('#txtIdFilaEditadaRepuesto').val(pos);
        //    $('#txtCodigoReferencia').val($('#codigoRepuesto'+pos+'').val());
        //    $('#txtNombreReferencia').val($('#nombreRepuesto'+pos+'').val());
        //    $('#txtCantidadReferencia').val(addComas($('#cantidadRepuesto'+pos+'').val()));
        //    $('#txtPrecioReferencia').val(addComas($('#precioRepuesto'+pos+'').val()));
        //    $('#txtPorIvaReferencia').val($('#porIvaRepuesto'+pos+'').val());
        //    $('#txtValorIvaReferencia').val(addComas(valorIva));
        //    $('#txtPorDsctoReferencia').val($('#porDsctRepuesto'+pos+'').val());
        //    $('#txtValorDsctoReferencia').val(addComas(valorDescuento));
        //    $('#txtPrecioTotalReferencia').val(addComas(valorTotal));
        //    $('#modalEditarReferencia').modal('show');
        //}

        function editarRepuesto(pos){
            $.ajax({
                url: '/ordenTaller/EditarRepuesto',
                data: {
                    repuesto:pos,
                },
                type: 'post',
                dataType: 'json',
                cache: false,
                success: function (data) {
                    if(data!=0){
                        var porcentajeIva = data.porcentajeIva;
                        var porcentajeDescuento = data.porcentajeDescuento;
                        var precio = data.precio;
                        var valorIva = data.valorIva;
                        var valorDescuento = data.valorDescuento;
                        var valorTotal = data.ValorTotal
                        $('#txtIdFilaEditadaRepuesto').val(data.id);
                        $('#txtCodigoReferencia').val(data.codigo);
                        $('#txtNombreReferencia').val(data.nombreReferencia);
                        $('#txtCantidadReferencia').val(data.cantidad);
                        $('#txtPrecioReferencia').val(addComas(data.precio));
                        $('#txtPorIvaReferencia').val(data.porcentajeIva);
                        $('#txtValorIvaReferencia').val(addComas(data.valorIva));
                        $('#txtPorDsctoReferencia').val(data.porcentajeDescuento);
                        $('#txtValorDsctoReferencia').val(addComas(data.valorDescuento));
                        $('#txtPrecioTotalReferencia').val(addComas(data.valorTotal));
                        $('#modalEditarReferencia').modal('show');
                    }

                }

            });
            var porcentajeIva = $('#porIvaRepuesto'+pos+'').val();
            var porcentajeDescuento = $('#porDsctRepuesto'+pos+'').val();
            var precio = $('#precioRepuesto'+pos+'').val();
            var valorIva = parseFloat($('#precioRepuesto'+pos+'').val())*$('#porIvaRepuesto'+pos+'').val()/100;
            var valorDescuento = parseFloat($('#precioRepuesto'+pos+'').val())*$('#porDsctRepuesto'+pos+'').val()/100;
            var valorTotal = (parseFloat(precio)+ valorIva - valorDescuento) * parseFloat($('#cantidadRepuesto'+pos+'').val())
            $('#txtIdFilaEditadaRepuesto').val(pos);
            $('#txtCodigoReferencia').val($('#codigoRepuesto'+pos+'').val());
            $('#txtNombreReferencia').val($('#nombreRepuesto'+pos+'').val());
            $('#txtCantidadReferencia').val(addComas($('#cantidadRepuesto'+pos+'').val()));
            $('#txtPrecioReferencia').val(addComas($('#precioRepuesto'+pos+'').val()));
            $('#txtPorIvaReferencia').val($('#porIvaRepuesto'+pos+'').val());
            $('#txtValorIvaReferencia').val(addComas(valorIva));
            $('#txtPorDsctoReferencia').val($('#porDsctRepuesto'+pos+'').val());
            $('#txtValorDsctoReferencia').val(addComas(valorDescuento));
            $('#txtPrecioTotalReferencia').val(addComas(valorTotal));
            $('#modalEditarReferencia').modal('show');
        }

        $('#btnModificarReferencia').click(function(){
            if($('#txtCantidadReferencia').val() == '' || $('#txtIdFilaEditadaRepuesto').val() == ''){
              /*  $('#mensajeAlertaAgregarOperacion').text('Debe digitar tarifa, operacion, tecnico y cliente para poder agregar');
                $('#alertaAgregarOperacion').show();
                setTimeout(function () {
                    $("#alertaAgregarOperacion").fadeOut(2500);
                }, 10000);*/
            }
            else{
                $.ajax({
                    url: '/ordenTaller/GuardarEdicionRepuesto',
                    data: {
                        idrepuesto: $('#txtIdFilaEditadaRepuesto').val(),
                        cantidad: $('#txtCantidadReferencia').val(),
                    },
                    type: 'post',
                    dataType: 'json',
                    cache: false,
                    success: function (data) {
                        if(data!=0){
                            swal("Modificado!", "El registro se ha modificado correctamente.", "success");
                            $('#modalEditarReferencia').modal('hide');
                            CargarDatosPorOrdenId();
                        }
                        else{

                        }
                    }
                });
            }
        });

        $('#btnAgregarOperacion').click(function(){
            if($('#tipoTarifa').val() == '' || $('#operacionesTempario').val() == '' || $('#tecnico').val() == '' || $('#id_cliente').val() == ''){
                $('#mensajeAlertaAgregarOperacion').text('Debe digitar tarifa, operacion, tecnico y cliente para poder agregar');
                $('#alertaAgregarOperacion').show();
                setTimeout(function () {
                    $("#alertaAgregarOperacion").fadeOut(2500);
                }, 10000);
            }else{
                $.ajax({
                    url: '/ordenTaller/BuscarTiempoTemparioOT',
                    data: {
                        idorden: $('#id').val(),
                        codigoOperacion: $('#operacionesTempario').val(),
                        id_cliente: $('#id_cliente').val(),
                        tipo_tarifa: $('#tipoTarifa').val(),
                        tecnico: $('#tecnico').val(),
                        //descuento: $('#txtDescuentoOperacion').val()
                    },
                    type: 'post',
                    dataType: 'json',
                    cache: false,
                    success: function (data) {

                        if(data.existeTarifa == false){
                            $('#mensajeAlertaAgregarOperacion').text(data.mensajeExisteTarifa);
                            $('#alertaAgregarOperacion').show();
                            setTimeout(function () {
                                $("#alertaAgregarOperacion").fadeOut(2500);
                            }, 10000);
                        }else{
                            $('#tablaOperacionesPorPlaca').find('tbody').append('<tr id="rowOperaciones'+ data.idope +'">'
                                +'<td align="left">'
                                    +'<input style="display:none" type="text" id="codigoOperacion'+data.idope+'" name="codigoOperacion'+ data.idope + '" value="' + $('#operacionesTempario').val() + '"/>'
                                    + $('#operacionesTempario').val()
                                +'</td>'
                                +'<td align="left">'
                                    + $("#operacionesTempario option:selected").text()
                                +'</td>'
                                //+'<td align="left">'
                                //    +'<input style="display:none" type="text" id="tipoTarifa' + numeroOperacion+'" name="tipoTarifa'+ numeroOperacion + '" value="' + $('#tipoTarifa').val() + '"/>'
                                //    + $("#tipoTarifa option:selected").text()
                                //+'</td>'
                                +'<td align="left">'
                                    +'<input style="display:none" type="text" id="id_tecnico' + data.idope+'" name="id_tecnico'+ data.idope + '" value="' + data.idTecnico + '"/>'
                                    + $("#tecnico option:selected").text()
                                +'</td>'
                                +'<td align="right">'
                                    +'<input style="display:none" type="text" id="tiempo'+ data.idope + '" name="tiempo'+ data.idope + '" value="' + data.tiempo + '"/>'
                                    + data.tiempo
                                +'</td>'
                                +'<td align="right">'
                                    +'<input style="display:none" type="text" id="precio'+ data.idope + '" name="precio' + data.idope + '" value="' + data.precio + '"/>$ '
                                    + addComas(data.precio)
                                +'</td>'
                                //+'<td align="right">'
                                //    +'<input style="display:none" type="text" id="descuento' + data.idope+'" name="descuento'+ data.idope + '" value="' + $('#txtDescuentoOperacion').val() + '"/>'
                                //    + $('#txtDescuentoOperacion').val()
                                //+'</td>'
                                +'<td align="right">'
                                    +'<input style="display:none" type="text" id="descuentoV' + data.idope+'" name="descuentoV'+ data.idope + '" value="' + data.valorDescuento + '"/>'
                                    + addComas(data.valorDescuento)
                                +'</td>'
                                +'<td align="right">'
                                    +'<input style="display:none" type="text" id="ivaOperacion' + data.idope+'" name="ivaOperacion'+ data.idope + '" value="' + data.ivaOperacion + '"/>'
                                    + data.ivaOperacion
                                +'</td>'
                                +'<td align="right">'
                                    +'<input style="display:none" type="text" id="ValorIva' + data.idope+'" name="ValorIva'+ data.idope + '" value="' + data.valorIva + '"/>$ '
                                    + addComas(data.valorIva)
                                + '</td>'
                                +'<td align="right">'
                                    +'<input style="display:none" type="text" id="ValorTotal' + data.idope+'" name="ValorTotal'+ data.idope + '" value="' + data.valorTotal + '"/>$ '
                                    + addComas(data.valorTotal)
                                + '</td>'
                                +'<td width="15%" style="text-align:center">'
                                    +'<button type="button" class="btn btn-danger btn-xs" onclick="eliminarOperacion(' + data.idope + ')">&nbsp;&nbsp;<i class="fa fa-times"></i>&nbsp;&nbsp;</button>'
                                +'</td>'
                            +'</tr>');
                            numeroOperacion++;
                            $('#numeroOperaciones').val(numeroOperacion);
                            $('#tipoTarifa').val('').select2();
                            $('#operacionesTempario').val('').select2();
                            $('#tecnico').val('').select2();
                            $('#txtDescuentoOperacion').val('');
                            CargarDatosPorOrdenId()
                        }
                    }
                })
            }
        });

        function eliminarOperacion(pos){
            $("#rowOperaciones" + pos + "").remove();
        }

        var enviarEsto;
        $('#btnSolicitarRepuestos').click(function(){
            $( ".i-checks" ).each(function(index) {
                if  ($(this).prop('checked') && !$(this).prop('disabled')) {
                    k = index;
                    debugger;
                    id_orden: $('#id').val()
                    if ($('#idRepuestoBD'+k+'').val() !="") {
                        enviarEsto = $('#idRepuestoBD'+k+'').val()
                    }else {
                        enviarEsto = null;
                    }
                    $("#tablaSolicitudRepuestos").find("tbody").append('<tr id="filaReferencias' + contadorRS + '">'
                            +'<td>'//referencia
                                +'<input style="display:none;" name="referencia' + contadorRS + '" id="referencia' + contadorRS + '" class="form-control" type="text" value="' + $('#codigoRepuestoBD'+k+'').val() + '">'
                                +'<input style="display:none;" name="idDetalleReferencia' + contadorRS + '" id="idDetalleReferencia' + contadorRS + '" class="form-control" type="text" value="' + enviarEsto + '">'
                                + $('#codigoRepuesto'+k+'').val()
                            +'</td>'
                            +'<td style="text-align:right">'//cantidad
                                +'<input style="display:none;" name="cantidadRepuesto0' + contadorRS + '" id="cantidadReferencia' + contadorRS + '" class="form-control" type="hidden" value="' + $('#cantidadRepuesto'+k+'').val() + '">'
                                + $('#cantidadRepuestoBD'+k+'').val()
                            +'</td>'
                            +'<td style="text-align:right">'//Valor unitario
                                +'<input  style="text-align:right; display:none" name="valorUnitarioReferencia' + contadorRS + '" id="valorUnitarioReferencia' + contadorRS + '" class="form-control" type="hidden" value="' + $('#precioRepuestoBD'+k+'').val() + '">'
                                + $('#precioRepuesto'+k+'').val()
                            +'</td>'
                        +'</tr>');
                    contadorRS++;
                    $('#listaReferenciasSolicitud').val(k);


                    $.ajax({
                        url: '/ordenTaller/SolicitarRepuestos',
                        data: {
                            idOrden: $('#id').val(),
                            repuesto: $('#codigoRepuestoBD'+k+'').val(),
                            cantidad: $('#cantidadRepuestoBD'+k+'').val(),
                            precio: $('#precioRepuestoBD'+k+'').val(),
                            detalle: enviarEsto
                        },
                        type: 'post',
                        dataType: 'json',
                        cache: false,
                        success: function (data) {
                            console.log(data)
                            if (data.error == false) {
                                $('#alertaSolicitudGuardadaRepuesto').removeClass("alert alert-danger").addClass("alert alert-success");
                                $('#alertaSolicitudGuardadaRepuesto').show();
                                $('#msjSolicitud').text('Se creo la solicitud del repuesto de manera exitosa');
                                CargarDatosPorOrdenId();

                            }else {
                                if (data.mensaje == "") {
                                    $('#alertaSolicitudGuardadaRepuesto').removeClass("alert alert-success").addClass("alert alert-danger");
                                    $('#alertaSolicitudGuardadaRepuesto').show();
                                    $('#msjSolicitud').text('Ya se realizo la solicitud del repuesto seleccionado');
                                }else {
                                    $('#alertaSolicitudGuardadaRepuesto').removeClass("alert alert-success").addClass("alert alert-danger");
                                    $('#alertaSolicitudGuardadaRepuesto').show();
                                    $('#msjSolicitud').text(data.mensaje);
                                }

                            }
                        },
                    })

                }
            });
        });

        var numero_miles = "";
        function formatNumber (n) {
            n = String(n).replace(/\D/g, "");
            return n === '' ? n : String(n).replace(/\B(?=(\d{3})+(?!\d))/g, ".");
        }

        function miles (id) {
            numero_miles = formatNumber($('#'+id+'').val());
            $('#'+id+'').val(numero_miles);
        }

        $('#txtTiempoEstimado').keyup(function(){
            var tiempo = 0;
            if($.trim($('#txtTiempoEstimado').val()) != ''){
                tiempo = parseFloat($('#txtTiempoEstimado').val());
            }
            if($('input[name="rbHorasDias"]:checked').val() == 'dias'){
                tiempo = tiempo * 24;
            }
            var fechaHoy = new Date();
            fechaHoy.setHours(fechaHoy.getHours() + tiempo);
            var d = fechaHoy.getDate();

            var m =  fechaHoy.getMonth();
            m += 1;  // JavaScript months are 0-11
            var y = fechaHoy.getFullYear();
            var hour = fechaHoy.getHours()
            var minutes = fechaHoy.getMinutes();
            $('#txtEntregaEstimado').val(d + "/" + m + "/" + y + " " + hour + ":" + minutes);
        });

        var cantidadContactosActual = 0;
        @*function buscarContactosCliente() {
            $.ajax({
                url: '/ordenTaller/BuscarContactosCliente',
                data: {
                    id_tercero: @ViewBag.tercero,
                },
                type: 'post',
                dataType: 'json',
                cache: false,
                success: function (data) {
                    if (data.buscarContactos.length != cantidadContactosActual) {
                        cantidadContactosActual = data.buscarContactos.length;
                        $('#recibidode').empty();
                        $('#recibidode').append($('<option>', {
                            value: '',
                            text: ''
                        }));
                        for (var i = 0; i < data.buscarContactos.length; i++) {
                            $('#recibidode').append($('<option>', {
                                value: data.buscarContactos[i].con_tercero_id,
                                text: data.buscarContactos[i].con_tercero_nombre
                            }));
                        }
                        $('#recibidode').append($('<option>', {
                            value: 'Otro',
                            text: 'Otro'
                        }));
                        $('#recibidode').val('').attr('display','visible:visible').select2();
                    }
                },
                complete: function () {
                    setTimeout(function () {
                        buscarContactosCliente(@ViewBag.tercero);
                    }, 12000);
                }
            })
        }*@

        $('#btnEditarSolicitud').click(function(){
            if($.trim($('#txtSolicitudClienteEditar').val()) != '' && $.trim($('#txtRespuestaClienteEditar').val()) != ''){
                var posicion = $('#txtIdFilaEditada').val();
                var newRow = '<tr id="row'+ posicion +'"><td align="center"><input style="display:none" type="text" id="solicitud'+posicion+'" name="solicitud'
                                                + posicion+'" value="' + $.trim($('#txtSolicitudClienteEditar').val()) + '"/><input style="display:none" type="text" id="idsolicitud'+posicion+'" name="idsolicitud'
                                                + posicion+'" value="' + $.trim($('#txtIdSolicitudEditada').val()) + '"/>' + $.trim($('#txtSolicitudClienteEditar').val())
                                                + '</td><td align="center"><input style="display:none" type="text" id="respuesta'+posicion+'" name="respuesta'
                                                + posicion+'" value="' + $.trim($('#txtRespuestaClienteEditar').val()) + '"/>' + $.trim($('#txtRespuestaClienteEditar').val())
                                                + '</td><td width="15%" style="text-align:center"><button type="button" class="btn btn-warning btn-xs" onclick="editarSolicitud('
                                                + posicion + ')">&nbsp;&nbsp;<i class="fa fa-pencil-square-o"></i>&nbsp;&nbsp;</button></td></tr>';
                $("#row" + posicion + "").replaceWith(newRow);
                $('#modalEditarSolicitudCliente').modal('hide');
            }
        });

        function eliminarSolicitud(pos){
            $("#row" + pos + "").remove();
        }

        function editarSolicitud(pos){
            var valorAnterior = $('#solicitud'+pos+'').val();
            var respuestaAnterior = $('#respuesta'+pos+'').val();
            var idSolicitudAnterior = $('#idsolicitud'+pos+'').val();
            $('#txtRespuestaClienteEditar').val(respuestaAnterior);
            $('#txtIdSolicitudEditada').val(idSolicitudAnterior);
            $('#txtSolicitudClienteEditar').val(valorAnterior);
            $('#txtIdFilaEditada').val(pos);
            $('#modalEditarSolicitudCliente').modal('show');
        }

        $('#btnAgregarSolicitud').click(function(){
            if($.trim($('#txtSolicitudCliente').val()) != ''){
                $('#tablaSolicitudes').find('tbody').append('<tr id="row'+ numeroSolicitud +'">'
                            +'<td align="center">'
                                +'<input style="display:none" type="text" id="solicitud'+numeroSolicitud+'" name="solicitud' + numeroSolicitud+'" value="' + $.trim($('#txtSolicitudCliente').val()) + '"/>'
                                + $.trim($('#txtSolicitudCliente').val())
                            +'</td>'
                            +'<td align="center">'
                                +'<input style="display:none" type="text" id="respuesta'+numeroSolicitud+'" name="respuesta'+ numeroSolicitud+'" value=""/>'
                                + ''
                            +'</td>'
                        +'</tr>');
                numeroSolicitud++;
                $('#numeroSolicitudes').val(numeroSolicitud);
                $('#txtSolicitudCliente').val('');
            }
        });

        @*$('#recibidode').change(function () {
            if ($('#recibidode').val() == 'Otro') {
                window.open('@Url.Action("update", "icb_terceros")?id=' + $('#tercero').val()+'&&menu='+@ViewBag.id_menu, '_blank');
            }
        });*@

        function buscarCliente() {
            $.ajax({
                url: '/ordenTaller/BuscarClientePorDocumento',
                data: {
                    id_tercero: $('#id_cliente').val(),
                    documento: $('#txtDocumentoCliente').val()
                },
                type: 'post',
                dataType: 'json',
                cache: false,
                success: function (data) {
                    if (data.success == true) {
                        $('#documentoNoEncontrado').hide();
                        $('#documentoBuscado').text(data.buscarCliente.doc_tercero);
                        $('#documentoBuscadoCliente').val(data.buscarCliente.doc_tercero);
                        $('#docTerceroBuscado').val(data.buscarCliente.tercero_id);
                        $('#nombreBuscado').text(data.buscarCliente.nombres);
                        $('#telefonoBuscado').text(data.buscarCliente.telf_tercero);
                        $('#celularBuscado').text(data.buscarCliente.celular_tercero);
                        $('#emailBuscado').text(data.buscarCliente.email_tercero);
                        $('#ciudadBuscado').text('');
                        $('.areaClienteOculta').show();

                        $('#tercero').val(data.buscarCliente.tercero_id);
                        $('#id_cliente').val(data.buscarCliente.cltercero_id);
                        //buscarContactosCliente(data.buscarCliente.tercero_id);
                    } else {
                        $('#documentoNoEncontrado').show();
                        $('.areaClienteOculta').hide();
                        $('#documentoBuscado').text('');
                        $('#nombreBuscado').text('');
                        $('#telefonoBuscado').text('');
                        $('#celularBuscado').text('');
                        $('#emailBuscado').text('');
                        $('#ciudadBuscado').text('');
                        $('#tercero').val('');
                    }
                }
            })
        }

        $('#placa').keyup(function () {
            $('#placaNoEncontrada').hide();
            $('.areaVehiculoOculta').hide();
            $('#areaPanelCliente').hide();
        });

        $('#btnBuscarCliente').click(function () {
            buscarCliente(null);
        });

        $('#btnBuscarPlaca').click(function () {
            $.ajax({
                url: '/ordenTaller/BuscarVehiculoPorPlaca',
                data: {
                    placa: $('#placa').val()
                },
                type: 'post',
                dataType: 'json',
                cache: false,
                success: function (data) {
                    if (data.success == true) {
                        $('#placaNoEncontrada').hide();
                        $('#serieBuscado').text(data.buscarVehiculo.vin);
                        $('#numMotorBuscado').text(data.buscarVehiculo.nummot_vh);
                        $('#kilometrajeBuscado').text(data.buscarVehiculo.kilometraje);
                        $('#colorBuscado').text(data.buscarVehiculo.colvh_nombre);
                        $('#fechaVentaBuscado').text(data.buscarVehiculo.fecha_venta);
                        $('#fechaFinGarantiaBuscado').text(data.buscarVehiculo.fecha_fin_garantia);
                        $('.areaVehiculoOculta').show();
                        $('#areaPanelCliente').show();

                        // Validacion para propietario del vehiculo si existe
                        if (data.buscarVehiculo.propietario == null || data.buscarVehiculo.propietario == '') {
                            $('#documentoNoEncontrado').show();
                            $('#areaTxtBuscarDocumento').show();
                            $('.areaClienteOculta').hide();
                        } else {
                            $('#documentoNoEncontrado').hide();
                            $('#areaTxtBuscarDocumento').hide();
                            buscarCliente(data.buscarVehiculo.propietario);
                        }

                    } else {
                        $('#placaNoEncontrada').show();
                        $('.areaVehiculoOculta').hide();
                        $('#areaPanelCliente').hide();
                        $('#serieBuscado').text('');
                        $('#numMotorBuscado').text('');
                        $('#kilometrajeBuscado').text('');
                        $('#colorBuscado').text('');
                        $('#fechaVentaBuscado').text('');
                        $('#fechaFinGarantiaBuscado').text('');
                    }
                },
            })
        });

        $('#cerrarModalOrdenCreada').click(function () {
            $('#modalOrdenCreada').hide();
        });

        function buscarSolicitudesCreadas(idOrden){
            $.ajax({
                url: '/ordenTaller/BuscarSolicitudesPorOrden',
                data: {
                    id_orden: $('#id').val()
                },
                type: "post",
                cache: false,
                success: function (data) {
                    $('#tablaSolicitudes').find('tbody').empty();
                    for (var i = 0; i < data.length; i++) {
                        $('#tablaSolicitudes').find('tbody').append('<tr id="row'+ numeroSolicitud +'">'
                                    +'<td align="center">'
                                        +'<input style="display:none" type="text" id="solicitud'+numeroSolicitud+'" name="solicitud' + numeroSolicitud+'" value="' + data[i].solicitud + '"/>'
                                        +'<input style="display:none" type="text" id="idsolicitud'+numeroSolicitud+'" name="idsolicitud' + numeroSolicitud+'" value="' + data[i].idsolicitud + '"/>'
                                        + data[i].solicitud
                                    +'</td>'
                                    +'<td align="center">'
                                        +'<input style="display:none" type="text" id="respuesta'+numeroSolicitud+'" name="respuesta' + numeroSolicitud+'" value="' + data[i].respuesta + '"/>'
                                        + data[i].respuesta
                                    +'</td>'
                                    +'<td width="15%" style="text-align:center">'
                                        +'<button type="button" class="btn btn-warning btn-xs" onclick="editarSolicitud('+ numeroSolicitud + ')">&nbsp;&nbsp;<i class="fa fa-pencil-square-o"></i>&nbsp;&nbsp;</button>'
                                    +'</td>'
                                +'</tr>');
                        numeroSolicitud++;
                        $('#numeroSolicitudes').val(numeroSolicitud);
                    }
                }
            })
        }

        function  buscarTareasAsignadas(){
            $.ajax({
                url: '/ordenTaller/buscarTareasAsignadas',
                data: {
                    idCita: $('#citaOrden').val()
                },
                type: "post",
                cache: false,
                success: function (data) {
                    console.log(data)
                    if(data!=0){
                        if (data.length == 0) {
                            $('#tareasInspeccion').hide()
                            $('#tablaTareas').find('tbody').empty();
                        }else{
                            $('#tareasInspeccion').show()
                            $('#tablaTareas').find('tbody').empty();
                            for (var i = 0; i < data.length; i++) {

                                $('#tablaTareas').find('tbody').append('<tr id="row'+ numeroTareas +'">'
                                        +'<td align="left">'
                                            +'<input style="display:none" type="text" id="descripcionTarea'+numeroTareas+'" name="descripcionTarea'+ numeroTareas+'" value="' + data[i].descripcion + '"/>'
                                            + data[i].descripcion
                                        +'</td>'
                                        +'<td align="right">'
                                            +'<input style="display:none" type="text" id="cantidadTarea'+numeroTareas+'" name="cantidadTarea'+ numeroTareas+'" value="' + data[i].cantidad + '"/>'
                                            + data[i].cantidad
                                        +'</td>'
                                        +'<td align="right">'
                                            +'<input style="display:none" type="text" id="valorTarea'+numeroTareas+'" name="valorTarea'+ numeroTareas+'" value="' + data[i].valor_unitario + '"/>'
                                            + addComas(data[i].valor_unitario)
                                        +'</td>'
                                        +'<td align="right">'
                                            +'<input style="display:none" type="text" id="fechaTarea'+numeroTareas+'" name="fechaTarea'+ numeroTareas+'" value="' + data[i].fecautorizacion + '"/>'
                                            + data[i].fecautorizacion
                                        +'</td>'
                                        +'<td align="center">'
                                            +'<input type="checkbox" onclick="autorizarTarea('+ data[i].id +')" id="autorizoTarea'+numeroTareas+'" name="autorizoTarea'+ numeroTareas+'" value=""/>'
                                        +'</td>'
                                    +'</tr>');
                                numeroTareas++;
                                $('#numeroTareas').val(numeroTareas);

                                if (data[i].autorizado == true) {
                                    $('#autorizoTarea'+i).prop('checked', true)
                                }
                            }
                        }
                    }
                }
            })
        }

        function autorizarTarea(id) {
            $.ajax({
                url: '/ordenTaller/autorizarTarea',
                data: {
                    idTarea: id
                },
                type: "post",
                cache: false,
                success: function (data) {
                    buscarTareasAsignadas()
                }
            })
        }

        function valida(id){
            window.location.href = '@Url.Action("Update", "ordenTaller")?menu='+@ViewBag.id_menu+'&&id=' + id;
        }

        function buscarAjaxOrdenesTaller(){
            $.ajax({
                url: '/ordenTaller/BuscarOrdenesDeTaller',
                data: {},
                type: "post",
                cache: false,
                success: function (data) {
                    $('#tablaPaginada').find('tbody').empty();
                    for (var i = 0; i < data.length; i++) {
                        $('#tablaPaginada').find('tbody').append('<tr><td align="right">' + data[i].codigoentrada + '</td><td align="left">' + data[i].doc_tercero + '</td><td align="left">'
                                        + data[i].nombreTercero + '</td><td align="left">'
                                        + data[i].plac_vh + '</td><td align="left">'
                                        + data[i].modvh_nombre + '</td><td align="left">'
                                        + data[i].fecha + '</td><td width="5%" align="center"><button class="btn btn-info btn-xs" onclick="valida('
                                        + data[i].id
                                        + ')">&nbsp;&nbsp;Ver&nbsp;&nbsp;</button></td></tr>');
                    }
                },
                complete: function (data) {
                    $('#tablaPaginada').dataTable({
                        //"ajax": 'api/datatables.json',
                        //dom: "<''<'col-sm-4'l><'col-sm-4 text-center'B><'col-sm-4'f>>t<'col-sm-4'i>p",
                        dom: "<''<'col-md-6'l><'col-md-6'f>>t<'col-md-4'i><'col-md-8 text-right'pB>",
                        "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
                        buttons: [
                            { extend: 'excel', className: 'btn-sm', text: 'Exportar a Excel' },
                            //{ extend: 'pdf', title: 'ExampleFile', className: 'btn-sm', text: 'PDF' },
                            //{ extend: 'print', className: 'btn-sm', text: 'Imprimir' }
                        ]
                    });
                }
            })
        }

        function sumarprecio(numero){
           
            var valor1=$('#valorTotalBD'+numero).val();
            var sumavalor=parseFloat(quitCommas(valor1));
            var valortotal=parseFloat(quitCommas($('#total_repuestos').val()));
                valortotal=valortotal+sumavalor;

            $('#total_repuestos').val(addComas(valortotal));
        }

        function restarprecio(numero){
          
            var sumavalor=parseFloat(quitCommas($('#valorTotalBD'+numero).val()));
            var valortotal=parseFloat(quitCommas($('#total_repuestos').val()));

                valortotal=valortotal-sumavalor;

            $('#total_repuestos').val(addComas(valortotal));
        }


    </script>


    @if (TempData["mensaje"] != null)
    {
        <script type="text/javascript">
            $('#modalOrdenCreada').show();
        </script>
    }

}
