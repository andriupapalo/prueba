@model Homer_MVC.Models.TOTformulario

@{
    ViewBag.Icono = "fa fa-file";
    ViewBag.Title = "Editar TOT";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section Styles {
    <link href="~/Vendor/datatables.net-bs/css/dataTables.bootstrap.min.css" rel="stylesheet" />
    <link href="~/Vendor/bootstrap-toggle-master/css/bootstrap-toggle.min.css" rel="stylesheet" />
    @Styles.Render("~/bundles/select2/css")
}

<div class="panel-body">
    <div class="panel-heading" style="background-color:white;  border:solid 1px; border-color:#e4e5e7">
        <div class="panel-body">

            <div id="hbreadcrumb" class="pull-right">

                <button type="button" class="btn btn-mini btn-default" style="border-radius:25px" data-container="body" data-toggle="popover" data-placement="left" data-title="Enlaces" data-content="<ul>@ViewBag.nombreEnlaces</ul>" data-html="true">
                    <i class="text-info fa fa-tags"></i>
                </button>
                <button type="button" class="btn btn-mini btn-default" style="border-radius:25px" data-container="body" data-toggle="popover" data-placement="left" data-title="Documentos" data-content="<ul></i><a href=''>Documento 1</a></ul>  <ul></i><a href=''>Documento 2</a></ul> <ul></i><a href=''>Documento 3</a></ul>" data-html="true">
                    <i class="text-primary fa fa-files-o"></i>
                </button>
                <button type="button" class="btn btn-mini btn-default" style="border-radius:25px" data-container="body" data-toggle="popover" data-placement="left" data-title="Favoritos" data-content="@ViewBag.Favoritos" data-html="true">
                    <i class="text-warning fa fa-star"></i>
                </button>

            </div>

            <h3 class="font-light m-b-xs">
                <i class="text-info @ViewBag.Icono"></i>&nbsp;&nbsp;@ViewBag.Title&nbsp;&nbsp;<span id="labelestado"></span>

            </h3>
            <small>@ViewBag.Title</small>
        </div>
    </div>
</div>

<div class="panel-body" style="padding-top:0px;">
    <div class="hpanel">

        <div id="mensajeerrorval"></div>
        @if (TempData["mensaje_error"] != null)
            {
            <div class="alert alert-danger  alert-dismissible" id="mensaje_error">
                <button type="button" class="close" data-dismiss="alert" arial-label="close"><span aria-hidden="true">&times;</span></button>
                <p>@TempData["mensaje_error"]</p>
            </div>
            }
        @if (TempData["mensaje"] != null)
            {
            <div class="alert alert-success  alert-dismissible" id="mensaje">
                <button type="button" class="close" data-dismiss="alert" arial-label="close"><span aria-hidden="true">&times;</span></button>
                <p>@TempData["mensaje"]</p>
            </div>
            }
        <div id="tabs" class="tab-content">
            <div class="m float-e-margins text-right" id="mensajetot">
                <div class="tooltip-demo">

                    <div id="div-mensaje"></div>

                </div>
            </div>



            <ul id="tabs-crear" class="nav nav-tabs">
                <li class="active"><a data-toggle="tab" href="#crear" id="refcrear"><i class="@ViewBag.Icono"></i>&nbsp;&nbsp;@ViewBag.Title</a></li>
                <li class="" />
                <a data-toggle="tab" href="#buscar" onclick="Buscartot()"><i class="fa fa-search"></i>&nbsp;&nbsp;Búsquedas</a></li>
            </ul>



            <div id="crear" class="tab-pane active">

                <div class="panel-body">

                    @using (Html.BeginForm())
                        {

                        <div class="panel-body-btns text-right">
                            <button type="button" class="btn btn-primary" onclick="guardarvalores()" id="btnguardartot" >&nbsp;&nbsp;Guardar</button>
                        </div>

                        <div class="form-horizontal">

                            <div class="hpanel">
                                <div class="panel-heading hbuilt" style="background-color:#e4e5e7">
                                    <div class="panel-tools">
                                        <a class="showhide"><i class="fa fa-chevron-up"></i></a>

                                    </div>
                                    <i class="fa fa-car"></i>&nbsp;&nbsp;&nbsp;Liquidacion TOT
                                </div>
                                <div class="panel-body">
                                    <div class="row">
                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="control-label col-md-4">Tipo Documento:&nbsp;&nbsp;<span class="text-danger">*</span></label>
                                                <div class="col-md-6">
                                                    @Html.DropDownListFor(model => model.tipo, null, "", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione", required = "required" })
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="control-label col-md-4">Bodega:&nbsp;&nbsp;<span class="text-danger">*</span></label>
                                                <div class="col-md-6">
                                                    @Html.DropDownListFor(model => model.Bodega, null, "", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione", required = "required" })
                                                </div>
                                            </div>
                                        </div>

                                    </div>

                                    <div class="row">

                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="control-label col-md-4">Perfil Contable:&nbsp;<span class="text-danger">*</span></label>
                                                <div class="col-md-6">
                                                    @Html.DropDownListFor(model => model.perfil, null, "", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione", required = "required" })

                                                </div>
                                            </div>
                                        </div>


                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="control-label col-md-4">Proveedor:&nbsp;<span class="text-danger">*</span></label>
                                                <div class="col-md-6">
                                                    @Html.DropDownListFor(model => model.proveedor, null, "", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione", required = "required" })

                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="control-label col-md-4">Condición pago:&nbsp;&nbsp;<span class="text-danger">*</span></label>
                                                <div class="col-md-6">
                                                    @Html.DropDownListFor(model => model.fpago, null, "", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione", required = "required" })

                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="control-label col-md-4">Numero  factura:&nbsp;<span class="text-danger">*</span></label>
                                                <div class="col-md-6">
                                                    @Html.EditorFor(model => model.numerofactura, new { htmlAttributes = new { @class = "form-control", @required = "required", @placeholder = "Digite el numero de la factura" } })

                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="control-label col-md-4">Fecha:&nbsp;&nbsp;<span class="text-danger">*</span></label>
                                                <div class="col-md-6">
                                                    @Html.EditorFor(model => model.fecha, new { htmlAttributes = new { @class = "form-control", @required = "required" } })
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="control-label col-md-4">Solicitado por:&nbsp;<span class="text-danger">*</span></label>
                                                <div class="col-md-6">
                                                    <input id="nombreusuario" class="form-control " value="@ViewBag.nombreusuario" />
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="control-label col-md-4">Numero de OT:&nbsp;&nbsp;<span class="text-danger">*</span></label>
                                                <div class="col-md-6">
                                                    @Html.DropDownListFor(model => model.numot, null, "", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione", required = "required" })


                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="control-label col-md-4">Tarifa:&nbsp;&nbsp;<span class="text-danger">*</span></label>
                                                <div class="col-md-6">
                                                    @Html.DropDownListFor(model => model.tipotarifa, null, "", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione", required = "required" })


                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                    <input type="hidden" id="numerototid" name="numerototid" />

                                    @Html.HiddenFor(model => model.id)



                                </div>
                            </div>




                        </div>


                        <div class="hpanel" id="operacionesdiv" >
                            <div class="panel-heading hbuilt" style="background-color:#e4e5e7">
                                <div class="panel-tools">
                                    <a class="showhide"><i class="fa fa-chevron-up"></i></a>
                                </div>
                                <i class="fa fa-cogs"></i>&nbsp;&nbsp;&nbsp;Operaciones
                            </div>
                            <div class="panel-body">


                                <div class="row">

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Operación:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                <input id="operaciontxt" class="form-control" type="text" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Valor Unitario:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                <input id="valorunitxt" class="form-control" type="text" />
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Descuento:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                <input id="descuentooptxt" class="form-control" type="text" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Iva:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                <input id="Ivaoptxt" class="form-control" type="text" />
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-sm-12">
                                        <div class="form-group">
                                            <div class="panel-body-btns text-right">
                                                <button type="button" class="btn btn-success" id="btnAgregarOperacion" onclick="AgregarOperacionTOT()"><i class="fa fa-plus"></i>&nbsp;&nbsp;Agregar</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row" style="overflow: auto;">


                                    <div class="col-md-12">
                                        <div class="table-responsive">
                                            <div id="div-mensaje-buscar"></div>
                                            <table class="table table-striped table-bordered table-hover" id="tablaOperaciones">
                                                <thead>
                                                    <tr>
                                                        <th style="text-align:center">Operación</th>
                                                        <th style="text-align:center">Valor</th>
                                                        <th style="text-align:center">Valor Descuento</th>
                                                        <th style="text-align:center">Valor Iva</th>
                                                        <th style="text-align:center">Valor Total</th>
                                                        <th style="text-align:center">Acciones</th>
                                                    </tr>
                                                </thead>
                                                <tbody></tbody>
                                            </table>

                                        </div>
                                    </div>

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Total Valor Operaciones:</label>
                                            <div class="col-md-6">
                                                @Html.Editor("totaloperaciones", new { htmlAttributes = new { @class = "form-control", @placeholder = "Total Operaciones", @readonly = "true" } })
                                            </div>
                                        </div>
                                    </div>



                                </div>
                            </div>
                        </div>

                        <div class="hpanel" id="repuestosdiv">
                            <div class="panel-heading hbuilt" style="background-color:#e4e5e7">
                                <div class="panel-tools">
                                    <a class="showhide"><i class="fa fa-chevron-up"></i></a>
                                </div>
                                <i class="fa fa-cogs"></i>&nbsp;&nbsp;&nbsp;Repuestos
                            </div>
                            <div class="panel-body">
                                <div class="row">
                                    <div class="col-sm-12">
                                        <div class="form-group">
                                            <div class="panel-body-btns text-right">
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Repuesto:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                <input id="Repuestotxt" class="form-control" type="text" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Valor Unitario:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                <input id="valorunireptxt" class="form-control" type="text" />
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Cantidad:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                <input id="Cantidadreptxt" class="form-control" type="text" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Descuento:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                <input id="descuentoreptxt" class="form-control" type="text" />
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Iva:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                <input id="Ivareptxt" class="form-control" type="text" />
                                            </div>
                                        </div>
                                    </div>

                                </div>
                                <div class="row">
                                    <div class="col-sm-12">
                                        <div class="form-group">
                                            <div class="panel-body-btns text-right">
                                                <button type="button" class="btn btn-success" onclick="AgergarReppuestosTOT()"><i class="fa fa-plus"></i>&nbsp;&nbsp;Agregar</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="table-responsive">
                                            <div id="div-mensaje-buscar"></div>
                                            <table class="table table-striped table-bordered table-hover" id="tablaRepuestos">
                                                <thead>
                                                    <tr>
                                                        <th style="text-align:center">Repuesto</th>
                                                        <th style="text-align:center">Cantidad</th>
                                                        <th style="text-align:center">Valor Unitariop</th>
                                                        <th style="text-align:center">Descuento</th>
                                                        <th style="text-align:center">Iva</th>
                                                        <th style="text-align:center">Total</th>
                                                        <th style="text-align:center">Accion</th>

                                                    </tr>
                                                </thead>
                                                <tbody></tbody>
                                            </table>

                                        </div>
                                    </div>

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Total Valor Repuestos:</label>
                                            <div class="col-md-6">
                                                @Html.Editor("total_repuestos", new { htmlAttributes = new { @class = "form-control", @placeholder = "Total Repuestos", @readonly = "true" } })
                                            </div>
                                        </div>
                                    </div>

                                </div>
                                <div class="row">
                                    <div class="col-md-12">

                                        <div class="alert alert-success" role="alert" style="display:none;" id="alertaSolicitudGuardadaRepuesto">
                                            <p id="msjSolicitud"></p>
                                        </div>
                                    </div>
                                </div>
                                <br />
                            </div>
                        </div>

                        <div class="hpanel" id="totalesdiv">
                            <div class="panel-heading hbuilt" style="background-color:#e4e5e7">
                                <div class="panel-tools">
                                    <a class="showhide"><i class="fa fa-chevron-up"></i></a>

                                </div>
                                <i class="fa fa-calendar-check-o"></i>&nbsp;&nbsp;&nbsp;Totales
                            </div>
                            <div class="panel-body">
                                <div class="row">
                                    <div class="col-sm-6 text-right">

                                        <table class="table table-striped table-bordered table-responsive table-hover">
                                            <tr>
                                                <th>Subtotal</th>
                                                <td>@Html.Editor("subtotal", new { htmlAttributes = new { @class = "form-control", @placeholder = "Subtotal", @readonly = "true" } })</td>
                                            </tr>
                                            <tr>
                                                <th>Total Descuentos</th>
                                                <td>@Html.Editor("totaldescuentos", new { htmlAttributes = new { @class = "form-control", @placeholder = "Total Descuentos", @readonly = "true" } })</td>
                                            </tr>
                                            <tr>
                                                <th>Total IVA</th>
                                                <td>@Html.Editor("totaliva", new { htmlAttributes = new { @class = "form-control", @placeholder = "Total IVA", @readonly = "true" } })</td>
                                            </tr>
                                            <tr>
                                                <th>Total</th>
                                                <td>@Html.Editor("total", new { htmlAttributes = new { @class = "form-control", @placeholder = "Total Final", @readonly = "true" } })</td>
                                            </tr>
                                            <tr>
                                                <th>Total con Ganancia</th>
                                                <td>@Html.Editor("totalganancia", new { htmlAttributes = new { @class = "form-control", @placeholder = "Total Final", @readonly = "true" } })</td>
                                            </tr>
                                        </table>
                                    </div>


                                </div>
                            </div>
                        </div>



                        }
                </div>
            </div>
            <div id="modalFacturacion" class="modal" tabindex="-1" aria-hidden="true" role="dialog">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="color-line"></div>
                        <div class="modal-header text-center">
                            @*<button type="button" class="close" data-dismiss="modal">&times;</button>*@
                            <h4 class="modal-title">TOT actualizada con éxito</h4>
                        </div>
                        <div class="modal-body">
                            <div class="row" style="text-align: center;">
                                <h4>Se actualizo el Trabajo en Otros Talleres con el número</h4>
                                <h3>
                                    <div id="numCreadodetot" name="numCreadodetot"></div>
                                </h3>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal" id="cerrarModalFactura">Cerrar</button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="buscar" class="tab-pane">
                <div class="panel-body">
                    <div class="panel-body-busqueda">
                        <div class="table-responsive">
                            <div id="div-mensaje-buscar"></div>
                            <div class="row">
                                <div class="col-md-3">
                                    <label>Consulta</label>
                                    <input type="text" id="buscartxt" class="form-control" />
                                </div>
                                <div class="col-md-3">
                                    <label>Fecha Desde</label>
                                    <input type="text" id="fechaini" class="form-control fechas" />
                                </div>
                                <div class="col-md-3">
                                    <label>Fecha Hasta</label>
                                    <input type="text" id="fechafin" class="form-control fechas" />
                                </div>
                                <div class="col-md-3">
                                    <button class="btn btn-outline-primary" onclick="Filtrar()">Consultar</button>
                                </div>
                            </div>

                            <table class="table table-striped table-bordered table-hover" id="tablaPaginada">
                                <thead>
                                    <tr>
                                        <th style="text-align:center">TOT</th>
                                        <th style="text-align:center">OT</th>
                                        <th style="text-align:center">Fecha</th>
                                        <th style="text-align:center">Proveedor</th>
                                        <th style="text-align:center">Operaciones</th>
                                        <th style="text-align:center">Repuestos</th>
                                        <th style="text-align:center">Valor Total</th>
                                        <th style="text-align:center">Accion</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>



        </div>

    </div>
</div>
@section Scripts {
    @Scripts.Render("~/bundles/select2/js")
    <script src="~/Vendor/datatables/media/js/jquery.dataTables.min.js"></script>
    <script src="~/Vendor/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>
    <script src="~/Vendor/datatables.net-buttons/js/buttons.html5.min.js"></script>
    <script src="~/Vendor/datatables.net-buttons/js/buttons.print.min.js"></script>
    <script src="~/Vendor/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
    <script src="~/Vendor/datatables.net-buttons-bs/js/buttons.bootstrap.min.js"></script>
    <script src="~/Vendor/datatablesExcelExport/dataTable1.4.0-buttons.js"></script>
    <script src="~/Vendor/datatablesExcelExport/JSZip3.1.3.min.js"></script>
    <script src="~/Vendor/datatablesExcelExport/jsZipDataTables.js"></script>
    <script src="~/Vendor/bootstrap-toggle-master/js/bootstrap-toggle.min.js"></script>
    <script src="~/Vendor/moment/moment.js"></script>
    <script src="~/Vendor/eonasdan-bootstrap-datetimepicker/build/js/bootstrap-datetimepicker.min.js"></script>

    <script src="~/Scripts/detalleot.js"></script>
    <script>
           $(document).ready(function () {

                  $('.js-source-states').select2();

               $("#fecha").find('imput').val(fecha);
                 $('.fechas').datetimepicker({
                format: 'YYYY/MM/DD',
                maxDate: `-${new Date()}`
            });

                     $("#fechaini").val(fecha);
               $("#fechaini").find('imput').val(fecha);
                    $("#fechafin").val(fecha);
                $("#fechafin").find('imput').val(fecha);
                      setTimeout(function () {
                $("#mensajetot").fadeOut(1500);
            }, 3000);
              
               Datostot();
              });

        $('#proveedor').change(function () {
            $.ajax({
                url: '/ordenTaller/buscarFormaPago',
                data: {
                    id: $('#proveedor').val()
                },
                type: "post",
                cache: false,
                success: function (data) {
                    console.log('dato'+data.data);
                    if (data.info == true) {
                        $('#fpago').val(data.data.id).trigger('change');
                    }
                }
            });
        });

        $('#tipo').change(function () {

        $.ajax({
                    url: '/CentralAtencion/traerPerfiles',
                    data: {
                        tipoDocumento: $('#tipo').val(),
                        bodega: $('#Bodega').val(),
                    },
                    type: 'post',
                    dataType: 'json',
                    cache: false,
            success: function (data) {

                        if (data != 0) {
                            $('#perfil').empty();
                            $('#perfil').append('<option value="">Seleccione</option>');
                            for (var i = 0; i < data.length; i++) {
                                $('#perfil').append('<option value="' + data[i].id + '">' + data[i].nombre + '</option>');
                            }
                            $('#perfil').trigger('change');
                        }
                    }
                });
        });


         $('#Bodega').change(function () {

        $.ajax({
                    url: '/CentralAtencion/traerPerfiles',
                    data: {
                        tipoDocumento: $('#tipo').val(),
                        bodega: $('#Bodega').val(),
                    },
                    type: 'post',
                    dataType: 'json',
                    cache: false,
            success: function (data) {

                        if (data != 0) {
                            $('#perfil').empty();
                            $('#perfil').append('<option value="">Seleccione</option>');
                            for (var i = 0; i < data.length; i++) {
                                $('#perfil').append('<option value="' + data[i].id + '">' + data[i].nombre + '</option>');
                            }
                            $('#perfil').trigger('change');
                        }
                    }
                });
            });

          $('#tipotarifa').change(function () {
              var tarifa = $('#tipotarifa').val();
        $.ajax({
                    url: '/ordenTaller/actualizartarifatot',
                    data: {
                        idtot: $('#id').val(),
                        tarifa: tarifa,
                    },
                    type: 'post',
                    dataType: 'json',
                    cache: false,
            success: function (data) {

                     
                    }
        });
                   $.ajax({
                url: '/ordenTaller/Calculartot',
                data: {
                    idtot: $('#id').val()  
                },
                type: "post",
                cache: false,
                success: function (data) {
                    $('#subtotal').val(data.subtotals);
                    $('#totaldescuentos').val(data.totaldescs);
                    $('#totaliva').val(data.totalivas);
                    $('#total').val(data.totals);
                     $('#totalganancia').val(data.totalconganancias);
                }
                   });


            });
        function Datostot() {    
           
            var id = $('#id').val();
         $('#numerototid').val(id)   
                  $.ajax({
                    url: '/ordenTaller/CargarItemsTot',
                    data: {
                        idtot: $('#id').val()                
                    },
                    type: 'post',
                    cache: false,
                      success: function (data) {
                            var totalop = 0;
                             var tabla = "";
                        $('#tablaOperaciones').find('tbody').empty();
                           for (var i = 0; i < data.datos.length; i++) {
                              totalop =parseInt(totalop) + parseInt(data.datos[i].vlunitario);
                               tabla += "<tr id='row'>";
                               tabla += "<td align='center'>";
                               tabla += "<input type='text' id='Descripcion"+ i + "'  name='Descripcion"+ i + "' class = 'form-control'  readonly='true'  value='" + data.datos[i].descripcion + "'/> ";
                               tabla += "</td>";
                               tabla += "<td align='center'>";
                               tabla += "<input  type='text' id='valorop" + i + "' name='valorop" + i + "' class = 'form-control'  readonly='true'  value='" + data.datos[i].vrunitario + "'/>";
                               tabla += "</td>";
                               tabla += "<td align='center'>";
                               tabla += "<input  type='text' id='descuentoop" + i + "' name='descuentoop" + i + "' class = 'form-control'  readonly='true'  value='" + data.datos[i].vrdescuento + "'/>";
                               tabla += "</td>";
                               tabla += "<td align='right'>";
                               tabla += "<input  type='text' id='ivaop" + i + "' name='ivaop" + i + "' class = 'form-control'  readonly='true'  value='" + data.datos[i].vliva + "' />";
                               tabla += "</td>";
                               tabla += "<td align='center'>";
                               tabla += "<input  type='text' id='totalop" + i + "' name='totalop" + i + "' class ='form-control'  readonly='true'  value='" + data.datos[i].vrunitario + "'/>";
                               tabla += "</td>";
                               tabla += "<td >";
                               tabla += "<button type='button' class='btn btn-danger btn-xs'  onclick='Eliminaritemtot("+ data.datos[i].id +",1)'> &nbsp;&nbsp;<i class='fa fa-times'></i>&nbsp;&nbsp;</button>";
                               tabla += "</td>";
                               tabla += "</tr>";
                             

                           }

                           $('#totaloperaciones').val(totalop);
                          $('#tablaOperaciones').find('tbody').append(tabla);

                           var totalrep = 0;
                          
                          	 var   tabla2 = "";
                        $('#tablaRepuestos').find('tbody').empty();
                           for (var i = 0; i < data.datos2.length; i++) {

                               var tdesc = 0, tiva = 0;
                               var total = 0;

                              total = parseInt(data.datos2[i].canti) * parseFloat(data.datos2[i].vlunitario);

                               if (data.datos2[i].vrdesc!=null) {
                                     tdesc = (parseInt(total) * parseFloat(data.datos2[i].vrdesc)) / 100;
                               total = parseInt(total) - parseInt(tdesc);
                               }
                               if (data.datos2[i].vriva!=null) {
                                   tiva = (parseInt(total) * parseFloat(data.datos2[i].vriva)) / 100;
                                    total = parseInt(total) +parseInt(tiva);
                               }

                                var  totalrep = parseInt(totalrep) + parseInt(total);

                          	   tabla2 += "<tr id='row'>";
                               tabla2 += "<td align='center'>";
                               tabla2 += "<input type='text' id='Descripcionrep" + i + "' name='Descripcionrep" + i + "' class = 'form-control'  readonly='true'  value='" + data.datos2[i].descripcion + "'/>";
                               tabla2 += "</td>";
                               tabla2 += "<td align='center'>";
                               tabla2 += "<input type='text' id='cantidadrep" + i + "' name='cantidadrep" + i + "' class = 'form-control'  readonly='true'  value='" + data.datos2[i].canti + "'/>"
                               tabla2 += "</td>";
                               tabla2 += "<td align='center'>";
                               tabla2 += "<input  type='text' id='valorrep" + i + "' name='valorrep" + i + "' class = 'form-control'  readonly='true'  value='" + data.datos2[i].vrunitario + "'/>";
                               tabla2 += "</td>";
                               tabla2 += "<td align='center'>";
                               tabla2 += "<input  type='text' id='descuentorep" + i + "' name='descuentorep" + i + "' class = 'form-control'  readonly='true'  value='" + data.datos2[i].vrdesc + "'/>";
                               tabla2 += "</td>";
                               tabla2 += "<td align='right'>";
                               tabla2 += "<input  type='text' id='ivarep" + i + "' name='ivarep" + i + "' class = 'form-control'  readonly='true'  value='" + data.datos2[i].vriva + "'/>";
                               tabla2 += "</td>";
                               tabla2 += "<td align='center'>";
                               tabla2 += "<input  type='text' id='totalrrep" + i + "' name='totalrrep" + i + "' class = 'form-control'  readonly='true'  value='" +addCommas(total)   + "'/>";
                               tabla2 += "</td>";
                               tabla2 += "<td>";
                               tabla2 += "<button type='button' class='btn btn-danger btn-xs'  onclick='Eliminaritemtot("+ data.datos2[i].id +",2)'> &nbsp;&nbsp;<i class='fa fa-times'></i>&nbsp;&nbsp;</button>";
                               tabla2 += "</td>";
                               tabla2 += "</tr>";
                             

                           }
                           $('#total_repuestos').val(totalrep);
                           $('#tablaRepuestos').find('tbody').append(tabla2);



                      }
                  });
                       $.ajax({
                url: '/ordenTaller/Calculartot',
                data: {
                    idtot: $('#id').val()  
                },
                type: "post",
                cache: false,
                success: function (data) {
                    $('#subtotal').val(data.subtotals);
                    $('#totaldescuentos').val(data.totaldescs);
                    $('#totaliva').val(data.totalivas);
                    $('#total').val(data.totals);
                     $('#totalganancia').val(data.totalconganancias);
                }
                   });
   }
             


        function AgregarOperacionTOT() {
            var operacion = $('#operaciontxt').val();
            var vrunitarioop = $('#valorunitxt').val();
            var descuentoop = $('#descuentooptxt').val();
            var iva = $('#Ivaoptxt').val();
            var idtot = $('#numerototid').val();

                    var tabla = ""
            if (operacion!="" && vrunitarioop !="") {
                   $.ajax({
                    url: '/ordenTaller/Crearoperaciontot',
                    data: {
                        idtot: idtot,
                        operacion: operacion,
                        vrunitarioop: vrunitarioop,
                        descuentoop: descuentoop,
                        iva: iva
                    },
                    type: 'post',
                    cache: false,
                       success: function (data) {
                           var totalop = 0;

                        $('#tablaOperaciones').find('tbody').empty();
                           for (var i = 0; i < data.length; i++) {
                                  totalop =parseInt(totalop) + parseInt(data[i].vlunitario);
                            tabla += "<tr id='row'>";
                               tabla += "<td align='center'>";
                               tabla += "<input type='text' id='Descripcion"+ i + "'  name='Descripcion"+ i + "' class = 'form-control'  readonly='true'  value='" + data[i].descripcion + "'/> ";
                               tabla += "</td>";
                               tabla += "<td align='center'>";
                               tabla += "<input  type='text' id='valorop" + i + "' name='valorop" + i + "' class = 'form-control'  readonly='true'  value='" + data[i].vrunitario + "'/>";
                               tabla += "</td>";
                               tabla += "<td align='center'>";
                               tabla += "<input  type='text' id='descuentoop" + i + "' name='descuentoop" + i + "' class = 'form-control'  readonly='true'  value='" + data[i].vrdescuento + "'/>";
                               tabla += "</td>";
                               tabla += "<td align='right'>";
                               tabla += "<input  type='text' id='ivaop" + i + "' name='ivaop" + i + "' class = 'form-control'  readonly='true'  value='" + data[i].vliva + "' />";
                               tabla += "</td>";
                               tabla += "<td align='center'>";
                               tabla += "<input  type='text' id='totalop" + i + "' name='totalop" + i + "' class ='form-control'  readonly='true'  value='" + data[i].vrunitario + "'/>";
                               tabla += "</td>";
                               tabla += "<td >";
                               tabla += "<button type='button' class='btn btn-danger btn-xs'  onclick='Eliminaritemtot("+ data[i].id +",1)'> &nbsp;&nbsp;<i class='fa fa-times'></i>&nbsp;&nbsp;</button>";
                               tabla += "</td>";
                               tabla += "</tr>";
                            

                           }

                           $('#totaloperaciones').val(totalop);
                           $('#tablaOperaciones').find('tbody').append(tabla);
                    }
                });
                   $.ajax({
                url: '/ordenTaller/Calculartot',
                data: {
                    idtot: idtot
                },
                type: "post",
                cache: false,
                success: function (data) {
                    $('#subtotal').val(data.subtotals);
                    $('#totaldescuentos').val(data.totaldescs);
                    $('#totaliva').val(data.totalivas);
                    $('#total').val(data.totals);
                     $('#totalganancia').val(data.totalconganancias);
                }
                   });
                $('#operaciontxt').val("");
                $('#valorunitxt').val("");
                $('#descuentooptxt').val("");
                $('#Ivaoptxt').val("");

            }


        }

        function AgergarReppuestosTOT() {
            var idtot = $('#numerototid').val();
            var repuesto = $('#Repuestotxt').val();
            var vrunitario = $('#valorunireptxt').val();
            var cantidad = $('#Cantidadreptxt').val();
            var descuento = $('#descuentoreptxt').val();
            var iva = $('#Ivareptxt').val();
                 var tabla = ""
              if (repuesto!="" && vrunitario !="" && cantidad !="") {
                   $.ajax({
                    url: '/ordenTaller/Crearrepuestostot',
                    data: {
                        idtot: idtot,
                        repuesto: repuesto,
                        vrunitario: vrunitario,
                        cantidad: cantidad,
                        descuento: descuento,
                        iva: iva
                    },
                    type: 'post',
                    cache: false,
                       success: function (data) {
                           var totalop = 0;

                        $('#tablaRepuestos').find('tbody').empty();
                           for (var i = 0; i < data.length; i++) {

                               var tdesc = 0, tiva = 0;
                               var total = 0;

                              total = parseInt(data[i].canti) * parseFloat(data[i].vlunitario);

                               if (data[i].vrdesc!=null) {
                                     tdesc = (parseInt(total) * parseFloat(data[i].vrdesc)) / 100;
                               total = parseInt(total) - parseInt(tdesc);
                               }
                               if (data[i].vriva!=null) {
                                   tiva = (parseInt(total) * parseFloat(data[i].vriva)) / 100;
                                    total = parseInt(total) +parseInt(tiva);
                               }

                                  totalop = parseInt(totalop) + parseInt(total);

                          	   tabla += "<tr id='row'>";
                               tabla += "<td align='center'>";
                               tabla += "<input type='text' id='Descripcionrep" + i + "' name='Descripcionrep" + i + "' class = 'form-control'  readonly='true'  value='" + data[i].descripcion + "'/>";
                               tabla += "</td>";
                               tabla += "<td align='center'>";
                               tabla += "<input type='text' id='cantidadrep" + i + "' name='cantidadrep" + i + "' class = 'form-control'  readonly='true'  value='" + data[i].canti + "'/>"
                               tabla += "</td>";
                               tabla += "<td align='center'>";
                               tabla += "<input  type='text' id='valorrep" + i + "' name='valorrep" + i + "' class = 'form-control'  readonly='true'  value='" + data[i].vrunitario + "'/>";
                               tabla += "</td>";
                               tabla += "<td align='center'>";
                               tabla += "<input  type='text' id='descuentorep" + i + "' name='descuentorep" + i + "' class = 'form-control'  readonly='true'  value='" + data[i].vrdesc + "'/>";
                               tabla += "</td>";
                               tabla += "<td align='right'>";
                               tabla += "<input  type='text' id='ivarep" + i + "' name='ivarep" + i + "' class = 'form-control'  readonly='true'  value='" + data[i].vriva + "'/>";
                               tabla += "</td>";
                               tabla += "<td align='center'>";
                               tabla += "<input  type='text' id='totalrrep" + i + "' name='totalrrep" + i + "' class = 'form-control'  readonly='true'  value='" +addCommas(total)   + "'/>";
                               tabla += "</td>";
                               tabla += "<td>";
                               tabla += "<button type='button' class='btn btn-danger btn-xs'  onclick='Eliminaritemtot("+ data[i].id +",2)'> &nbsp;&nbsp;<i class='fa fa-times'></i>&nbsp;&nbsp;</button>";
                               tabla += "</td>";
                               tabla += "</tr>";
                            

                           }
                           $('#total_repuestos').val(addCommas(totalop));
                           $('#tablaRepuestos').find('tbody').append(tabla);
                    }
                   });
                  setTimeout(function () {
                        $.ajax({
                url: '/ordenTaller/Calculartot',
                data: {
                    idtot: idtot
                },
                type: "post",
                cache: false,
                success: function (data) {
                      $('#subtotal').val(data.subtotals);
                    $('#totaldescuentos').val(data.totaldescs);
                    $('#totaliva').val(data.totalivas);
                    $('#total').val(data.totals);
                     $('#totalganancia').val(data.totalconganancias);
                }
                   });

                  }, 1000);


                  $('#Repuestotxt').val('');
                  $('#valorunireptxt').val('');
                  $('#Cantidadreptxt').val('');
                  $('#descuentoreptxt').val('');
                  $('#Ivareptxt').val('');


            }

        }




        function Eliminaritemtot(id, tipo) {
            var idtot = $('#numerototid').val();
                  $.ajax({
                url: '/ordenTaller/Eliminaritem',
                data: {
                    idtotdet: id,
                    tipo: tipo
                },
                type: "post",
                cache: false,
                success: function (data) {
                    if (tipo == 1) {
                        var tabla = ""
                           var totalop = 0;

                        $('#tablaOperaciones').find('tbody').empty();
                           for (var i = 0; i < data.length; i++) {
                                 totalop = parseInt(totalop) + parseInt(data[i].vlunitario);
                            tabla += "<tr id='row'>";
                               tabla += "<td align='center'>";
                               tabla += "<input type='text' id='Descripcion"+ i + "'  name='Descripcion"+ i + "' class = 'form-control'  readonly='true'  value='" + data[i].descripcion + "'/> ";
                               tabla += "</td>";
                               tabla += "<td align='center'>";
                               tabla += "<input  type='text' id='valorop" + i + "' name='valorop" + i + "' class = 'form-control'  readonly='true'  value='" + data[i].vrunitario + "'/>";
                               tabla += "</td>";
                               tabla += "<td align='center'>";
                               tabla += "<input  type='text' id='descuentoop" + i + "' name='descuentoop" + i + "' class = 'form-control'  readonly='true'  value='" + data[i].vrdesc + "'/>";
                               tabla += "</td>";
                               tabla += "<td align='right'>";
                               tabla += "<input  type='text' id='ivaop" + i + "' name='ivaop" + i + "' class = 'form-control'  readonly='true'  value='" + data[i].vliva + "' />";
                               tabla += "</td>";
                               tabla += "<td align='center'>";
                               tabla += "<input  type='text' id='totalop" + i + "' name='totalop" + i + "' class ='form-control'  readonly='true'  value='" + data[i].vrunitario + "'/>";
                               tabla += "</td>";
                               tabla += "<td >";
                               tabla += "<button type='button' class='btn btn-danger btn-xs'  onclick='Eliminaritemtot("+ data[i].id +",1)'> &nbsp;&nbsp;<i class='fa fa-times'></i>&nbsp;&nbsp;</button>";
                               tabla += "</td>";
                               tabla += "</tr>";
                             

                           }

                           $('#totaloperaciones').val(addCommas(totalop));
                           $('#tablaOperaciones').find('tbody').append(tabla);




                    } else {
                        var tabla = "";

                         var totalop = 0;

                        $('#tablaRepuestos').find('tbody').empty();
                           for (var i = 0; i < data.length; i++) {
                                 var tdesc = 0, tiva = 0;
                               var total = 0;

                              total = parseInt(data[i].canti) * parseFloat(data[i].vlunitario);

                               if (data[i].vrdesc!=null) {
                                     tdesc = (parseInt(total) * parseFloat(data[i].vrdesc)) / 100;
                               total = parseInt(total) - parseInt(tdesc);
                               }
                               if (data[i].vriva!=null) {
                                   tiva = (parseInt(total) * parseFloat(data[i].vriva)) / 100;
                                    total = parseInt(total) +parseInt(tiva);
                               }


                                            totalop = parseInt(totalop) + parseInt(total);

                          	   tabla += "<tr id='row'>";
                               tabla += "<td align='center'>";
                               tabla += "<input type='text' id='Descripcionrep" + i + "' name='Descripcionrep" + i + "' class = 'form-control'  readonly='true'  value='" + data[i].descripcion + "'/>";
                               tabla += "</td>";
                               tabla += "<td align='center'>";
                               tabla += "<input type='text' id='cantidadrep" + i + "' name='cantidadrep" + i + "' class = 'form-control'  readonly='true'  value='" + data[i].cant + "'/>"
                               tabla += "</td>";
                               tabla += "<td align='center'>";
                               tabla += "<input  type='text' id='valorrep" + i + "' name='valorrep" + i + "' class = 'form-control'  readonly='true'  value='" + data[i].vrunitario + "'/>";
                               tabla += "</td>";
                               tabla += "<td align='center'>";
                               tabla += "<input  type='text' id='descuentorep" + i + "' name='descuentorep" + i + "' class = 'form-control'  readonly='true'  value='" + data[i].vrdesc + "'/>";
                               tabla += "</td>";
                               tabla += "<td align='right'>";
                               tabla += "<input  type='text' id='ivarep" + i + "' name='ivarep" + i + "' class = 'form-control'  readonly='true'  value='" + data[i].vliva + "'/>";
                               tabla += "</td>";
                               tabla += "<td align='center'>";
                               tabla += "<input  type='text' id='totalrrep" + i + "' name='totalrrep" + i + "' class = 'form-control'  readonly='true'  value='" + addCommas(total)  + "'/>";
                               tabla += "</td>";
                               tabla += "<td>";
                               tabla += "<button type='button' class='btn btn-danger btn-xs'  onclick='Eliminaritemtot("+ data[i].id +",2)'> &nbsp;&nbsp;<i class='fa fa-times'></i>&nbsp;&nbsp;</button>";
                               tabla += "</td>";
                               tabla += "</tr>";
                  

                           }
                           $('#total_repuestos').val(addCommas(totalop));
                           $('#tablaRepuestos').find('tbody').append(tabla);

                    }





                }
                   });
            setTimeout(function () {
                        $.ajax({
                url: '/ordenTaller/Calculartot',
                data: {
                    idtot: idtot
                },
                type: "post",
                cache: false,
                success: function (data) {
                    $('#subtotal').val(data.subtotals);
                    $('#totaldescuentos').val(data.totaldescs);
                    $('#totaliva').val(data.totalivas);
                    $('#total').val(data.totals);
                     $('#totalganancia').val(data.totalconganancias);
                }
                   });

                  }, 1000);

        }
          function addCommas(nStr) {
            nStr += '';
            const x = nStr.split('.');
            var x1;
            x1 = x[0];
            const x2 = x.length > 1 ? `.${x[1]}` : '';
            const rgx = /(\d+)(\d{3})/;
            while (rgx.test(x1)) {
                x1 = x1.replace(rgx, '$1' + '.' + '$2');
            }
            return x1 + x2;
        }

        function guardarvalores() {
     
            var idtot = $('#id').val();
                 var tipo =  $('#tipo').val();
            var Bodega = $('#Bodega').val();
            var perfil = $('#perfil').val();
            var fpago = $('#fpago').val();
            var numerofactura = $('#numerofactura').val();
            var fecha = $('#fecha').val();
            var numot = $('#numot').val();
            var tipotarifa = $('#tipotarifa').val();
            var proveedor =  $('#proveedor').val();  
                    $.ajax({
                url: '/ordenTaller/GuardarValorestot',
                data: {
                    idtot: idtot,
                    tipo: tipo,
                         Bodega: Bodega,
                        perfil: perfil,
                        fpago: fpago,
                        numerofactura: numerofactura,
                        fecha: fecha,
                        numot: numot,
                        tipotarifa: tipotarifa,
                    proveedor: proveedor,               

                },
                type: "post",
                cache: false,
                success: function (data) {
                            $('#modalFacturacion').modal('show');
                            var mensaje = " <span class='label label-default'>"+data+"</span>";

                            $('#numCreadodetot').html(mensaje);


                }
                   });


        }

        function Buscartot() {

                      $.ajax({
                url: '/ordenTaller/ConsultarToT',
                data: {
                },
                type: "post",
                cache: false,
                success: function (data) {
                    $('#tablaPaginada').find('tbody').empty();
                    var tabla = "";

                    for (var i = 0; i < data.length; i++) {
                        tabla += "<tr>";
                        tabla += "<td align='left'>" + data[i].id2 + "</td>";
                        tabla += "<td align='left'>" + data[i].codigoentrada + "</td>";
                        tabla += "<td align='center'>" + data[i].fecha + "</td>";
                        tabla += "<td align='left'>" + data[i].proveedor + "</td>";
                        tabla += "<td align='center'>";
                        if (data[i].Operaciones.length > 0) {
                            for (var j = 0; j < data[i].Operaciones.length; j++) {
                                tabla += data[i].Operaciones[j].Descripcion + " | ";
                            }
                             tabla = tabla.slice(0, -2);
                        }
                        else {
                            tabla += "&nbsp;&nbsp;&nbsp;";

                        }
                        tabla += "</td>";
                               tabla += "<td align='center'>";
                        if (data[i].Repuestos.length > 0) {
                            for (var j = 0; j < data[i].Repuestos.length; j++) {
                                tabla += data[i].Repuestos[j].Descripcion + " | ";
                            }
                             tabla = tabla.slice(0, -2);
                        }
                        else {
                            tabla += "&nbsp;&nbsp;&nbsp;";

                        }
                        tabla += "</td>";

                        tabla += "<td align='center'>" + data[i].Valor_total + "</td>";
                        tabla += "<td width='5%'><button class='btn btn-info btn-xs' onclick='Editartot(" + data[i].id2 + ")'>&nbsp;&nbsp;Ver&nbsp;&nbsp;</button></td>";
                        tabla += "</tr>";
                    }

                        $('#tablaPaginada').find('tbody').append(tabla);
                },
                complete: function (data) {
                    $('#tablaPaginada').dataTable({
                        //"ajax": 'api/datatables.json',
                        //dom: "<''<'col-sm-4'l><'col-sm-4 text-center'B><'col-sm-4'f>>t<'col-sm-4'i>p",
                        dom: "<''<'col-md-6'l><'col-md-6'f>>t<'col-md-4'i><'col-md-8 text-right'pB>",
                        "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
                        buttons: [
                            //{ extend: 'excel', className: 'btn-sm', text: 'Exportar a Excel' },
                            ////{ extend: 'pdf', title: 'ExampleFile', className: 'btn-sm', text: 'PDF' },
                            ////{ extend: 'print', className: 'btn-sm', text: 'Imprimir' }
                        ]
                    });
                }
            });

        }

        function Filtrar() {
            var texto = $('#buscartxt').val();
            var ffinicio = $('#fechaini').val();
             var ffin =  $('#fechafin').val();
                 $.ajax({
                url: '/ordenTaller/ConsultarFiltroTot',
                     data: {
                         cadena: texto,
                         fechaini: ffinicio,
                         fechafin: ffin
                },
                type: "post",
                cache: false,
                     success: function (data) {
                         $('#tablaPaginada').DataTable().destroy();

                    $('#tablaPaginada').find('tbody').empty();
                    var tabla = "";

                    for (var i = 0; i < data.length; i++) {
                        tabla += "<tr>";
                        tabla += "<td align='left'>" + data[i].id2 + "</td>";
                        tabla += "<td align='left'>" + data[i].codigoentrada + "</td>";
                        tabla += "<td align='center'>" + data[i].fecha2 + "</td>";
                        tabla += "<td align='left'>" + data[i].proveedor + "</td>";
                        tabla += "<td align='center'>";
                        if (data[i].Operaciones.length > 0) {
                            for (var j = 0; j < data[i].Operaciones.length; j++) {
                                tabla += data[i].Operaciones[j].Descripcion + " | ";
                            }
                            tabla = tabla.slice(0, -2);
                        }
                        else {
                            tabla += "&nbsp;&nbsp;&nbsp;";

                        }

                        tabla += "</td>";
                               tabla += "<td align='center'>";
                        if (data[i].Repuestos.length > 0) {
                            for (var j = 0; j < data[i].Repuestos.length; j++) {
                                tabla += data[i].Repuestos[j].Descripcion + " | ";
                            }
                             tabla = tabla.slice(0, -2);
                        }
                        else {
                            tabla += "&nbsp;&nbsp;&nbsp;";

                        }
                        tabla += "</td>";

                        tabla += "<td align='center'>" + data[i].valor_total + "</td>";
                        tabla += "<td width='5%'><button class='btn btn-info btn-xs' onclick='Editartot(" + data[i].id2 + ")'>&nbsp;&nbsp;Ver&nbsp;&nbsp;</button></td>";
                        tabla += "</tr>";
                    }

                        $('#tablaPaginada').find('tbody').append(tabla);
                },
                complete: function (data) {
                    $('#tablaPaginada').dataTable({
                        //"ajax": 'api/datatables.json',
                        //dom: "<''<'col-sm-4'l><'col-sm-4 text-center'B><'col-sm-4'f>>t<'col-sm-4'i>p",
                        dom: "<''<'col-md-6'l><'col-md-6'f>>t<'col-md-4'i><'col-md-8 text-right'pB>",
                        "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
                        buttons: [
                            //{ extend: 'excel', className: 'btn-sm', text: 'Exportar a Excel' },
                            ////{ extend: 'pdf', title: 'ExampleFile', className: 'btn-sm', text: 'PDF' },
                            ////{ extend: 'print', className: 'btn-sm', text: 'Imprimir' }
                        ]
                    });
                }
            });



        }

          function quitCommas(nStr) {
            nStr.toString();
            const s = nStr.replace(/\./g, "");
            return s;
        }


          function Editartot(id) {
            window.open('@Url.Action("/EditarTOT", "OrdenTaller")?idtot=' + id, '_blank');   
        }

    </script>
}
