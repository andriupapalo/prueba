@model Homer_MVC.Models.EncabezadoOTModel

@{
    ViewBag.Icono = "fa fa-file";
    ViewBag.Title = "Orden De Taller";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section Styles {
    <link href="~/Vendor/datatables.net-bs/css/dataTables.bootstrap.min.css" rel="stylesheet" />
    <link href="~/Vendor/bootstrap-toggle-master/css/bootstrap-toggle.min.css" rel="stylesheet" />
    @Styles.Render("~/bundles/select2/css")
}

<div class="panel-body">
    <div class="panel-heading" style="background-color:white;  border:solid 1px; border-color:#e4e5e7">
        <div class="panel-body">

            <div id="hbreadcrumb" class="pull-right">

                <button type="button" class="btn btn-mini btn-default" style="border-radius:25px" data-container="body" data-toggle="popover" data-placement="left" data-title="Enlaces" data-content="<ul>@ViewBag.nombreEnlaces</ul>" data-html="true">
                    <i class="text-info fa fa-tags"></i>
                </button>
                <button type="button" class="btn btn-mini btn-default" style="border-radius:25px" data-container="body" data-toggle="popover" data-placement="left" data-title="Documentos" data-content="<ul></i><a href=''>Documento 1</a></ul>  <ul></i><a href=''>Documento 2</a></ul> <ul></i><a href=''>Documento 3</a></ul>" data-html="true">
                    <i class="text-primary fa fa-files-o"></i>
                </button>
                <button type="button" class="btn btn-mini btn-default" style="border-radius:25px" data-container="body" data-toggle="popover" data-placement="left" data-title="Favoritos" data-content="@ViewBag.Favoritos" data-html="true">
                    <i class="text-warning fa fa-star"></i>
                </button>

            </div>
            <h3 class="font-light m-b-xs">
                <i class="text-info @ViewBag.Icono"></i>&nbsp;&nbsp;@ViewBag.Title&nbsp;@Html.DisplayFor(model => model.codigoentrada)&nbsp;<span id="labelestado"></span>
            </h3>
            <small>@ViewBag.Title</small>
        </div>
    </div>
</div>

<div class="panel-body" style="padding-top:0px;">
    <div class="hpanel">
        @*@if (TempData["mensaje"] != null)
            {
                <div class="alert alert-success  alert-dismissible" id="mensaje">
                    <button type="button" class="close" data-dismiss="alert" arial-label="close"><span aria-hidden="true">&times;</span></button>
                    <p>@TempData["mensaje"]</p>
                </div>
            }*@

        @if (TempData["mensaje_error"] != null)
            {
            <div class="alert alert-danger  alert-dismissible" id="mensaje_error">
                <button type="button" class="close" data-dismiss="alert" arial-label="close"><span aria-hidden="true">&times;</span></button>
                <p>@TempData["mensaje_error"]</p>
            </div>
            }

        <div id="tabs" class="tab-content">

            <div class="m float-e-margins text-right">
                <div class="tooltip-demo">

                    <div id="div-mensaje"></div>

                </div>
            </div>
            <div>
                <div class="panel-body" style="display:none" id="paneloperacionesnormal">
                    <div class="row" id="panelproduccion">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="control-label col-md-4">Tiempo Transcurrido:&nbsp;<span class="text-danger">*</span></label>
                                <div class="col-md-6">
                                    <span id="tiempoDuracion">00:00:00</span>
                                    @*<input type="hidden" id="tiempoDuracionhid" />*@
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="row">
                                <button type="button" id="comenzar" name="comenzar" class=" col-lg-1  btn btn-lg btn-primary"><i class="fa fa-play-circle"></i></button>
                                <button type="button" id="modalpausar" name="modalpausar" class=" col-lg-1  btn btn-lg btn-warning"><i class="fa fa-pause-circle-o"></i></button>

                                <button type="button" id="pausar" name="pausar" class=" col-lg-1  btn btn-lg btn-warning" style="display: none;"><i class="fa fa-pause-circle-o"></i></button>
                                <button type="button" id="despausar" name="despausar" class="col-lg-1 btn btn-lg btn-info"><i class="fa fa-pause-circle"></i></button>
                                <button type="button" id="finalizar" name="finalizar" style="display:none;" class="col-lg-1 btn btn-lg btn-success"><i class="fa fa-stop-circle"></i></button>
                                <button type="button" id="reactivar" name="reactivar" style="display:none;" class="col-lg-1 btn btn-lg btn-primary2"><i class="fa fa-play"></i></button>

                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <ul id="tabs-crear" class="nav nav-tabs">
                <li class="active"><a data-toggle="tab" href="#crear"><i class="@ViewBag.Icono"></i>&nbsp;&nbsp;@ViewBag.Title - Datos de la Orden</a></li>
                <li class=""><a data-toggle="tab" href="#recepcion"><i class="@ViewBag.Icono"></i>&nbsp;&nbsp;@ViewBag.Title - Recepción</a></li>
                <li class=""><a data-toggle="tab" href="#inspeccion" id="insp_tab" onclick="inspeccionVhSig(0)"><i class="@ViewBag.Icono"></i>&nbsp;&nbsp;@ViewBag.Title - Inspeccion</a></li>
                <li class=""><a data-toggle="tab" href="#repuestosSolicitados"><i class="@ViewBag.Icono"></i>&nbsp;&nbsp;@ViewBag.Title - Repuestos Solicitados</a></li>

                @*@if (ViewBag.ejecucion == 1)
                    {*@
                <li class=""><a data-toggle="tab" href="#ejecucion"><i class="@ViewBag.Icono"></i>&nbsp;&nbsp;@ViewBag.Title - Ejecucion</a></li>
                @*}*@
                @if (ViewBag.liquidacion == 1)
                    {
                    <li class=""><a data-toggle="tab" href="#liquidacion"><i class="@ViewBag.Icono"></i>&nbsp;&nbsp;@ViewBag.Title - Liquidacion</a></li>

                    }
                <li class=""><a data-toggle="tab" href="#TOT"><i class="@ViewBag.Icono"></i>&nbsp;&nbsp;@ViewBag.Title -TOT</a></li>
                <li class="" onclick="BuscarHistorial();"><a data-toggle="tab" href="#Historial"><i class="@ViewBag.Icono"></i>&nbsp;&nbsp;Historial</a></li>
                <li class="" onclick="buscarAjaxOrdenesTaller();"><a data-toggle="tab" href="#buscar"><i class="fa fa-search"></i>&nbsp;&nbsp;Búsquedas</a></li>
            </ul>

            <div id="crear" class="tab-pane active">
                <div class="panel-body">

                    @using (Html.BeginForm())
                        {
                        @Html.AntiForgeryToken()
                        @Html.Hidden("menu")
                        @Html.Hidden("numeroSolicitudes")
                        @Html.Hidden("id_cliente")
                        @Html.Hidden("numeroOperaciones")
                        @Html.Hidden("id_cita")

                        @Html.HiddenFor(model => model.id);
                        @Html.HiddenFor(model => model.idcita);
                        //@Html.HiddenFor(model => model.tipooperacion);
                        @Html.HiddenFor(model => model.numero);
                        @Html.HiddenFor(model => model.tercero);
                        @Html.HiddenFor(model => model.bodega);
                        //@Html.HiddenFor(model => model.fecha);
                        @Html.HiddenFor(model => model.estado);
                        //@Html.HiddenFor(model => model.minimo);
                        //@Html.HiddenFor(model => model.deducible);
                        //@Html.HiddenFor(model => model.recibidode);
                        //@Html.HiddenFor(model => model.codigoentrada);
                        @Html.HiddenFor(model => model.entrega);
                        //@Html.HiddenFor(model => model.idtipodoc);
                        @*@Html.HiddenFor(model => model.fec_creacion);
                            @Html.HiddenFor(model => model.fec_actualizacion);
                            @Html.HiddenFor(model => model.userid_creacion);
                            @Html.HiddenFor(model => model.user_idactualizacion);*@

                        @Html.HiddenFor(model => model.estadoorden);
                        @Html.HiddenFor(model => model.razon_secundaria);

                        <input type="hidden" name="tipodegarantia" id="tipodegarantia" value="@ViewBag.tipodegarantia" />

                        <div class="form-horizontal">

                            @Html.ValidationSummary(true, "", new { @class = "text-danger" })

                            <input type="hidden" name="citaOrden" id="citaOrden" value="" />




                            <div class="hpanel">
                                <div class="panel-heading hbuilt" style="background-color:#e4e5e7">
                                    <div class="panel-tools">
                                        <a class="showhide"><i class="fa fa-chevron-up"></i></a>

                                    </div>
                                    <i class="fa fa-calendar-check-o"></i>&nbsp;&nbsp;&nbsp;Datos entrada
                                </div>
                                <div class="panel-body">

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Codigo:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                @Html.EditorFor(model => model.codigoentrada, new { htmlAttributes = new { @class = "form-control", @required = "required", @placeholder = "Digite codigo entrada", @readonly = "readonly" } })
                                                @Html.ValidationMessageFor(model => model.codigoentrada, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Tipo Documento:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                @Html.DropDownListFor(model => model.idtipodoc, null, "", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione", @required = "required", })
                                                @Html.ValidationMessageFor(model => model.idtipodoc, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Asesor:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                @Html.EditorFor(model => model.asesor, new { htmlAttributes = new { @class = "form-control requeridoAseguradora", @placeholder = "", @readonly = "readonly" } })


                                                @*@Html.DropDownListFor(model => model.asesor, null, "", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione", @required = "required" })*@
                                                @Html.ValidationMessageFor(model => model.asesor, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6 ">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Tecnico:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                @Html.DropDownListFor(model => model.tecnico, null, "", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione", @readonly = "readonly" })
                                                @*@Html.ValidationMessageFor(model => model.idtipodoc, "", new { @class = "text-danger" })*@
                                            </div>
                                            <div class="col-md-2">
                                                <div id="btnagenda"></div>
                                            </div>
                                        </div>

                                    </div>

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Razon Ingreso Primaria:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                @Html.DropDownListFor(model => model.razoningreso, null, "Seleccione", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione", @required = "required" })
                                                @Html.ValidationMessageFor(model => model.razoningreso, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>

                                    @*<div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="control-label col-md-4">Razon Secundaria:&nbsp;</label>
                                                <div class="col-md-6">
                                                    @Html.DropDownListFor(model => model.razon_secundaria, null, "", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione" })
                                                    @Html.ValidationMessageFor(model => model.razon_secundaria, "", new { @class = "text-danger" })
                                                </div>
                                            </div>
                                        </div>*@

                                    @*<div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="control-label col-md-4">Tipo Orden:&nbsp;<span class="text-danger">*</span></label>
                                                <div class="col-md-6">
                                                    @Html.DropDownListFor(model => model.tipooperacion, null, "", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione", @required = "required" })
                                                    @Html.ValidationMessageFor(model => model.tipooperacion, "", new { @class = "text-danger" })
                                                </div>
                                            </div>
                                        </div>*@

                                    <div class="col-sm-6" id="areaRazonIngreso" style="display:none;">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Aseguradora:&nbsp;</label>
                                            <div class="col-md-6">
                                                @Html.DropDownListFor(model => model.aseguradora, null, "Seleccione", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione" })
                                                @Html.ValidationMessageFor(model => model.aseguradora, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>

                                    <div id="areaGarantia" style="display:block;">
                                        <div class="col-sm-12">
                                            <div class="form-group">
                                                <label class="control-label col-md-4">Falla:&nbsp;<span class="text-danger">*</span></label>
                                                <div class="col-md-6">
                                                    @Html.TextAreaFor(m => m.garantia_falla, new RouteValueDictionary(new { @class = "form-control requeridoGarantia", style = "width: 100%; height:80px;" }))
                                                    @Html.ValidationMessageFor(model => model.garantia_falla, "", new { @class = "text-danger" })
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-12">
                                            <div class="form-group">
                                                <label class="control-label col-md-4">Causa:&nbsp;<span class="text-danger">*</span></label>
                                                <div class="col-md-6">
                                                    @Html.TextAreaFor(m => m.garantia_causa, new RouteValueDictionary(new { @class = "form-control requeridoGarantia", style = "width: 100%; height:80px;" }))
                                                    @Html.ValidationMessageFor(model => model.garantia_causa, "", new { @class = "text-danger" })
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-12">
                                            <div class="form-group">
                                                <label class="control-label col-md-4">Solución:&nbsp;<span class="text-danger">*</span></label>
                                                <div class="col-md-6">
                                                    @Html.TextAreaFor(m => m.garantia_solucion, new RouteValueDictionary(new { @class = "form-control requeridoGarantia", style = "width: 100%; height:80px;" }))
                                                    @Html.ValidationMessageFor(model => model.garantia_solucion, "", new { @class = "text-danger" })
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="areaDatosAseguradora" style="display:none;">
                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="control-label col-md-4">Poliza:&nbsp;<span class="text-danger">*</span></label>
                                                <div class="col-md-6">
                                                    @Html.EditorFor(model => model.poliza, new { htmlAttributes = new { @class = "form-control requeridoAseguradora", @placeholder = "Digite poliza" } })
                                                    @Html.ValidationMessageFor(model => model.poliza, "", new { @class = "text-danger" })
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="control-label col-md-4">Siniestro:&nbsp;<span class="text-danger">*</span></label>
                                                <div class="col-md-6">
                                                    @Html.EditorFor(model => model.siniestro, new { htmlAttributes = new { @class = "form-control requeridoAseguradora", @placeholder = "Digite siniestro" } })
                                                    @Html.ValidationMessageFor(model => model.siniestro, "", new { @class = "text-danger" })
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="control-label col-md-4">Valor Minimo:&nbsp;<span class="text-danger">*</span></label>
                                                <div class="col-md-6">
                                                    @Html.EditorFor(model => model.minimo, new { htmlAttributes = new { @class = "form-control requeridoAseguradora", @placeholder = "Digite valor ($)", @onkeyUp = "return miles(this.id)" } })
                                                    @*@Html.ValidationMessageFor(model => model.minimo, "", new { @class = "text-danger" })*@
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="control-label col-md-4">Deducible:&nbsp;<span class="text-danger">*</span></label>
                                                <div class="col-md-6">
                                                    @Html.EditorFor(model => model.deducible, new { htmlAttributes = new { @class = "form-control requeridoAseguradora", @placeholder = "Digite deducible", @onkeyUp = "return miles(this.id)" } })
                                                    @*@Html.ValidationMessageFor(model => model.deducible, "", new { @class = "text-danger" })*@
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="control-label col-md-4">Fecha Soat:&nbsp;<span class="text-danger">*</span></label>
                                                <div class="col-md-6">
                                                    @Html.EditorFor(model => model.fecha_soat, new { htmlAttributes = new { @class = "form-control requeridoAseguradora", @placeholder = "", } })
                                                    @*@Html.ValidationMessageFor(model => model.deducible, "", new { @class = "text-danger" })*@
                                                    <div class="col-sm-12" id="selectInfoSoat" style="display:none">
                                                        <div class="form-group">
                                                            <div class="col-md-12">
                                                                <div class="alert alert-danger">
                                                                    <strong></strong><p id="textosoat"></p><br />
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="control-label col-md-4">Numero de Soat:&nbsp;<span class="text-danger">*</span></label>
                                                <div class="col-md-6">
                                                    @Html.EditorFor(model => model.numero_soat, new { htmlAttributes = new { @class = "form-control requeridoAseguradora", @placeholder = "Digite N° de SOAT", @onkeyUp = "return soloNumeros(this.id)" } })
                                                    @*@Html.ValidationMessageFor(model => model.deducible, "", new { @class = "text-danger" })*@
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>

                            <div class="hpanel">
                                <div class="panel-heading hbuilt" style="background-color:#e4e5e7">
                                    <div class="panel-tools">
                                        <a class="showhide"><i class="fa fa-chevron-up"></i></a>

                                    </div>
                                    <i class="fa fa-car"></i>&nbsp;&nbsp;&nbsp;Datos Vehiculo
                                </div>
                                <div class="panel-body">

                                    <div class="row">
                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="control-label col-md-4">Placa / Plan Mayor:&nbsp;<span class="text-danger">*</span></label>
                                                <div class="col-md-6">
                                                    @*@Html.EditorFor(model => model.placa, new { htmlAttributes = new { @class = "form-control", @required = "required", @placeholder = "Digite placa", @readonly = "readonly" } })
                                                        @Html.ValidationMessageFor(model => model.placa, "", new { @class = "text-danger" })*@
                                                    <input type="text" name="placa" value="@ViewBag.placa1" class="form-control" readonly />
                                                </div>
                                                <div class="col-md-2">
                                                    <button type="button" class="btn btn-primary" id="btnBuscarPlaca" style="display:none"><i class="fa fa-search"></i></button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="control-label col-md-4">Modelo Vehículo:&nbsp;<span class="text-danger">*</span></label>
                                                <div class="col-md-6">
                                                    @Html.EditorFor(model => model.modelo, new { htmlAttributes = new { @class = "form-control", @required = "required", @placeholder = "Digite placa", @readonly = "readonly" } })
                                                    @Html.ValidationMessageFor(model => model.modelo, "", new { @class = "text-danger" })
                                                </div>
                                                <div class="col-md-2">

                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-6" style="display:none;" id="placaNoEncontrada">
                                            <div class="form-group">
                                                <label class="control-label col-md-10">Placa no encontrada &nbsp;<a class="btn btn-link" href="../../creacionVh?menu=@ViewBag.id_menu">&nbsp;Crear vehiculo aqui&nbsp;&nbsp;<i class="fa fa-car"></i></a>&nbsp;</label>

                                            </div>
                                        </div>

                                    </div>
                                    <div class="row">

                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="control-label col-md-4">Año Modelo :&nbsp;<span class="text-danger">*</span></label>
                                                <div class="col-md-6">
                                                    @Html.EditorFor(model => model.añovh, new { htmlAttributes = new { @class = "form-control", @required = "required", @placeholder = "Digite placa", @readonly = "readonly" } })
                                                    @Html.ValidationMessageFor(model => model.añovh, "", new { @class = "text-danger" })
                                                </div>
                                                <div class="col-md-2">

                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="control-label col-md-4">Serie:&nbsp;</label>
                                                <div class="col-md-6">
                                                    <p id="serieBuscado"></p>
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                    <div class="row">

                                        <div class="areaVehiculoOculta" style="display:none;">


                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">Numero Motor:&nbsp;</label>
                                                    <div class="col-md-6">
                                                        <p id="numMotorBuscado"></p>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">Color:&nbsp;</label>
                                                    <div class="col-md-6">
                                                        <p id="colorBuscado"></p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">Fecha Venta:&nbsp;</label>
                                                    <div class="col-md-6">
                                                        <p id="fechaVentaBuscado"></p>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">Fecha Fin Garantia:&nbsp;</label>
                                                    <div class="col-md-6">
                                                        <p id="fechaFinGarantiaBuscado"></p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">Fecha Compra:&nbsp;</label>
                                                    <div class="col-md-6">
                                                        <p id="fechacompra"></p>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">Concesionario:&nbsp;</label>
                                                    <div class="col-md-6">
                                                        <p id="Consecionariovh"></p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">Fecha Prometida:&nbsp;</label>
                                                    <div class="col-md-6">
                                                        <p id="fechaprometida"></p>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">Modelo:&nbsp;</label>
                                                    <div class="col-md-6">
                                                        <p id="Modelovh"></p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">Aseguradora:&nbsp;</label>
                                                    <div class="col-md-6">
                                                        <p id="aseguradoravh"></p>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">Flota:&nbsp;</label>
                                                    <div class="col-md-6">
                                                        <p id="flotavh"></p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row">

                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">Kilometraje Anterior:&nbsp;</label>
                                                    <div class="col-md-6">
                                                        @*<p id="kilometrajeBuscado"></p>*@
                                                        @Html.EditorFor(model => model.kilometraje, new { htmlAttributes = new { @class = "form-control", @required = "required", @placeholder = "Digite kilometraje", @readonly = "readonly" } })
                                                        @Html.ValidationMessageFor(model => model.kilometraje, "", new { @class = "text-danger" })
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">kilometraje Actual:&nbsp;<span class="text-danger">*</span></label>
                                                    <div class="col-md-6">
                                                        @Html.EditorFor(model => model.kilometraje_nuevo, new { htmlAttributes = new { @class = "form-control", @required = "required", @placeholder = "Digite kilometraje", @readonly = "readonly" } })
                                                        @Html.ValidationMessageFor(model => model.kilometraje_nuevo, "", new { @class = "text-danger" })
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                    </div>


                                </div>
                            </div>

                            <div class="hpanel" id="areaPanelCliente" style="display:none;">
                                <div class="panel-heading hbuilt" style="background-color:#e4e5e7">
                                    <div class="panel-tools">
                                        <a class="showhide"><i class="fa fa-chevron-up"></i></a>

                                    </div>
                                    <i class="fa fa-user-circle-o"></i>&nbsp;&nbsp;&nbsp;Datos Propietario
                                </div>
                                <div class="panel-body">

                                    <div class="row">

                                        <div class="row">
                                            <div class="col-sm-6" id="areaTxtBuscarDocumento">
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">Documento:&nbsp;<span class="text-danger">*</span></label>
                                                    <div class="col-md-6">
                                                        @Html.EditorFor(model => model.txtDocumentoCliente, new { htmlAttributes = new { @class = "form-control", @placeholder = "Digite numero documento" } })
                                                    </div>
                                                    <div class="col-md-2">
                                                        <button type="button" class="btn btn-primary" id="btnBuscarCliente"><i class="fa fa-search"></i></button>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-sm-6" style="display:none;" id="documentoNoEncontrado">
                                                <div class="form-group">
                                                    <label class="control-label col-md-10">Propietario no encontrado, puede buscarlo o&nbsp;<a class="btn btn-link" href="../../terceros?menu=@ViewBag.id_menu">&nbsp;Crear cliente aqui&nbsp;&nbsp;<i class="fa fa-user-circle-o"></i></a>&nbsp;</label>

                                                </div>
                                            </div>

                                        </div>

                                        <div class="areaClienteOculta" style="display:none;">
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">Documento:&nbsp;</label>
                                                    <div class="col-md-6">
                                                        <p id="documentoBuscado"></p>
                                                        <input type="hidden" value="" name="documentoBuscadoCliente" id="documentoBuscadoCliente" />
                                                        <input type="hidden" name="docTerceroBuscado" id="docTerceroBuscado" value="" />
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">Nombre:&nbsp;</label>
                                                    <div class="col-md-6">
                                                        <p id="nombreBuscado"></p>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">Telefono:&nbsp;</label>
                                                    <div class="col-md-6">
                                                        <p id="telefonoBuscado"></p>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">Celular:&nbsp;</label>
                                                    <div class="col-md-6">
                                                        <p id="celularBuscado"></p>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="row">
                                                <div class="col-sm-6">
                                                    <div class="form-group">
                                                        <label class="control-label col-md-4">Email:&nbsp;</label>
                                                        <div class="col-md-6">
                                                            <p id="emailBuscado"></p>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="col-sm-6">
                                                    <div class="form-group">
                                                        <label class="control-label col-md-4">Ciudad:&nbsp;</label>
                                                        <div class="col-md-6">
                                                            <p id="ciudadBuscado"></p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="row">

                                                <div class="col-sm-6">
                                                    <div class="form-group">
                                                        <label class="control-label col-md-4">Contacto:&nbsp;</label>
                                                        <div class="col-md-6">
                                                            <input type="text" id="contacto" name="name" value="@ViewBag.contacto" class="form-control" readonly />
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="col-sm-6">
                                                    <div class="form-group">
                                                        <label class="control-label col-md-4">Telefono Contacto:&nbsp;</label>
                                                        <div class="col-md-6">
                                                            <input type="text" id="tel_contacto" name="name" value="@ViewBag.telcontacto" class="form-control" readonly />
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>



                            @*/**********************************************************************************************************************************************************************************************************/*@
                            <div class="hpanel" id="tareasInspeccion" style="display:none">
                                <div class="panel-heading hbuilt" style="background-color:#e4e5e7">
                                    <div class="panel-tools">
                                        <a class="showhide"><i class="fa fa-chevron-up"></i></a>
                                    </div>
                                    <i class="fa fa-clone"></i>&nbsp;&nbsp;&nbsp;Adicionales de Inspección
                                </div>
                                <div class="panel-body">
                                    <div class="row">
                                        <div class="row">
                                            <div class="col-md-12 text-center">
                                                <h4><label class="label label-default">Tareas Solicitadas en Inspección</label></h4>
                                            </div>
                                        </div>

                                        <div class="col-md-12">
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <input type="hidden" name="numeroTareas" id="numeroTareas" value="" />
                                                    <div class="table-responsive">
                                                        <div id="div-mensaje-buscar"></div>
                                                        <table class="table table-striped table-bordered table-hover" id="tablaTareas">
                                                            <thead>
                                                                <tr>
                                                                    <th style="text-align:center">Tarea Inspección</th>
                                                                    <th style="text-align:center">Cantidad</th>
                                                                    <th style="text-align:center">Valor</th>
                                                                    <th style="text-align:center">Fecha Autorización</th>
                                                                    <th style="text-align:center">Autorizar</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody></tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            @*/**********************************************************************************************************************************************************************************************************/*@



                            <div class="panel-body-btns text-right">


                                <a class="btn  btn-danger col-md-2" id="btncerrarsinop" name="btncerrarsinop" style="display: none;"><i class="fa fa-times-circle"></i>&nbsp;&nbsp;&nbsp;Cerrar sin operacion</a>
                                &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                                <button class="btn btn-info" type="submit"><i class="fa fa-save"></i>&nbsp;&nbsp;&nbsp;Guardar</button>
                            </div>

                        </div>
                        }
                </div>
            </div>
            <div id="recepcion" class="tab-pane">
                <div class="panel-body">

                    <div class="hpanel">
                        <div class="panel-heading hbuilt" style="background-color:#e4e5e7">
                            <div class="panel-tools">
                                <a class="showhide"><i class="fa fa-chevron-up"></i></a>

                            </div>
                            <i class="fa fa-calendar"></i>&nbsp;&nbsp;&nbsp;Parametros De Entrega
                        </div>
                        <div class="panel-body">
                            <div class="row">

                            </div>
                            <br />
                            <div class="row">


                                <div class="row">

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Entrega:&nbsp;</label>
                                            <div class="col-md-4">
                                                @Html.Editor("txtEntregaEstimado", new { htmlAttributes = new { @class = "form-control", @required = "required", @placeholder = "Fecha entrega estimada", @readonly = "readonly" } })
                                            </div>
                                            <div class="col-md-4">

                                                <button type="button" class="btn btn-primary" id="btncambiofecha" onclick="abrirmodalfecha()"><i class="fa fa-calendar"></i>&nbsp;</button>

                                            </div>

                                        </div>
                                    </div>

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Notas:</label>
                                            <div class="col-md-6">
                                                @Html.TextAreaFor(m => m.notas, new RouteValueDictionary(new { @class = "someClass", style = "width: 100%; height:80px;" }))
                                                @Html.ValidationMessageFor(model => model.notas, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>




                                </div>

                            </div>
                        </div>
                    </div>

                    <div class="hpanel">
                        <div class="panel-heading hbuilt" style="background-color:#e4e5e7">
                            <div class="panel-tools">
                                <a class="showhide"><i class="fa fa-chevron-up"></i></a>

                            </div>
                            <i class="fa fa-clone"></i>&nbsp;&nbsp;&nbsp;Síntomas
                        </div>
                        <div class="panel-body">

                            <div class="row">

                                <div class="row">

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Síntoma:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                <input type="text" class="form-control" id="txtSolicitudCliente" name="txtSolicitudCliente" placeholder="Digite Síntoma" />
                                            </div>
                                        </div>
                                    </div>

                                </div>

                                <div class="row">
                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4"></label>
                                            <div class="col-md-6">
                                                <button type="button" class="btn btn-primary" id="btnAgregarSolicitud"><i class="fa fa-plus"></i>&nbsp;agregar</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-12 text-center">
                                        <h4><label class="label label-default">Síntomas Presentadas</label></h4>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-12">
                                        <div class="form-group">
                                            <div class="table-responsive">
                                                <div id="div-mensaje-buscar"></div>
                                                <table class="table table-striped table-bordered table-hover" id="tablaSolicitudes">
                                                    <thead>
                                                        <tr>
                                                            <th style="text-align:center">Síntomas Cliente</th>
                                                            <th style="text-align:center">Respuesta Taller</th>
                                                            <th style="text-align:center">Acción</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody></tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    @if (@ViewBag.mostrarsignos == 1)
                                        {  
                                        <button class="btn btn-primary" onclick="inspeccionVhSig(1)"><i class="fa fa-wrench"></i>  Inspeccion Signos Vitales</button>
                              
                                                                                }

                                                <button class="btn btn btn-danger " type="button" id="cotizacion" name="cotizacion" disabled="disabled"><i class="fa fa-file-pdf-o">&nbsp;Imprimir Presupuesto</i></button>
                                        
                                         
                                                <button class="btn btn-success " type="button" id="Pdf_OT" name="Pdf_OT"><i class="fa fa-file-pdf-o">&nbsp;Imprimir OT</i></button>
                                          
                                       
                                                <label>Checklist Inicial de vehiculo</label>
                                                <input type="checkbox" id="listinicialvh" name="listinicialvh" class="form-check" />
                                      


                                        </div>
                                    </div>
                        </div>
                    </div>

                    <div class="hpanel" id="hpanelaverias">
                        <div class="panel-heading hbuilt" style="background-color:#e4e5e7">
                            <div class="panel-tools">
                                <a class="showhide"><i class="fa fa-chevron-up"></i></a>

                            </div>
                            <i class="fa fa-wrench"></i>&nbsp;&nbsp;&nbsp;Averias
                        </div>
                        <div class="panel-body">

                            <div class="row">
                                <div class="row">
                                    <div class="col-md-12 text-center">
                                        <h4><label class="label label-default">Averias Presentadas</label></h4>
                                    </div>
                                </div>

                                <div class="col-sm-12">
                                    <div class="form-group">
                                        <div class="form-group">
                                            <div class="table-responsive">
                                                <div id="div-mensaje-buscar"></div>
                                                <table class="table table-striped table-bordered table-hover" id="tabla_averias">
                                                    <thead>
                                                        <tr>
                                                            <th style="text-align:center">Plan Mayor</th>
                                                            <th style="text-align:center">Fecha</th>
                                                            <th style="text-align:center">Descripción</th>
                                                            <th style="text-align:center">Averia</th>
                                                            <th style="text-align:center">Impacto</th>
                                                            <th style="text-align:center">Zona</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody></tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="hpanel">
                        <div class="panel-heading hbuilt" style="background-color:#e4e5e7">
                            <div class="panel-tools">
                                <a class="showhide"><i class="fa fa-chevron-up"></i></a>
                            </div>
                            <i class="fa fa-cogs"></i>&nbsp;&nbsp;&nbsp;Insumos
                        </div>
                        <div class="panel-body">
                            <div class="row">
                                <div class="row">

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Insumo:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                @Html.DropDownList("insumo", null, "", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione" })
                                            </div>
                                        </div>
                                    </div>


                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Porcentaje:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                @Html.Editor("porcentaje", new { htmlAttributes = new { @class = "form-control", @placeholder = "Digite cantidad" } })
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Tarifa:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                @Html.DropDownList("tarifainsumo", null, "", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione" })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <div class="col-md-6 col-md-offset-4">
                                                <button type="button" class="btn btn-primary" onclick="CalcularInsumo()">&nbsp;&nbsp;Calcular</button>
                                            </div>
                                        </div>
                                    </div>


                                </div>


                                <div class="col-md-12">
                                    <div class="table-responsive">
                                        <div id="div-mensaje-buscar"></div>
                                        <table class="table table-striped table-bordered table-hover" id="tablainsumos">
                                            <thead>
                                                <tr>
                                                    <th style="text-align:center">Código</th>
                                                    <th style="text-align:center">Descripciòn</th>
                                                    <th style="text-align:center">Tipo Tarifa</th>
                                                    <th style="text-align:center">Porcentaje</th>
                                                    <th style="text-align:center">Valor Tarifa</th>
                                                    <th style="text-align:center">Valor Horas</th>
                                                    <th style="text-align:center">Accion</th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>

                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label class="control-label col-md-4">Total Valor Insumos:</label>
                                        <div class="col-md-6">
                                            @Html.Editor("totalinsumos", new { htmlAttributes = new { @class = "form-control", @placeholder = "Total Insumos", @readonly = "true" } })
                                        </div>
                                    </div>
                                </div>



                            </div>
                        </div>
                    </div>

                    <div class="hpanel">
                        <div class="panel-heading hbuilt" style="background-color:#e4e5e7">
                            <div class="panel-tools">
                                <a class="showhide"><i class="fa fa-chevron-up"></i></a>
                            </div>
                            <i class="fa fa-cogs"></i>&nbsp;&nbsp;&nbsp;Combos
                        </div>
                        <div class="panel-body">
                            <div class="row">
                                <div class="row">

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Nombre del combo:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                @Html.DropDownList("comboot", null, "", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione" })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <div class="col-md-6 col-md-offset-4">
                                                <button type="button" class="btn btn-primary" onclick="AgregarComboot()">&nbsp;&nbsp;Agregar</button>
                                            </div>
                                        </div>
                                    </div>


                                </div>


                                <div class="col-md-12">
                                    <div class="table-responsive">
                                        <div id="div-mensaje-buscar"></div>
                                        <table class="table table-striped table-bordered table-hover" id="tablacombos">
                                            <thead>
                                                <tr>
                                                    <th style="text-align:center">Código</th>
                                                    <th style="text-align:center">Nombre</th>
                                                    <th style="text-align:center">Horas Cliente</th>
                                                    <th style="text-align:center">Horas Operario</th>
                                                    <th style="text-align:center">Tarifa</th>
                                                    <th style="text-align:center">Valor Horas</th>
                                                    <th style="text-align:center">Accion</th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>

                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label class="control-label col-md-4">Total Valor Combo:</label>
                                        <div class="col-md-6">
                                            @Html.Editor("totalcombo", new { htmlAttributes = new { @class = "form-control", @placeholder = "Total Combo", @readonly = "true" } })
                                        </div>
                                    </div>
                                </div>



                            </div>
                        </div>
                    </div>
                    <div class="hpanel">
                        <div class="panel-heading hbuilt" style="background-color:#e4e5e7">
                            <div class="panel-tools">
                                <a class="showhide"><i class="fa fa-chevron-up"></i></a>
                            </div>
                            <i class="fa fa-cogs"></i>&nbsp;&nbsp;&nbsp;Operaciones
                        </div>
                        <div class="panel-body">
                            <div class="row">
                                <div class="row">
                                    @*<div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="control-label col-md-4">Tipo Tarifa:&nbsp;<span class="text-danger">*</span></label>
                                                <div class="col-md-6">
                                                    @Html.DropDownList("tipoTarifa", null, "", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione" })
                                                    <input type="hidden" name="nitTipoTarifa" id="nitTipoTarifa" value="" />
                                                </div>
                                            </div>
                                        </div>*@

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Operación:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                @Html.DropDownList("operacionesTempario", null, "", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione" })
                                            </div>
                                        </div>
                                    </div>



                                    @*<div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="control-label col-md-4">Descuento (%):</label>
                                                <div class="col-md-6">
                                                    @Html.Editor("txtDescuentoOperacion", new { htmlAttributes = new { @class = "form-control", @placeholder = "Digite descuento" } })
                                                </div>
                                            </div>
                                        </div>*@

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <div class="col-md-6 col-md-offset-4">
                                                <button type="button" class="btn btn-primary" id="btnAgregarOperacion"><i class="fa fa-plus"></i>&nbsp;&nbsp;Agregar</button>
                                                <button type="button" class="btn btn-success" id="btnGarantia" onclick="agregarGarantia()"><i class="fa fa-file-archive-o"></i>&nbsp;&nbsp;Garantía</button>
                                                <button type="button" class="btn btn-default" id="btnenviarsmsopera" onclick="enviomsm2()"><i class="fa fa-envelope-o"></i>&nbsp;&nbsp;Enviar autoriizacion</button>

                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-12 text-center" style="display:none;" id="alertaAgregarOperacion">
                                        <div class="form-group">
                                            <div class="col-md-12">
                                                <div class="alert alert-info">
                                                    <strong>Alerta!</strong><p id="mensajeAlertaAgregarOperacion"></p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>


                                <div class="col-md-12">
                                    <div class="table-responsive">
                                        <div id="div-mensaje-buscar"></div>
                                        <table class="table table-striped table-bordered table-hover" id="tablaOperacionesPorPlaca">
                                            <thead>
                                                <tr>
                                                    <th style="text-align:center">Código</th>
                                                    <th style="text-align:center">Operación</th>
                                                    <th style="text-align:center">Tecnico</th>
                                                    <th style="text-align:center">Tiempo</th>

                                                    <th style="text-align:center">Valor Total</th>
                                                    <th style="text-align:center">Autorizacion</th>

                                                    <th style="text-align:center">Autorizacion Solicitada</th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>

                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label class="control-label col-md-4">Total Valor Operaciones:</label>
                                        <div class="col-md-6">
                                            @Html.Editor("totaloperaciones", new { htmlAttributes = new { @class = "form-control", @placeholder = "Total Operaciones", @readonly = "true" } })
                                        </div>
                                    </div>
                                </div>



                            </div>
                        </div>
                    </div>

                    <div class="hpanel">
                        <div class="panel-heading hbuilt" style="background-color:#e4e5e7">
                            <div class="panel-tools">
                                <a class="showhide"><i class="fa fa-chevron-up"></i></a>
                            </div>
                            <i class="fa fa-cogs"></i>&nbsp;&nbsp;&nbsp;Repuestos
                        </div>
                        <div class="panel-body">
                            <div class="row">
                                <div class="col-sm-12">
                                    <div class="form-group">
                                        <div class="panel-body-btns text-right">
                                            <a class="btn btn-info" href="@ViewBag.linkrepuestos" target="_blank"><i class="fa fa-car"></i>&nbsp;&nbsp;&nbsp;Catálogo de Repuestos</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">

                                @Html.Hidden("nombre_repuesto")

                                <div class="row">
                                    <div class="col-lg-12">
                                        <div class="form-group">
                                            <label class="control-label col-md-6">Tipo de repuesto:<span class="text-danger">*&nbsp;</span></label>
                                            <div class="col-md-6">
                                                <input type="checkbox" name="tipoRepuesto" id="tipoRepuesto" value="" data_toggle="toggle" data_size="mini" checked />
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">

                                    @*<div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="control-label col-md-4">Tipo Tarifa:&nbsp;<span class="text-danger">*</span></label>
                                                <div class="col-md-6">
                                                    @Html.DropDownList("tipoTarifaR", null, "", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione" })
                                                </div>
                                            </div>
                                        </div>*@

                                    <div class="col-sm-6" id="rOficial">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Referencia:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                @Html.DropDownList("repuestos", null, "", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione" })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6" style="display:none" id="rGenerico">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Referencia Generica:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                @Html.DropDownList("repuestosG", null, "", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione" })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Cantidad:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                @Html.Editor("txtCantidadRepuesto", new { htmlAttributes = new { @class = "form-control", @placeholder = "Digite cantidad" } })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Precio Unitario:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                @Html.Editor("txtPrecioRepuesto", new { htmlAttributes = new { @class = "form-control", @placeholder = "Digite precio", @readonly = "readonly" } })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Iva:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-3" style="display:none">
                                                @Html.Editor("txtPorIvaRepuesto", new { htmlAttributes = new { @class = "form-control", @placeholder = "Iva (%)", @readonly = "readonly" } })
                                            </div>
                                            <div class="col-md-3">
                                                @Html.Editor("txtValorIvaRepuesto", new { htmlAttributes = new { @class = "form-control", @placeholder = "Iva ($)", @readonly = "readonly" } })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6" style="display:none">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Descuento:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-3">
                                                @Html.Editor("txtPorDsctoRepuesto", new { htmlAttributes = new { @class = "form-control", @placeholder = "Descuento (%)", @readonly = "readonly" } })
                                            </div>
                                            <div class="col-md-3">
                                                @Html.Editor("txtValorDsctoRepuesto", new { htmlAttributes = new { @class = "form-control", @placeholder = "Descuento ($)", @readonly = "readonly" } })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <div class="col-md-6 col-md-offset-4">
                                                <button type="button" class="btn btn-primary" id="btnAgregarRepuesto"><i class="fa fa-plus"></i>&nbsp;&nbsp;Agregar</button>
                                            </div>
                                        </div>
                                    </div>
                                    <input type="hidden" id="totakopera" />
                                    <div class="col-sm-12 text-center" style="display:none;" id="alertaAgregarRepuesto">
                                        <div class="form-group">
                                            <div class="col-md-12">
                                                <div class="alert alert-info">
                                                    <strong>Alerta!</strong><p id="mensajeAlertaAgregarRepuesto"></p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>

                                <div class="col-sm-12 col-md-12 col-lg-12">
                                    <p><strong> Leyendas</strong></p>
                                    <div class="col-sm-2 col-md-2 col-lg-2" style="text-align:center">
                                        <button type="button" class="btn btn-sm btn-success btn-circle">&nbsp;</button><strong>Stock en bodega</strong>
                                    </div>
                                    <div class="col-sm-2 col-md-2 col-lg-2" style="text-align:center">
                                        <button type="button" class="btn btn-sm btn-warning btn-circle">&nbsp;</button><strong> Stock en Otra Bodega</strong>
                                    </div>
                                    <div class="col-sm-2 col-md-2 col-lg-2" style="text-align:center">
                                        <button type="button" class="btn btn-sm btn-warning2 btn-circle">&nbsp;</button><strong> Stock en referencia reemplazo</strong>
                                    </div>
                                    <div class="col-sm-2 col-md-2 col-lg-2" style="text-align:center">
                                        <button type="button" class="btn btn-sm btn-danger btn-circle">&nbsp;</button><strong> NO hay stock</strong>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="table-responsive">
                                        <div id="div-mensaje-buscar"></div>
                                        <table class="table table-striped table-bordered table-hover" id="tablaRepuestosPorPlaca">
                                            <thead>
                                                <tr>
                                                    <th style="text-align:center">Código</th>
                                                    <th style="text-align:center">Descripción</th>
                                                    <th style="text-align:center">Cantidad</th>
                                                    <th style="text-align:center">Precio Unitario</th>
                                                    @*<th style="text-align:center">Iva (%)</th>*@
                                                    <th style="text-align:center">Iva ($)</th>
                                                    @*<th style="text-align:center">Descuento (%)</th>
                                                        <th style="text-align:center">Descuento ($)</th>*@
                                                    <th style="text-align:center">Total</th>
                                                    <th style="text-align:center">Stock</th>
                                                    <th style="text-align:center">Solicitar</th>
                                                    <th style="text-align:center">Estado Solicitud</th>
                                                    <th style="text-align:center">Acción</th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                        <input type="hidden" value="" name="numeroRepuestos" id="numeroRepuestos" />
                                    </div>
                                </div>

                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label class="control-label col-md-4">Total Valor Repuestos:</label>
                                        <div class="col-md-6">
                                            @Html.Editor("total_repuestos", new { htmlAttributes = new { @class = "form-control", @placeholder = "Total Operaciones", @readonly = "true" } })
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-12" style="display:none">
                                    <div class="table-responsive">
                                        <div id="div-mensaje-buscar"></div>
                                        <table class="table table-striped table-bordered table-hover" id="tablaSolicitudRepuestos">
                                            <thead>
                                                <tr>
                                                    <th style="text-align:center">Código</th>
                                                    <th style="text-align:center">Cantidad</th>
                                                    <th style="text-align:center">Precio Unitario</th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <div class="panel-body-btns text-right">
                                        <button class="btn btn-primary" type="button" id="btnSolicitarRepuestos" style="display:none" disabled><i class="fa fa-save"></i>&nbsp;&nbsp;&nbsp;Solicitar</button>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    @*<div class="alert alert-info" role="alert">
                                            <p>Para solicitar los repuestos primero debes haber guardado la orden</p>
                                        </div>*@
                                    <div class="alert alert-success" role="alert" style="display:none;" id="alertaSolicitudGuardadaRepuesto">
                                        <p id="msjSolicitud"></p>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-12">
                                <div class="table-responsive">
                                    <div id="div-mensaje-buscar"></div>
                                    <table class="table table-striped table-bordered table-hover" id="tablaRepuestosSolicitudes">
                                        <thead>
                                            <tr>
                                                <th style="text-align:center"># Solicitud</th>
                                                <th style="text-align:center">Repuesto</th>
                                                <th style="text-align:center">Cantidad Solicitada</th>
                                                <th style="text-align:center">Precio Unitario</th>
                                                <th style="text-align:center">Fecha de Solicitud</th>
                                                <th style="text-align:center">Recibido</th>
                                                <th style="text-align:center">Fecha de Recepción</th>
                                                <th style="text-align:center">Cantidad Recepcion</th>
                                                <th style="text-align:center">Estado Solicitud</th>
                                            </tr>
                                        </thead>
                                        <tbody></tbody>
                                    </table>
                                </div>
                            </div>

                            <br />
                        </div>
                    </div>


                    <div id="modalcambiofechaentrega" class="modal" tabindex="-1" aria-hidden="true" role="dialog">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="color-line"></div>
                                <div class="modal-header text-center">
                                    @*<button type="button" class="close" data-dismiss="modal">&times;</button>*@
                                    <h4 class="modal-title">Cambio de fecha de entrega OT No. <span id="numCamot"></span></h4>
                                </div>
                                <div class="modal-body">
                                    <div class="row">
                                        <label>Fecha</label>
                                        <input type="text" class="form-control fechas2" id="Nfechaentrega" />
                                    </div>
                                    <br />
                                    <div class="row">
                                        <textarea id="obsCamFecha" class="form-control" cols="5"></textarea>
                                    </div>

                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal" id="cerrarModalOrdenCreada">Cerrar</button>
                                    <button type="button" class="btn btn-secondary" onclick="GuardarNuevaFecha()">Guardar</button>

                                </div>
                            </div>
                        </div>
                    </div>



                </div>
            </div>
            <div id="inspeccion" class="tab-pane">
                <div class="panel-body">
                    <div id="dv_sistemasVh">
                    </div>
                    <div id="dv_operacionesVh">
                        @if (Request["id"] != null || !Request.Url.Segments[3].IsEmpty())
                            {
                            var id_url = (Request["id"] != null) ? Request["id"] : Request.Url.Segments[3];
                            @Html.Action("tablasVw", "SignosVitales", new { ot_id = id_url });
                            }
                    </div>
                </div>
            </div>
            <div id="repuestosSolicitados" class="tab-pane">
                <div class="panel-body">
                    <div class="hpanel">
                        <div class="panel-heading hbuilt" style="background-color:#e4e5e7">
                            <div class="panel-tools">
                                <a class="showhide"><i class="fa fa-chevron-up"></i></a>

                            </div>
                            <i class="fa fa-gears"></i>&nbsp;&nbsp;&nbsp;Repuestos Solicitados
                        </div>

                        <div class="panel-body">
                            <div class="panel-body-busqueda">
                                <div class="col-md-12">
                                    <div class="table-responsive">
                                        <div id="div-mensaje-buscar"></div>
                                        <table class="table table-striped table-bordered table-hover" id="tablaRepuestosSolicitudes2">
                                            <thead>
                                                <tr>
                                                    <th style="text-align:center"># Solicitud</th>
                                                    <th style="text-align:center">Repuesto</th>
                                                    <th style="text-align:center">Cantidad Solicitada</th>
                                                    <th style="text-align:center">Precio Unitario</th>
                                                    <th style="text-align:center">Fecha de Solicitud</th>
                                                    <th style="text-align:center">Recibido</th>
                                                    <th style="text-align:center">Fecha de Recepción</th>
                                                    <th style="text-align:center">Cantidad Recepcion</th>
                                                    <th style="text-align:center">Estado Solicitud</th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>

                    <div class="hpanel">
                        <div class="panel-heading hbuilt" style="background-color:#e4e5e7">
                            <div class="panel-tools">
                                <a class="showhide"><i class="fa fa-chevron-up"></i></a>

                            </div>
                            <i class="fa fa-gears"></i>&nbsp;&nbsp;&nbsp;Repuestos Recibidos
                        </div>

                        <div class="panel-body">
                            <div class="panel-body-busqueda">
                                <div class="col-md-12">
                                    <div class="table-responsive">
                                        <div id="div-mensaje-buscar"></div>
                                        <table class="table table-striped table-bordered table-hover" id="tablaRepuestosTrasladados">
                                            <thead>
                                                <tr>
                                                    <th style="text-align:center"># Traslado</th>
                                                    <th style="text-align:center">Repuesto</th>
                                                    <th style="text-align:center">Cantidad</th>
                                                    <th style="text-align:center">Precio Unitario</th>
                                                    @*<th style="text-align:center">Iva (%)</th>*@
                                                    <th style="text-align:center">Iva ($)</th>
                                                    @*<th style="text-align:center">Descuento (%)</th>
                                                        <th style="text-align:center">Descuento ($)</th>*@
                                                    <th style="text-align:center">Total</th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>

                    <div class="col-md-6">
                        <button type="button" name="btnEjecutarOT" id="btnEjecutarOT" class="btn btn-sm btn-info" style="display:none"><i class="fa fa-play"></i>&nbsp;Comenzar Operacion</button>
                    </div>
                </div>
            </div>
            <div id="ejecucion" class="tab-pane">
                <div class="panel-body">

                    <div class="hpanel">
                        <div class="panel-heading hbuilt" style="background-color:#e4e5e7">
                            <div class="panel-tools">
                                <a class="showhide"><i class="fa fa-chevron-up"></i></a>

                            </div>
                            <i class="fa fa-gears"></i>&nbsp;&nbsp;&nbsp;Repuestos Recibidos
                        </div>

                        <div class="panel-body">


                        </div>
                    </div>
                    <div class="hpanel">
                        <div class="panel-heading hbuilt" style="background-color:#e4e5e7">
                            <div class="panel-tools">
                                <a class="showhide"><i class="fa fa-chevron-up"></i></a>

                            </div>
                            <i class="fa fa-gears"></i>&nbsp;&nbsp;&nbsp;Tracking de Eventos
                        </div>

                        <div class="panel-body">

                            <div class="panel-body-busqueda">
                                <div class="col-md-12">
                                    <div class="table-responsive">
                                        <div id="div-mensaje-buscar"></div>
                                        <table class="table table-striped table-bordered table-hover" id="trackingEventos">
                                            <thead>
                                                <tr>
                                                    <th style="text-align:center">#</th>
                                                    <th style="text-align:center">Descripcion</th>
                                                    <th style="text-align:center">Observacion</th>
                                                    <th style="text-align:center">Estado de OT</th>
                                                    <th style="text-align:center">Responsable</th>
                                                    <th style="text-align:center">Fecha</th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>



                    <div class="col-md-6">
                        <button type="button" name="btnFinalizarOT" id="btnFinalizarOT" class="btn btn-sm btn-info" style="display:none"><i class="fa fa-hand-paper-o"></i>&nbsp;Finalizar Operaciones</button>
                    </div>
                </div>
            </div>
            <div id="Historial" class="tab-pane">
                <div class="panel-body">
                    <div class="panel-body-busqueda">
                        <div class="table-responsive">
                            <div id="div-mensaje-buscar"></div>
                            <div class="row">
                                <div class="col-md-8">
                                    <div class="form-group">
                                        <label class="control-label col-md-2">Fecha Desde:&nbsp;<span class="text-danger">*</span></label>
                                        <div class="col-md-4">
                                            <input type="date" class="form-control" id="fechadesde" name="fechadesde" required="required">
                                        </div>
                                        <label class="control-label col-md-2">Fecha Hasta:&nbsp;<span class="text-danger">*</span></label>
                                        <div class="col-md-4">
                                            <input type="date" class="form-control" id="fechahasta" name="fechahasta" required="required">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <button type="button" class="btn btn-primary" id="btnFiltrarhisto"><i class="fa fa-filter" aria-hidden="true"></i>&nbsp;&nbsp;Filtrar</button>
                                </div>

                            </div>

                            <table class="table table-striped table-bordered table-hover" id="tablaPaginadahistorial">
                                <thead>
                                    <tr>
                                        <th style="text-align:center">Kilometraje Inicial</th>
                                        <th style="text-align:center">Fecha de ingreso</th>
                                        <th style="text-align:center">Ot Generada</th>
                                        <th style="text-align:center">Operaciones</th>
                                        <th style="text-align:center">Sintomas </th>
                                        <th style="text-align:center">Repuestos</th>

                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>

                    </div>
                </div>
            </div>
            <div id="TOT" class="tab-pane">
                <div class="panel-body">
                    <div class="panel-body-busqueda">
                        <div class="table-responsive">
                            <div id="div-mensaje-buscar"></div>
                            <div class="panel-body-btns text-right">
                                <button type="button" class="btn btn-primary" onclick="CrearTOTliq()" id="btncrerrartotl" style="display: none;">&nbsp;&nbsp;Crear TOT</button>
                            </div>
                            <div class="row">
                                <div class="col-md-3">
                                    <label>Consulta</label>
                                    <input type="text" id="buscartxt" class="form-control" />
                                </div>
                                <div class="col-md-3">
                                    <label>Fecha Desde</label>
                                    <input type="text" id="fechaini" class="form-control fechas" />
                                </div>
                                <div class="col-md-3">
                                    <label>Fecha Hasta</label>
                                    <input type="text" id="fechafin" class="form-control fechas" />
                                </div>
                                <div class="col-md-3">
                                    <button class="btn btn-outline-primary" onclick="Filtrar()">Consultar</button>
                                </div>
                            </div>


                            <table class="table table-striped table-bordered table-hover" id="tablaPaginadatot">
                                <thead>
                                    <tr>
                                        <th style="text-align:center">TOT</th>
                                        <th style="text-align:center">Fecha</th>
                                        <th style="text-align:center">Proveedor</th>
                                        <th style="text-align:center">Operaciones</th>
                                        <th style="text-align:center">Repuestos</th>
                                        <th style="text-align:center">Valor Total</th>

                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>


            </div>
            <div id="buscar" class="tab-pane">
                <div class="panel-body">
                    <div class="panel-body-busqueda">
                        <div class="table-responsive">
                            <div id="div-mensaje-buscar"></div>
                            <div class="row">
                                <div class="col-md-8">
                                    <div class="form-group">
                                        <label class="control-label col-md-2">Fecha Desde:&nbsp;<span class="text-danger">*</span></label>
                                        <div class="col-md-4">
                                            @Html.Editor("fechadesde", new { htmlAttributes = new { @class = "form-control", @type = "text", @placeholder = "Ingrese fecha", @required = "required" } })
                                        </div>
                                        <label class="control-label col-md-2">Fecha Hasta:&nbsp;<span class="text-danger">*</span></label>
                                        <div class="col-md-4">
                                            @Html.Editor("fechahasta", new { htmlAttributes = new { @class = "form-control", @type = "text", @placeholder = "Ingrese fecha", @required = "required" } })
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">

                                </div>

                            </div>


                            <table class="table table-striped table-bordered table-hover" id="tablaPaginada">
                                <thead>
                                    <tr>
                                        <th style="text-align:center">Codigo Orden</th>
                                        <th style="text-align:center">Documento</th>
                                        <th style="text-align:center">Cliente</th>
                                        <th style="text-align:center">Placa</th>
                                        <th style="text-align:center">Descripcion</th>
                                        <th style="text-align:center">Fecha</th>
                                        <th style="text-align:center">Acción</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>

                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<div id="modalEditarSolicitudCliente" class="modal hmodal-success" tabindex="-1" aria-hidden="true" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="color-line"></div>
            <div class="modal-header text-center">
                @*<button type="button" class="close" data-dismiss="modal">&times;</button>*@
                <h4 class="modal-title">Editar Solicitud</h4>
            </div>
            <div class="modal-body">

                <input type="hidden" id="txtIdFilaEditada" />
                <input type="hidden" id="txtIdSolicitudEditada" />

                <div class="row" style="text-align:center;">
                    <div class="col-sm-12">
                        <div class="form-group">
                            <label class="control-label col-md-2">Solicitud:&nbsp;</label>
                            <div class="col-md-8">
                                <input type="text" class="form-control" id="txtSolicitudClienteEditar" name="txtSolicitudClienteEditar" placeholder="Digite solicitud del cliente" readonly />
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row" style="text-align:center;">
                    <div class="col-sm-12">
                        <div class="form-group">
                            <label class="control-label col-md-2">Respuesta:&nbsp;</label>
                            <div class="col-md-8">
                                <input type="text" class="form-control" id="txtRespuestaClienteEditar" name="txtRespuestaClienteEditar" placeholder="Digite respuesta a solicitud" />
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="btnEditarSolicitud">Aceptar</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal" id="cerrarModal">Cancelar</button>
            </div>
        </div>
    </div>
</div>

<div id="modalOrdenCreada" class="modal" tabindex="-1" aria-hidden="true" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="color-line"></div>
            <div class="modal-header text-center">
                @*<button type="button" class="close" data-dismiss="modal">&times;</button>*@
                <h4 class="modal-title">Orden de taller registrada con éxito</h4>
            </div>
            <div class="modal-body">
                <div class="row" style="text-align:center;">
                    <h4>Se Creó la orden de taller</h4> <h3><span class="label label-default">@TempData["mensaje"]</span></h3>
                </div>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal" id="cerrarModalOrdenCreada">Cerrar</button>
            </div>
        </div>
    </div>
</div>

<div id="modalEditarReferencia" class="modal hmodal-success" tabindex="-1" aria-hidden="true" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="color-line"></div>
            <div class="modal-header text-center">
                @*<button type="button" class="close" data-dismiss="modal">&times;</button>*@
                <h4 class="modal-title">Editar Referencia</h4>
                <small class="font-bold">Referencias que se asignaran a la orden de taller.</small>
            </div>
            <div class="modal-body">

                <input type="hidden" id="txtIdFilaEditadaRepuesto" />

                <div class="col-sm-12">
                    <div class="form-group">
                        <label class="control-label col-md-4">Referencia:&nbsp;<span class="text-danger">*</span></label>
                        <div class="col-md-6">
                            @Html.Editor("txtCodigoReferencia", new { htmlAttributes = new { @class = "form-control", @placeholder = "Nombre Referencia", @readonly = "readonly" } })
                        </div>
                    </div>
                </div>

                <div class="col-sm-12">
                    <div class="form-group">
                        <label class="control-label col-md-4">Nombre:&nbsp;<span class="text-danger">*</span></label>
                        <div class="col-md-6">
                            @Html.Editor("txtNombreReferencia", new { htmlAttributes = new { @class = "form-control", @placeholder = "Nombre Referencia", @readonly = "readonly" } })
                        </div>
                    </div>
                </div>

                <div class="col-sm-12">
                    <div class="form-group">
                        <label class="control-label col-md-4">Cantidad:&nbsp;<span class="text-danger">*</span></label>
                        <div class="col-md-6">
                            @Html.Editor("txtCantidadReferencia", new { htmlAttributes = new { @class = "form-control", @placeholder = "Cantidad Referencia" } })
                        </div>
                    </div>
                </div>

                <div class="col-sm-12">
                    <div class="form-group">
                        <label class="control-label col-md-4">Precio:&nbsp;<span class="text-danger">*</span></label>
                        <div class="col-md-6">
                            @Html.Editor("txtPrecioReferencia", new { htmlAttributes = new { @class = "form-control", @placeholder = "Precio Referencia", @readonly = "readonly" } })
                        </div>
                    </div>
                </div>

                <div class="col-sm-12" style="display:none">
                    <div class="form-group">
                        <label class="control-label col-md-4">Iva (%):&nbsp;<span class="text-danger">*</span></label>
                        <div class="col-md-6">
                            @Html.Editor("txtPorIvaReferencia", new { htmlAttributes = new { @class = "form-control", @placeholder = "Iva (%)", @readonly = "readonly" } })
                        </div>
                    </div>
                </div>

                <div class="col-sm-12">
                    <div class="form-group">
                        <label class="control-label col-md-4">Iva ($):&nbsp;<span class="text-danger">*</span></label>
                        <div class="col-md-6">
                            @Html.Editor("txtValorIvaReferencia", new { htmlAttributes = new { @class = "form-control", @placeholder = "Iva ($)", @readonly = "readonly" } })
                        </div>
                    </div>
                </div>

                <div class="col-sm-12" style="display:none">
                    <div class="form-group">
                        <label class="control-label col-md-4">Descuento (%):&nbsp;<span class="text-danger">*</span></label>
                        <div class="col-md-6">
                            @Html.Editor("txtPorDsctoReferencia", new { htmlAttributes = new { @class = "form-control", @placeholder = "Descuento (%)", @readonly = "readonly" } })
                        </div>
                    </div>
                </div>

                <div class="col-sm-12" style="display:none">
                    <div class="form-group">
                        <label class="control-label col-md-4">Descuento ($):&nbsp;<span class="text-danger">*</span></label>
                        <div class="col-md-6">
                            @Html.Editor("txtValorDsctoReferencia", new { htmlAttributes = new { @class = "form-control", @placeholder = "Descuento ($)", @readonly = "readonly" } })
                        </div>
                    </div>
                </div>

                <div class="col-sm-12">
                    <div class="form-group">
                        <label class="control-label col-md-4">Precio Total:&nbsp;<span class="text-danger">*</span></label>
                        <div class="col-md-6">
                            @Html.Editor("txtPrecioTotalReferencia", new { htmlAttributes = new { @class = "form-control", @placeholder = "Precio Total", @readonly = "readonly" } })
                        </div>
                    </div>
                </div>

                <label></label>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="btnModificarReferencia">Guardar</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal" id="cerrarModal">Cancelar</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade hmodal-success in" id="modalTareas" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="color-line"></div>
            <div class="modal-header">
                <h4 class="modal-title">Tareas Por Gestionar</h4>
                <small class="font-bold">Los siguientes procesos estan asociados al estado que ha seleccionado</small>
            </div>

            <form id="Tareasform" onsubmit="return false" method="post" name="myForm">

                @Html.AntiForgeryToken()

                <div class="modal-body">

                    @Html.ValidationSummary(true, "", new { @class = "text-danger" })
                    <input type="hidden" name="prioridad" id="prioridad" value="" />
                    <input type="hidden" name="nombre_item" id="nombre_item" value="" />
                    <input type="hidden" name="nombre_categoria" id="nombre_categoria" value="" />
                    <div style="display:none;">
                        @Html.DropDownList("selectItems", Enumerable.Empty<SelectListItem>(), "", htmlAttributes: new { @class = "form-control js-source-states", @style = "display:none" })
                        @Html.DropDownList("selectCategorias", Enumerable.Empty<SelectListItem>(), "", htmlAttributes: new { @class = "form-control js-source-states", @style = "display:none" })
                    </div>

                    <div class="col-sm-12">
                        <div class="form-group">
                            <label class="control-label col-md-4">Tarea:&nbsp;<span class="text-danger">*</span></label>
                            <div class="col-md-6">
                                @Html.DropDownList("selectTareas", Enumerable.Empty<SelectListItem>(), "", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione", @required = "required" })
                            </div>
                        </div>
                    </div>

                    <div class="col-sm-12">
                        <div class="form-group">
                            <label class="control-label col-md-4">Cantidad:&nbsp;<span class="text-danger">*</span></label>
                            <div class="col-md-6">
                                @Html.Editor("txtCantidad", new { htmlAttributes = new { @class = "form-control", @placeholder = "Digite Cantidad", @required = "required", @autocomplete = "off", @onkeyUp = "return miles(this.id)" } })
                            </div>
                        </div>
                    </div>

                    <div class="col-sm-12">
                        <div class="form-group">
                            <label class="control-label col-md-4">Costo:&nbsp;<span class="text-danger">*</span></label>
                            <div class="col-md-6">
                                @Html.Editor("txtCosto", new { htmlAttributes = new { @class = "form-control", @placeholder = "Digite Costo", @required = "required", @autocomplete = "off", @onkeyUp = "return miles(this.id)" } })
                            </div>
                        </div>
                    </div>

                    <div class="col-sm-12" style="display:none;" id="areaFechaOculta">
                        <div class="form-group">
                            <label class="control-label col-md-4">Fecha:&nbsp;<span class="text-danger">*</span></label>
                            <div class="col-md-6">
                                @Html.Editor("txtFecha", new { htmlAttributes = new { @class = "form-control fechas", @placeholder = "Digite Fecha", @required = "required" } })
                            </div>
                        </div>
                    </div>

                    <div class="col-md-12">
                        <label class="text-danger"></label>
                    </div>

                    <label></label>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
                    <button type="submit" class="btn btn-primary" id="btnAgregarTarea">Guardar</button>
                </div>

            </form>
        </div>
    </div>
</div>

<div class="modal fade hmodal-success in" id="modalEditarTareas" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="color-line"></div>
            <div class="modal-header">
                <h4 class="modal-title">Tareas Por Gestionar</h4>
                <small class="font-bold">Los siguientes procesos estan asociados al estado que ha seleccionado</small>
            </div>

            <form id="TareasformEditar" onsubmit="return false" method="post" name="myForm2">

                @Html.AntiForgeryToken()

                <div class="modal-body">

                    @Html.ValidationSummary(true, "", new { @class = "text-danger" })
                    <input type="hidden" name="prioridadEditar" id="prioridadEditar" value="" />
                    <input type="hidden" name="nombre_itemEditar" id="nombre_itemEditar" value="" />
                    <input type="hidden" name="nombre_categoriaEditar" id="nombre_categoriaEditar" value="" />

                    <div class="col-sm-12">
                        <div class="form-group">
                            <label class="control-label col-md-4">Tarea:&nbsp;<span class="text-danger">*</span></label>
                            <div class="col-md-6">
                                @Html.DropDownList("selectTareasEditar", Enumerable.Empty<SelectListItem>(), "", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione", @required = "required" })
                            </div>
                        </div>
                    </div>

                    <div class="col-sm-12">
                        <div class="form-group">
                            <label class="control-label col-md-4">Cantidad:&nbsp;<span class="text-danger">*</span></label>
                            <div class="col-md-6">
                                @Html.Editor("txtCantidadEditar", new { htmlAttributes = new { @class = "form-control", @placeholder = "Digite Cantidad", @required = "required", @autocomplete = "off", @onkeyUp = "return miles(this.id)" } })
                            </div>
                        </div>
                    </div>

                    <div class="col-sm-12">
                        <div class="form-group">
                            <label class="control-label col-md-4">Costo:&nbsp;<span class="text-danger">*</span></label>
                            <div class="col-md-6">
                                @Html.Editor("txtCostoEditar", new { htmlAttributes = new { @class = "form-control", @placeholder = "Digite Costo", @required = "required", @autocomplete = "off", @onkeyUp = "return miles(this.id)" } })
                            </div>
                        </div>
                    </div>

                    <div class="col-sm-12" style="display:none;" id="areaFechaOcultaEditar">
                        <div class="form-group">
                            <label class="control-label col-md-4">Fecha:&nbsp;<span class="text-danger">*</span></label>
                            <div class="col-md-6">
                                @Html.Editor("txtFechaEditar", new { htmlAttributes = new { @class = "form-control fechas", @placeholder = "Digite Fecha", @required = "required" } })
                            </div>
                        </div>
                    </div>

                    <div class="col-md-12">
                        <label class="text-danger"></label>
                    </div>

                    <label></label>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
                    <button type="submit" class="btn btn-primary" id="btnEditarTarea">Guardar</button>
                </div>

            </form>
        </div>
    </div>
</div>

<div id="modal_confirmar" class="modal fade " tabindex="-1" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header" style="padding: 10px ">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><i class="fa fa-close" style="cursor:pointer"></i></button>
                <h6 class="modal-title" style="font-size: 25px ">
                    <i class="fa fa-check"></i> &nbsp;&nbsp;&nbsp; Confirmacion
                </h6>
            </div>
            <div class="modal-body">
                @using (Html.BeginForm())
                    {
                    @Html.AntiForgeryToken()
                    <input type="hidden" name="txt_confirmar" id="txt_confirmar1" value="0">
                    <input type="hidden" name="txt_insp_op1" id="txt_insp_op1" value="">

                    <div class="row">
                        <div class="col-md-12">
                            <textarea id="txt_observacion1" name="txt_observacion1" class="form-control" rows="3" placeholder="Observacion Requerida" required></textarea>
                        </div>
                    </div>
                    <br>
                    <div id="btns_aut" style="text-align:center" class="row">
                        <div class="col-sm-12">
                            <input type="button" value="Enviar Respuesta" class="btn btn-block btn-primary" onclick="confirmar()">
                        </div>
                    </div>
                    <div class="clearfix"></div>
                    }
            </div>
        </div>
    </div>
</div>

<div id="modal_cancelar" class="modal fade " tabindex="-1" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header" style="padding: 10px ">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><i class="fa fa-close" style="cursor:pointer"></i></button>
                <h6 class="modal-title" style="font-size: 25px ">
                    &nbsp;&nbsp;&nbsp; Observación
                </h6>
            </div>
            <div class="modal-body">
                <label>A continuacion escriba los motivos para cerrar la OT</label>
                <textarea class="form-control" rows="5" id="observacioncancel"></textarea>
                <div class="modal-footer">
                    <button class="btn btn-primary" onclick="GuardarOnservacion()">Guardar</button>
                </div>

            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modalkilometraje" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="color-line"></div>
            <div class="modal-header">
                <h4 class="modal-title">¿Esta seguro que es el Kilometraje correcto?</h4>
            </div>
            <div class="modal-body">
                <div class="col-sm-12" id="areaKilometraje">
                    <div class="form-group">
                        <label class="control-label col-md-4">Kilometraje:&nbsp;<span class="text-danger">*</span></label>
                        <div class="col-md-6">
                            @Html.Editor("txtKilometraje", new { htmlAttributes = new { @class = "form-control", @placeholder = "Digite Km", @required = "required" } })
                        </div>
                    </div>
                </div>

            </div>
            <br />
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="actualizarKilometraje()">Guardar</button>
                <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modalmtivopausa" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="color-line"></div>
            <div class="modal-header">
                <h4 class="modal-title">Pausar Tarea</h4>
            </div>


            <div class="modal-body">
                <div class="row" id="mensajemodalpausa" style="display: none; color: red;">Tiene campos sin llenar</div>
                <div class="row" id="mensajemodalpausaclave" style="display: none; color: red;">clave de seguridad incorrecta</div>
                <br />

                <div class="row">
                    <div class="form-group">
                        <label class="control-label col-md-4">Clave de seguridad:&nbsp;<span class="text-danger">*</span></label>
                        <div class="col-md-6">
                            <input id="claveseguridadmodalpuasa" class="form-control" />
                        </div>
                    </div>
                </div>



                <div class="row">
                    <div class="form-group">
                        <label class="control-label col-md-4">Motivo de pausa:&nbsp;<span class="text-danger">*</span></label>
                        <div class="col-md-6">
                            <select id="motivosdepausa" class="form-control">
                            </select>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="form-group">
                        <label class="control-label col-md-4">Observacion:&nbsp;<span class="text-danger">*</span></label>
                        <div class="col-md-6">
                            <textarea id="observacionpausa" class="form-control"></textarea>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="table-responsive">
                        <div id="div-mensaje-buscar"></div>
                        <table class="table table-striped table-bordered table-hover" id="tablaPaginadampausa">
                            <thead>
                                <tr>
                                    <th style="text-align:center">Observaci&oacute;n</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>


                </div>

            </div>
            <br />
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="btnmodalpausa()">Pausar</button>
                <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="modalclavereanudar" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="color-line"></div>
            <div class="modal-header">
                <h4 class="modal-title">Clave de Seguridad</h4>
            </div>


            <div class="modal-body">

                <div class="row" id="mensajeReiniciarclave" style="display: none; color: red;">clave de seguridad incorrecta</div>
                <br />

                <div class="row">
                    <div class="form-group">
                        <label class="control-label col-md-4">Clave de seguridad:&nbsp;<span class="text-danger">*</span></label>
                        <div class="col-md-6">
                            <input id="claveseguridadreiniciar" class="form-control" />
                        </div>
                    </div>
                </div>
            </div>
            <br />
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="btndespausar()">Aceptar</button>
                <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="modalclavefinalizar" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="color-line"></div>
            <div class="modal-header">
                <h4 class="modal-title">Clave de Seguridad</h4>
            </div>


            <div class="modal-body">

                <div class="row" id="mensajeFinalizarclave" style="display: none; color: red;">clave de seguridad incorrecta</div>
                <p id="mensajevalidar" style="color: red;"></p>
                <br />

                <div class="row">
                    <div class="form-group">
                        <label class="control-label col-md-4">Clave de seguridad:&nbsp;<span class="text-danger">*</span></label>
                        <div class="col-md-6">
                            <input id="claveseguridadfinalizar" class="form-control" />
                        </div>
                    </div>
                </div>
            </div>
            <br />
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="btnfinalizar()">Aceptar</button>
                <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="modalclavesolicitudrep" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="color-line"></div>
            <div class="modal-header">
                <h4 class="modal-title">Clave de Seguridad</h4>
            </div>


            <div class="modal-body">

                <div class="row" id="mensajeSolicitudrepclave" style="display: none; color: red;">clave de seguridad incorrecta</div>
                <br />

                <div class="row">
                    <div class="form-group">
                        <label class="control-label col-md-4">Clave de seguridad:&nbsp;<span class="text-danger">*</span></label>
                        <div class="col-md-6">
                            <input id="claveseguridadsolicitudrep" class="form-control" />
                        </div>
                    </div>
                </div>
            </div>
            <br />
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="btnsolicitudrep()">Aceptar</button>
                <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="modalclavePresuesto" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="color-line"></div>
            <div class="modal-header">
                <h4 class="modal-title">Clave de Seguridad</h4>
            </div>


            <div class="modal-body">

                <div class="row" id="mensajePresupuestoclave" style="display: none; color: red;">clave de seguridad incorrecta</div>
                <br />

                <div class="row">
                    <div class="form-group">
                        <label class="control-label col-md-4">Clave de seguridad:&nbsp;<span class="text-danger">*</span></label>
                        <div class="col-md-6">
                            <input id="claveseguridadpresupuesto" class="form-control" />
                        </div>
                    </div>
                </div>
            </div>
            <br />
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="btnpresupuesto()">Aceptar</button>
                <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="modalcampaña" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="color-line"></div>
            <div class="modal-header">
                <h4 class="modal-title">Campaña</h4>
            </div>
            <div class="modal-body">

                <div class="row" id="mensajePresupuestoclave" style="display: none; color: red;">
                    El vehiculo pertenece a la campaña: <div id="idcampanatxt"></div><br />
                    con el numero gwn: <div id="idnumgwn"></div><br />
                    Numero circular:  <div id="idcircular"></div><br />
                </div>
                <br />
     
            </div>
            <br />
            <div class="modal-footer">               
                <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>


@section Scripts {
    @Scripts.Render("~/bundles/select2/js")
    <script src="~/Vendor/datatables/media/js/jquery.dataTables.min.js"></script>
    <script src="~/Vendor/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>
    <script src="~/Vendor/datatables.net-buttons/js/buttons.html5.min.js"></script>
    <script src="~/Vendor/datatables.net-buttons/js/buttons.print.min.js"></script>
    <script src="~/Vendor/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
    <script src="~/Vendor/datatables.net-buttons-bs/js/buttons.bootstrap.min.js"></script>
    <script src="~/Vendor/datatablesExcelExport/dataTable1.4.0-buttons.js"></script>
    <script src="~/Vendor/datatablesExcelExport/JSZip3.1.3.min.js"></script>
    <script src="~/Vendor/pdfmake/build/pdfmake.min.js"></script>
    <script src="~/Vendor/pdfmake/build/vfs_fonts.js"></script>
    <script src="~/Vendor/datatablesExcelExport/jsZipDataTables.js"></script>
    <script src="~/Vendor/bootstrap-toggle-master/js/bootstrap-toggle.min.js"></script>
    <script src="~/Vendor/moment/moment.js"></script>
    <script src="~/Vendor/eonasdan-bootstrap-datetimepicker/build/js/bootstrap-datetimepicker.min.js"></script>
    <script src="~/Scripts/detalleot.js?fec=@DateTime.Now"></script>
    <script src="~/Scripts/inspeccionSistemasVh.js?fec=@DateTime.Now"></script>
    <script type="text/javascript">
        var numeroOperacion = 0;
        var numeroTareas = 0;
        var contadorRS = 0;
        var numeroRepuesto = 0;
        var numeroSolicitud = 0;
        var BDnumeroOperacion = 0;
        var BDnumeroRepuesto = 0;
        var BDnumeroSolicitud = 0;

        $(document).ready(function () {

            var valor1 =$('#kilometraje_nuevo').val();
            var valor2 = addCommas(valor1);
            $('#kilometraje_nuevo').val(valor2);

            var valor3 =$('#kilometraje').val();
            var valor4 = addCommas(valor3);
            $('#kilometraje').val(valor4);



            var razon2=$("#razoningreso option:selected").text();
            $('.js-source-states').select2();
            $('#idtipodoc').select2('readonly', true);
            $('#tecnico').select2('readonly', true);
            buscarAverias();
                   var fecha = '@DateTime.Now.ToString("yyyy-MM-dd")';
                var mes = '@DateTime.Now.Month';
                if (parseInt(mes) < 10) { mes = '0' + mes;}


                 $('.fechas2').datetimepicker({
                format: 'YYYY/MM/DD',
            });

                     $("#fechaini").val(fecha);
               $("#fechaini").find('imput').val(fecha);
                    $("#fechafin").val(fecha);
            $("#fechafin").find('imput').val(fecha);

                var fecha2 = '@DateTime.Now.Year' + '-' +mes + '-01';
                 $("#fechadesde").val(fecha2);
                $("#fechadesde").find('imput').val(fecha);
                $("#fechahasta").val(fecha);
                $("#fechahasta").find('imput').val(fecha);

            $('#fecha_soat').datetimepicker({
                format: 'YYYY/MM/DD'
            }).on('dp.change', function (e) {

                var fechax = e.currentTarget.value;
                var fechasoat=moment(fechax,"YYYY-MM-DD");
                var fechahoy2 = new Date().toJSON().slice(0,10).replace(/-/g,'/');
                var fechahoy=moment(fechahoy2,"YYYY-MM-DD");
                var diferencia=fechahoy.diff(fechasoat,'days');
                if(diferencia>365){
                    $('#selectInfoSoat').show();
                    $('#textosoat').html('El SOAT se encuentra vencido');
                }
                else{
                    $('#selectInfoSoat').hide();
                    $('#textosoat').html('');
                }
            });

            $('#citaOrden').val(@ViewBag.citaId)
            $('#id_cita').val(@ViewBag.citaId)

            $('#aseguradora').append($('<option>', {
                value: '',
                text: 'Ninguna'
            }));
            $('#numeroSolicitudes').val(0);
            $('#btnBuscarPlaca').trigger('click');
            $('#txtEntregaEstimado').val('@ViewBag.entrega');
            $('#minimoOrden').val(addComas($('#minimo').val()));
            $('#deducibleOrden').val(addComas($('#deducible').val()));


            if(razon2.indexOf("Colision") >= 0){
                $('#areaRazonIngreso').show();
            }
            else{
                $('#areaRazonIngreso').hide();
                $('#aseguradora').val('');
                $('#poliza').val('');
                $('#siniestro').val('');
                $('#minimoOrden').val('');
                $('#deducibleOrden').val('');
                $('#aseguradora').val('').trigger('change');
            }

            if ($('#aseguradora').val() == '') {
                $('#areaDatosAseguradora').hide();
                $('.requeridoAseguradora').prop('required', false);
            } else {
                $('.requeridoAseguradora').prop('required', true);
                $('#areaDatosAseguradora').show();
            }
            var estado = '@ViewBag.tipoEstado';
            var permiso = '@ViewBag.Permiso';

            if (permiso == "Si") {
                if (estado == "OT" || estado == "E" || estado == "SR") {
                    $("#btncerrarsinop").css("display","block");
                }

            }
            var estadomodfi = '@ViewBag.Permisomodif';

            if (estadomodfi == "Si" ) {
                if (estado != "A" && estado != "T") {
                    $.ajax({
                        url: '/ordenTaller/BahiaCitaOT',
                        data: {
                                 id_orden: $('#id').val()
                               },
                        type: 'post', cache: false,
                        success: function (data) {

                               var btn = "<a class='btn btn-primary' href='@Url.Action("Edit", "bahia")?menu=5373&&id="+ data+"'><i class='fa fa-calendar-check-o'></i>&ensp;&ensp;Ver</a>";
                     $("#btnagenda").html(btn);


                        }
                    })




                }



            }
            campania();
            buscarPermisoToT();
            datosmotivopausa();
            CargarDatosPorOrdenId();
            buscarTareasAsignadas();
            buscarSolicitudesCreadas($('#id').val());
            verificargarantia();
            BuscarHistorial();
            Permisos();
            MostrarAverias();

        });


        function campania() {
                 $.ajax({
                url: '/ordenTaller/Buscarpermiso',
                data: {
                },
                type: "post",
                cache: false,
                success: function (result) {
                    if (result == true) {
                        $("#modalcampaña").show();

                    }
                }
            })



        }



          function buscarPermisoToT() {
            $.ajax({
                url: '/CentralAtencion/Buscarpermiso',
                data: {
                },
                type: "post",
                cache: false,
                success: function (result) {
                    if (result == true) {
                        $("#btncrerrartotl").show();
                    }
                }
            })
        }

        function Permisos() {

                  $.ajax({
                url: '/ordenTaller/Permisosinsumos',
                data: {
                },
                type: "post",
                cache: false,
                success: function (data) {
                    if (data=="No") {
           $('#porcentaje').prop('readonly', true);                    }


                }
                  });
               $.ajax({
                url: '/ordenTaller/PermisoReactivarot',
                   data: {
                    idorden: $('#id').val()
                },
                type: "post",
                cache: false,
                success: function (data) {
                    if (data=="Si") {
                        $('#paneloperacionesnormal').show();
                        $('#comenzar').hide();
                        $('#modalpausar').hide();
                        $('#pausar').hide();
                        $('#despausar').hide();
                        $('#finalizar').hide();
                        $('#reactivar').show();
                    }


                }
            });

        }
         function CrearTOTliq() {
            id = $('#id').val();
            window.open('@Url.Action("/CreacionTOT", "OrdenTaller")?id=' + id, '_blank');

        }

        function MostrarAverias() {
             var id = $('#id').val();
                     $.ajax({
                url: '/ordenTaller/ConsultarAverias',
                         data: {
                    idot: id
                },
                type: "post",
                cache: false,
                success: function (data) {
                    if (data == false) {
                        $('#hpanelaverias').hide();
                    }

                }
            });

        }



        function datosmotivopausa() {

                  $.ajax({
                url: '/ordenTaller/BuscarMotivosPausaSelect',
                data: {
                },
                type: "post",
                cache: false,
                success: function (data) {
                    $('#motivosdepausa').empty();
                    var option = "";
                      option += "<option value='0' > seleccione </option>";
                    for (var i = 0; i < data.length; i++) {

                        option += "<option value='"+data[i].id+"'>" + data[i].motivo + "</option>";


                    }

                        $('#motivosdepausa').html(option);
                }
            });
        }


        function actualizarKm() {

            swal({
                title: "¿ESTA SEGURO QUE EL KM ES EL CORRECTO?",
                text: "",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                confirmButtonText: "Si, Eliminar!",
                cancelButtonText: "No, cancelar!",
                closeOnConfirm: true,
                closeOnCancel: false
            },
                function (isConfirm) {
                    if (isConfirm) {


                        $('#modalkilometraje').modal('show');

                    } else {
                        swal("Cancelado", "Se ha cancelado la operación", "error");
                    }
                });

        }

        function actualizarKilometraje() {

            var placa = $('#placa').val();
            var kilometraje=$('#txtKilometraje').val();

            $.ajax({
                url: '/InspeccionVh/actualizarKilometraje',
                data: {
                    placa: placa,
                    kilometraje: kilometraje,
                },
                type: "post",
                cache: false,
                success: function (result) {

                    if (result == 1) {
                        swal("Exito", "Se actualizo el kilometraje", "success");

                    } else {
                        swal("Error", "No se pudo actualizar el kilometraje", "error");
                    }

                }
            });
            //location.reload();
        }

        $('#cotizacion').click(function (event) {
                 $('#mensajePresupuestoclave').hide();
            $('#modalclavePresuesto').modal('show');
             $('#claveseguridadpresupuesto').val("");
        });


        function btnpresupuesto() {
                  var clave = $('#claveseguridadpresupuesto').val();
            var tecnico = $('#tecnico').val();
                $.ajax({
                    url: '/ordenTaller/ClaveSeguridadTecnico',
                    data: {
                        idtecnico: tecnico,
                        clave: clave
                    },
                    type: 'post',
                    dataType: 'json',
                    cache: false,
                    success: function (data) {
                        console.log(data)
                        if (data) {
                            cotizacion();
                              $('#btnEjecutarOT').trigger('click');
                          $('#modalclavePresuesto').modal('hide');
                        } else {
                            $('#mensajePresupuestoclave').show();
                        }


                    }
                });


        }

        function cotizacion() {
                   window.open('@Url.Action("CotizacionPDF", "OrdenTaller")?id_orden_trabajo=' + $('#id').val(), '_blank');
            window.location.href = '@Url.Action("Update", "ordenTaller")?menu='+@ViewBag.id_menu+'&&id=' + $('#id').val();
            CargarDatosPorOrdenId();
        }





        $('#Pdf_OT').click(function (event) {

            
                  $.ajax({
                url: '/ordenTaller/PermisoImprimirOT',
                      data: {
                          idorden: $('#id').val()
                },
                type: "post",
                cache: false,
                      success: function (data) {
                    console.log('valor'+data)
                          if (data == "Si") {
                              console.log('Ingreso')
                              window.open('@Url.Action("OrdenTallerPDF", "OrdenTaller")?id=' + $('#id').val(), '_blank');
                          }
                          else {
                                 swal("Error!", "Ya se a realizado la impresion de la Orden de Trabajo", "error");
                          }
                }
                  });


   

        });


        function addCommas(nStr) {

            nStr += '';
            x = nStr.split('.');
            x1 = x[0];
            x2 = x.length > 1 ? `,${x[1]}` : '';
            const rgx = /(\d+)(\d{3})/;
            while (rgx.test(x1)) {
                x1 = x1.replace(rgx, '$1' + '.' + '$2');
            }
            return x1 + x2;

        }

        function verificargarantia(){

            var razon_ingreso=$('#razoningreso').val();
            //var razon_secundaria=$('#razon_secundaria').val();
            //if(razon_ingreso==7 || razon_secundaria==7){
            var razongarantia=@ViewBag.razongarantia;
            if(razon_ingreso==razongarantia){
                $('#areaGarantia').show();
            }
            else{
                $('#garantia_falla').val('');
                $('#garantia_causa').val('');
                $('#garantia_solucion').val('');
                $('#areaGarantia').hide();
            }
        };

        $('#tipoRepuesto').bootstrapToggle({
            on: 'Repuesto',
            off: 'Generico'
        });

        $('#tipoRepuesto').change(function () {
            if ($('#tipoRepuesto').prop('checked')) {
                $('#rOficial').show();
                $('#rGenerico').hide();
                $('#repuestosG').val('').select2();
            } else {
                $('#rOficial').hide();
                $('#rGenerico').show();
                $('#repuestos').val('').select2();
                $('#txtCantidadRepuesto').val('');
                $('#txtPrecioRepuesto').val(0);
                $('#txtPorDsctoRepuesto').val(0);
                $('#txtPorIvaRepuesto').val(0);
            }
        });

        $('#aseguradora').change(function () {
            if ($('#aseguradora').val() == '') {
                $('#areaDatosAseguradora').hide();
                $('.requeridoAseguradora').prop('required', false);
            } else {
                $('.requeridoAseguradora').prop('required', true);
                $('#areaDatosAseguradora').show();
                //$.ajax({
                //    url: '/ordenTaller/BuscarNitAseguradora',
                //    data: {
                //        aseguradora: $('#aseguradora').val()
                //    },
                //    type: 'post',
                //    dataType: 'json',
                //    cache: false,
                //    success: function (data) {
                //        $('#nitTipoTarifa').val(data);
                //    }
                //});
            }
        });

        function CargarDatosPorOrdenId(){
            $.ajax({
                url: '/ordenTaller/BuscarDatosPorIdOrden',
                data: {
                    id_orden: $('#id').val()
                },
                type: 'post',
                dataType: 'json',
                cache: false,
                success: function (data) {

                    $('#tablaOperacionesPorPlaca').find('tbody').empty();
                    for (var i = 0; i < data.buscarOperaciones.length; i++) {
                        console.log()
                        BDnumeroOperacion = numeroOperacion;
                        var fila = "";
                        var fila2 = "";
                        var tdAuto = "<a onclick='modalNotif3(1," + data.buscarOperaciones[i].idoperacion + ")' class='btn btn-success btn-sm'><i class='fa fa-check'></i><b> SI</b></a><a onclick='modalNotif3(0," + data.buscarOperaciones[i].idoperacion + ")' class='btn btn-danger btn-sm'><i class='fa fa-times'></i><b> NO</b></a>";
                        var tdSucc = "<i style='font-size:17pt;' class='fa fa-check-circle text-success'></i><a onclick='mostrar_detalle3(" + data.buscarOperaciones[i].idoperacion + ")'><i style='margin-left:15px;font-size:17pt;' class='fa fa-file-text text-success'></i></a>";
                        var tdDang = "<i style='font-size:17pt;' class='fa fa-times-circle text-danger'></i><a onclick='mostrar_detalle3(" + data.buscarOperaciones[i].idoperacion + ")'><i style='margin-left:15px;font-size:17pt;' class='fa fa-file-text text-danger'></i></a>";
                        var tdCheck = "<input type='checkbox' class='i-checks' id='solicitarOperacionBD" + BDnumeroOperacion + "' name='solicitarOperacionBD" + BDnumeroOperacion + "' checked " + " value='" + BDnumeroRepuesto + "'/>";

                        if (data.buscarOperaciones[i].estado == "-1" && data.buscarOperaciones[i].fecha_envio_sms == "") {
                            fila = tdAuto;
                        }
                        else if (data.buscarOperaciones[i].estado == "0") {
                            fila = tdDang;
                        }
                        else if (data.buscarOperaciones[i].estado == "1") {
                            fila = tdSucc;
                        }
                        else {
                            fila = tdCheck;
                        }

                        var btncheck = "";

                        if (data.buscarOperaciones[i].boton_sms == null || data.buscarOperaciones[i].estadorepuesta == null ) {
                            btncheck = "<label id='autoizacheck" + i + "'> No </label>";
                        } else {
                           btncheck = "<label id='autoizacheck" + i + "'>Si </label>";
                        }

                        $('#totakopera').val(i);
                        $('#tablaOperacionesPorPlaca').find('tbody').append('<tr id="rowOperaciones' + BDnumeroOperacion + '">'
                            + '<td align="left">'
                            + '<input style="display:none" type="text" id="codigoOperacionBD' + BDnumeroOperacion + '" name="codigoOperacionBD' + BDnumeroOperacion + '" value="' + data.buscarOperaciones[i].codigo + '"/>'
                            + data.buscarOperaciones[i].codigo
                            + '</td>'
                            + '<td align="left">'
                            + data.buscarOperaciones[i].operacion
                            + '</td>'
                            //+'<td align="left">'
                            //    +'<input style="display:none" type="text" id="tipoTarifaBD' + BDnumeroOperacion+'" name="tipoTarifaBD' + BDnumeroOperacion + '" value="' + data.buscarOperaciones[i].id_tarifa + '"/>'
                            //    + data.buscarOperaciones[i].tarifa
                            //+'</td>'
                            + '<td align="left">'
                            + '<input style="display:none" type="text" id="id_tecnicoBD' + BDnumeroOperacion + '" name="id_tecnicoBD' + BDnumeroOperacion + '" value="' + data.buscarOperaciones[i].tecnico_id + '"/>'
                            + data.buscarOperaciones[i].tecnico
                            + '</td>'
                            + '<td align="right">'
                            + '<input style="display:none" type="text" id="tiempoBD' + BDnumeroOperacion + '" name="tiempoBD' + BDnumeroOperacion + '" value="' + data.buscarOperaciones[i].tiempo + '"/>'
                            + '<input style="display:none" type="text" id="precioBD' + BDnumeroOperacion + '" name="precioBD' + BDnumeroOperacion + '" value="' + data.buscarOperaciones[i].precio + '"/>'
                            + '<input style="display:none" type="text" id="ivaOperacionBD' + BDnumeroOperacion + '" name="ivaOperacionBD' + BDnumeroOperacion + '" value="' + data.buscarOperaciones[i].ivaOperacion + '"/>'
                            + data.buscarOperaciones[i].tiempo
                            + '</td>'
                            //+'<td align="right">'
                            //    + addComas(data.buscarOperaciones[i].precio)
                            //+ '</td>'
                            //    +'<td align="right">'
                            //    +'<input style="display:none" type="text" id="descuentoBD' + BDnumeroOperacion+'" name="descuentoBD'+ BDnumeroOperacion + '" value="' + data.buscarOperaciones[i].descuentoOperacion + '"/>'
                            //    + data.buscarOperaciones[i].descuentoOperacion
                            //+'</td>'
                            //+'<td align="right">'
                            //    +'<input style="display:none" type="text" id="descuentoVBD' + BDnumeroOperacion+'" name="descuentoVBD'+ BDnumeroOperacion + '" value="' + data.buscarOperaciones[i].descuento + '"/>'
                            //    + addComas(data.buscarOperaciones[i].descuento)
                            //+'</td>'
                            //+'<td align="right">'
                            //    + data.buscarOperaciones[i].ivaOperacion
                            //+'</td>'
                            //+'<td align="right">$ '
                            //    + addComas(data.buscarOperaciones[i].valorIva)
                            //+'</td>'
                            + '<td align="right">$ '
                            + addComas(data.buscarOperaciones[i].valorTotal)
                            + '</td>'
                            + '<td align="center"> '
                            + fila
                            + '</td>'
                              + '<td align="center"> '
                            + btncheck
                            + '</td>'
                            + '<td width="15%" style="text-align:center">'
                            + '<button type="button" class="btn btn-danger btn-xs" onclick="eliminarOperacionBD(' + data.buscarOperaciones[i].idoperacion + ')">&nbsp;&nbsp;<i class="fa fa-times"></i>&nbsp;&nbsp;</button>&nbsp;&nbsp;'
                            + '</td>'
                            + '</tr>');
                        numeroOperacion++;
                        $("#autoizacheck" + i).trigger('change');
                        //$('#numeroOperaciones').val(numeroOperacion);
                    }
                    $('#labelestado').html('');

                    $('#totaloperaciones').val('');
                    $('#totaloperaciones').val(data.preciooperaciones);
                    $('#txtEntregaEstimado').val('');
                    $('#txtEntregaEstimado').val(data.entrega);
                    $('#tablaRepuestosPorPlaca').find('tbody').empty();
                    $('#total_repuestos').val('');
                    $('#total_repuestos').val(data.preciorepuestos);
                    $('#labelestado').html(data.estado);

                    for (var i = 0; i < data.repuestosAgendados.length; i++) {
                        var solicitado = '';


                        if (data.repuestosAgendados[i].solicitado == true) {

                            solicitado = 'checked';
                        }
                        var texto = "";
                        if (data.repuestosAgendados[i].stock_bodega > 0) {
                            texto = "<button type='button' class='btn btn-xs btn-success btn-circle'>&nbsp;&nbsp;&nbsp;</button>";
                        }
                        else if (data.repuestosAgendados[i].stock_otrasbodegas > 0) {
                            texto = "<button type='button' class='btn btn-xs btn-warning btn-circle'>&nbsp;&nbsp;&nbsp;</button>";
                        }
                        else if (data.repuestosAgendados[i].stock_reemplazo > 0) {
                            texto = "<button type='button' class='btn btn-xs btn-warning2 btn-circle'>&nbsp;&nbsp;&nbsp;</button>";
                        }
                        else {
                            texto = "<button type='button' class='btn btn-xs btn-danger btn-circle'>&nbsp;&nbsp;&nbsp;</button>";
                        }

                        $('#tablaRepuestosPorPlaca').find('tbody').append('<tr id="rowRepuestoBD' + BDnumeroRepuesto + '">'
                            + '<td align="left">'
                            + '<input style="display:none" type="text" id="codigoRepuestoBD' + BDnumeroRepuesto + '" name="codigoRepuestoBD' + BDnumeroRepuesto + '" value="' + data.repuestosAgendados[i].ref_codigo + '"/>'
                            + '<input style="display:none" type="text" id="idRepuestoBD' + BDnumeroRepuesto + '" name="idRepuestoBD' + BDnumeroRepuesto + '" value="' + data.repuestosAgendados[i].id + '"/>'
                            + data.repuestosAgendados[i].ref_codigo
                            + '</td>'
                            + '<td align="left">'
                            + '<input style="display:none" type="text" id="nombreRepuestoBD' + BDnumeroRepuesto + '" name="nombreRepuestoBD' + BDnumeroRepuesto + '" value="' + data.repuestosAgendados[i].ref_descripcion + '"/>'
                            + data.repuestosAgendados[i].ref_descripcion
                            + '</td>'
                            //+'<td align="left">'
                            //    +'<input style="display:none" type="text" id="tarifaBD'+BDnumeroRepuesto+'" name="tarifaBD'+ BDnumeroRepuesto+'" value="' + data.repuestosAgendados[i].idTarifa + '"/>'
                            //    + data.repuestosAgendados[i].tarifaDes
                            //+ '</td>'
                            + '<td align="right">'
                            + '<input style="display:none" type="text" id="cantidadRepuestoBD' + BDnumeroRepuesto + '" name="cantidadRepuestoBD' + BDnumeroRepuesto + '" value="' + data.repuestosAgendados[i].cantidad + '"/>'
                            + '<input style="display:none" type="text" id="precioRepuestoBD' + BDnumeroRepuesto + '" name="precioRepuestoBD' + BDnumeroRepuesto + '" value="' + data.repuestosAgendados[i].precio + '"/>'
                            + '<input style="display:none" type="text" id="porIvaRepuestoBD' + BDnumeroRepuesto + '" name="porIvaRepuestoBD' + BDnumeroRepuesto + '" value="' + data.repuestosAgendados[i].por_iva + '"/>'
                            + '<input style="display:none" type="text" id="porDsctRepuestoBD' + BDnumeroRepuesto + '" name="porDsctRepuestoBD' + BDnumeroRepuesto + '" value="' + data.repuestosAgendados[i].por_dscto + '"/>'
                            + data.repuestosAgendados[i].cantidad
                            + '</td>'
                            + '<td align="right">'
                            + addComas(data.repuestosAgendados[i].precio)
                            + '</td>'
                            //+'<td align="right">'
                            //    +'<input style="display:none" type="text" id="porIvaRepuestoBD'+ BDnumeroRepuesto + '" name="porIvaRepuestoBD'+ BDnumeroRepuesto + '" value="' + data.repuestosAgendados[i].por_iva + '"/>% '
                            //    + data.repuestosAgendados[i].por_iva
                            //+'</td>'
                            + '<td align="right">$'
                            + addComas(data.repuestosAgendados[i].valorIva)
                            + '</td>'
                            //+'<td align="right">'
                            //    +'<input style="display:none" type="text" id="porDsctRepuestoBD'+ BDnumeroRepuesto + '" name="porDsctRepuestoBD' + BDnumeroRepuesto + '" value="' + data.repuestosAgendados[i].por_dscto + '"/>% '
                            //    + addComas(data.repuestosAgendados[i].por_dscto)
                            //+ '</td>'
                            //+'<td align="right">$'
                            //    + addComas(data.repuestosAgendados[i].valor_dscto)
                            //+'</td>'
                            + '<td align="right">'
                            + '<input style="display:none" type="text" id="valorTotalBD' + BDnumeroRepuesto + '" name="valorTotalBD' + BDnumeroRepuesto + '" value="' + data.repuestosAgendados[i].valorTotal + '"/>$ '
                            + addComas(data.repuestosAgendados[i].valorTotal)
                            + '</td>'
                            + '<td align="center">'
                            + texto
                            + '</td>'
                            + '<td align="center">'
                            + '<input type="checkbox" class="i-checks" id="solicitarRepuestoBD' + BDnumeroRepuesto + '" name="solicitarRepuestoBD' + BDnumeroRepuesto + '" ' + solicitado + ' value="' + BDnumeroRepuesto + '"/>'
                            + '</td>'
                              + '<td align="center">'
                            //+ data.repuestosAgendados[i].Estado_sol
                            + (data.repuestosAgendados[i].Descripcion != null ? data.repuestosAgendados[i].Descripcion : 'Sin Estado')
                            + '</td>'
                            + '<td width="15%" style="text-align:center">'
                            + '<button id="editRptBD' + BDnumeroRepuesto + '" type="button" class="btn btn-warning btn-xs" onclick="editarRepuesto(' + data.repuestosAgendados[i].id + ')">&nbsp;&nbsp;<i class="fa fa-edit"></i>&nbsp;&nbsp;</button>&nbsp;&nbsp;'
                            + '<button id="elimRptBD' + BDnumeroRepuesto + '" type="button" class="btn btn-danger btn-xs" onclick="eliminarRepuestoBD(' + data.repuestosAgendados[i].id + ')">&nbsp;&nbsp;<i class="fa fa-times"></i>&nbsp;&nbsp;</button>'
                            + '</td>'
                            + '</tr>');
                        //$('#numeroRepuestos').val(numeroRepuesto);

                        if (data.repuestosAgendados[i].solicitudes == true) {
                            $('#editRptBD' + BDnumeroRepuesto + '').prop('disabled', true);
                            $('#elimRptBD' + BDnumeroRepuesto + '').prop('disabled', true);
                            $('#solicitarRepuestoBD' + BDnumeroRepuesto + '').prop('disabled', true);
                        }
                        BDnumeroRepuesto++;
                    }

                    if (data.botoninicioinspeccion == 1 && data.botonfininspeccion == 1) {
                        $('[href="#inspeccion"]').show();

                    } else {
                        $('[href="#inspeccion"]').hide();
                    }
                    if (data.botonfininspeccion == 1) {
                        $('#btn_terminar_inspeccion').hide();
                    }
                    else {
                        $('#btn_terminar_inspeccion').show();
                    }
                    if (data.botonsolicitudrepuestos == 1) {
                        $('[href="#repuestosSolicitados"]').show();

                    } else {
                        $('[href="#repuestosSolicitados"]').hide();
                    }
                    if (data.botonsolicitudrepuestos == 1) {
                        $('[href="#repuestosSolicitados"]').show();

                    } else {
                        $('[href="#repuestosSolicitados"]').hide();
                    }

                    if (data.botonimpresionpdf == 1) {
                        $('#btnSolicitarRepuestos').prop('disabled', false);
                        $('#btnSolicitarRepuestos').show();

                    } else {
                        $('#btnSolicitarRepuestos').prop('disabled', true);
                        $('#btnSolicitarRepuestos').hide();
                    }

                    if (data.operacioniniciada == "1") {
                        $('[href="#ejecucion"]').show();

                    } else {
                        $('[href="#ejecucion"]').hide();
                    }

                    if (data.solicitar > 0) {
                        $('#btnSolicitarRepuestos').show();
                    }
                    else {
                        $('#btnSolicitarRepuestos').hide();
                    }
                    $('#tablaRepuestosSolicitudes').find('tbody').empty();
                    if (data.listaSolicitados.length > 0) {
                        $('#btnEjecutarOT').hide();
                    }
                    for (var i = 0; i < data.listaSolicitados.length; i++) {
                        $('#tablaRepuestosSolicitudes').find('tbody').append('<tr id="rowRepuestoSoliBD' + id + '">'
                            + '<td align="left">'
                            + data.listaSolicitados[i].id
                            + '</td>'
                            + '<td align="left">'
                            + data.listaSolicitados[i].descripcion
                            + '</td>'
                            //+'<td align="left">'
                            //    + data.repuestosSolicitados[i].tarifa
                            //+ '</td>'
                            + '<td align="right">'
                            + data.listaSolicitados[i].cantidad
                            + '</td>'
                            + '<td align="right">'
                            + data.listaSolicitados[i].precio
                            + '</td>'
                            + '<td align="right">'
                            + data.listaSolicitados[i].fechasolicitud
                            + '</td>'
                            + '<td align="right">'
                            + data.listaSolicitados[i].recibido
                            + '</td>'
                            + '<td align="right">'
                            + data.listaSolicitados[i].fecharecibido
                            + '</td>'
                            + '<td align="right">'
                            + data.listaSolicitados[i].cantidadrecibido
                            + '</td>'
                               + '<td align="right">'
                            + data.listaSolicitados[i].estado
                            + '</td>'
                            + '</tr>');
                    }

                    $('#tablaRepuestosSolicitudes2').find('tbody').empty();
                    for (var i = 0; i < data.listaSolicitados.length; i++) {
                        $('#tablaRepuestosSolicitudes2').find('tbody').append('<tr id="rowRepuestoSoliBD' + id + '">'
                            + '<td align="left">'
                            + data.listaSolicitados[i].id
                            + '</td>'
                            + '<td align="left">'
                            + data.listaSolicitados[i].descripcion
                            + '</td>'
                            //+'<td align="left">'
                            //    + data.repuestosSolicitados[i].tarifa
                            //+ '</td>'
                            + '<td align="right">'
                            + data.listaSolicitados[i].cantidad
                            + '</td>'
                            + '<td align="right">'
                            + data.listaSolicitados[i].precio
                            + '</td>'
                            + '<td align="right">'
                            + data.listaSolicitados[i].fechasolicitud
                            + '</td>'
                            + '<td align="right">'
                            + data.listaSolicitados[i].recibido
                            + '</td>'
                            + '<td align="right">'
                            + data.listaSolicitados[i].fecharecibido
                            + '</td>'
                            + '<td align="right">'
                            + data.listaSolicitados[i].cantidadrecibido
                            + '</td>'
                             + '<td align="right">'
                            + data.listaSolicitados[i].estado
                            + '</td>'
                            + '</tr>');
                    }

                    $('#tablaRepuestosTrasladados').find('tbody').empty();
                    for (var i = 0; i < data.repuestosSolicitados.length; i++) {

                        precio = parseInt(data.repuestosSolicitados[i].precioU)

                        var descuento = 0;
                        if ($.trim(data.repuestosSolicitados[i].descuento) != '') {
                            descuento = Math.round((parseFloat(data.repuestosSolicitados[i].descuento) * parseInt(data.repuestosSolicitados[i].precioU) / 100) * parseFloat(data.repuestosSolicitados[i].cantidad));
                        }
                        var iva = 0;
                        if ($.trim(data.repuestosSolicitados[i].iva) != '') {
                            iva = Math.round(((parseFloat(data.repuestosSolicitados[i].cantidad) * parseInt(data.repuestosSolicitados[i].precioU) - descuento) * parseFloat(data.repuestosSolicitados[i].iva) / 100));
                        }
                        var valorAntesIva = (data.repuestosSolicitados[i].cantidad) * parseInt(data.repuestosSolicitados[i].precioU);
                        var valorTotal = (valorAntesIva + iva) - descuento;
                        var codigo = data.repuestosSolicitados[i].codigo;
                        var precioU = data.repuestosSolicitados[i].precioU;
                        var porcentaje_iva = data.repuestosSolicitados[i].iva;
                        var porcentaje_descuento = data.repuestosSolicitados[i].descuento;
                        var cantidad = data.repuestosSolicitados[i].cantidad;

                        $('#tablaRepuestosTrasladados').find('tbody').append('<tr id="rowRepuestoBD' + BDnumeroRepuesto + '">'
                            + '<td align="left">'
                            + data.repuestosSolicitados[i].traslado
                            + '</td>'
                            + '<td align="left">'
                            + data.repuestosSolicitados[i].repuesto
                            + '</td>'
                            //+'<td align="left">'
                            //    + data.repuestosSolicitados[i].tarifa
                            //+ '</td>'
                            + '<td align="right">'
                            + data.repuestosSolicitados[i].cantidad
                            + '</td>'
                            + '<td align="right">'
                            + addComas(data.repuestosSolicitados[i].precioU)
                            + '</td>'
                            + '<td align="right">'
                            + data.repuestosSolicitados[i].iva
                            + '</td>'
                            + '<td align="right">$'
                            + addComas(iva)
                            + '</td>'
                            + '<td align="right">'
                            + addComas(data.repuestosSolicitados[i].descuento)
                            + '</td>'
                            + '<td align="right">$'
                            + addComas(descuento)
                            + '</td>'
                            + '<td align="right">$ '
                            + addComas(valorTotal)
                            + '</td>'
                            + '</tr>');
                    }

                  
                    //$('#tiempoDuracionhid').val(data.tiempotranscurrido);
                    $('#trackingEventos').find('tbody').empty();
                    var indice = 0;
                    for (var i = 0; i < data.datostracking.length; i++) {
                        indice = i + 1; var motivospausa = "";
                       
                        if (data.datostracking[i].observaciones.length > 0) {
                            for (var j = 0; j < data.datostracking[i].observaciones.length; j++) {

                                if (data.datostracking[i].observaciones[j]!=null) {
                                         motivospausa += data.datostracking[i].observaciones[j] + " &nbsp;&nbsp;";   
                                }                                                      
                            }

                        } else { motivospausa = "&nbsp;&nbsp;";}                   


                        $('#trackingEventos').find('tbody').append('<tr>'
                            + '<td align="left">'
                            + indice
                            + '</td>'
                            + '<td align="left">'
                            + data.datostracking[i].descripcion
                            + '</td>'
                            +'<td align="left">'
                            +  motivospausa
                            + '</td>'
                            + '<td align="right">'
                            + data.datostracking[i].estado
                            + '</td>'
                            + '<td align="right">'
                            + data.datostracking[i].responsable
                            + '</td>'
                            + '<td align="right">'
                            + data.datostracking[i].fecha
                            + '</td>'
                            + '</tr>');
                    }
                    $('#comenzar').hide();
                    $('#modalpausar').hide();
                    $('#despausar').hide();
                    $('#finalizar').hide();

                    //TOT
                           var tabla = "";
                    $('#tablaPaginadatot').find('tbody').empty();
                    var tabla = "";

                    for (var i = 0; i < data.tots.length; i++) {
                        tabla += "<tr>";
                        tabla += "<td align='left'>" + data.tots[i].id2 + "</td>";
                        tabla += "<td align='center'>" + data.tots[i].fecha2 + "</td>";
                        tabla += "<td align='left'>" + data.tots[i].proveedor + "</td>";
                        tabla += "<td align='center'>";
                        if (data.tots[i].Operaciones.length > 0) {
                            for (var j = 0; j < data.tots[i].Operaciones.length; j++) {
                                tabla += data.tots[i].Operaciones[j].Descripcion + " | ";
                            }
                             tabla = tabla.slice(0, -2);
                        }
                        else {
                            tabla += "&nbsp;&nbsp;&nbsp;";

                        }
                        tabla += "</td>";
                               tabla += "<td align='center'>";
                        if (data.tots[i].Repuestos.length > 0) {
                            for (var j = 0; j < data.tots[i].Repuestos.length; j++) {
                                tabla += data.tots[i].Repuestos[j].Descripcion + " | ";
                            }
                             tabla = tabla.slice(0, -2);
                        }
                        else {
                            tabla += "&nbsp;&nbsp;&nbsp;";

                        }
                        tabla += "</td>";

                        tabla += "<td align='center'>" + data.tots[i].valor_total2 + "</td>";
                       tabla += "</tr>";
                    }

                        $('#tablaPaginadatot').find('tbody').append(tabla);

                    //insumos
                     $('#tablainsumos').find('tbody').empty();
                  var   tabla2 = "";
                    for (var i = 0; i < data.listainsumos.length; i++) {
                        tabla2 += "<tr>";
                        tabla2 += "<td align='center'>" + data.listainsumos[i].codigo_insumo + "</td>";
                        tabla2 += "<td align='left'>" + data.listainsumos[i].Descripcion_insumo + "</td>";
                        tabla2 += "<td align='center'>" + data.listainsumos[i].tarifa + "</td>";
                        tabla2 += "<td align='center'>" + data.listainsumos[i].porcentaje + "</td>";
                        tabla2 += "<td align='center'>" + addComas(data.listainsumos[i].valor_tarifa) + "</td>";
                        tabla2 += "<td align='center'>" + addComas(data.listainsumos[i].valort_horas) + "</td>";
                        if (data.resultadoinsumo == "Si") {
                            tabla2 += "<td align='left'><button class='btn btn-danger btn-xs'  onclick='Eliminarinsumo(" + data.listainsumos[i].id + ")'>&nbsp;&nbsp;<i class='fa fa-times'></i>&nbsp;&nbsp;</button></td>";
                        } else {
                              tabla2 += "<td align='left'>&nbsp;&nbsp;</td>";


                        }

                        tabla2 += "</tr>";
                    }

                        $('#tablainsumos').find('tbody').append(tabla2);
                    $('#totalinsumos').val(addComas(data.vtotalinsumo));

                    //Combos

                     $('#tablacombos').find('tbody').empty();
                  var   tabla3 = "";
                    for (var i = 0; i < data.combosot.length; i++) {
                        tabla3 += "<tr>";
                         tabla3 += "<td align='left'>";
                        tabla3 += data.combosot[i].codigo+ " <br/> ";
                        tabla3 +="</td>";
                        tabla3 += "<td align='left'>";
                        tabla3 += data.combosot[i].operacion;
                        tabla3 +="</td>";
                        tabla3 += "<td align='center'>" + addComas(data.combosot[i].totalHorasCliente) + "</td>";
                        tabla3 += "<td align='center'>" + addComas(data.combosot[i].totalhorasoperario) + "</td>";
                        tabla3 += "<td align='center'>";
                        var opciontarifa = "";
                            opciontarifa = opciontarifa + "<option value=''>Seleccione</option>";
                            for (var n = 0; n < data.combosot[i].ttipostarifa.length; n++) {
                                var seleccionado = "";
                                if (data.combosot[i].ttipostarifa != 0) {
                                    if (data.combosot[i].tipotarifa == data.combosot[i].ttipostarifa[n].id) {
                                        seleccionado = "selected";
                                    }
                                }
                                opciontarifa = opciontarifa + "<option value='" + data.combosot[i].ttipostarifa[n].id + "'  " + seleccionado + ">" + data.combosot[i].ttipostarifa[n].descripcion + "</option>";
                            }

                        tabla3 += "<select id='tarifaBD" + i + "' name='tarifaBD" + i + "' class='repuestos' onchange='actualizarTarifacombo(" + i + ","+data.combosot[i].id+","+data.combosot[i].totalHorasCliente+")'>";
                        tabla3 +=  opciontarifa;
                        tabla3 += "</select>";
                        tabla3 += "</td>";
                        tabla3 += "<td align='center'>" + addComas(data.combosot[i].valortotal) + "</td>";
                        tabla3 += "<td align='left'><button class='btn btn-danger btn-xs'  onclick='EliminarCombo(\"" + data.combosot[i].id + "\")'>&nbsp;&nbsp;<i class='fa fa-times'></i>&nbsp;&nbsp;</button></td>";


                        tabla3 += "</tr>";
                    }

                        $('#tablacombos').find('tbody').append(tabla3);
                    $('#totalcombo').val(addComas(data.totalcombos));




                    if (data.buscarOperaciones.length > 0) {
                        $('#cotizacion').show();
                        $('#cotizacion').prop('disabled', false);
                    }
                    else {
                        $('#cotizacion').hide();
                        $('#cotizacion').prop('disabled', true);
                    }
                    if (data.botoniniciar == 1) {
                        $('#comenzar').show();
                        $('#paneloperacionesnormal').show();
                    }
                    if (data.botoniniciar == 1) {
                        $('#comenzar').show();
                        $('#paneloperacionesnormal').show();
                    }
                    if (data.botonpausar == 1) {
                        $('#modalpausar').show();
                        $('#paneloperacionesnormal').show();
                    }
                    if (data.botondespausar == 1) {
                        $('#despausar').show();
                        $('#paneloperacionesnormal').show();
                    }
                    if (data.botonfinalizar == 1) {
                        $('#finalizar').show();
                        $('#paneloperacionesnormal').show();
                    }



                var variable =  setInterval(function () {
                $.ajax({
                    url: '/ordenTaller/VerificarEstadoEntregaRepuestos',
                data: {
                    id_orden: $('#id').val()
                    },
                    type: 'post',
                    dataType: 'json',
                    cache: false,
                    success: function (data) {
                         console.log('Valido estado repuesto'+data)
                        if (data == "Si") {
                            if (document.getElementById("despausar").style.display == "block") {
                                $("#finalizar").css("display", "none");
                            } else {
                                $("#finalizar").css("display", "block");

                                clearInterval(variable);
                            }

                        } else {
                            $("#finalizar").css("display", "none");
                        }


                    }
                });
                    },
                    3000);


                },
                complete: function (data) {
                    $('.i-checks').iCheck({
                        checkboxClass: 'icheckbox_square-green',
                        radioClass: 'iradio_square-green'
                    }).on('ifChanged', function (e) {

                        // Get the  field name
                        var isChecked = e.currentTarget.checked;
                        var nombre = e.currentTarget.id;
                        if (nombre.indexOf("solicitarRepuestoBD") != -1) {
                            if (isChecked == true) {
                                sumarprecio(e.currentTarget.value);
                            }
                            else {
                                restarprecio(e.currentTarget.value);
                            }
                        }
                    });
                    console.log("data"+data.responseJSON )
                    if (data.responseJSON.avanza == 1) {
                        movertiempo(data.responseJSON.tiempotranscurrido);
                    }
                    else {
                        clearInterval(movertiempo);
                        $('#tiempoDuracion').html("<h3 class='text-primary'><strong>" + data.responseJSON.tiempotranscurrido + "</strong></h3>");
                    }
                }
            });
        }


        function actualizarTarifacombo(index,tempario, horas ) {
            var tarifa = $('#tarifaBD' + index).val();

                  $.ajax({
                url: '/ordenTaller/CambiarprecioCombo',
                data: {
                    tarifa: tarifa,
                    horas: horas,
                    idtempario: tempario,
                    idot:  $('#id').val()
                },
                type: 'post',
                dataType: 'json',
                cache: false,
                success: function (data) {
                CargarDatosPorOrdenId();

                }
            });

        }


        function enviomsm2() {
            var id = $('#id').val();
            var totalchech = 0;
            for (var i = 0; i < $('#totakopera').val(); i++) {
                if ($('#autoizacheck' + i).prop('checked')) {
                    totalchech++;
                }
            }
            if (totalchech>0) {


            $.ajax({
                url: '/ordenTaller/envioMensajeTexto',
                data: {
                    idins_op: id
                },
                type: 'post',
                dataType: 'json',
                cache: false,
                success: function (data) {
                    console.log(data);
                },
                complete:function(data){
                    CargarDatosPorOrdenId();
                }
            });
                  }
        }

        function AgregarComboot() {
            var id = $('#id').val();
            var combo = $('#comboot').val();
            var tarifa = $('#tarifacombo').val();
            if (combo!="" && tarifa!="") {
                 $.ajax({
                url: '/ordenTaller/AgregarCombo',
                data: {
                    idot: id,
                    idcombo: combo
                },
                type: 'post',
                dataType: 'json',
                cache: false,
                     success: function (data) {
                         CargarDatosPorOrdenId();
                         $("#comboot").val(' ').select2();


                }
            });
            }

        }

        function EliminarCombo(id) {
                  $.ajax({
                url: '/ordenTaller/EliminarCombo',
                data: {
                    idtempario: id
                },
                type: 'post',
                dataType: 'json',
                cache: false,
                success: function (data) {
                    CargarDatosPorOrdenId();
                }
            });

        }
        function movertiempo(tiempo){
            var tiempohora=tiempo.split(":");
            var hora=tiempohora[0];
            var minuto=tiempohora[1];
            var segundo=tiempohora[2];
           /* if(hora<10){
                    hora="0"+hora;
                }
                if(minuto<10){
                    minuto="0"+minuto;
                }
                if(segundo<10){
                    segundo="0"+segundo;
                }*/
            counter = window.setInterval(function(){
                hora2=(hora.toLocaleString(undefined,{minimumIntegerDigits: 2}));
                minuto2=(minuto.toLocaleString(undefined,{minimumIntegerDigits: 2}));
                segundo2=(segundo.toLocaleString(undefined,{minimumIntegerDigits: 2}));
                $('#tiempoDuracion').html("<h3 class='text-danger'><strong>"+ hora2 + ":"+ minuto2 +":"+segundo2 + "<strong></h3>");
                segundo++;
                if(segundo==60){
                    minuto++;
                    segundo=0;
                }else if(minuto==60 ){
                    hora++;
                    minuto = 0;
                }
            },1000);
        }

        $('#btnEjecutarOT').click(function(){
            $('#btnEjecutarOT').hide();
            var orden= $('#id').val();
            $.ajax({
                url: '/ordenTaller/ComenzarEjecucion',
                data: {
                    id_orden: $('#id').val(),
                    ope:1,
                },
                type: 'post',
                dataType: 'json',
                cache: false,
                success: function (data) {
                    console.log(data)
                    if(data!=0){
                        swal("Iniciado!", "La Orden de Taller ha iniciado ejecución de operaciones.", "success");
                        CargarDatosPorOrdenId();
                    }
                }
            });
        });

        $('#comenzar').click(function(){
            $('#comenzar').hide();
            var orden= $('#id').val();
            $.ajax({
                url: '/ordenTaller/ComenzarEjecucion',
                data: {
                    id_orden: $('#id').val(),
                    ope:1,
                },
                type: 'post',
                dataType: 'json',
                cache: false,
                success: function (data) {
                    console.log(data)
                    if(data!=0){
                        swal("Iniciado!", "La Orden de Taller ha iniciado ejecución de operaciones.", "success");
                        CargarDatosPorOrdenId();
                    }
                }
            });
        });

        $('#modalpausar').click(function () {
                       $('#observacionpausa').val('');
            $('#motivosdepausa').select(0);
            $("#motivosdepausa option[value='0'").attr('selected',true);
            $('#modalmtivopausa').modal('show');
              $('#tablaPaginadampausa').dataTable().fnDestroy();
               $.ajax({
                url: '/ordenTaller/GetObservacionespuasa',
                   data: {
                       idorden: $('#id').val()
                },
                type: "post",
                cache: false,
                success: function (data) {
                    $('#tablaPaginadampausa').find('tbody').empty();
                    var tabla = "";
                    console.log(data);
                    for (var i = 0; i < data.length; i++) {
                        tabla += "<tr>";
                        tabla += "<td align='left'>" + data[i] + "</td>";
                         tabla += "</tr>";
                     }
                       $('#tablaPaginadampausa').find('tbody').append(tabla);
                },
                complete: function (data) {
                    $('#tablaPaginadampausa').dataTable({
                        dom: "<''<'col-md-6'l><'col-md-6'f>>t<'col-md-4'i><'col-md-8 text-right'pB>",
                        "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
                        buttons: [
                            { extend: 'excel', className: 'btn-sm', text: 'Exportar a Excel' },
                        ]
                    });
                }
            })


        });

        function btnmodalpausa() {

            $('#mensajemodalpausa').hide();
            var observacionpausa = $('#observacionpausa').val();
            var motivo = $('#motivosdepausa option:selected').val();
            var clave = $('#claveseguridadmodalpuasa').val();
            var tecnico = $('#tecnico').val();

            if (observacionpausa != "" && motivo != "0" && clave != "") {
                $('#mensajemodalpausaclave').hide();
                $.ajax({
                    url: '/ordenTaller/ClaveSeguridadTecnico',
                    data: {
                        idtecnico: tecnico,
                        clave: clave,
                    },
                    type: 'post',
                    dataType: 'json',
                    cache: false,
                    success: function (data) {
                        console.log(data)
                        if (data) {
                            $('#pausar').trigger('click');
                            $('#modalmtivopausa').modal('hide');
                        } else {
                            $('#mensajemodalpausaclave').show();
                        }


                    }
                });

         } else {

                $('#mensajemodalpausa').show();

            }
        }

        $('#pausar').click(function(){
            $('#pausar').hide();
            var orden = $('#id').val();
              var observacionpausa = $('#observacionpausa').val();
            var motivo =  $('#motivosdepausa option:selected').val();
            $.ajax({
                url: '/ordenTaller/ComenzarEjecucion',
                data: {
                    id_orden: $('#id').val(),
                    ope: 2,
                    motivo: motivo,
                    observacionpausa: observacionpausa
                },
                type: 'post',
                dataType: 'json',
                cache: false,
                success: function (data) {
                    console.log(data)
                    if(data!=0){
                        swal("Pausado!", "La Orden de Taller ha sido pausada.", "success");
                        clearInterval(counter);
                        CargarDatosPorOrdenId();
                    }
                }
            });
        });




        $('#despausar').click(function () {
              $('#mensajeReiniciarclave').hide();
            $('#modalclavereanudar').modal('show');
             $('#claveseguridadreiniciar').val("");
        });

        function btndespausar() {

            var clave = $('#claveseguridadreiniciar').val();
            var tecnico = $('#tecnico').val();
                $.ajax({
                    url: '/ordenTaller/ClaveSeguridadTecnico',
                    data: {
                        idtecnico: tecnico,
                        clave: clave,
                    },
                    type: 'post',
                    dataType: 'json',
                    cache: false,
                    success: function (data) {
                        console.log(data)
                        if (data) {
                            despausar();
                          $('#modalclavereanudar').modal('hide');
                        } else {
                            $('#mensajeReiniciarclave').show();
                        }


                    }
                });



        }


        function despausar() {
               $('#despausar').hide();
            var orden= $('#id').val();
            $.ajax({
                url: '/ordenTaller/ComenzarEjecucion',
                data: {
                    id_orden: $('#id').val(),
                    ope:3,
                },
                type: 'post',
                dataType: 'json',
                cache: false,
                success: function (data) {
                    console.log(data)
                    if(data!=0){
                        swal("Iniciado!", "Se ha reanudado la ejecución de La Orden de Taller.", "success");
                        CargarDatosPorOrdenId();
                    }
                    else{
                        swal("Error!", "Se ha presentado un error ", "error");

                    }
                }
            });

        }


        $('#finalizar').click(function(){
           $('#mensajeFinalizarclave').hide();
            $('#modalclavefinalizar').modal('show');
             $('#claveseguridadfinalizar').val("");
        });

        function btnfinalizar() {

            var clave = $('#claveseguridadfinalizar').val();
            var tecnico = $('#tecnico').val();
                $.ajax({
                    url: '/ordenTaller/ClaveSeguridadTecnico',
                    data: {
                        idtecnico: tecnico,
                        clave: clave,
                    },
                    type: 'post',
                    dataType: 'json',
                    cache: false,
                    success: function (data) {

                        if (data) {
                            validarchecklist();
                       

                        } else {
                            $('#mensajeFinalizarclave').show();
                        }


                    }
                });


        }



        function validarchecklist() {
      $('#mensajevalidar').text('');
            if ($('#listinicialvh').prop('checked') != false) {
                $.ajax({
                    url: '/ordenTaller/validarInspeccion',
                    data: {
                        idorden: $('#id').val(),
                    },
                    type: 'post',
                    dataType: 'json',
                    cache: false,
                    success: function (data) {
                        if (data.fecha_inicio_inspeccion != null) {
                            if (data.fecha_inspeccion != null) {
                                finalizar();
                                $('#modalclavefinalizar').modal('hide');
                            } else {
                                $('#mensajevalidar').text('No a finaliozado la inspeccion de signos vitales');

                            }
                        } else {
                         $('#mensajevalidar').text('No a iniciado una inspeccion de signos vitales');
                        }



                    }
                });
            } else {            
                
              $('#mensajevalidar').text('Debe tener marcado la casilla de inspeccion de signos vitales');

            }

        }

        function finalizar() {

                $('#finalizar').hide();
            var orden = $('#id').val();
            console.log($('#tiempoDuracion').text());

            $.ajax({
                url: '/ordenTaller/ComenzarEjecucion',
                data: {
                    id_orden: $('#id').val(),
                    ope:4,
                },
                type: 'post',
                dataType: 'json',
                cache: false,
                success: function (data) {

                    if(data!=0){
                        swal("Finalizado!", "La ejecución de la orden de taller ha finalizado satisfactoriamente", "success");
                        clearInterval(counter);
                        $('#paneloperacionesnormal').hide();
                        CargarDatosPorOrdenId();
                        Permisos();
                    }
                    else{
                        swal("Error!", "Se ha presentado un error ", "error");
                    }
                }
            });


        }


        function Detener() {

               $('#finalizar').hide();
            var orden= $('#id').val();
             if(data!=0){
                        swal("Iniciado!", "La ejecución de la orden de taller ha finalizado satisfactoriamente", "success");
                        clearInterval(counter);
                        $('#paneloperacionesnormal').hide();
                        CargarDatosPorOrdenId();
                    }
                    else{
                        swal("Error!", "Se ha presentado un error ", "error");
                    }
        }

        function GuardarOnservacion() {

            var id = $('#id').val();
            var observacion = $("#observacioncancel").val();

              $.ajax({
                url: '/ordenTaller/CerrarSinOperacion',
                data: {
                    id_orden: $('#id').val(),
                    observacion: observacion
                },
                type: 'post',
                cache: false,
                success: function (data) {
                    $('#modal_cancelar').modal('hide');
                    window.location.href = '@Url.Action("Update", "ordenTaller")?menu=' +@ViewBag.id_menu+'&&id=' + id;
                    Detener();
                }
            });
        }




        $('#btncerrarsinop').click(function () {
            swal({
                title: "Esta seguro que desea cerrar la Orden de Trabajo?",
                text: "La orden de trabajo se cerrara sin operacion ",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                confirmButtonText: "Si, Eliminar!",
                cancelButtonText: "No, cancelar!",
                closeOnConfirm: true,
                closeOnCancel: false
            },
                function (isConfirm) {
                    if (isConfirm) {


                        $('#modal_cancelar').modal('show');

                    } else {
                        swal("Cancelado", "Se ha cancelado la operación", "error");
                    }
                });
        });
        //$('#tipoTarifa').change(function(){
        //    if ($('#tipoTarifa').val() == parseInt(1) || $('#tipoTarifa').val() == parseInt(3) || $('#tipoTarifa').val() == parseInt(4)) {
        //        $('#nitTipoTarifa').val($('#docTerceroBuscado').val());
        //        if ($('#operacionesTempario').val() != "") {
        //            $.ajax({
        //                url: '/ordenTaller/BuscarDescuentoOperacion',
        //                data: {
        //                    tarifa: $('#tipoTarifa').val(),
        //                    operacion: $('#operacionesTempario').val(),
        //                    tercero: $('#nitTipoTarifa').val()
        //                },
        //                type: 'post',
        //                dataType: 'json',
        //                cache: false,
        //                success: function (data) {
        //                    console.log('que hubo chino')
        //                    console.log(data)
        //                    $('#txtDescuentoOperacion').val(data);
        //                }
        //            })
        //        }
        //    }
        //    if ($('#tipoTarifa').val() == parseInt(2)) {
        //        $.ajax({
        //            url: '/ordenTaller/BuscarNitTarifa',
        //            data: {
        //                tarifa: $('#tipoTarifa').val(),
        //            },
        //            type: 'post',
        //            dataType: 'json',
        //            cache: false,
        //            success: function (data) {
        //                console.log(data)
        //                $('#nitTipoTarifa').val(data);
        //                if ($('#operacionesTempario').val() != "") {
        //                    $.ajax({
        //                        url: '/ordenTaller/BuscarDescuentoOperacion',
        //                        data: {
        //                            tarifa: $('#tipoTarifa').val(),
        //                            operacion: $('#operacionesTempario').val(),
        //                            tercero: $('#nitTipoTarifa').val()
        //                        },
        //                        type: 'post',
        //                        dataType: 'json',
        //                        cache: false,
        //                        success: function (data) {
        //                            console.log('que hubo chino')
        //                            console.log(data)
        //                            $('#txtDescuentoOperacion').val(data);
        //                        }
        //                    })
        //                }
        //            }
        //        })
        //    }
        //    if($('#tipoTarifa').val() == parseInt(5)){
        //        $.ajax({
        //            url: '/ordenTaller/BuscarNitAseguradora',
        //            data: {
        //                aseguradora: $('#aseguradora').val()
        //            },
        //            type: 'post',
        //            dataType: 'json',
        //            cache: false,
        //            success: function (data) {
        //                $('#nitTipoTarifa').val(data);
        //                if ($('#operacionesTempario').val() != "") {
        //                    $.ajax({
        //                        url: '/ordenTaller/BuscarDescuentoOperacion',
        //                        data: {
        //                            tarifa: $('#tipoTarifa').val(),
        //                            operacion: $('#operacionesTempario').val(),
        //                            tercero: $('#nitTipoTarifa').val()
        //                        },
        //                        type: 'post',
        //                        dataType: 'json',
        //                        cache: false,
        //                        success: function (data) {
        //                            console.log('que hubo chino')
        //                            console.log(data)
        //                            $('#txtDescuentoOperacion').val(data);
        //                        }
        //                    })
        //                }
        //            }
        //        });
        //    }
        //});

        //$('#operacionesTempario').change(function(){
        //    $.ajax({
        //        url: '/ordenTaller/BuscarDescuentoOperacion',
        //        data: {
        //            tarifa: $('#tipoTarifa').val(),
        //            operacion: $('#operacionesTempario').val(),
        //            tercero: $('#nitTipoTarifa').val()
        //        },
        //        type: 'post',
        //        dataType: 'json',
        //        cache: false,
        //        success: function (data) {
        //            $('#txtDescuentoOperacion').val(data);
        //        }
        //    })
        //});

        $('#repuestos').change(function () {
            $.ajax({
                url: '/ordenTaller/BuscarReferencia',
                data: {
                    codigo_referencia: $('#repuestos').val(),
                    documento_cliente: $('#documentoBuscadoCliente').val()
                },
                type: 'post',
                dataType: 'json',
                cache: false,
                success: function (data) {
                    if (data.error == false) {
                        $('#nombre_repuesto').val(data.referenciaEncontrada.ref_descripcion);
                        $('#txtPrecioRepuesto').val(addComas(data.referenciaEncontrada.precio));
                        $('#txtPorIvaRepuesto').val(data.referenciaEncontrada.por_iva);
                        //$('#txtValorIvaRepuesto').val(addComas(data.referenciaEncontrada.valorIva));
                        $('#txtPorDsctoRepuesto').val(data.referenciaEncontrada.por_dscto);
                        //$('#txtValorDsctoRepuesto').val(addComas(data.referenciaEncontrada.valor_dscto));
                    } else {
                        $('#mensajeAlertaAgregarRepuesto').text(data.errorMessage);
                        $('#alertaAgregarRepuesto').show();
                        setTimeout(function () {
                            $("#alertaAgregarRepuesto").fadeOut(2500);
                        }, 10000);
                    }
                }
            });
        });


        $('#repuestosG').change(function(){
            $.ajax({
                url: '/ordenTaller/BuscarReferencia',
                data: {
                    codigo_referencia: $('#repuestosG').val(),
                    documento_cliente: $('#documentoBuscadoCliente').val()
                },
                type: 'post',
                dataType: 'json',
                cache: false,
                success: function (data) {
                    if (data.error == false) {
                        $('#nombre_repuesto').val(data.referenciaEncontrada.ref_descripcion);
                        $('#txtPrecioRepuesto').val(addComas(data.referenciaEncontrada.precio));
                        $('#txtPorIvaRepuesto').val(data.referenciaEncontrada.por_iva);
                        //$('#txtValorIvaRepuesto').val(addComas(data.referenciaEncontrada.valorIva));
                        $('#txtPorDsctoRepuesto').val(data.referenciaEncontrada.por_dscto);
                        //$('#txtValorDsctoRepuesto').val(addComas(data.referenciaEncontrada.valor_dscto));
                    } else {
                        $('#mensajeAlertaAgregarRepuesto').text(data.errorMessage);
                        $('#alertaAgregarRepuesto').show();
                        setTimeout(function () {
                            $("#alertaAgregarRepuesto").fadeOut(2500);
                        }, 10000);
                    }
                }
            });
        });


        $('#txtCantidadRepuesto').keyup(function () {
            var valorDescuento = Math.round(parseInt(quitCommas($('#txtPrecioRepuesto').val())) * parseInt(quitCommas($('#txtCantidadRepuesto').val())) * ($('#txtPorDsctoRepuesto').val() / 100));
            var valorIVA = Math.round((parseInt(quitCommas($('#txtPrecioRepuesto').val())) * parseInt(quitCommas($('#txtCantidadRepuesto').val())) - valorDescuento) * ($('#txtPorIvaRepuesto').val() / 100));
            $('#txtValorDsctoRepuesto').val(addComas(valorDescuento));
            $('#txtValorIvaRepuesto').val(addComas(valorIVA));
        });

        $('#txtCantidadReferencia').keyup(function () {

            var cantidad = $('#txtCantidadReferencia').val() == "" ? 0 : parseInt(quitCommas($('#txtCantidadReferencia').val()));
            var valorDescuentoR = Math.round((parseInt(quitCommas($('#txtPrecioReferencia').val())) * cantidad * ($('#txtPorDsctoReferencia').val() / 100)));
            var valorIVAR = Math.round((parseInt(quitCommas($('#txtPrecioReferencia').val())) * cantidad - valorDescuentoR) * ($('#txtPorIvaReferencia').val() / 100))
            var valorTotalR = Math.round(parseInt(quitCommas($('#txtPrecioReferencia').val())) * cantidad - valorDescuentoR + valorIVAR);
            $('#txtValorDsctoReferencia').val(addComas(valorDescuentoR));
            $('#txtValorIvaReferencia').val(addComas(valorIVAR));
            $('#txtPrecioTotalReferencia').val(addComas(valorTotalR));

        });

        $('#btnAgregarRepuesto').click(function(){

            if($('#repuestos').val() != '' && $('#txtCantidadRepuesto').val() != ''){
                if ($('#txtCantidadRepuesto').val() > 0) {
                    var calcularTotal = ($('#txtCantidadRepuesto').val() * parseInt(quitCommas($('#txtPrecioRepuesto').val())) - parseInt(quitCommas($('#txtValorDsctoRepuesto').val())) + parseInt(quitCommas($('#txtValorIvaRepuesto').val())));

                    $.ajax({
                        url: '/ordenTaller/AgregarRepuesto',
                        data: {
                            orden: $('#id').val(),
                            codigorepuesto: $('#repuestos').val(),
                            cantidad: $('#txtCantidadRepuesto').val(),
                            preciounitario: $('#txtPrecioRepuesto').val(),
                            porcentajeiva: $('#txtPorIvaRepuesto').val(),
                            porcentajedescuento: $('#txtPorDsctoRepuesto').val()
                        },
                        type: 'post',
                        dataType: 'json',
                        cache: false,
                        success: function (data) {
                            if(data!=0){
                                numeroRepuesto++;
                                $('#numeroRepuestos').val(numeroRepuesto);
                                $('#repuestos').val('').select2();
                                $('#txtCantidadRepuesto').val('');
                                $('#txtPrecioRepuesto').val('');
                                $('#txtPorIvaRepuesto').val('');
                                $('#txtValorIvaRepuesto').val('');
                                $('#txtPorDsctoRepuesto').val('');
                                $('#txtValorDsctoRepuesto').val('');
                                CargarDatosPorOrdenId();
                            }
                        }
                    });

                }else {
                    $('#mensajeAlertaAgregarRepuesto').text('No puedes agregar referencias cuya cantidad es 0');
                    $('#alertaAgregarRepuesto').show();
                    setTimeout(function () {
                        $("#alertaAgregarRepuesto").fadeOut(2500);
                    }, 10000);
                }
            }
            else if($('#repuestosG').val() != '' && $('#txtCantidadRepuesto').val() != ''){
                if ($('#txtCantidadRepuesto').val() != 0){
                    var calcularTotal = ($('#txtCantidadRepuesto').val() * parseInt(quitCommas($('#txtPrecioRepuesto').val())) - parseInt(quitCommas($('#txtValorDsctoRepuesto').val())) + parseInt(quitCommas($('#txtValorIvaRepuesto').val())));

                    $.ajax({
                        url: '/ordenTaller/AgregarRepuesto',
                        data: {
                            orden: $('#id').val(),
                            codigorepuesto: $('#repuestosG').val(),
                            cantidad: $('#txtCantidadRepuesto').val(),
                            preciounitario: $('#txtPrecioRepuesto').val(),
                            porcentajeiva: $('#txtPorIvaRepuesto').val(),
                            porcentajedescuento: $('#txtPorDsctoRepuesto').val()
                        },
                        type: 'post',
                        dataType: 'json',
                        cache: false,
                        success: function (data) {
                            if(data!=0){
                                numeroRepuesto++;
                                $('#numeroRepuestos').val(numeroRepuesto);
                                $('#repuestos').val('').select2();
                                $('#txtCantidadRepuesto').val('');
                                $('#txtPrecioRepuesto').val('');
                                $('#txtPorIvaRepuesto').val('');
                                $('#txtValorIvaRepuesto').val('');
                                $('#txtPorDsctoRepuesto').val('');
                                $('#txtValorDsctoRepuesto').val('');
                                CargarDatosPorOrdenId();
                            }
                        }
                    });

                }else {
                    $('#mensajeAlertaAgregarRepuesto').text('No puedes agregar referencias cuya cantidad es 0');
                    $('#alertaAgregarRepuesto').show();
                    setTimeout(function () {
                        $("#alertaAgregarRepuesto").fadeOut(2500);
                    }, 10000);
                }
            }
            else{
                $('#mensajeAlertaAgregarRepuesto').text('Debe digitar una referencia y una cantidad');
                $('#alertaAgregarRepuesto').show();
                setTimeout(function () {
                    $("#alertaAgregarRepuesto").fadeOut(2500);
                }, 10000);
            }
        });

        function quitCommas(nStr) {
            nStr.toString();
            var s = nStr.replace(/\./g, "");
            return s;
        }

        function eliminarOperacionBD(id) {
            swal({
                title: "Esta seguro que desea eliminar?",
                text: "El registro se eliminara de la base de datos",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                confirmButtonText: "Si, Eliminar!",
                cancelButtonText: "No, cancelar!",
                closeOnConfirm: false,
                closeOnCancel: false
            },
                function (isConfirm) {
                    if (isConfirm) {
                        $.ajax({
                            url: '/ordenTaller/EliminarOperacion',
                            data: {
                                id: id
                            },
                            type: "post",
                            cache: false,
                            success: function () {
                                swal("Eliminado!", "El registro se ha eliminado correctamente.", "success");
                                CargarDatosPorOrdenId();
                                cargarTablas()
                                //location.reload(true);
                            }
                        });

                    } else {
                        swal("Cancelado", "Se ha cancelado la operación", "error");
                    }
                });
        }
        //buscardatospororden
        function eliminarRepuestoBD(id) {
            swal({
                title: "Esta seguro que desea eliminar?",
                text: "El registro se eliminara de la base de datos",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                confirmButtonText: "Si, Eliminar!",
                cancelButtonText: "No, cancelar!",
                closeOnConfirm: false,
                closeOnCancel: false
            },
                function (isConfirm) {
                    if (isConfirm) {
                        $.ajax({
                            url: '/ordenTaller/EliminarRepuesto',
                            data: {
                                id: id
                            },
                            type: "post",
                            cache: false,
                            success: function () {
                                swal("Eliminado!", "El registro se ha eliminado correctamente.", "success");
                                CargarDatosPorOrdenId();
                                //location.reload(true);
                            }
                        });

                    } else {
                        swal("Cancelado", "Se ha cancelado la operación", "error");
                    }
                });
        }

        function eliminarRepuesto(pos){
            $("#rowRepuesto" + pos + "").remove();
        }
        //$('#razon_secundaria').change(function(){
        //    verificargarantia();
        //});

        $('#razoningreso').change(function(){
            verificargarantia();
            var razon=$("#razoningreso option:selected").text();
            if(razon.indexOf("Colision") >= 0){
                $('#areaRazonIngreso').show();
            }
            else{
                $('#areaRazonIngreso').hide();
                $('#aseguradora').val('');
                $('#poliza').val('');
                $('#siniestro').val('');
                $('#minimoOrden').val('');
                $('#deducibleOrden').val('');
                $('#aseguradora').val('').trigger('change');
            }

            //$.ajax({
            //    url: '/ordenTaller/buscarRazonesSecundarias',
            //    data: {
            //        razonprimaria: $('#razoningreso').val(),
            //    },
            //    type: 'post',
            //    dataType: 'json',
            //    cache: false,
            //    success: function (data) {
            //        $('#razon_secundaria').empty();
            //        if (data != 0) {
            //            if (data.length > 0) {
            //                var ope = "";
            //                ope += ' <option value="">Seleccione</option>'

            //                for (var j = 0; j < data.length; j++) {
            //                    ope += ' <option value="' + data[j].id + '">' + data[j].nombre + '</option>'
            //                }
            //                $('#razon_secundaria').append(ope);
            //            }
            //            $('#razon_secundaria').val("").trigger('change');
            //        }
            //    }
            //})
        });
        //function editarRepuesto(pos){
        //    var porcentajeIva = $('#porIvaRepuesto'+pos+'').val();
        //    var porcentajeDescuento = $('#porDsctRepuesto'+pos+'').val();
        //    var precio = $('#precioRepuesto'+pos+'').val();
        //    var valorIva = parseFloat($('#precioRepuesto'+pos+'').val())*$('#porIvaRepuesto'+pos+'').val()/100;
        //    var valorDescuento = parseFloat($('#precioRepuesto'+pos+'').val())*$('#porDsctRepuesto'+pos+'').val()/100;
        //    var valorTotal = (parseFloat(precio)+ valorIva - valorDescuento) * parseFloat($('#cantidadRepuesto'+pos+'').val())
        //    $('#txtIdFilaEditadaRepuesto').val(pos);
        //    $('#txtCodigoReferencia').val($('#codigoRepuesto'+pos+'').val());
        //    $('#txtNombreReferencia').val($('#nombreRepuesto'+pos+'').val());
        //    $('#txtCantidadReferencia').val(addComas($('#cantidadRepuesto'+pos+'').val()));
        //    $('#txtPrecioReferencia').val(addComas($('#precioRepuesto'+pos+'').val()));
        //    $('#txtPorIvaReferencia').val($('#porIvaRepuesto'+pos+'').val());
        //    $('#txtValorIvaReferencia').val(addComas(valorIva));
        //    $('#txtPorDsctoReferencia').val($('#porDsctRepuesto'+pos+'').val());
        //    $('#txtValorDsctoReferencia').val(addComas(valorDescuento));
        //    $('#txtPrecioTotalReferencia').val(addComas(valorTotal));
        //    $('#modalEditarReferencia').modal('show');
        //}

        function editarRepuesto(pos){
            $.ajax({
                url: '/ordenTaller/EditarRepuesto',
                data: {
                    repuesto:pos,
                },
                type: 'post',
                dataType: 'json',
                cache: false,
                success: function (data) {
                    if(data!=0){
                        var porcentajeIva = data.porcentajeIva;
                        var porcentajeDescuento = data.porcentajeDescuento;
                        var precio = data.precio;
                        var valorIva = data.valorIva;
                        var valorDescuento = data.valorDescuento;
                        var valorTotal = data.ValorTotal;
                        $('#txtIdFilaEditadaRepuesto').val(data.id);
                        $('#txtCodigoReferencia').val(data.codigo);
                        $('#txtNombreReferencia').val(data.nombreReferencia);
                        $('#txtCantidadReferencia').val(data.cantidad);
                        $('#txtPrecioReferencia').val(addComas(data.precio));
                        $('#txtPorIvaReferencia').val(data.porcentajeIva);
                        $('#txtValorIvaReferencia').val(addComas(data.valorIva));
                        $('#txtPorDsctoReferencia').val(data.porcentajeDescuento);
                        $('#txtValorDsctoReferencia').val(addComas(data.valorDescuento));
                        $('#txtPrecioTotalReferencia').val(addComas(data.valorTotal));
                        $('#modalEditarReferencia').modal('show');
                    }
                }
            });

            var porcentajeIva = $('#porIvaRepuesto'+pos+'').val();
            var porcentajeDescuento = $('#porDsctRepuesto'+pos+'').val();
            var precio = $('#precioRepuesto'+pos+'').val();
            var valorIva = parseFloat($('#precioRepuesto'+pos+'').val())*$('#porIvaRepuesto'+pos+'').val()/100;
            var valorDescuento = parseFloat($('#precioRepuesto'+pos+'').val())*$('#porDsctRepuesto'+pos+'').val()/100;
            var valorTotal = (parseFloat(precio)+ valorIva - valorDescuento) * parseFloat($('#cantidadRepuesto'+pos+'').val())
            $('#txtIdFilaEditadaRepuesto').val(pos);
            $('#txtCodigoReferencia').val($('#codigoRepuesto'+pos+'').val());
            $('#txtNombreReferencia').val($('#nombreRepuesto'+pos+'').val());
            $('#txtCantidadReferencia').val(addComas($('#cantidadRepuesto'+pos+'').val()));
            $('#txtPrecioReferencia').val(addComas($('#precioRepuesto'+pos+'').val()));
            $('#txtPorIvaReferencia').val($('#porIvaRepuesto'+pos+'').val());
            $('#txtValorIvaReferencia').val(addComas(valorIva));
            $('#txtPorDsctoReferencia').val($('#porDsctRepuesto'+pos+'').val());
            $('#txtValorDsctoReferencia').val(addComas(valorDescuento));
            $('#txtPrecioTotalReferencia').val(addComas(valorTotal));
            $('#modalEditarReferencia').modal('show');
        }

        $('#btnModificarReferencia').click(function(){
            if($('#txtCantidadReferencia').val() == '' || $('#txtIdFilaEditadaRepuesto').val() == ''){
              /*  $('#mensajeAlertaAgregarOperacion').text('Debe digitar tarifa, operacion, tecnico y cliente para poder agregar');
                $('#alertaAgregarOperacion').show();
                setTimeout(function () {
                    $("#alertaAgregarOperacion").fadeOut(2500);
                }, 10000);*/
            }
            else{
                $.ajax({
                    url: '/ordenTaller/GuardarEdicionRepuesto',
                    data: {
                        idrepuesto: $('#txtIdFilaEditadaRepuesto').val(),
                        cantidad: $('#txtCantidadReferencia').val(),
                    },
                    type: 'post',
                    dataType: 'json',
                    cache: false,
                    success: function (data) {
                        if(data!=0){
                            swal("Modificado!", "El registro se ha modificado correctamente.", "success");
                            $('#modalEditarReferencia').modal('hide');
                            CargarDatosPorOrdenId();
                        }
                        else{

                        }
                    }
                });
            }
        });

        function buscarAverias() {
            $.ajax({
                url: '/ordenTaller/buscarAverias',
                data: {
                    ot: $('#id').val()
                },
                type: 'post',
                cache: false,
                success: function (data) {
                    $('#tabla_averias').find('tbody').empty();
                    for (var i = 0; i < data.length; i++) {
                        $('#tabla_averias').find('tbody').append(
                            '<tr>'
                            + '<td align="center">' + data[i].planmayor + '</td>'
                            + '<td align="center">' + data[i].fecha + '</td>'
                            + '<td align="left">' + data[i].observacion + '</td>'
                            + '<td align="left">' + data[i].averia + '</td>'
                            + '<td align="left">' + data[i].impacto + '</td>'
                            + '<td align="left">' + data[i].zona + '</td>'
                            + '</tr>'
                        );
                    }
                }
            });
        }

        function agregarGarantia() {
            var id = $('#placa').val();

            $.ajax({
                url: '/ordenTaller/agregarGarantia',
                data: {
                    id: id
                },
                type: "post",
                cache: false,
                success: function (result) {

                    if (result == 1) {
                        swal("Exito", "Se asigno garantía", "success");
                    } else {
                        swal("Error", "Error al asignar garantía", "error");
                    }

                }
            })
        }

        $('#btnAgregarOperacion').click(function(){
            if($('#tipoTarifa').val() == '' || $('#operacionesTempario').val() == '' || $('#tecnico').val() == '' || $('#id_cliente').val() == ''){
                $('#mensajeAlertaAgregarOperacion').text('Debe digitar tarifa, operacion, tecnico y cliente para poder agregar');
                $('#alertaAgregarOperacion').show();
                setTimeout(function () {
                    $("#alertaAgregarOperacion").fadeOut(2500);
                }, 10000);
            }else{
                $.ajax({
                    url: '/ordenTaller/BuscarTiempoTemparioOT',
                    data: {
                        idorden: $('#id').val(),
                        codigoOperacion: $('#operacionesTempario').val(),
                        id_cliente: $('#id_cliente').val(),
                        tipo_tarifa: $('#tipoTarifa').val(),
                        tecnico: $('#tecnico').val(),
                        //descuento: $('#txtDescuentoOperacion').val()
                    },
                    type: 'post',
                    dataType: 'json',
                    cache: false,
                    success: function (data) {

                        if (data.existeTarifa == false) {
                            $('#mensajeAlertaAgregarOperacion').text(data.mensajeExisteTarifa);
                            $('#alertaAgregarOperacion').show();
                            setTimeout(function () {
                                $("#alertaAgregarOperacion").fadeOut(2500);
                            }, 10000);
                        } else {
                            $('#tablaOperacionesPorPlaca').find('tbody').append('<tr id="rowOperaciones' + data.idope + '">'
                                + '<td align="left">'
                                + '<input style="display:none" type="text" id="codigoOperacion' + data.idope + '" name="codigoOperacion' + data.idope + '" value="' + $('#operacionesTempario').val() + '"/>'
                                + $('#operacionesTempario').val()
                                + '</td>'
                                + '<td align="left">'
                                + $("#operacionesTempario option:selected").text()
                                + '</td>'
                                //+'<td align="left">'
                                //    +'<input style="display:none" type="text" id="tipoTarifa' + numeroOperacion+'" name="tipoTarifa'+ numeroOperacion + '" value="' + $('#tipoTarifa').val() + '"/>'
                                //    + $("#tipoTarifa option:selected").text()
                                //+'</td>'
                                + '<td align="left">'
                                + '<input style="display:none" type="text" id="id_tecnico' + data.idope + '" name="id_tecnico' + data.idope + '" value="' + data.idTecnico + '"/>'
                                + $("#tecnico option:selected").text()
                                + '</td>'
                                + '<td align="right">'
                                + '<input style="display:none" type="text" id="tiempo' + data.idope + '" name="tiempo' + data.idope + '" value="' + data.tiempo + '"/>'
                                + data.tiempo
                                + '</td>'
                                + '<td align="right">'
                                + '<input style="display:none" type="text" id="precio' + data.idope + '" name="precio' + data.idope + '" value="' + data.precio + '"/>$ '
                                + addComas(data.precio)
                                + '</td>'
                                //+'<td align="right">'
                                //    +'<input style="display:none" type="text" id="descuento' + data.idope+'" name="descuento'+ data.idope + '" value="' + $('#txtDescuentoOperacion').val() + '"/>'
                                //    + $('#txtDescuentoOperacion').val()
                                //+'</td>'
                                + '<td align="right">'
                                + '<input style="display:none" type="text" id="descuentoV' + data.idope + '" name="descuentoV' + data.idope + '" value="' + data.valorDescuento + '"/>'
                                + addComas(data.valorDescuento)
                                + '</td>'
                                + '<td align="right">'
                                + '<input style="display:none" type="text" id="ivaOperacion' + data.idope + '" name="ivaOperacion' + data.idope + '" value="' + data.ivaOperacion + '"/>'
                                + data.ivaOperacion
                                + '</td>'
                                + '<td align="right">'
                                + '<input style="display:none" type="text" id="ValorIva' + data.idope + '" name="ValorIva' + data.idope + '" value="' + data.valorIva + '"/>$ '
                                + addComas(data.valorIva)
                                + '</td>'
                                + '<td align="right">'
                                + '<input style="display:none" type="text" id="ValorTotal' + data.idope + '" name="ValorTotal' + data.idope + '" value="' + data.valorTotal + '"/>$ '
                                + addComas(data.valorTotal)
                                + '</td>'
                                + '<td width="15%" style="text-align:center">'
                                + '<button type="button" class="btn btn-danger btn-xs" onclick="eliminarOperacion(' + data.idope + ')">&nbsp;&nbsp;<i class="fa fa-times"></i>&nbsp;&nbsp;</button>'
                                + '</td>'
                                + '</tr>');
                            numeroOperacion++;
                            $('#numeroOperaciones').val(numeroOperacion);
                            $('#tipoTarifa').val('').select2();
                            $('#operacionesTempario').val('').select2();
                            //$('#tecnico').val('').select2();
                            $('#txtDescuentoOperacion').val('');
                            CargarDatosPorOrdenId()
                        }
                    }
                });
            }
        });

        function eliminarOperacion(pos){
            $("#rowOperaciones" + pos + "").remove();
        }

        var enviarEsto;
        $('#btnSolicitarRepuestos').click(function(){
             $('#mensajeSolicitudrepclave').hide();
            $('#modalclavesolicitudrep').modal('show');
             $('#claveseguridadsolicitudrep').val("");
        });


        function btnsolicitudrep() {
                   var clave = $('#claveseguridadsolicitudrep').val();
            var tecnico = $('#tecnico').val();
                $.ajax({
                    url: '/ordenTaller/ClaveSeguridadTecnico',
                    data: {
                        idtecnico: tecnico,
                        clave: clave,
                    },
                    type: 'post',
                    dataType: 'json',
                    cache: false,
                    success: function (data) {

                        if (data) {
                            Solicitarrepuestos();
                          $('#modalclavesolicitudrep').modal('hide');
                        } else {
                            $('#mensajeSolicitudrepclave').show();
                        }


                    }
                });



        }

        function Solicitarrepuestos() {
              $( ".i-checks" ).each(function(index) {
                if  ($(this).prop('checked') && !$(this).prop('disabled')) {
                    k = index;

                    id_orden: $('#id').val()
                    if ($('#idRepuestoBD'+k+'').val() !="") {
                        enviarEsto = $('#idRepuestoBD'+k+'').val()
                    }else {
                        enviarEsto = null;
                    }
                    contadorRS++;
                    $('#listaReferenciasSolicitud').val(k);
                    var estadoo = $('#estadootform').val();
                    $.ajax({
                        url: '/ordenTaller/SolicitarRepuestos',
                        data: {
                            idOrden: $('#id').val(),
                            repuesto: $('#codigoRepuestoBD' + k + '').val(),
                            cantidad: $('#cantidadRepuestoBD' + k + '').val(),
                            precio: $('#precioRepuestoBD' + k + '').val(),
                            detalle: enviarEsto,
                            estadoot: estadoo
                        },
                        type: 'post',
                        dataType: 'json',
                        cache: false,
                        success: function (data) {
                            console.log('solicitud'+data)
                            if (data.error == false) {
                                $('#alertaSolicitudGuardadaRepuesto').removeClass("alert alert-danger").addClass("alert alert-success");
                                $('#alertaSolicitudGuardadaRepuesto').show();
                                $('#msjSolicitud').text('Se creo la solicitud del repuesto de manera exitosa');
                                CargarDatosPorOrdenId();

                            } else {
                                if (data.mensaje == "") {
                                    $('#alertaSolicitudGuardadaRepuesto').removeClass("alert alert-success").addClass("alert alert-danger");
                                    $('#alertaSolicitudGuardadaRepuesto').show();
                                    $('#msjSolicitud').text('Ya se realizo la solicitud del repuesto seleccionado');
                                } else {
                                    $('#alertaSolicitudGuardadaRepuesto').removeClass("alert alert-success").addClass("alert alert-danger");
                                    $('#alertaSolicitudGuardadaRepuesto').show();
                                    $('#msjSolicitud').text(data.mensaje);
                                }
                            }
                        }
                    });
                }
                CargarDatosPorOrdenId();
            });



        }


        var numero_miles = "";
        function formatNumber (n) {
            n = String(n).replace(/\D/g, "");
            return n === '' ? n : String(n).replace(/\B(?=(\d{3})+(?!\d))/g, ".");
        }

        function miles (id) {
            numero_miles = formatNumber($('#'+id+'').val());
            $('#'+id+'').val(numero_miles);
        }

        $('#txtTiempoEstimado').keyup(function(){
            var tiempo = 0;
            if($.trim($('#txtTiempoEstimado').val()) != ''){
                tiempo = parseFloat($('#txtTiempoEstimado').val());
            }
            if($('input[name="rbHorasDias"]:checked').val() == 'dias'){
                tiempo = tiempo * 24;
            }
            var fechaHoy = new Date();
            fechaHoy.setHours(fechaHoy.getHours() + tiempo);
            var d = fechaHoy.getDate();

            var m =  fechaHoy.getMonth();
            m += 1;  // JavaScript months are 0-11
            var y = fechaHoy.getFullYear();
            var hour = fechaHoy.getHours()
            var minutes = fechaHoy.getMinutes();
            $('#txtEntregaEstimado').val(d + "/" + m + "/" + y + " " + hour + ":" + minutes);
        });

        var cantidadContactosActual = 0;
        @*function buscarContactosCliente() {
            $.ajax({
                url: '/ordenTaller/BuscarContactosCliente',
                data: {
                    id_tercero: @ViewBag.tercero,
                },
                type: 'post',
                dataType: 'json',
                cache: false,
                success: function (data) {
                    if (data.buscarContactos.length != cantidadContactosActual) {
                        cantidadContactosActual = data.buscarContactos.length;
                        $('#recibidode').empty();
                        $('#recibidode').append($('<option>', {
                            value: '',
                            text: ''
                        }));
                        for (var i = 0; i < data.buscarContactos.length; i++) {
                            $('#recibidode').append($('<option>', {
                                value: data.buscarContactos[i].con_tercero_id,
                                text: data.buscarContactos[i].con_tercero_nombre
                            }));
                        }
                        $('#recibidode').append($('<option>', {
                            value: 'Otro',
                            text: 'Otro'
                        }));
                        $('#recibidode').val('').attr('display','visible:visible').select2();
                    }
                },
                complete: function () {
                    setTimeout(function () {
                        buscarContactosCliente(@ViewBag.tercero);
                    }, 12000);
                }
            })
        }*@

        $('#btnEditarSolicitud').click(function(){
            if($.trim($('#txtSolicitudClienteEditar').val()) != '' && $.trim($('#txtRespuestaClienteEditar').val()) != ''){
                $.ajax({
                    url: '/ordenTaller/actualizarSolicitud',
                    data: {
                        idsolicitud: $('#txtIdSolicitudEditada').val(),
                        solicitud:$('#txtSolicitudClienteEditar').val(),
                        respuesta:$('#txtRespuestaClienteEditar').val(),
                    },
                    type: "post",
                    cache: false,
                    success: function (data) {
                        if(data.valor!=0){
                            $('#modalEditarSolicitudCliente').modal('hide');
                        }
                    },
                    complete:function(data){
                        buscarSolicitudesCreadas($('#id').val());
                    }
                });
            }
        });

        //function eliminarSolicitud(pos){
        //    $.ajax({
        //        url: '/ordenTaller/actualizarSolicitud',
        //        data: {
        //            idsolicitud: $('#txtIdSolicitudEditada').val(),
        //            solicitud:$('#txtSolicitudClienteEditar').val(),
        //            respuesta:$('#txtRespuestaClienteEditar').val(),
        //        },
        //        type: "post",
        //        cache: false,
        //        success: function (data) {
        //            if(data.valor!=0){
        //                $('#modalEditarSolicitudCliente').modal('hide');
        //            }
        //        },
        //        complete:function(data){
        //            CargarDatosPorOrdenId();
        //        }
        //    });
        //    $("#row" + pos + "").remove();
        //}

        function editarSolicitud(pos){
            var valorAnterior = $('#solicitud'+pos+'').val();
            var respuestaAnterior = $('#respuesta'+pos+'').val();
            var idSolicitudAnterior = $('#idsolicitud'+pos+'').val();
            $('#txtRespuestaClienteEditar').val(respuestaAnterior);
            $('#txtIdSolicitudEditada').val(idSolicitudAnterior);
            $('#txtSolicitudClienteEditar').val(valorAnterior);
            $('#txtIdFilaEditada').val(pos);
            $('#modalEditarSolicitudCliente').modal('show');
        }

        $('#btnAgregarSolicitud').click(function(){
            if($.trim($('#txtSolicitudCliente').val()) != ''){
                var textosolicitud=$.trim($('#txtSolicitudCliente').val());
                var idorden=$('#id').val();
                $.ajax({
                    url: '/ordenTaller/agregarSolicitud',
                    data: {
                        idorden: idorden,
                        solicitud:textosolicitud,
                    },
                    type: "post",
                    cache: false,
                    success: function (data) {
                        if(data.valor!=0){
                            $('#modalEditarSolicitudCliente').modal('hide');
                            $('#txtSolicitudCliente').val('');
                        }
                    },
                    complete:function(data){
                        buscarSolicitudesCreadas($('#id').val());
                    }
                });
            }
        });
        //$('#btnAgregarSolicitud').click(function(){
        //    if($.trim($('#txtSolicitudCliente').val()) != ''){
        //        $('#tablaSolicitudes').find('tbody').append('<tr id="row'+ numeroSolicitud +'">'
        //                    +'<td align="center">'
        //                        +'<input style="display:none" type="text" id="solicitud'+numeroSolicitud+'" name="solicitud' + numeroSolicitud+'" value="' + $.trim($('#txtSolicitudCliente').val()) + '"/>'
        //                        + $.trim($('#txtSolicitudCliente').val())
        //                    +'</td>'
        //                    +'<td align="center">'
        //                        +'<input style="display:none" type="text" id="respuesta'+numeroSolicitud+'" name="respuesta'+ numeroSolicitud+'" value=""/>'
        //                        + ''
        //                    +'</td>'
        //                    +'<td width="15%" style="text-align:center">'
        //                        +'<button type="button" class="btn btn-danger btn-xs" onclick="eliminarSolicitud(' + numeroSolicitud + ')">&nbsp;&nbsp;<i class="fa fa-times"></i>&nbsp;&nbsp;</button>&nbsp;&nbsp;'
        //                        +'<button type="button" class="btn btn-warning btn-xs" onclick="editarSolicitud('  + numeroSolicitud + ')">&nbsp;&nbsp;<i class="fa fa-pencil-square-o"></i>&nbsp;&nbsp;</button>'
        //                    +'</td>'
        //                +'</tr>');
        //        numeroSolicitud++;
        //        $('#numeroSolicitudes').val(numeroSolicitud);
        //        $('#txtSolicitudCliente').val('');
        //    }
        //});

        @*$('#recibidode').change(function () {
            if ($('#recibidode').val() == 'Otro') {
                window.open('@Url.Action("update", "icb_terceros")?id=' + $('#tercero').val()+'&&menu='+@ViewBag.id_menu, '_blank');
            }
        });*@

        function buscarCliente() {
            $.ajax({
                url: '/ordenTaller/BuscarClientePorDocumento',
                data: {
                    id_tercero: @ViewBag.tercero,
                    documento: $('#txtDocumentoCliente').val()
                },
                type: 'post',
                dataType: 'json',
                cache: false,
                success: function (data) {
                    if (data.success == true) {
                        $('#documentoNoEncontrado').hide();
                        $('#documentoBuscado').text(data.buscarCliente.doc_tercero);
                        $('#documentoBuscadoCliente').val(data.buscarCliente.doc_tercero);
                        $('#docTerceroBuscado').val(data.buscarCliente.tercero_id);
                        $('#nombreBuscado').text(data.buscarCliente.nombres);
                        $('#telefonoBuscado').text(data.buscarCliente.telf_tercero);
                        $('#celularBuscado').text(data.buscarCliente.celular_tercero);
                        $('#emailBuscado').text(data.buscarCliente.email_tercero);
                        $('#ciudadBuscado').text('');
                        $('.areaClienteOculta').show();

                        $('#tercero').val(data.buscarCliente.tercero_id);
                        $('#id_cliente').val(data.buscarCliente.cltercero_id);
                        //buscarContactosCliente(data.buscarCliente.tercero_id);
                    } else {
                        $('#documentoNoEncontrado').show();
                        $('.areaClienteOculta').hide();
                        $('#documentoBuscado').text('');
                        $('#nombreBuscado').text('');
                        $('#telefonoBuscado').text('');
                        $('#celularBuscado').text('');
                        $('#emailBuscado').text('');
                        $('#ciudadBuscado').text('');
                        $('#tercero').val('');
                    }
                }
            });
        }

        $('#placa').keyup(function () {
            $('#placaNoEncontrada').hide();
            $('.areaVehiculoOculta').hide();
            $('#areaPanelCliente').hide();
        });

        $('#btnBuscarCliente').click(function () {
            buscarCliente(null);
        });

        $('#btnBuscarPlaca').click(function () {
            $.ajax({
                url: '/ordenTaller/BuscarVehiculoPorPlaca',
                data: {
                    placa: $('#placa').val()
                },
                type: 'post',
                dataType: 'json',
                cache: false,
                success: function (data) {
                    if (data.success == true) {
                        $('#placaNoEncontrada').hide();
                        $('#serieBuscado').text(data.buscarVehiculo.vin);
                        $('#numMotorBuscado').text(data.buscarVehiculo.nummot_vh);
                        $('#kilometrajeBuscado').text(data.buscarVehiculo.kilometraje);
                        $('#colorBuscado').text(data.buscarVehiculo.colvh_nombre);
                        $('#fechaVentaBuscado').text(data.buscarVehiculo.fecha_venta);
                        $('#fechaFinGarantiaBuscado').text(data.buscarVehiculo.fecha_fin_garantia);
                        $('#fechacompra').text(data.buscarVehiculo.fecfact_fabrica);
                        $('#aseguradoravh').text(data.buscarVehiculo.aseguradora);
                        $('#Modelovh').text(data.buscarVehiculo.modvh_nombre);
                        $('#flotavh').text(data.buscarVehiculo.flota);
                         $('#Consecionariovh').text(data.buscarVehiculo.concesionario);

                        $('.areaVehiculoOculta').show();
                        $('#areaPanelCliente').show();

                        // Validacion para propietario del vehiculo si existe
                        if (data.buscarVehiculo.propietario == null || data.buscarVehiculo.propietario == '') {
                            $('#documentoNoEncontrado').show();
                            $('#areaTxtBuscarDocumento').show();
                            $('.areaClienteOculta').hide();
                        } else {
                            $('#documentoNoEncontrado').hide();
                            $('#areaTxtBuscarDocumento').hide();
                            buscarCliente(data.buscarVehiculo.propietario);
                        }
                    } else {
                        $('#placaNoEncontrada').show();
                        $('.areaVehiculoOculta').hide();
                        $('#areaPanelCliente').hide();
                        $('#serieBuscado').text('');
                        $('#numMotorBuscado').text('');
                        $('#kilometrajeBuscado').text('');
                        $('#colorBuscado').text('');
                        $('#fechaVentaBuscado').text('');
                        $('#fechaFinGarantiaBuscado').text('');
                    }
                }
            });
        });

        $('#cerrarModalOrdenCreada').click(function () {
            $('#modalOrdenCreada').hide();
        });

        function buscarSolicitudesCreadas(idOrden){
            $.ajax({
                url: '/ordenTaller/BuscarSolicitudesPorOrden',
                data: {
                    id_orden: $('#id').val()
                },
                type: "post",
                cache: false,
                success: function (data) {
                    $('#tablaSolicitudes').find('tbody').empty();
                    for (var i = 0; i < data.length; i++) {
                        $('#tablaSolicitudes').find('tbody').append('<tr id="row' + numeroSolicitud + '">'
                            + '<td align="center">'
                            + '<input style="display:none" type="text" id="solicitud' + numeroSolicitud + '" name="solicitud' + numeroSolicitud + '" value="' + data[i].solicitud + '"/>'
                            + '<input style="display:none" type="text" id="idsolicitud' + numeroSolicitud + '" name="idsolicitud' + numeroSolicitud + '" value="' + data[i].idsolicitud + '"/>'
                            + data[i].solicitud
                            + '</td>'
                            + '<td align="center">'
                            + '<input style="display:none" type="text" id="respuesta' + numeroSolicitud + '" name="respuesta' + numeroSolicitud + '" value="' + data[i].respuesta + '"/>'
                            + data[i].respuesta
                            + '</td>'
                            + '<td width="15%" style="text-align:center">'
                            + '<button type="button" class="btn btn-warning btn-xs" onclick="editarSolicitud(' + numeroSolicitud + ')">&nbsp;&nbsp;<i class="fa fa-pencil-square-o"></i>&nbsp;&nbsp;</button>'
                            + '</td>'
                            + '</tr>');
                        numeroSolicitud++;
                        $('#numeroSolicitudes').val(numeroSolicitud);
                    }
                }
            });
        }


        function abrirmodalfecha() {
                $.ajax({
                url: '/ordenTaller/FechaEntrega',
                data: {
                 idorden: $('#id').val()
                },
                type: 'post',
                dataType: 'json',
                cache: false,
                success: function (data) {
                    var idnum = "" + $('#id').val() + "";
                    $('#Nfechaentrega').val(data);
                    $('#numCamot').html(idnum);
                     $('#modalcambiofechaentrega').modal('show');
                }
            });
        }

        function GuardarNuevaFecha() {

            var fecha = $('#Nfechaentrega').val();
            var observacion = $('#obsCamFecha').val();

            $.ajax({
                url: '/ordenTaller/CambiarFechaentrega',
                data: {
                    idorden: $('#id').val(),
                    fecha: fecha,
                    observacion: observacion
                },
                type: 'post',
                dataType: 'json',
                cache: false,
                success: function (data) {
                    $('#modalcambiofechaentrega').modal('hide');
                    swal("Se actualizo la fecha de entrega satisfactoriamente");
                    location.reload();
                }
            });
        }


        function  buscarTareasAsignadas(){
            $.ajax({
                url: '/ordenTaller/buscarTareasAsignadas',
                data: {
                    idCita: $('#citaOrden').val()
                },
                type: "post",
                cache: false,
                success: function (data) {
                    console.log(data)
                    if (data != 0) {
                        if (data.length == 0) {
                            $('#tareasInspeccion').hide()
                            $('#tablaTareas').find('tbody').empty();
                        } else {
                            $('#tareasInspeccion').show()
                            $('#tablaTareas').find('tbody').empty();
                            for (var i = 0; i < data.length; i++) {

                                $('#tablaTareas').find('tbody').append('<tr id="row' + numeroTareas + '">'
                                    + '<td align="left">'
                                    + '<input style="display:none" type="text" id="descripcionTarea' + numeroTareas + '" name="descripcionTarea' + numeroTareas + '" value="' + data[i].descripcion + '"/>'
                                    + data[i].descripcion
                                    + '</td>'
                                    + '<td align="right">'
                                    + '<input style="display:none" type="text" id="cantidadTarea' + numeroTareas + '" name="cantidadTarea' + numeroTareas + '" value="' + data[i].cantidad + '"/>'
                                    + data[i].cantidad
                                    + '</td>'
                                    + '<td align="right">'
                                    + '<input style="display:none" type="text" id="valorTarea' + numeroTareas + '" name="valorTarea' + numeroTareas + '" value="' + data[i].valor_unitario + '"/>'
                                    + addComas(data[i].valor_unitario)
                                    + '</td>'
                                    + '<td align="right">'
                                    + '<input style="display:none" type="text" id="fechaTarea' + numeroTareas + '" name="fechaTarea' + numeroTareas + '" value="' + data[i].fecautorizacion + '"/>'
                                    + data[i].fecautorizacion
                                    + '</td>'
                                    + '<td align="center">'
                                    + '<input type="checkbox" onclick="autorizarTarea(' + data[i].id + ')" id="autorizoTarea' + numeroTareas + '" name="autorizoTarea' + numeroTareas + '" value=""/>'
                                    + '</td>'
                                    + '</tr>');
                                numeroTareas++;
                                $('#numeroTareas').val(numeroTareas);

                                if (data[i].autorizado == true) {
                                    $('#autorizoTarea' + i).prop('checked', true)
                                }
                            }
                        }
                    }
                }
            });
        }

        function autorizarTarea(id) {
            $.ajax({
                url: '/ordenTaller/autorizarTarea',
                data: {
                    idTarea: id
                },
                type: "post",
                cache: false,
                success: function (data) {
                    buscarTareasAsignadas()
                }
            });
        }

        function valida(id){
            window.location.href = '@Url.Action("Update", "ordenTaller")?menu='+@ViewBag.id_menu+'&&id=' + id;
        }

        function buscarAjaxOrdenesTaller(){
            $.ajax({
                url: '/ordenTaller/BuscarOrdenesDeTaller',
                data: {},
                type: "post",
                cache: false,
                success: function (data) {
                    $('#tablaPaginada').find('tbody').empty();
                    for (var i = 0; i < data.length; i++) {
                        $('#tablaPaginada').find('tbody').append('<tr><td align="right">' + data[i].codigoentrada + '</td><td align="left">' + data[i].doc_tercero + '</td><td align="left">'
                            + data[i].nombreTercero + '</td><td align="left">'
                            + data[i].plac_vh + '</td><td align="left">'
                            + data[i].modvh_nombre + '</td><td align="left">'
                            + data[i].fecha + '</td><td width="5%" align="center"><button class="btn btn-info btn-xs" onclick="valida('
                            + data[i].id
                            + ')">&nbsp;&nbsp;Ver&nbsp;&nbsp;</button></td></tr>');
                    }
                },
                complete: function (data) {
                    $('#tablaPaginada').dataTable({
                        //"ajax": 'api/datatables.json',
                        //dom: "<''<'col-sm-4'l><'col-sm-4 text-center'B><'col-sm-4'f>>t<'col-sm-4'i>p",
                        dom: "<''<'col-md-6'l><'col-md-6'f>>t<'col-md-4'i><'col-md-8 text-right'pB>",
                        "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
                        buttons: [
                            { extend: 'excel', className: 'btn-sm', text: 'Exportar a Excel' },
                            //{ extend: 'pdf', title: 'ExampleFile', className: 'btn-sm', text: 'PDF' },
                            //{ extend: 'print', className: 'btn-sm', text: 'Imprimir' }
                        ]
                    });
                }
            });
        }

        function sumarprecio(numero){

            var valor1=$('#valorTotalBD'+numero).val();
            var sumavalor=parseFloat(quitCommas(valor1));
            var valortotal=parseFloat(quitCommas($('#total_repuestos').val()));
                valortotal=valortotal+sumavalor;

            $('#total_repuestos').val(addComas(valortotal));
        }

        function restarprecio(numero){

            var sumavalor=parseFloat(quitCommas($('#valorTotalBD'+numero).val()));
            var valortotal=parseFloat(quitCommas($('#total_repuestos').val()));

                valortotal=valortotal-sumavalor;

            $('#total_repuestos').val(addComas(valortotal));
        }

        function modalNotif3(autoriza,idn) {

            $('#modal_confirmar').modal('show');
            $('#txt_confirmar1').val(autoriza);
            $('#txt_insp_op1').val(idn);

        }
        function confirmar() {

            list = [{ conf: 'NO AUTORIZADO', style: 'color:red' },
                { conf: 'AUTORIZADO', style: 'color:green' }];
            fec = '2019-05-06';
            obs = 'Obs';
            var id=$('#txt_insp_op1').val();
            var autoriza=$('#txt_confirmar1').val();
            var observacion=$('#txt_observacion1').val();
            $.ajax({
                url: '/ordenTaller/confirmarRespuesto',
                type: 'POST',
                data: {
                    id: id,
                    autoriza2: autoriza,
                    observacion: observacion
                },
                success: function (resp) {
                    console.log(resp)
                    if (resp.error == false) {
                        var resl = resp.resl == true ? 1 : 0;
                        $('#autorizacion_div').hide();
                        $('#respuesta_div').show();
                        $('#conf_resp').text(list[resl].conf);
                        $('#conf_resp').prop('style', list[resl].style);
                        $('#conf_fec').text(resp.fec);
                        $('#conf_obs').text(resp.obs);
                    }
                    $('#modal_confirmar').modal('hide');
                },
                complete: function (resp) {
                    CargarDatosPorOrdenId();
                    buscarTareasAsignadas();
                    buscarSolicitudesCreadas($('#id').val());
                    verificargarantia();
                }
            });
        }
        function BuscarHistorial() {
            console.log('placa'+$('#placa').val());
            $.ajax({
                url: '/ordenTaller/DatosHistoricos',
                data: {
                    placa: $('#placa').val(),
                    fecha_desde: null,
                    fecha_hasta: null
                },
                type: 'post',
                dataType: 'json',
                cache: false,
                success: function (data) {

                    var tabla = "";
                    $('#tablaPaginadahistorial').dataTable().fnDestroy();
                    $('#tablaPaginadahistorial').find('tbody').empty();
                    for (var i = 0; i < data.length; i++) {
                        tabla +=     '<tr align="center">'
                        tabla += '<td align="center">' + data[i].kilometraje + '</td>';
                        tabla += '<td align="center">' + data[i].fecha + '</td>';
                        tabla += '<td align="center">' + data[i].otgenerada + '</td>';
                        tabla += '<td align="center">';
                        if (data[i].Codigo_operacion.length > 0) {


                            tabla += '<table class="table table-striped table-bordered table-hover">';
                            tabla += '<thead>';
                            tabla += '<tr>';
                            tabla += '<th>Codigo operacion</th>';
                            tabla += '<th>Descripcion</th>';
                            tabla += '</tr>';
                            tabla += '</thead>';
                            tabla += '<tbody>';
                            for (var j = 0; j < data[i].Codigo_operacion.length; j++) {
                                tabla += '<tr>';
                                tabla += '<td align="center">' + data[i].Codigo_operacion[j].idtempario + '</td>';
                                tabla += '<td align="center">' + data[i].Codigo_operacion[j].operacion + '</td>';
                                tabla += '</tr>';
                            }
                            tabla += '</tbody>';
                            tabla += '</table>';
                        } else {
                               tabla += 'Sin codigo de operacion';
                        }

                        tabla += '</td>';
                        tabla += '<td align="center">';
                        if (data[i].sintomas.length > 0) {


                            tabla += '<table class="table table-striped table-bordered table-hover">';
                            tabla += '<thead>';
                            tabla += '<tr>';
                            tabla += '<th>Descripcion</th>';
                            tabla += '<th>Respuesta</th>';
                            tabla += '</tr>';
                            tabla += '</thead>';
                            tabla += '<tbody>';
                            for (var j = 0; j < data[i].sintomas.length; j++) {
                                tabla += '<tr>';
                                tabla += '<td align="center">' + data[i].sintomas[j].descripcion + '</td>';
                                tabla += '<td align="center">' + data[i].sintomas[j].respuesta + '</td>';
                                tabla += '</tr>';
                            }
                            tabla += '</tbody>';
                            tabla += '</table>';
                        } else {
                            tabla += 'No hay sintomas';
                        }


                        tabla += '</td>';
                        tabla += '<td align="center">';
                        if (data[i].repuestos.length > 0) {


                            tabla += '<table class="table table-striped table-bordered table-hover">';
                            tabla += '<thead>';
                            tabla += '<tr>';
                            tabla += '<th>Codigo</th>';
                            tabla += '<th>Descripcion</th>';
                            tabla += '</tr>';
                            tabla += '</thead>';
                            tabla += '<tbody>';
                            for (var j = 0; j < data[i].repuestos.length; j++) {
                                tabla += '<tr>';
                                tabla += '<td align="center">' + data[i].repuestos[j].codigo + '</td>';
                                tabla += '<td align="center">' + data[i].repuestos[j].descripcion + '</td>';
                                tabla += '</tr>';
                            }
                            tabla += '</tbody>';
                            tabla += '</table>';
                        } else {
                             tabla += 'No hay repuestos';
                        }
                        tabla += '</td>';
                        tabla += '</tr>';
                    }


                    $('#tablaPaginadahistorial').find('tbody').append(tabla);



                },
                complete: function (data) {
                    $('#tablaPaginadahistorial').dataTable({

                        dom: "<''<'col-md-6'l><'col-md-6'f>>t<'col-md-4'i><'col-md-8 text-right'pB>",
                        "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
                        buttons: [
                            { extend: 'excel', className: 'btn-sm', text: 'Exportar a Excel' },

                        ]
                    });
                }

            });


        }
           $('#btnFiltrarhisto').click(function () {
               BuscarHistorialfechas();
        });

        function BuscarHistorialfechas() {

            $.ajax({
                url: '/ordenTaller/DatosHistoricos',
                data: {
                    placa: $('#placa').val(),
                    fecha_desde: $('#fechadesde').val(),
                    fecha_hasta: $('#fechahasta').val()
                },
                type: 'post',
                dataType: 'json',
                cache: false,
                success: function (data) {

                    var tabla = "";
                    $('#tablaPaginadahistorial').dataTable().fnDestroy();
                    $('#tablaPaginadahistorial').find('tbody').empty();
                    for (var i = 0; i < data.length; i++) {
                        tabla +=     '<tr align="center">'
                        tabla += '<td align="center">' + data[i].kilometraje + '</td>';
                        tabla += '<td align="center">' + data[i].fecha + '</td>';
                        tabla += '<td align="center">' + data[i].otgenerada + '</td>';
                        tabla += '<td align="center">';
                        if (data[i].Codigo_operacion.length > 0) {


                            tabla += '<table class="table table-striped table-bordered table-hover">';
                            tabla += '<thead>';
                            tabla += '<tr>';
                            tabla += '<th>Codigo operacion</th>';
                            tabla += '<th>Descripcion</th>';
                            tabla += '</tr>';
                            tabla += '</thead>';
                            tabla += '<tbody>';
                            for (var j = 0; j < data[i].Codigo_operacion.length; j++) {
                                tabla += '<tr>';
                                tabla += '<td align="center">' + data[i].Codigo_operacion[j].idtempario + '</td>';
                                tabla += '<td align="center">' + data[i].Codigo_operacion[j].operacion + '</td>';
                                tabla += '</tr>';
                            }
                            tabla += '</tbody>';
                            tabla += '</table>';
                        } else {
                               tabla += 'Sin codigo de operacion';
                        }

                        tabla += '</td>';
                        tabla += '<td align="center">';
                        if (data[i].sintomas.length > 0) {


                            tabla += '<table class="table table-striped table-bordered table-hover">';
                            tabla += '<thead>';
                            tabla += '<tr>';
                            tabla += '<th>Descripcion</th>';
                            tabla += '<th>Respuesta</th>';
                            tabla += '</tr>';
                            tabla += '</thead>';
                            tabla += '<tbody>';
                            for (var j = 0; j < data[i].sintomas.length; j++) {
                                tabla += '<tr>';
                                tabla += '<td align="center">' + data[i].sintomas[j].descripcion + '</td>';
                                tabla += '<td align="center">' + data[i].sintomas[j].respuesta + '</td>';
                                tabla += '</tr>';
                            }
                            tabla += '</tbody>';
                            tabla += '</table>';
                        } else {
                            tabla += 'No hay sintomas';
                        }


                        tabla += '</td>';
                        tabla += '<td align="center">';
                        if (data[i].repuestos.length > 0) {


                            tabla += '<table class="table table-striped table-bordered table-hover">';
                            tabla += '<thead>';
                            tabla += '<tr>';
                            tabla += '<th>Codigo</th>';
                            tabla += '<th>Descripcion</th>';
                            tabla += '</tr>';
                            tabla += '</thead>';
                            tabla += '<tbody>';
                            for (var j = 0; j < data[i].repuestos.length; j++) {
                                tabla += '<tr>';
                                tabla += '<td align="center">' + data[i].repuestos[j].codigo + '</td>';
                                tabla += '<td align="center">' + data[i].repuestos[j].descripcion + '</td>';
                                tabla += '</tr>';
                            }
                            tabla += '</tbody>';
                            tabla += '</table>';
                        } else {
                             tabla += 'No hay repuestos';
                        }
                        tabla += '</td>';
                        tabla += '</tr>';
                    }


                    $('#tablaPaginadahistorial').find('tbody').append(tabla);



                },
                complete: function (data) {
                    $('#tablaPaginadahistorial').dataTable({

                        dom: "<''<'col-md-6'l><'col-md-6'f>>t<'col-md-4'i><'col-md-8 text-right'pB>",
                        "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
                        buttons: [
                            { extend: 'excel', className: 'btn-sm', text: 'Exportar a Excel' },

                        ]
                    });
                }

            });


        }

           function Filtrar() {
            var texto = $('#buscartxt').val();
            var ffinicio = $('#fechaini').val();
             var ffin = $('#fechafin').val();


                 $.ajax({
                     url: '/ordenTaller/ConsultarFiltroTotliq',
                     data: {
                         idot: $('#id').val(),
                         cadena: texto,
                         fechaini: ffinicio,
                         fechafin: ffin
                     },
                     type: "post",
                     cache: false,
                     success: function (data) {
                         $('#tablaPaginadatot').DataTable().destroy();

                         $('#tablaPaginadatot').find('tbody').empty();
                         var tabla = "";

                         for (var i = 0; i < data.length; i++) {
                             tabla += "<tr>";
                             tabla += "<td align='left'>" + data[i].id2 + "</td>";
                             tabla += "<td align='center'>" + data[i].fecha2 + "</td>";
                             tabla += "<td align='left'>" + data[i].proveedor + "</td>";
                             tabla += "<td align='center'>";
                             if (data[i].Operaciones.length > 0) {
                                 for (var j = 0; j < data[i].Operaciones.length; j++) {
                                     tabla += data[i].Operaciones[j].Descripcion + " | ";
                                 }
                                 tabla = tabla.slice(0, -2);
                             }
                             else {
                                 tabla += "&nbsp;&nbsp;&nbsp;";

                             }

                             tabla += "</td>";
                             tabla += "<td align='center'>";
                             if (data[i].Repuestos.length > 0) {
                                 for (var j = 0; j < data[i].Repuestos.length; j++) {
                                     tabla += data[i].Repuestos[j].Descripcion + " | ";
                                 }
                                 tabla = tabla.slice(0, -2);
                             }
                             else {
                                 tabla += "&nbsp;&nbsp;&nbsp;";

                             }
                             tabla += "</td>";

                             tabla += "<td align='center'>" + data[i].valor_total + "</td>";

                             tabla += "</tr>";
                         }

                         $('#tablaPaginadatot').find('tbody').append(tabla);
                     },
                     complete: function (data) {
                         $('#tablaPaginadatot').dataTable({
                             //"ajax": 'api/datatables.json',
                             //dom: "<''<'col-sm-4'l><'col-sm-4 text-center'B><'col-sm-4'f>>t<'col-sm-4'i>p",
                             dom: "<''<'col-md-6'l><'col-md-6'f>>t<'col-md-4'i><'col-md-8 text-right'pB>",
                             "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
                             buttons: [
                                 //{ extend: 'excel', className: 'btn-sm', text: 'Exportar a Excel' },
                                 ////{ extend: 'pdf', title: 'ExampleFile', className: 'btn-sm', text: 'PDF' },
                                 ////{ extend: 'print', className: 'btn-sm', text: 'Imprimir' }
                             ]
                         });
                     }
                 });


        }

        function Eliminarinsumo(id) {

             $.ajax({
                url: '/ordenTaller/EliminarInsumo',
                type: 'POST',
                data: {
                    id: id
                },
                 success: function (resp) {
                     location.reload();
                }
            });

        }

        $('#insumo').change(function () {
                $.ajax({
                url: '/ordenTaller/Porcentajeinsumo',
                type: 'POST',
                    data: {
                        codigo: $('#insumo').val()
                },    type: 'post',
                dataType: 'json',
                cache: false,
                 success: function (resp) {
                    $('#porcentaje').val(resp);
                }
            });


        });



        function CalcularInsumo(){
            var porcentaje = $('#porcentaje').val();
            var tarifa = $('#tarifainsumo').val();
       var codigo =  $('#insumo').val();
             $.ajax({
                url: '/ordenTaller/CalcularInsumo',
                type: 'POST',
                data: {
                    id: $('#id').val(),
                    codigo: codigo,
                    porcentaje: porcentaje,
                    tarifa: tarifa
                },    type: 'post',
                dataType: 'json',
                cache: false,
                 success: function (resp) {
                     location.reload();
                }
            });
        }

        $('#reactivar').click(function () {

              $.ajax({
                url: '/ordenTaller/CambiarEstado',
                type: 'POST',
                data: {
                    idorden: $('#id').val()
                },    type: 'post',
                dataType: 'json',
                cache: false,
                 success: function (resp) {
                       if(resp!=false){
                        swal("Iniciado!", "Se ha reanudado la ejecución de La Orden de Taller.", "success");
                           CargarDatosPorOrdenId();
                           movertiempo($('#tiempoDuracion').text());
                            $('#reactivar').hide()
                    }
                    else{
                        swal("Error!", "Se ha presentado un error ", "error");

                    }
                }
            });

        });




    </script>
    @if (TempData["mensaje"] != null)
        {
        <script type="text/javascript">
            $('#modalOrdenCreada').show();
        </script>
        }
}