@model Homer_MVC.Models.EncabezadoOTModel

@{
    ViewBag.Icono = "fa fa-file";
    ViewBag.Title = "Garantia OT";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section Styles {
    <link href="~/Vendor/datatables.net-bs/css/dataTables.bootstrap.min.css" rel="stylesheet" />
    <link href="~/Vendor/bootstrap-toggle-master/css/bootstrap-toggle.min.css" rel="stylesheet" />
    @Styles.Render("~/bundles/select2/css")
}

<div class="panel-body">
    <div class="panel-heading" style="background-color:white;  border:solid 1px; border-color:#e4e5e7">
        <div class="panel-body">

            <div id="hbreadcrumb" class="pull-right">

                <button type="button" class="btn btn-mini btn-default" style="border-radius:25px" data-container="body" data-toggle="popover" data-placement="left" data-title="Enlaces" data-content="<ul>@ViewBag.nombreEnlaces</ul>" data-html="true">
                    <i class="text-info fa fa-tags"></i>
                </button>
                <button type="button" class="btn btn-mini btn-default" style="border-radius:25px" data-container="body" data-toggle="popover" data-placement="left" data-title="Documentos" data-content="<ul></i><a href=''>Documento 1</a></ul>  <ul></i><a href=''>Documento 2</a></ul> <ul></i><a href=''>Documento 3</a></ul>" data-html="true">
                    <i class="text-primary fa fa-files-o"></i>
                </button>
                <button type="button" class="btn btn-mini btn-default" style="border-radius:25px" data-container="body" data-toggle="popover" data-placement="left" data-title="Favoritos" data-content="@ViewBag.Favoritos" data-html="true">
                    <i class="text-warning fa fa-star"></i>
                </button>

            </div>
            <h3 class="font-light m-b-xs">
                <i class="text-info @ViewBag.Icono"></i>&nbsp;&nbsp;@ViewBag.Title&nbsp;@Html.DisplayFor(model => model.codigoentrada)&nbsp;<span id="labelestado"></span>
            </h3>
            <small>@ViewBag.Title</small>
        </div>
    </div>
</div>

<div class="panel-body" style="padding-top:0px;">
    <div class="hpanel">
        @*@if (TempData["mensaje"] != null)
            {
                <div class="alert alert-success  alert-dismissible" id="mensaje">
                    <button type="button" class="close" data-dismiss="alert" arial-label="close"><span aria-hidden="true">&times;</span></button>
                    <p>@TempData["mensaje"]</p>
                </div>
            }*@

        @if (TempData["mensaje_error"] != null)
            {
            <div class="alert alert-danger  alert-dismissible" id="mensaje_error">
                <button type="button" class="close" data-dismiss="alert" arial-label="close"><span aria-hidden="true">&times;</span></button>
                <p>@TempData["mensaje_error"]</p>
            </div>
            }

    <div id="tabs" class="tab-content">

        <div class="m float-e-margins text-right">
            <div class="tooltip-demo">

                <div id="div-mensaje"></div>

            </div>
        </div>
  >




        <div id="crear" class="tab-pane active">
            <div class="panel-body">

                @using (Html.BeginForm())
                    {
                    @Html.AntiForgeryToken()
                    @Html.Hidden("menu")
                    @Html.Hidden("numeroSolicitudes")
                    @Html.Hidden("id_cliente")
                    @Html.Hidden("numeroOperaciones")
                    @Html.Hidden("id_cita")

                    @Html.HiddenFor(model => model.id);
                    @Html.HiddenFor(model => model.idcita);
                  
                    @Html.HiddenFor(model => model.numero);
                    @Html.HiddenFor(model => model.tercero);
                    @Html.HiddenFor(model => model.bodega);
                   
                    @Html.HiddenFor(model => model.estado);
            
                    @Html.HiddenFor(model => model.entrega);
      

                    @Html.HiddenFor(model => model.estadoorden);
                    @Html.HiddenFor(model => model.razon_secundaria);

                    <input type="hidden" name="tipodegarantia" id="tipodegarantia" value="@ViewBag.tipodegarantia" />

                    <div class="form-horizontal">

                        @Html.ValidationSummary(true, "", new { @class = "text-danger" })

                        <input type="hidden" name="citaOrden" id="citaOrden" value="" />

                        <div class="row">

                            <div class="col-sm-6">
                                <div class="form-group">
                                    <label class="control-label col-md-4">Estado:&nbsp;<span class="text-danger">*</span></label>
                                    <div class="col-md-6">
                                        @Html.DropDownListFor(model => model.Estadodos, null, "", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione", @required = "required", })

                                    </div>
                                </div>
                            </div>

                        </div>


                        <div class="hpanel">
                            <div class="panel-heading hbuilt" style="background-color:#e4e5e7">
                                <div class="panel-tools">
                                    <a class="showhide"><i class="fa fa-chevron-up"></i></a>

                                </div>
                                <i class="fa fa-calendar-check-o"></i>&nbsp;&nbsp;&nbsp;Datos entrada
                            </div>
                            <div class="panel-body">

                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label class="control-label col-md-4">Codigo:&nbsp;<span class="text-danger">*</span></label>
                                        <div class="col-md-6">
                                            @Html.EditorFor(model => model.codigoentrada, new { htmlAttributes = new { @class = "form-control", @required = "required", @placeholder = "Digite codigo entrada", @readonly = "readonly" } })
                                            @Html.ValidationMessageFor(model => model.codigoentrada, "", new { @class = "text-danger" })
                                        </div>
                                    </div>
                                </div>

                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label class="control-label col-md-4">Tipo Documento:&nbsp;<span class="text-danger">*</span></label>
                                        <div class="col-md-6">
                                            @Html.DropDownListFor(model => model.idtipodoc, null, "", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione", @required = "required", })
                                            @Html.ValidationMessageFor(model => model.idtipodoc, "", new { @class = "text-danger" })
                                        </div>
                                    </div>
                                </div>

                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label class="control-label col-md-4">Asesor:&nbsp;<span class="text-danger">*</span></label>
                                        <div class="col-md-6">
                                            @Html.EditorFor(model => model.asesor, new { htmlAttributes = new { @class = "form-control requeridoAseguradora", @placeholder = "", @readonly = "readonly" } })


                                            @*@Html.DropDownListFor(model => model.asesor, null, "", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione", @required = "required" })*@
                                            @Html.ValidationMessageFor(model => model.asesor, "", new { @class = "text-danger" })
                                        </div>
                                    </div>
                                </div>

                                <div class="col-sm-6 ">
                                    <div class="form-group">
                                        <label class="control-label col-md-4">Tecnico:&nbsp;<span class="text-danger">*</span></label>
                                        <div class="col-md-6">
                                            @Html.DropDownListFor(model => model.tecnico, null, "", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione", @readonly = "readonly" })
                                            @*@Html.ValidationMessageFor(model => model.idtipodoc, "", new { @class = "text-danger" })*@
                                        </div>
                                        <div class="col-md-2">
                                            <div id="btnagenda"></div>
                                        </div>
                                    </div>

                                </div>

                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label class="control-label col-md-4">Razon Ingreso Primaria:&nbsp;<span class="text-danger">*</span></label>
                                        <div class="col-md-6">
                                            @Html.DropDownListFor(model => model.razoningreso, null, "Seleccione", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione", @required = "required" })
                                            @Html.ValidationMessageFor(model => model.razoningreso, "", new { @class = "text-danger" })
                                        </div>
                                    </div>
                                </div>


                                <div class="col-sm-6" id="areaRazonIngreso" style="display:none;">
                                    <div class="form-group">
                                        <label class="control-label col-md-4">Aseguradora:&nbsp;</label>
                                        <div class="col-md-6">
                                            @Html.DropDownListFor(model => model.aseguradora, null, "Seleccione", htmlAttributes: new { @class = "form-control js-source-states", @placeholder = "Seleccione" })
                                            @Html.ValidationMessageFor(model => model.aseguradora, "", new { @class = "text-danger" })
                                        </div>
                                    </div>
                                </div>

                                <div id="areaGarantia" style="display:block;">
                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Falla:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                @Html.TextAreaFor(m => m.garantia_falla, new RouteValueDictionary(new { @class = "form-control requeridoGarantia", style = "width: 100%; height:80px;" }))
                                                @Html.ValidationMessageFor(model => model.garantia_falla, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Causa:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                @Html.TextAreaFor(m => m.garantia_causa, new RouteValueDictionary(new { @class = "form-control requeridoGarantia", style = "width: 100%; height:80px;" }))
                                                @Html.ValidationMessageFor(model => model.garantia_causa, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Solución:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                @Html.TextAreaFor(m => m.garantia_solucion, new RouteValueDictionary(new { @class = "form-control requeridoGarantia", style = "width: 100%; height:80px;" }))
                                                @Html.ValidationMessageFor(model => model.garantia_solucion, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div id="areaDatosAseguradora" style="display:none;">
                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Poliza:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                @Html.EditorFor(model => model.poliza, new { htmlAttributes = new { @class = "form-control requeridoAseguradora", @placeholder = "Digite poliza" } })
                                                @Html.ValidationMessageFor(model => model.poliza, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Siniestro:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                @Html.EditorFor(model => model.siniestro, new { htmlAttributes = new { @class = "form-control requeridoAseguradora", @placeholder = "Digite siniestro" } })
                                                @Html.ValidationMessageFor(model => model.siniestro, "", new { @class = "text-danger" })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Valor Minimo:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                @Html.EditorFor(model => model.minimo, new { htmlAttributes = new { @class = "form-control requeridoAseguradora", @placeholder = "Digite valor ($)", @onkeyUp = "return miles(this.id)" } })
                                                @*@Html.ValidationMessageFor(model => model.minimo, "", new { @class = "text-danger" })*@
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Deducible:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                @Html.EditorFor(model => model.deducible, new { htmlAttributes = new { @class = "form-control requeridoAseguradora", @placeholder = "Digite deducible", @onkeyUp = "return miles(this.id)" } })
                                                @*@Html.ValidationMessageFor(model => model.deducible, "", new { @class = "text-danger" })*@
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Fecha Soat:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                @Html.EditorFor(model => model.fecha_soat, new { htmlAttributes = new { @class = "form-control requeridoAseguradora", @placeholder = "", } })
                                                @*@Html.ValidationMessageFor(model => model.deducible, "", new { @class = "text-danger" })*@
                                                <div class="col-sm-12" id="selectInfoSoat" style="display:none">
                                                    <div class="form-group">
                                                        <div class="col-md-12">
                                                            <div class="alert alert-danger">
                                                                <strong></strong><p id="textosoat"></p><br />
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Numero de Soat:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                @Html.EditorFor(model => model.numero_soat, new { htmlAttributes = new { @class = "form-control requeridoAseguradora", @placeholder = "Digite N° de SOAT", @onkeyUp = "return soloNumeros(this.id)" } })
                                                @*@Html.ValidationMessageFor(model => model.deducible, "", new { @class = "text-danger" })*@
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>

                        <div class="hpanel">
                            <div class="panel-heading hbuilt" style="background-color:#e4e5e7">
                                <div class="panel-tools">
                                    <a class="showhide"><i class="fa fa-chevron-up"></i></a>

                                </div>
                                <i class="fa fa-car"></i>&nbsp;&nbsp;&nbsp;Datos Vehiculo
                            </div>
                            <div class="panel-body">

                                <div class="row">
                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Placa / Plan Mayor:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                @*@Html.EditorFor(model => model.placa, new { htmlAttributes = new { @class = "form-control", @required = "required", @placeholder = "Digite placa", @readonly = "readonly" } })
                                @Html.ValidationMessageFor(model => model.placa, "", new { @class = "text-danger" })*@
                                                <input type="text" name="placa" value="@ViewBag.placa1" class="form-control" readonly />
                                            </div>
                                            <div class="col-md-2">
                                                <button type="button" class="btn btn-primary" id="btnBuscarPlaca" style="display:none"><i class="fa fa-search"></i></button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Modelo Vehículo:&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                @Html.EditorFor(model => model.modelo, new { htmlAttributes = new { @class = "form-control", @required = "required", @placeholder = "Digite placa", @readonly = "readonly" } })
                                                @Html.ValidationMessageFor(model => model.modelo, "", new { @class = "text-danger" })
                                            </div>
                                            <div class="col-md-2">

                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6" style="display:none;" id="placaNoEncontrada">
                                        <div class="form-group">
                                            <label class="control-label col-md-10">Placa no encontrada &nbsp;<a class="btn btn-link" href="../../creacionVh?menu=@ViewBag.id_menu">&nbsp;Crear vehiculo aqui&nbsp;&nbsp;<i class="fa fa-car"></i></a>&nbsp;</label>

                                        </div>
                                    </div>

                                </div>
                                <div class="row">

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Año Modelo :&nbsp;<span class="text-danger">*</span></label>
                                            <div class="col-md-6">
                                                @Html.EditorFor(model => model.añovh, new { htmlAttributes = new { @class = "form-control", @required = "required", @placeholder = "Digite placa", @readonly = "readonly" } })
                                                @Html.ValidationMessageFor(model => model.añovh, "", new { @class = "text-danger" })
                                            </div>
                                            <div class="col-md-2">

                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label class="control-label col-md-4">Serie:&nbsp;</label>
                                            <div class="col-md-6">
                                                <p id="serieBuscado"></p>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                                <div class="row">

                                    <div class="areaVehiculoOculta" style="display:none;">


                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="control-label col-md-4">Numero Motor:&nbsp;</label>
                                                <div class="col-md-6">
                                                    <p id="numMotorBuscado"></p>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="control-label col-md-4">Color:&nbsp;</label>
                                                <div class="col-md-6">
                                                    <p id="colorBuscado"></p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="control-label col-md-4">Fecha Venta:&nbsp;</label>
                                                <div class="col-md-6">
                                                    <p id="fechaVentaBuscado"></p>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="control-label col-md-4">Fecha Fin Garantia:&nbsp;</label>
                                                <div class="col-md-6">
                                                    <p id="fechaFinGarantiaBuscado"></p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>



                                    <div class="row">

                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="control-label col-md-4">Kilometraje Anterior:&nbsp;</label>
                                                <div class="col-md-6">
                                                    @*<p id="kilometrajeBuscado"></p>*@
                                                    @Html.EditorFor(model => model.kilometraje, new { htmlAttributes = new { @class = "form-control", @required = "required", @placeholder = "Digite kilometraje", @readonly = "readonly" } })
                                                    @Html.ValidationMessageFor(model => model.kilometraje, "", new { @class = "text-danger" })
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="control-label col-md-4">kilometraje Actual:&nbsp;<span class="text-danger">*</span></label>
                                                <div class="col-md-6">
                                                    @Html.EditorFor(model => model.kilometraje_nuevo, new { htmlAttributes = new { @class = "form-control", @required = "required", @placeholder = "Digite kilometraje", @readonly = "readonly" } })
                                                    @Html.ValidationMessageFor(model => model.kilometraje_nuevo, "", new { @class = "text-danger" })
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>


                            </div>
                        </div>

                        <div class="hpanel" id="areaPanelCliente" style="display:none;">
                            <div class="panel-heading hbuilt" style="background-color:#e4e5e7">
                                <div class="panel-tools">
                                    <a class="showhide"><i class="fa fa-chevron-up"></i></a>

                                </div>
                                <i class="fa fa-user-circle-o"></i>&nbsp;&nbsp;&nbsp;Datos Propietario
                            </div>
                            <div class="panel-body">

                                <div class="row">

                                    <div class="row">
                                        <div class="col-sm-6" id="areaTxtBuscarDocumento">
                                            <div class="form-group">
                                                <label class="control-label col-md-4">Documento:&nbsp;<span class="text-danger">*</span></label>
                                                <div class="col-md-6">
                                                    @Html.EditorFor(model => model.txtDocumentoCliente, new { htmlAttributes = new { @class = "form-control", @placeholder = "Digite numero documento" } })
                                                </div>
                                                <div class="col-md-2">
                                                    <button type="button" class="btn btn-primary" id="btnBuscarCliente"><i class="fa fa-search"></i></button>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-6" style="display:none;" id="documentoNoEncontrado">
                                            <div class="form-group">
                                                <label class="control-label col-md-10">Propietario no encontrado, puede buscarlo o&nbsp;<a class="btn btn-link" href="../../terceros?menu=@ViewBag.id_menu">&nbsp;Crear cliente aqui&nbsp;&nbsp;<i class="fa fa-user-circle-o"></i></a>&nbsp;</label>

                                            </div>
                                        </div>

                                    </div>

                                    <div class="areaClienteOculta">
                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="control-label col-md-4">Documento:&nbsp;</label>
                                                <div class="col-md-6">
                                                    <p id="documentoBuscado"></p>
                                                    <input type="hidden" value="" name="documentoBuscadoCliente" id="documentoBuscadoCliente" />
                                                    <input type="hidden" name="docTerceroBuscado" id="docTerceroBuscado" value="" />
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="control-label col-md-4">Nombre:&nbsp;</label>
                                                <div class="col-md-6">
                                                    <p id="nombreBuscado"></p>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="control-label col-md-4">Telefono:&nbsp;</label>
                                                <div class="col-md-6">
                                                    <p id="telefonoBuscado"></p>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="control-label col-md-4">Celular:&nbsp;</label>
                                                <div class="col-md-6">
                                                    <p id="celularBuscado"></p>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">Email:&nbsp;</label>
                                                    <div class="col-md-6">
                                                        <p id="emailBuscado"></p>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">Ciudad:&nbsp;</label>
                                                    <div class="col-md-6">
                                                        <p id="ciudadBuscado"></p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row">

                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">Contacto:&nbsp;</label>
                                                    <div class="col-md-6">
                                                        <input type="text" id="contacto" name="name" value="@ViewBag.contacto" class="form-control" readonly />
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">Telefono Contacto:&nbsp;</label>
                                                    <div class="col-md-6">
                                                        <input type="text" id="tel_contacto" name="name" value="@ViewBag.telcontacto" class="form-control" readonly />
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>



                        @*/**********************************************************************************************************************************************************************************************************/*@
                        <div class="hpanel" id="tareasInspeccion" style="display:none">
                            <div class="panel-heading hbuilt" style="background-color:#e4e5e7">
                                <div class="panel-tools">
                                    <a class="showhide"><i class="fa fa-chevron-up"></i></a>
                                </div>
                                <i class="fa fa-clone"></i>&nbsp;&nbsp;&nbsp;Adicionales de Inspección
                            </div>
                            <div class="panel-body">
                                <div class="row">
                                    <div class="row">
                                        <div class="col-md-12 text-center">
                                            <h4><label class="label label-default">Tareas Solicitadas en Inspección</label></h4>
                                        </div>
                                    </div>

                                    <div class="col-md-12">
                                        <div class="col-md-12">
                                            <div class="form-group">
                                                <input type="hidden" name="numeroTareas" id="numeroTareas" value="" />
                                                <div class="table-responsive">
                                                    <div id="div-mensaje-buscar"></div>
                                                    <table class="table table-striped table-bordered table-hover" id="tablaTareas">
                                                        <thead>
                                                            <tr>
                                                                <th style="text-align:center">Tarea Inspección</th>
                                                                <th style="text-align:center">Cantidad</th>
                                                                <th style="text-align:center">Valor</th>
                                                                <th style="text-align:center">Fecha Autorización</th>
                                                                <th style="text-align:center">Autorizar</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody></tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        @*/**********************************************************************************************************************************************************************************************************/*@


                        <div class="hpanel" id="paneloperaciones">
                            <div class="panel-heading hbuilt" style="background-color:#e4e5e7">
                                <div class="panel-tools">
                                    <a class="showhide"><i class="fa fa-chevron-up"></i></a>

                                </div>
                                <i class="fa fa-user-circle-o"></i>&nbsp;&nbsp;&nbsp;Operaciones
                            </div>
                            <div class="panel-body">

                                <div class="col-md-12">
                                    <div class="table-responsive">
                                        <div id="div-mensaje-buscar"></div>
                                        <table class="table table-striped table-bordered table-hover" id="tablaOperacionesPorPlaca">
                                            <thead>
                                                <tr>
                                                    <th style="text-align:center">Código</th>
                                                    <th style="text-align:center">Operación</th>
                                                    <th style="text-align:center">Tecnico</th>
                                                    <th style="text-align:center">Tiempo</th>

                                                    <th style="text-align:center">Valor Total</th>

                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>

                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label class="control-label col-md-4">Total Valor Operaciones:</label>
                                        <div class="col-md-6">
                                            @Html.Editor("totaloperaciones", new { htmlAttributes = new { @class = "form-control", @placeholder = "Total Operaciones", @readonly = "true" } })
                                        </div>
                                    </div>
                                </div>




                            </div>
                        </div>


                        <div class="hpanel" id="panelrepuestos">
                            <div class="panel-heading hbuilt" style="background-color:#e4e5e7">
                                <div class="panel-tools">
                                    <a class="showhide"><i class="fa fa-chevron-up"></i></a>

                                </div>
                                <i class="fa fa-user-circle-o"></i>&nbsp;&nbsp;&nbsp;Repuestos
                            </div>
                            <div class="panel-body">


                                <div class="col-md-12">
                                    <div class="table-responsive">
                                        <div id="div-mensaje-buscar"></div>
                                        <table class="table table-striped table-bordered table-hover" id="tablaRepuestosPorPlaca">
                                            <thead>
                                                <tr>
                                                    <th style="text-align:center">Código</th>
                                                    <th style="text-align:center">Descripción</th>
                                                    <th style="text-align:center">Cantidad</th>
                                                    <th style="text-align:center">Precio Unitario</th>
                                                    <th style="text-align:center">Iva ($)</th>
                                                    <th style="text-align:center">Total</th>
                                                    <th style="text-align:center">Stock</th>

                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                        <input type="hidden" value="" name="numeroRepuestos" id="numeroRepuestos" />
                                    </div>
                                </div>

                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label class="control-label col-md-4">Total Valor Repuestos:</label>
                                        <div class="col-md-6">
                                            @Html.Editor("total_repuestos", new { htmlAttributes = new { @class = "form-control", @placeholder = "Total Operaciones", @readonly = "true" } })
                                        </div>
                                    </div>
                                </div>


                            </div>
                        </div>



                    </div>
                    }
            </div>
        </div>

    </div>
    </div>
</div>


@section Scripts {
    @Scripts.Render("~/bundles/select2/js")
    <script src="~/Vendor/datatables/media/js/jquery.dataTables.min.js"></script>
    <script src="~/Vendor/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>
    <script src="~/Vendor/datatables.net-buttons/js/buttons.html5.min.js"></script>
    <script src="~/Vendor/datatables.net-buttons/js/buttons.print.min.js"></script>
    <script src="~/Vendor/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
    <script src="~/Vendor/datatables.net-buttons-bs/js/buttons.bootstrap.min.js"></script>
    <script src="~/Vendor/datatablesExcelExport/dataTable1.4.0-buttons.js"></script>
    <script src="~/Vendor/datatablesExcelExport/JSZip3.1.3.min.js"></script>

    <script src="~/Vendor/datatablesExcelExport/jsZipDataTables.js"></script>
    <script src="~/Vendor/bootstrap-toggle-master/js/bootstrap-toggle.min.js"></script>
    <script src="~/Vendor/moment/moment.js"></script>
    <script src="~/Vendor/eonasdan-bootstrap-datetimepicker/build/js/bootstrap-datetimepicker.min.js"></script>
    <script src="~/Scripts/detalleot.js?fec=@DateTime.Now"></script>
    <script src="~/Scripts/inspeccionSistemasVh.js?fec=@DateTime.Now"></script>
    <script type="text/javascript">
        var numeroOperacion = 0;
        var numeroTareas = 0;
        var contadorRS = 0;
        var numeroRepuesto = 0;
        var numeroSolicitud = 0;
        var BDnumeroOperacion = 0;
        var BDnumeroRepuesto = 0;
        var BDnumeroSolicitud = 0;

        $(document).ready(function () {

            var valor1 =$('#kilometraje_nuevo').val();
            var valor2 = addCommas(valor1);
            $('#kilometraje_nuevo').val(valor2);

            var valor3 =$('#kilometraje').val();
            var valor4 = addCommas(valor3);
            $('#kilometraje').val(valor4);



            var razon2=$("#razoningreso option:selected").text();
            $('.js-source-states').select2();
            $('#Estadodos').trigger('change');

            $('#idtipodoc').select2('readonly', true);
            $('#tecnico').select2('readonly', true);            
                $('#razoningreso').select2('readonly', true);
                   var fecha = '@DateTime.Now.ToString("yyyy-MM-dd")';
                var mes = '@DateTime.Now.Month';
                if (parseInt(mes) < 10) { mes = '0' + mes;}


                 $('.fechas2').datetimepicker({
                format: 'YYYY/MM/DD',

            });

                     $("#fechaini").val(fecha);
               $("#fechaini").find('imput').val(fecha);
                    $("#fechafin").val(fecha);
            $("#fechafin").find('imput').val(fecha);

                var fecha2 = '@DateTime.Now.Year' + '-' +mes + '-01';
                 $("#fechadesde").val(fecha2);
                $("#fechadesde").find('imput').val(fecha);
                $("#fechahasta").val(fecha);
                $("#fechahasta").find('imput').val(fecha);

            $('#fecha_soat').datetimepicker({
                format: 'YYYY/MM/DD'
            }).on('dp.change', function (e) {

                var fechax = e.currentTarget.value;
                var fechasoat=moment(fechax,"YYYY-MM-DD");
                var fechahoy2 = new Date().toJSON().slice(0,10).replace(/-/g,'/');
                var fechahoy=moment(fechahoy2,"YYYY-MM-DD");
                var diferencia=fechahoy.diff(fechasoat,'days');
                if(diferencia>365){
                    $('#selectInfoSoat').show();
                    $('#textosoat').html('El SOAT se encuentra vencido');
                }
                else{
                    $('#selectInfoSoat').hide();
                    $('#textosoat').html('');
                }
            });

            $('#citaOrden').val(@ViewBag.citaId)
            $('#id_cita').val(@ViewBag.citaId)

            $('#aseguradora').append($('<option>', {
                value: '',
                text: 'Ninguna'
            }));
            $('#numeroSolicitudes').val(0);
            $('#btnBuscarPlaca').trigger('click');
            $('#txtEntregaEstimado').val('@ViewBag.entrega');
            $('#minimoOrden').val(addComas($('#minimo').val()));
            $('#deducibleOrden').val(addComas($('#deducible').val()));


            if(razon2.indexOf("Colision") >= 0){
                $('#areaRazonIngreso').show();
            }
            else{
                $('#areaRazonIngreso').hide();
                $('#aseguradora').val('');
                $('#poliza').val('');
                $('#siniestro').val('');
                $('#minimoOrden').val('');
                $('#deducibleOrden').val('');
                $('#aseguradora').val('').trigger('change');
            }

            if ($('#aseguradora').val() == '') {
                $('#areaDatosAseguradora').hide();
                $('.requeridoAseguradora').prop('required', false);
            } else {
                $('.requeridoAseguradora').prop('required', true);
                $('#areaDatosAseguradora').show();
            }
            var estado = '@ViewBag.tipoEstado';
            var permiso = '@ViewBag.Permiso';

            if (permiso == "Si") {
                if (estado == "OT" || estado == "E" || estado == "SR") {
                    $("#btncerrarsinop").css("display","block");
                }

            }
            var estadomodfi = '@ViewBag.Permisomodif';

            if (estadomodfi == "Si" ) {
                if (estado != "A" && estado != "T") {
                    $.ajax({
                        url: '/ordenTaller/BahiaCitaOT',
                        data: {
                                 id_orden: $('#id').val()
                               },
                        type: 'post', cache: false,
                        success: function (data) {

                               var btn = "<a class='btn btn-primary' href='@Url.Action("Edit", "bahia")?menu=5373&&id="+ data+"'><i class='fa fa-calendar-check-o'></i>&ensp;&ensp;Ver</a>";
                     $("#btnagenda").html(btn);


                        }
                    })




                }



            }
   
            CargarDatosPorOrdenId();
            colcoardatosplaca();

            var validacionKm = '@ViewBag.validacionkm';

            if (validacionKm) {

                $('#modalkilometraje').modal('show');
            }

        });

          function CargarDatosPorOrdenId(){
            $.ajax({
                url: '/ordenTaller/Consultaopeyrepgaran',
                data: {
                    idorden: $('#id').val()
                },
                type: 'post',
                dataType: 'json',
                cache: false,
                success: function (data) {

                    $('#tablaOperacionesPorPlaca').find('tbody').empty();
                    for (var i = 0; i < data.buscarOperaciones.length; i++) {
                        console.log()
                        BDnumeroOperacion = numeroOperacion;
                        var fila = "";
                        var fila2 = "";
                        var tdAuto = "<a onclick='modalNotif3(1," + data.buscarOperaciones[i].idoperacion + ")' class='btn btn-success btn-sm'><i class='fa fa-check'></i><b> SI</b></a><a onclick='modalNotif3(0," + data.buscarOperaciones[i].idoperacion + ")' class='btn btn-danger btn-sm'><i class='fa fa-times'></i><b> NO</b></a>";
                        var tdSucc = "<i style='font-size:17pt;' class='fa fa-check-circle text-success'></i><a onclick='mostrar_detalle3(" + data.buscarOperaciones[i].idoperacion + ")'><i style='margin-left:15px;font-size:17pt;' class='fa fa-file-text text-success'></i></a>";
                        var tdDang = "<i style='font-size:17pt;' class='fa fa-times-circle text-danger'></i><a onclick='mostrar_detalle3(" + data.buscarOperaciones[i].idoperacion + ")'><i style='margin-left:15px;font-size:17pt;' class='fa fa-file-text text-danger'></i></a>";
                        var tdCheck = "<input type='checkbox' class='i-checks' id='solicitarOperacionBD" + BDnumeroOperacion + "' name='solicitarOperacionBD" + BDnumeroOperacion + "' checked " + " value='" + BDnumeroRepuesto + "'/>";

                        if (data.buscarOperaciones[i].estado == "-1" && data.buscarOperaciones[i].fecha_envio_sms == "") {
                            fila = tdAuto;
                        }
                        else if (data.buscarOperaciones[i].estado == "0") {
                            fila = tdDang;
                        }
                        else if (data.buscarOperaciones[i].estado == "1") {
                            fila = tdSucc;
                        }
                        else {
                            fila = tdCheck;
                        }

                        var btncheck = "";

                        if (data.buscarOperaciones[i].boton_sms == null || data.buscarOperaciones[i].estadorepuesta == null ) {
                            btncheck = "<label id='autoizacheck" + i + "'> No </label>";
                        } else {
                           btncheck = "<label id='autoizacheck" + i + "'>Si </label>";
                        }

                        $('#totakopera').val(i);
                        $('#tablaOperacionesPorPlaca').find('tbody').append('<tr id="rowOperaciones' + BDnumeroOperacion + '">'
                            + '<td align="left">'
                            + '<input style="display:none" type="text" id="codigoOperacionBD' + BDnumeroOperacion + '" name="codigoOperacionBD' + BDnumeroOperacion + '" value="' + data.buscarOperaciones[i].codigo + '"/>'
                            + data.buscarOperaciones[i].codigo
                            + '</td>'
                            + '<td align="left">'
                            + data.buscarOperaciones[i].operacion
                            + '</td>'
                            + '<td align="left">'
                            + '<input style="display:none" type="text" id="id_tecnicoBD' + BDnumeroOperacion + '" name="id_tecnicoBD' + BDnumeroOperacion + '" value="' + data.buscarOperaciones[i].tecnico_id + '"/>'
                            + data.buscarOperaciones[i].tecnico
                            + '</td>'
                            + '<td align="right">'
                            + '<input style="display:none" type="text" id="tiempoBD' + BDnumeroOperacion + '" name="tiempoBD' + BDnumeroOperacion + '" value="' + data.buscarOperaciones[i].tiempo + '"/>'
                            + '<input style="display:none" type="text" id="precioBD' + BDnumeroOperacion + '" name="precioBD' + BDnumeroOperacion + '" value="' + data.buscarOperaciones[i].precio + '"/>'
                            + '<input style="display:none" type="text" id="ivaOperacionBD' + BDnumeroOperacion + '" name="ivaOperacionBD' + BDnumeroOperacion + '" value="' + data.buscarOperaciones[i].ivaOperacion + '"/>'
                            + data.buscarOperaciones[i].tiempo
                            + '</td>'
                          
                            + '<td align="right">$ '
                            + addComas(data.buscarOperaciones[i].valorTotal)
                            + '</td>'                
                            + '</tr>');
                        numeroOperacion++;
                        $("#autoizacheck" + i).trigger('change');
                        //$('#numeroOperaciones').val(numeroOperacion);
                    }
                    $('#labelestado').html('');

                    $('#totaloperaciones').val('');
                    $('#totaloperaciones').val(data.valoroperaciones);              
                    $('#tablaRepuestosPorPlaca').find('tbody').empty();
                    $('#total_repuestos').val('');
                    $('#total_repuestos').val(data.valorrepuestos);
                  for (var i = 0; i < data.repuestosAgendados.length; i++) {
                        var solicitado = '';


                        $('#tablaRepuestosPorPlaca').find('tbody').append('<tr id="rowRepuestoBD' + BDnumeroRepuesto + '">'
                            + '<td align="left">'
                            + '<input style="display:none" type="text" id="codigoRepuestoBD' + BDnumeroRepuesto + '" name="codigoRepuestoBD' + BDnumeroRepuesto + '" value="' + data.repuestosAgendados[i].ref_codigo + '"/>'
                            + '<input style="display:none" type="text" id="idRepuestoBD' + BDnumeroRepuesto + '" name="idRepuestoBD' + BDnumeroRepuesto + '" value="' + data.repuestosAgendados[i].id + '"/>'
                            + data.repuestosAgendados[i].ref_codigo
                            + '</td>'
                            + '<td align="left">'
                            + '<input style="display:none" type="text" id="nombreRepuestoBD' + BDnumeroRepuesto + '" name="nombreRepuestoBD' + BDnumeroRepuesto + '" value="' + data.repuestosAgendados[i].ref_descripcion + '"/>'
                            + data.repuestosAgendados[i].ref_descripcion
                            + '</td>'                      
                            + '<td align="right">'
                            + '<input style="display:none" type="text" id="cantidadRepuestoBD' + BDnumeroRepuesto + '" name="cantidadRepuestoBD' + BDnumeroRepuesto + '" value="' + data.repuestosAgendados[i].cantidad + '"/>'
                            + '<input style="display:none" type="text" id="precioRepuestoBD' + BDnumeroRepuesto + '" name="precioRepuestoBD' + BDnumeroRepuesto + '" value="' + data.repuestosAgendados[i].precio + '"/>'
                            + '<input style="display:none" type="text" id="porIvaRepuestoBD' + BDnumeroRepuesto + '" name="porIvaRepuestoBD' + BDnumeroRepuesto + '" value="' + data.repuestosAgendados[i].por_iva + '"/>'
                            + '<input style="display:none" type="text" id="porDsctRepuestoBD' + BDnumeroRepuesto + '" name="porDsctRepuestoBD' + BDnumeroRepuesto + '" value="' + data.repuestosAgendados[i].por_dscto + '"/>'
                            + data.repuestosAgendados[i].cantidad
                            + '</td>'
                            + '<td align="right">'
                            + addComas(data.repuestosAgendados[i].precio)
                            + '</td>'                         
                            + '<td align="right">$'
                            + addComas(data.repuestosAgendados[i].valorIva)
                            + '</td>'                       
                            + '<td align="right">'
                            + '<input style="display:none" type="text" id="valorTotalBD' + BDnumeroRepuesto + '" name="valorTotalBD' + BDnumeroRepuesto + '" value="' + data.repuestosAgendados[i].valorTotal + '"/>$ '
                            + addComas(data.repuestosAgendados[i].valorTotal)
                            + '</td>'
                            + '<td align="center">'
                            + texto
                            + '</td>'                                               
                            + '</tr>');
                  

                        BDnumeroRepuesto++;
                    }


                
                },
                complete: function (data) {
                    $('.i-checks').iCheck({
                        checkboxClass: 'icheckbox_square-green',
                        radioClass: 'iradio_square-green'
                    }).on('ifChanged', function (e) {

                        // Get the  field name
                        var isChecked = e.currentTarget.checked;
                        var nombre = e.currentTarget.id;
                        if (nombre.indexOf("solicitarRepuestoBD") != -1) {
                            if (isChecked == true) {
                                sumarprecio(e.currentTarget.value);
                            }
                            else {
                                restarprecio(e.currentTarget.value);
                            }
                        }
                    });

                  
                }
            });
        }


        function addCommas(nStr) {

            nStr += '';
            x = nStr.split('.');
            x1 = x[0];
            x2 = x.length > 1 ? `,${x[1]}` : '';
            const rgx = /(\d+)(\d{3})/;
            while (rgx.test(x1)) {
                x1 = x1.replace(rgx, '$1' + '.' + '$2');
            }
            return x1 + x2;

        }

        function colcoardatosplaca() {
            $.ajax({
                url: '/ordenTaller/BuscarVehiculoPorPlaca',
                data: {
                    placa: $('#placa').val()
                },
                type: 'post',
                dataType: 'json',
                cache: false,
                success: function (data) {
                    if (data.success == true) {
                        $('#placaNoEncontrada').hide();
                        $('#serieBuscado').text(data.buscarVehiculo.vin);
                        $('#numMotorBuscado').text(data.buscarVehiculo.nummot_vh);
                        $('#kilometrajeBuscado').text(data.buscarVehiculo.kilometraje);
                        $('#colorBuscado').text(data.buscarVehiculo.colvh_nombre);
                        $('#fechaVentaBuscado').text(data.buscarVehiculo.fecha_venta);
                        $('#fechaFinGarantiaBuscado').text(data.buscarVehiculo.fecha_fin_garantia);
                        $('.areaVehiculoOculta').show();
                        $('#areaPanelCliente').show();

                        // Validacion para propietario del vehiculo si existe
                        if (data.buscarVehiculo.propietario == null || data.buscarVehiculo.propietario == '') {
                            $('#documentoNoEncontrado').show();
                            $('#areaTxtBuscarDocumento').show();
                            $('.areaClienteOculta').hide();
                        } else {
                            $('#documentoNoEncontrado').hide();
                            $('#areaTxtBuscarDocumento').hide();
                            buscarCliente(data.buscarVehiculo.propietario);
                        }
                    } else {
                        $('#placaNoEncontrada').show();
                        $('.areaVehiculoOculta').hide();
                        $('#areaPanelCliente').hide();
                        $('#serieBuscado').text('');
                        $('#numMotorBuscado').text('');
                        $('#kilometrajeBuscado').text('');
                        $('#colorBuscado').text('');
                        $('#fechaVentaBuscado').text('');
                        $('#fechaFinGarantiaBuscado').text('');
                    }
                }
            });
        }
            
      function buscarCliente() {
            $.ajax({
                url: '/ordenTaller/BuscarClientePorDocumento',
                data: {
                    id_tercero: @ViewBag.tercero,
                    documento: $('#txtDocumentoCliente').val()
                },
                type: 'post',
                dataType: 'json',
                cache: false,
                success: function (data) {
                    if (data.success == true) {
                        $('#documentoNoEncontrado').hide();
                        $('#documentoBuscado').text(data.buscarCliente.doc_tercero);
                        $('#documentoBuscadoCliente').val(data.buscarCliente.doc_tercero);
                        $('#docTerceroBuscado').val(data.buscarCliente.tercero_id);
                        $('#nombreBuscado').text(data.buscarCliente.nombres);
                        $('#telefonoBuscado').text(data.buscarCliente.telf_tercero);
                        $('#celularBuscado').text(data.buscarCliente.celular_tercero);
                        $('#emailBuscado').text(data.buscarCliente.email_tercero);
                        $('#ciudadBuscado').text('');
                        $('.areaClienteOculta').show();

                        $('#tercero').val(data.buscarCliente.tercero_id);
                        $('#id_cliente').val(data.buscarCliente.cltercero_id);
                        //buscarContactosCliente(data.buscarCliente.tercero_id);
                    } else {
                        $('#documentoNoEncontrado').show();
                        $('.areaClienteOculta').hide();
                        $('#documentoBuscado').text('');
                        $('#nombreBuscado').text('');
                        $('#telefonoBuscado').text('');
                        $('#celularBuscado').text('');
                        $('#emailBuscado').text('');
                        $('#ciudadBuscado').text('');
                        $('#tercero').val('');
                    }
                }
            });
        }

    </script>
    @if (TempData["mensaje"] != null)
        {
        <script type="text/javascript">
            $('#modalOrdenCreada').show();
        </script>
        }
}

